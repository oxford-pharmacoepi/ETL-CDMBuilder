SELECT REPLACE(SOURCE_CODE, '.', '') SOURCE_CODE, TARGET_CONCEPT_ID 
FROM SOURCE_TO_CONCEPT_MAP 
WHERE TARGET_VOCABULARY_ID = 1 /*SNOMED*/ AND SOURCE_VOCABULARY_ID = 2 /*ICD9*/
		AND PRIMARY_MAP = 'Y' AND (INVALID_REASON IS NULL or INVALID_REASON = '') AND GETDATE() BETWEEN VALID_START_DATE and VALID_END_DATE
/*only pull valid ICD9 condition codes - only start with V/E/0-9 and between 3 to 6 char unless E then between 4 to 6*/ 
 AND ( 
 CASE 
 WHEN SUBSTRING(SOURCE_CODE, 1, 1) IN ('V','0','1','2','3','4','5','6','7','8','9') 
 AND LEN(SOURCE_CODE) BETWEEN 3 AND 6 THEN 1 

 WHEN SUBSTRING(SOURCE_CODE, 1, 1) IN ('E') 
 AND LEN(SOURCE_CODE) BETWEEN 4 AND 6 THEN 1 

 ELSE 0 
 END 
 ) = 1 
 /*since we have the decimals we have another method to cut out procedures*/ 
 AND ( 
 CASE 
 WHEN LEN(SOURCE_CODE) = 3 AND SOURCE_CODE NOT LIKE '%.%' THEN 1 
 WHEN LEN(SOURCE_CODE) BETWEEN 5 AND 6 AND SUBSTRING(SOURCE_CODE,4,1) IN ('.') THEN 1 
 WHEN SUBSTRING(SOURCE_CODE, 1, 1) IN ('E') THEN 
 CASE 
 WHEN LEN(SOURCE_CODE) = 4 AND SOURCE_CODE NOT LIKE '%.%' THEN 1 
 WHEN LEN(SOURCE_CODE) BETWEEN 6 AND 7 AND SUBSTRING(SOURCE_CODE,5,1) IN ('.') THEN 1 
 END 

 ELSE 0 
 END 
 ) = 1