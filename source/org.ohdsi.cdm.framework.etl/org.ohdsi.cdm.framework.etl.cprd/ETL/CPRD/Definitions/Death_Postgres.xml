<QueryDefinition>
	<Query>
		SELECT DISTINCT
			a.patid,
		case
			when a.frd &gt; b.uts then a.frd
				else b.uts 
			end as observation_period_start_date,
		case
			when a.tod is null then b.lcd
			when a.tod is not null and a.tod &lt; b.lcd  then a.tod
			when a.tod is not null and a.tod &gt;= b.lcd  then b.lcd
			else '23-DEC-2099' 
		end as observation_period_end_date,
			deathdate,
			toreason,
		CASE
			WHEN toreason = 1 and deathdate is not null and deathdate &gt; '1987-01-01' THEN 1
			ELSE 0
		END as DIED
		from pat as a
		join {sc}.practice b on a.pracid = b.pracid
		where deathdate is not null
	</Query>
	<Death>
		<DeathDefinition>
			<PersonId>patid</PersonId>
			<StartDate>deathdate</StartDate>
			<Died>DIED</Died>
			<Concepts>
				<Concept>
					<Fields>
						<Field key="toreason" defaultConceptId = "1" defaultTypeId = "38003569"/>
					</Fields>
				</Concept>
			</Concepts>
		</DeathDefinition>
	</Death>
</QueryDefinition>