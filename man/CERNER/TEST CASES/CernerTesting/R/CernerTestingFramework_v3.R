# Copyright 2017 Observational Health Data Sciences and Informatics
#
# This file is part of the CernerTesting package
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

#' Set up the testing framework
#'
#' @export

initFramework <- function() {
  insertDf <- data.frame(table = character(), sql = character(), stringsAsFactors = FALSE)
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_admission_source', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_admission_source;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_admission_type', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_admission_type;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_anesthesia_type', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_anesthesia_type;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_antimicrobial', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_antimicrobial;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_asa_class', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_asa_class;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_cancel_reason', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_cancel_reason;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_caresetting', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_caresetting;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_collection_src_site', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_collection_src_site;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_collection_status', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_collection_status;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_compliance_status', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_compliance_status;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_date', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_date;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_diagnosis', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_diagnosis;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_diagnosis_type', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_diagnosis_type;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_diagnostic_grouping', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_diagnostic_grouping;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_dischg_disp', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_dischg_disp;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_discontinue_reason', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_discontinue_reason;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_event_class', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_event_class;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_event_code', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_event_code;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_event_reltn', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_event_reltn;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_event_source', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_event_source;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_formulary_type', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_formulary_type;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_frequency', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_frequency;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_hospital', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_hospital;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_interp_result', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_interp_result;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_isolate', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_isolate;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_lab_procedure', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_lab_procedure;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_lab_result_type', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_lab_result_type;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_manufacturer', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_manufacturer;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_med_order_status', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_med_order_status;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_med_product', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_med_product;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_med_reason', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_med_reason;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_medication', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_medication;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_mic_order_status', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_mic_order_status;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_micro_result_type', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_micro_result_type;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_normalcy', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_normalcy;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_normalcy_method', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_normalcy_method;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_order_stop_type', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_order_stop_type;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_order_type', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_order_type;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_patient', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_patient;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_patient_type', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_patient_type;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_payer', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_payer;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_physician', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_physician;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_present_on_admit', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_present_on_admit;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_procedure', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_procedure;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_procedure_modifier', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_procedure_modifier;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_reporting_priority', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_reporting_priority;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_result_indicator', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_result_indicator;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_result_type_proc', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_result_type_proc;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_route_admin', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_route_admin;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_surgical_case_level', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_surgical_case_level;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_surgical_procedure', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_surgical_procedure;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_surgical_specialty', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_surgical_specialty;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_test_type', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_test_type;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_unit', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_unit;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_d_wound_class', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_d_wound_class;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_f_clinical_event', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_f_clinical_event;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_f_diagnosis', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_f_diagnosis;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_f_enc_history', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_f_enc_history;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_f_encounter', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_f_encounter;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_f_implant_log', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_f_implant_log;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_f_lab_procedure', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_f_lab_procedure;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_f_med_history', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_f_med_history;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_f_medication', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_f_medication;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_f_micro_susceptibility', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_f_micro_susceptibility;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_f_microbiology', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_f_microbiology;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_f_procedure', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_f_procedure;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_f_surgical_case', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_f_surgical_case;')
  insertDf[nrow(insertDf) + 1,] <- c('hf_f_surgical_procedure', 'TRUNCATE TABLE @nativeDatabaseSchema.hf_f_surgical_procedure;')
  assign('insertDf', insertDf, envir = globalenv())
  testSql <- c()
  testSql <- c(testSql, "IF OBJECT_ID('@cdmDatabaseSchema.test_results', 'U') IS NOT NULL DROP TABLE @cdmDatabaseSchema.test_results;")
  testSql <- c(testSql, '')
  testSql <- c(testSql, "CREATE TABLE @cdmDatabaseSchema.test_results (id INT, description VARCHAR(512), cdm_pid INT, source_pid INT, test VARCHAR(256), status VARCHAR(5));")
  testSql <- c(testSql, '')
  assign('testSql', testSql, envir = globalenv())
  assign('testId', 1, envir = globalenv())
  assign('testDescription', '', envir = globalenv())

  defaultValues <- new.env(parent = globalenv())
  assign('defaultValues', defaultValues, envir = globalenv())

  defaults <- list()
  assign('hf_d_admission_source', defaults, envir = defaultValues)

  defaults <- list()
  assign('hf_d_admission_type', defaults, envir = defaultValues)

  defaults <- list()
  assign('hf_d_anesthesia_type', defaults, envir = defaultValues)

  defaults <- list()
  defaults$drug_classification <- 'quinolones'
  assign('hf_d_antimicrobial', defaults, envir = defaultValues)

  defaults <- list()
  assign('hf_d_asa_class', defaults, envir = defaultValues)

  defaults <- list()
  assign('hf_d_cancel_reason', defaults, envir = defaultValues)

  defaults <- list()
  assign('hf_d_caresetting', defaults, envir = defaultValues)

  defaults <- list()
  assign('hf_d_collection_src_site', defaults, envir = defaultValues)

  defaults <- list()
  assign('hf_d_collection_status', defaults, envir = defaultValues)

  defaults <- list()
  assign('hf_d_compliance_status', defaults, envir = defaultValues)

  defaults <- list()
  defaults$year <- '2012'
  defaults$quarter <- '3'
  defaults$month <- '12'
  defaults$month_name <- 'JUL'
  defaults$day_number_in_month <- '22'
  defaults$week_number_in_year <- '44'
  defaults$day_of_week <- 'WEDNESDAY'
  defaults$day_number_of_week <- '1'
  defaults$holiday_ind <- '0'
  defaults$weekday_ind <- '1'
  assign('hf_d_date', defaults, envir = defaultValues)

  defaults <- list()
  defaults$diagnosis_type <- 'ICD10-CM'
  assign('hf_d_diagnosis', defaults, envir = defaultValues)

  defaults <- list()
  assign('hf_d_diagnosis_type', defaults, envir = defaultValues)

  defaults <- list()
  defaults$mdc_code <- '99'
  defaults$mdc_code_desc <- 'Unknown/Invalid'
  defaults$drg_code <- '999'
  defaults$drg_code_desc <- 'NULL'
  defaults$drg_id <- '1999'
  defaults$mdc_id <- '99'
  defaults$drg_type <- 'DRG'
  assign('hf_d_diagnostic_grouping', defaults, envir = defaultValues)

  defaults <- list()
  defaults$beg_effective_dt_tm <- '1800-01-01.000000'
  defaults$end_effective_dt_tm <- '2100-12-31.000000'
  assign('hf_d_dischg_disp', defaults, envir = defaultValues)

  defaults <- list()
  assign('hf_d_discontinue_reason', defaults, envir = defaultValues)

  defaults <- list()
  assign('hf_d_event_class', defaults, envir = defaultValues)

  defaults <- list()
  defaults$event_code_display <- 'Braden Scale'
  defaults$event_code_group <- 'Blood Gas Test'
  defaults$event_code_category <- 'Vital Sign'
  assign('hf_d_event_code', defaults, envir = defaultValues)

  defaults <- list()
  assign('hf_d_event_reltn', defaults, envir = defaultValues)

  defaults <- list()
  assign('hf_d_event_source', defaults, envir = defaultValues)

  defaults <- list()
  assign('hf_d_formulary_type', defaults, envir = defaultValues)

  defaults <- list()
  assign('hf_d_frequency', defaults, envir = defaultValues)

  defaults <- list()
  defaults$census_region <- 'South'
  defaults$census_division <- '6'
  defaults$bed_size_range <- '<5'
  defaults$teaching_facility_ind <- '0'
  defaults$cath_lab_full_ind <- '0'
  defaults$cath_lab_diagnostic_ind <- '0'
  defaults$urban_rural_status <- 'Urban'
  defaults$acute_status <- 'Acute'
  defaults$alt_health_system_id <- '79'
  assign('hf_d_hospital', defaults, envir = defaultValues)

  defaults <- list()
  assign('hf_d_interp_result', defaults, envir = defaultValues)

  defaults <- list()
  defaults$isolate_type <- 'Bacteria'
  defaults$isolate_category <- 'Salmonella'
  defaults$isolate_rept_category <- 'Salmonella'
  assign('hf_d_isolate', defaults, envir = defaultValues)

  defaults <- list()
  defaults$lab_procedure_group <- 'Allergy Test'
  defaults$lab_super_group <- 'General Test'
  assign('hf_d_lab_procedure', defaults, envir = defaultValues)

  defaults <- list()
  assign('hf_d_lab_result_type', defaults, envir = defaultValues)

  defaults <- list()
  assign('hf_d_manufacturer', defaults, envir = defaultValues)

  defaults <- list()
  assign('hf_d_med_order_status', defaults, envir = defaultValues)

  defaults <- list()
  defaults$drug_code <- 'd03770'
  defaults$drug_desc <- 'emollients, topical'
  assign('hf_d_med_product', defaults, envir = defaultValues)

  defaults <- list()
  assign('hf_d_med_reason', defaults, envir = defaultValues)

  defaults <- list()
  defaults$brand_name <- 'Ibuprofen'
  defaults$generic_name <- 'ibuprofen'
  defaults$route_description <- 'oral'
  defaults$dose_form_description <- 'tablet'
  assign('hf_d_medication', defaults, envir = defaultValues)

  defaults <- list()
  assign('hf_d_mic_order_status', defaults, envir = defaultValues)

  defaults <- list()
  defaults$test_type <- 'Microbiology'
  assign('hf_d_micro_result_type', defaults, envir = defaultValues)

  defaults <- list()
  assign('hf_d_normalcy', defaults, envir = defaultValues)

  defaults <- list()
  assign('hf_d_normalcy_method', defaults, envir = defaultValues)

  defaults <- list()
  assign('hf_d_order_stop_type', defaults, envir = defaultValues)

  defaults <- list()
  assign('hf_d_order_type', defaults, envir = defaultValues)

  defaults <- list()
  defaults$race <- 'Caucasian'
  defaults$gender <- 'Female'
  defaults$marital_status <- 'Single'
  assign('hf_d_patient', defaults, envir = defaultValues)

  defaults <- list()
  assign('hf_d_patient_type', defaults, envir = defaultValues)

  defaults <- list()
  assign('hf_d_payer', defaults, envir = defaultValues)

  defaults <- list()
  defaults$medical_specialty <- 'NULL'
  assign('hf_d_physician', defaults, envir = defaultValues)

  defaults <- list()
  assign('hf_d_present_on_admit', defaults, envir = defaultValues)

  defaults <- list()
  defaults$procedure_type <- 'ICD10-PCS'
  defaults$procedure_code <- '043EECA7-F13'
  defaults$procedure_description <- 'CPT'
  assign('hf_d_procedure', defaults, envir = defaultValues)

  defaults <- list()
  assign('hf_d_procedure_modifier', defaults, envir = defaultValues)

  defaults <- list()
  assign('hf_d_reporting_priority', defaults, envir = defaultValues)

  defaults <- list()
  assign('hf_d_result_indicator', defaults, envir = defaultValues)

  defaults <- list()
  assign('hf_d_result_type_proc', defaults, envir = defaultValues)

  defaults <- list()
  assign('hf_d_route_admin', defaults, envir = defaultValues)

  defaults <- list()
  assign('hf_d_surgical_case_level', defaults, envir = defaultValues)

  defaults <- list()
  defaults$order_type <- 'Surgery'
  assign('hf_d_surgical_procedure', defaults, envir = defaultValues)

  defaults <- list()
  assign('hf_d_surgical_specialty', defaults, envir = defaultValues)

  defaults <- list()
  assign('hf_d_test_type', defaults, envir = defaultValues)

  defaults <- list()
  assign('hf_d_unit', defaults, envir = defaultValues)

  defaults <- list()
  assign('hf_d_wound_class', defaults, envir = defaultValues)

  defaults <- list()
  defaults$encounter_id <- '634785782'
  defaults$lab_procedure_id <- '23'
  defaults$event_code_id <- '226'
  defaults$event_class_id <- '15'
  defaults$event_end_dt_tm <- '2010-02-19 14:44:00.000000'
  defaults$event_end_dt_id <- '7285'
  defaults$event_reltn_id <- '4'
  defaults$event_start_dt_id <- '4019'
  defaults$event_expiration_dt_id <- '4019'
  defaults$event_normalcy_id <- '-1'
  defaults$event_normalcy_method_id <- '-1'
  defaults$performed_dt_id <- '4019'
  defaults$performed_prsnl_id <- '-9'
  defaults$result_normalcy_flg <- '0'
  defaults$result_time_unit_id <- '250'
  defaults$result_units_id <- '250'
  defaults$result_value_dt_id <- '4019'
  defaults$result_feasible_ind <- '0'
  defaults$result_inaccurate_ind <- '0'
  defaults$event_source_id <- '-1'
  defaults$verified_dt_id <- '4019'
  defaults$verified_prsnl_id <- '-9'
  #defaults$_extractyear <- '2014'
  assign('hf_f_clinical_event', defaults, envir = defaultValues)

  defaults <- list()
  defaults$encounter_id <- '357148349'
  defaults$diagnosis_id <- '7278'
  defaults$diagnosis_priority <- '1'
  defaults$diagnosis_type_id <- '83'
  defaults$present_on_admit_id <- '6'
  defaults$third_party_ind <- '0'
  #defaults$_extractyear <- '2014'
  assign('hf_f_diagnosis', defaults, envir = defaultValues)

  defaults <- list()
  defaults$encounter_id <- '634785782'
  defaults$patient_type_id <- '98'
  defaults$caresetting_id <- '16'
  defaults$begin_dt_tm <- '2014-01-08 12:00:00.000000'
  defaults$end_dt_tm <- '2014-01-08 12:00:00.000000'
  defaults$begin_dt_id <- '7739'
  defaults$end_dt_id <- '7740'
  #defaults$_extractyear <- '2014'
  assign('hf_f_enc_history', defaults, envir = defaultValues)

  defaults <- list()
  defaults$hospital_id <- '84'
  defaults$admitting_physician_id <- '-1'
  defaults$discharge_caresetting_id <- '16'
  defaults$patient_type_id <- '98'
  defaults$admitted_dt_id <- '4019'
  defaults$discharged_dt_id <- '4019'
  defaults$discharge_disposition_id <- '1'
  defaults$diagnostic_grouping_id <- '1'
  defaults$admission_source_id <- '1'
  defaults$admission_type_id <- '6'
  defaults$payer_id <- '22'
  defaults$total_charges <- '0.000000'
  defaults$billing_ind <- '1'
  defaults$weight_unit_id <- '250'
  defaults$discharged_dt_tm <- '2014-01-08.000000'
  defaults$admitted_tm_valid_ind <- '1'
  defaults$discharged_tm_valid_ind <- '1'
  #defaults$_extractyear <- '2014'
  assign('hf_f_encounter', defaults, envir = defaultValues)

  defaults <- list()
  defaults$manufacturer_id <- '-9'
  defaults$expiration_dt_id <- '4019'
  defaults$surgical_case_id <- '6021842'
  defaults$encounter_id <- '360742999'
  #defaults$_extractyear <- '2016'
  assign('hf_f_implant_log', defaults, envir = defaultValues)

  defaults <- list()
  defaults$encounter_id <- '634818260'
  defaults$detail_lab_procedure_id <- '39'
  defaults$order_lab_procedure_id <- '526'
  defaults$lab_order_caresetting_id <- '16'
  defaults$reporting_priority_id <- '1'
  defaults$lab_result_type_id <- '7'
  defaults$result_indicator_id <- '8'
  defaults$lab_ordered_dt_id <- '4019'
  defaults$lab_drawn_dt_id <- '4019'
  defaults$lab_received_dt_id <- '4019'
  defaults$lab_completed_dt_id <- '4019'
  defaults$lab_cancelled_dt_id <- '4019'
  defaults$lab_verified_dt_id <- '4019'
  defaults$date_result_id <- '4019.000000'
  defaults$result_units_id <- '250.0'
  defaults$lab_ordered_tm_vld_flg <- '1'
  defaults$lab_drawn_tm_vld_flg <- '1'
  defaults$lab_received_tm_vld_flg <- '1'
  defaults$lab_completed_tm_vld_flg <- '1'
  defaults$lab_cancelled_tm_vld_flg <- '0'
  defaults$lab_verified_tm_vld_flg <- '1'
  defaults$lab_performed_tm_vld_flg <- '1'
  defaults$lab_performed_caresetting_id <- '174'
  defaults$collection_source_id <- '522'
  assign('hf_f_lab_procedure', defaults, envir = defaultValues)

  defaults <- list()
  defaults$encounter_id <- '634785782'
  defaults$ordering_physician_id <- '-1'
  defaults$med_history_flg <- '1'
  defaults$req_start_dt_id <- '4019'
  defaults$route_administration_id <- '57'
  defaults$order_stop_type_id <- '4'
  defaults$med_stopped_dt_id <- '4019'
  defaults$frequency_id <- '111'
  defaults$order_strength_units_id <- '250'
  defaults$order_volume_units_id <- '250'
  defaults$duration_unit_id <- '250'
  defaults$next_dose_dt_id <- '4019'
  defaults$infusion_rate_units_id <- '250'
  defaults$med_reason_id <- '-1'
  defaults$cancel_reason_id <- '-1'
  defaults$dispensed_quantity_units_id <- '250'
  defaults$compliance_status_id <- '-1'
  defaults$med_entered_dt_id <- '7738'
  defaults$med_entered_tm_vld_flg <- '1'
  defaults$med_product_id <- '791'
  #defaults$_extractyear <- '2014'
  assign('hf_f_med_history', defaults, envir = defaultValues)

  defaults <- list()
  defaults$encounter_id <- '120885265'
  defaults$medication_id <- '14883'
  defaults$med_dispensed_caresetting_id <- '174'
  defaults$med_request_caresetting_id <- '174'
  defaults$discontinue_reason_id <- '1'
  defaults$route_administration_id <- '56'
  defaults$formulary_type_id <- '1'
  defaults$frequency_id <- '110'
  defaults$order_stop_type_id <- '2'
  defaults$order_type_id <- '4'
  defaults$med_order_status_id <- '4'
  defaults$med_started_dt_id <- '7187'
  defaults$med_entered_dt_id <- '7187'
  defaults$med_stopped_dt_id <- '4019'
  defaults$med_discontinued_dt_id <- '4019'
  defaults$total_dispensed_doses <- '0.0'
  defaults$dose_quantity <- '1.0'
  defaults$initial_dose_quantity <- '0.0'
  defaults$dose_units_id <- '39'
  defaults$charge_quantity <- '0.0'
  defaults$credit_quantity <- '0.0'
  defaults$infusion_rate <- '0.0'
  defaults$infusion_time_units_id <- '250'
  defaults$order_strength_units_id <- '174'
  defaults$order_volume <- '1.0'
  defaults$order_volume_units_id <- '162'
  defaults$med_started_dt_tm <- '2011-05-22 08:42:00.000000'
  defaults$med_started_tm_valid_flg <- '1'
  defaults$med_entered_tm_valid_flg <- '1'
  defaults$med_stopped_tm_valid_flg <- '1'
  defaults$med_discontinued_tm_valid_flg <- '1'
  #defaults$_extractyear <- '2014'
  assign('hf_f_medication', defaults, envir = defaultValues)

  defaults <- list()
  defaults$encounter_id <- '252004367'
  defaults$order_lab_procedure_id <- '337'
  defaults$test_type_id <- '1'
  defaults$isolate_id <- '2211'
  defaults$antimicrobial_id <- '87'
  defaults$interp_result_id <- '8'
  defaults$interp_perf_dt_id <- '4019'
  defaults$interp_perf_tm_vld_flg <- '0'
  defaults$interp_verf_dt_id <- '4019'
  defaults$interp_verf_tm_vld_flg <- '1'
  defaults$numeric_result <- '0'
  defaults$numeric_result_perf_dt_id <- '4019'
  defaults$numeric_result_perf_tm_vld_flg <- '0'
  defaults$numeric_result_verf_dt_id <- '4019'
  defaults$numeric_result_verf_tm_vld_flg <- '1'
  defaults$result_units_id <- '250'
  defaults$collection_source_id <- '411'
  defaults$collection_site_id <- '522'
  #defaults$_extractyear <- '2014'
  assign('hf_f_micro_susceptibility', defaults, envir = defaultValues)

  defaults <- list()
  defaults$encounter_id <- '633921645'
  defaults$order_lab_procedure_id <- '76'
  defaults$isolate_id <- '2521'
  defaults$micro_order_caresetting_id <- '25'
  defaults$micro_result_type_id <- '2'
  defaults$result_type_procedure_id <- '24'
  defaults$collection_source_id <- '29'
  defaults$collection_site_id <- '522'
  defaults$reporting_priority_id <- '1'
  defaults$micro_order_status_id <- '3'
  defaults$collection_status_id <- '14'
  defaults$micro_lab_ordered_dt_id <- '7129'
  defaults$micro_lab_drawn_dt_id <- '4019'
  defaults$micro_lab_received_dt_id <- '4019'
  defaults$micro_lab_completed_dt_id <- '4019'
  defaults$micro_lab_cancelled_dt_id <- '4019'
  defaults$first_report_entered_dt_id <- '4019'
  defaults$last_report_updated_dt_id <- '4019'
  defaults$total_report_updates <- '1'
  defaults$micro_lab_drawn_tm_vld_flg <- '1'
  defaults$micro_lab_received_tm_vld_flg <- '1'
  defaults$micro_lab_complted_tm_vld_flg <- '1'
  defaults$micro_lab_cancelled_tm_vld_flg <- '1'
  defaults$first_rpt_entered_tm_vld_flg <- '0'
  #defaults$_extractyear <- '2013'
  assign('hf_f_microbiology', defaults, envir = defaultValues)

  defaults <- list()
  defaults$encounter_id <- '552617023'
  defaults$procedure_id <- '2616'
  defaults$procedure_dt_id <- '4019'
  defaults$procedure_priority <- '1'
  defaults$third_party_ind <- '0'
  #defaults$_extractyear <- '2014'
  assign('hf_f_procedure', defaults, envir = defaultValues)

  defaults <- list()
  defaults$encounter_id <- '403688293'
  defaults$case_level_id <- '-9'
  defaults$case_start_dt_id <- '4019'
  defaults$case_stop_dt_id <- '4019'
  defaults$case_duration <- '10'
  defaults$scheduled_case_start_dt_id <- '4019'
  defaults$scheduled_case_stop_dt_id <- '4019'
  defaults$scheduled_case_duration <- '60'
  defaults$case_specialty_id <- '-9'
  defaults$case_completed_ind <- '1'
  defaults$case_cancelled_dt_id <- '4019'
  defaults$case_cancelled_reason_id <- '-1'
  defaults$case_closing_start_dt_id <- '4019'
  defaults$transport_requested_dt_id <- '4019'
  defaults$operating_room_setup_dt_id <- '4019'
  defaults$operating_room_ready_dt_id <- '4019'
  defaults$patient_in_preop_hold_dt_id <- '4019'
  defaults$patient_out_preop_hold_dt_id <- '4019'
  defaults$preop_antibiotic_admin_dt_id <- '4019'
  defaults$patient_out_oper_room_dt_id <- '4019'
  defaults$anesthesia_start_dt_id <- '4019'
  defaults$anesthesia_induct_dt_id <- '4019'
  defaults$anesthesia_stop_dt_id <- '4019'
  defaults$surgeon_in_oper_room_dt_id <- '4019'
  defaults$patient_in_pacu_dt_id <- '4019'
  defaults$patient_out_pacu_dt_id <- '4019'
  defaults$patient_in_pacu_ii_dt_id <- '4019'
  defaults$patient_out_pacu_ii_dt_id <- '4019'
  defaults$patient_in_oper_room_dt_id <- '4019'
  #defaults$_extractyear <- '2013'
  assign('hf_f_surgical_case', defaults, envir = defaultValues)

  defaults <- list()
  defaults$encounter_id <- '508089715'
  defaults$surgical_procedure_id <- '-9'
  defaults$wound_class_id <- '2'
  defaults$asa_class_id <- '3'
  defaults$procedure_specialty_id <- '17'
  defaults$procedure_revision_ind <- '0'
  defaults$procedure_modifier_01_id <- '-1'
  defaults$procedure_modifier_02_id <- '-1'
  defaults$procedure_modifier_03_id <- '-1'
  defaults$procedure_duration <- '10'
  defaults$procedure_start_dt_tm <- '2012-06-21 13:37:00.000000'
  defaults$procedure_start_dt_id <- '7265'
  defaults$procedure_stop_dt_id <- '7265'
  defaults$primary_procedure_ind <- '1'
  defaults$scheduled_procedure_duration <- '0'
  defaults$procedure_completion_ind <- '1'
  defaults$concurrent_procedure_ind <- '0'
  defaults$anesthesia_type_id <- '7'
  defaults$expected_case_level_id <- '-1'
  defaults$case_level_id <- '9'
  #defaults$_extractyear <- '2014'
  assign('hf_f_surgical_procedure', defaults, envir = defaultValues)
}

initFramework()

generateInsertSql <- function()
{
  insertSql <<- c()
  tables <- unique(insertDf$table)
  lapply(tables, function(t) {
    insertSql <<- c(insertSql, subset(insertDf, table == t)$sql)
  })
  insertSql
}

declareTest <- function(description, source_pid = NULL, cdm_pid = NULL) {
  testId <- 0
  if (exists('testId', where = globalenv()))
  {
    testId <- get('testId', envir = globalenv())
  }

  assign('testId', testId + 1, envir = globalenv())
  assign('testDescription', description, envir = globalenv())
  assign('testNewAdded', TRUE, envir = globalenv())
  assign('testNewExpected', TRUE, envir = globalenv())

  assign('source_pid', source_pid, envir = globalenv())
  assign('cdm_pid', cdm_pid, envir = globalenv())

  groupItemIndex <- 0
  if (exists('groupItemIndex', where = globalenv()))
  {
    groupItemIndex <- get("groupItemIndex", envir = globalenv())
  }
  assign('groupItemIndex', groupItemIndex + 1, envir = globalenv())
}

declareTestGroup <- function(groupName)
{
  groupIndex <- 0
  if (exists('groupIndex', where = globalenv()))
  {
    groupIndex <- get("groupIndex", envir = globalenv())
  }
  assign('groupIndex', groupIndex + 1, envir = globalenv())
  assign('currentGroup', groupName, envir = globalenv())
  assign('groupItemIndex', -1, envir = globalenv())
}

set_defaults_hf_d_admission_source <- function(admission_source_id, admission_source_code, admission_source_code_desc) {
  defaults <- get('hf_d_admission_source', envir = defaultValues)
  if (!missing(admission_source_id)) {
    defaults$admission_source_id <- admission_source_id
  }
  if (!missing(admission_source_code)) {
    defaults$admission_source_code <- admission_source_code
  }
  if (!missing(admission_source_code_desc)) {
    defaults$admission_source_code_desc <- admission_source_code_desc
  }
  assign('hf_d_admission_source', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_admission_type <- function(admission_type_id, admission_type_code, admission_type_code_desc) {
  defaults <- get('hf_d_admission_type', envir = defaultValues)
  if (!missing(admission_type_id)) {
    defaults$admission_type_id <- admission_type_id
  }
  if (!missing(admission_type_code)) {
    defaults$admission_type_code <- admission_type_code
  }
  if (!missing(admission_type_code_desc)) {
    defaults$admission_type_code_desc <- admission_type_code_desc
  }
  assign('hf_d_admission_type', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_anesthesia_type <- function(anesthesia_type_id, anesthesia_type_desc) {
  defaults <- get('hf_d_anesthesia_type', envir = defaultValues)
  if (!missing(anesthesia_type_id)) {
    defaults$anesthesia_type_id <- anesthesia_type_id
  }
  if (!missing(anesthesia_type_desc)) {
    defaults$anesthesia_type_desc <- anesthesia_type_desc
  }
  assign('hf_d_anesthesia_type', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_antimicrobial <- function(antimicrobial_id, antimicrobial_dcode, antimicrobial_desc, drug_classification, antibiogram_class, antimicrobial_mnemonic, loinc_long, loinc_short) {
  defaults <- get('hf_d_antimicrobial', envir = defaultValues)
  if (!missing(antimicrobial_id)) {
    defaults$antimicrobial_id <- antimicrobial_id
  }
  if (!missing(antimicrobial_dcode)) {
    defaults$antimicrobial_dcode <- antimicrobial_dcode
  }
  if (!missing(antimicrobial_desc)) {
    defaults$antimicrobial_desc <- antimicrobial_desc
  }
  if (!missing(drug_classification)) {
    defaults$drug_classification <- drug_classification
  }
  if (!missing(antibiogram_class)) {
    defaults$antibiogram_class <- antibiogram_class
  }
  if (!missing(antimicrobial_mnemonic)) {
    defaults$antimicrobial_mnemonic <- antimicrobial_mnemonic
  }
  if (!missing(loinc_long)) {
    defaults$loinc_long <- loinc_long
  }
  if (!missing(loinc_short)) {
    defaults$loinc_short <- loinc_short
  }
  assign('hf_d_antimicrobial', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_asa_class <- function(asa_class_id, asa_class_code, asa_class_desc) {
  defaults <- get('hf_d_asa_class', envir = defaultValues)
  if (!missing(asa_class_id)) {
    defaults$asa_class_id <- asa_class_id
  }
  if (!missing(asa_class_code)) {
    defaults$asa_class_code <- asa_class_code
  }
  if (!missing(asa_class_desc)) {
    defaults$asa_class_desc <- asa_class_desc
  }
  assign('hf_d_asa_class', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_cancel_reason <- function(cancel_reason_id, cancel_reason_desc) {
  defaults <- get('hf_d_cancel_reason', envir = defaultValues)
  if (!missing(cancel_reason_id)) {
    defaults$cancel_reason_id <- cancel_reason_id
  }
  if (!missing(cancel_reason_desc)) {
    defaults$cancel_reason_desc <- cancel_reason_desc
  }
  assign('hf_d_cancel_reason', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_caresetting <- function(caresetting_id, caresetting_desc) {
  defaults <- get('hf_d_caresetting', envir = defaultValues)
  if (!missing(caresetting_id)) {
    defaults$caresetting_id <- caresetting_id
  }
  if (!missing(caresetting_desc)) {
    defaults$caresetting_desc <- caresetting_desc
  }
  assign('hf_d_caresetting', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_collection_src_site <- function(collection_source_site_id, snomed_code, collection_source_site_desc, source_type) {
  defaults <- get('hf_d_collection_src_site', envir = defaultValues)
  if (!missing(collection_source_site_id)) {
    defaults$collection_source_site_id <- collection_source_site_id
  }
  if (!missing(snomed_code)) {
    defaults$snomed_code <- snomed_code
  }
  if (!missing(collection_source_site_desc)) {
    defaults$collection_source_site_desc <- collection_source_site_desc
  }
  if (!missing(source_type)) {
    defaults$source_type <- source_type
  }
  assign('hf_d_collection_src_site', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_collection_status <- function(collection_status_id, collection_status_code, collection_status_desc) {
  defaults <- get('hf_d_collection_status', envir = defaultValues)
  if (!missing(collection_status_id)) {
    defaults$collection_status_id <- collection_status_id
  }
  if (!missing(collection_status_code)) {
    defaults$collection_status_code <- collection_status_code
  }
  if (!missing(collection_status_desc)) {
    defaults$collection_status_desc <- collection_status_desc
  }
  assign('hf_d_collection_status', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_compliance_status <- function(compliance_status_id, compliance_desc) {
  defaults <- get('hf_d_compliance_status', envir = defaultValues)
  if (!missing(compliance_status_id)) {
    defaults$compliance_status_id <- compliance_status_id
  }
  if (!missing(compliance_desc)) {
    defaults$compliance_desc <- compliance_desc
  }
  assign('hf_d_compliance_status', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_date <- function(date_id, year, quarter, month, month_name, day_number_in_month, week_number_in_year, day_of_week, day_number_of_week, holiday_ind, weekday_ind) {
  defaults <- get('hf_d_date', envir = defaultValues)
  if (!missing(date_id)) {
    defaults$date_id <- date_id
  }
  if (!missing(year)) {
    defaults$year <- year
  }
  if (!missing(quarter)) {
    defaults$quarter <- quarter
  }
  if (!missing(month)) {
    defaults$month <- month
  }
  if (!missing(month_name)) {
    defaults$month_name <- month_name
  }
  if (!missing(day_number_in_month)) {
    defaults$day_number_in_month <- day_number_in_month
  }
  if (!missing(week_number_in_year)) {
    defaults$week_number_in_year <- week_number_in_year
  }
  if (!missing(day_of_week)) {
    defaults$day_of_week <- day_of_week
  }
  if (!missing(day_number_of_week)) {
    defaults$day_number_of_week <- day_number_of_week
  }
  if (!missing(holiday_ind)) {
    defaults$holiday_ind <- holiday_ind
  }
  if (!missing(weekday_ind)) {
    defaults$weekday_ind <- weekday_ind
  }
  assign('hf_d_date', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_diagnosis <- function(diagnosis_id, diagnosis_type, diagnosis_code, diagnosis_description) {
  defaults <- get('hf_d_diagnosis', envir = defaultValues)
  if (!missing(diagnosis_id)) {
    defaults$diagnosis_id <- diagnosis_id
  }
  if (!missing(diagnosis_type)) {
    defaults$diagnosis_type <- diagnosis_type
  }
  if (!missing(diagnosis_code)) {
    defaults$diagnosis_code <- diagnosis_code
  }
  if (!missing(diagnosis_description)) {
    defaults$diagnosis_description <- diagnosis_description
  }
  assign('hf_d_diagnosis', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_diagnosis_type <- function(diagnosis_type_id, diagnosis_type_display) {
  defaults <- get('hf_d_diagnosis_type', envir = defaultValues)
  if (!missing(diagnosis_type_id)) {
    defaults$diagnosis_type_id <- diagnosis_type_id
  }
  if (!missing(diagnosis_type_display)) {
    defaults$diagnosis_type_display <- diagnosis_type_display
  }
  assign('hf_d_diagnosis_type', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_diagnostic_grouping <- function(diagnostic_grouping_id, mdc_code, mdc_code_desc, drg_code, drg_code_desc, drg_id, mdc_id, drg_type) {
  defaults <- get('hf_d_diagnostic_grouping', envir = defaultValues)
  if (!missing(diagnostic_grouping_id)) {
    defaults$diagnostic_grouping_id <- diagnostic_grouping_id
  }
  if (!missing(mdc_code)) {
    defaults$mdc_code <- mdc_code
  }
  if (!missing(mdc_code_desc)) {
    defaults$mdc_code_desc <- mdc_code_desc
  }
  if (!missing(drg_code)) {
    defaults$drg_code <- drg_code
  }
  if (!missing(drg_code_desc)) {
    defaults$drg_code_desc <- drg_code_desc
  }
  if (!missing(drg_id)) {
    defaults$drg_id <- drg_id
  }
  if (!missing(mdc_id)) {
    defaults$mdc_id <- mdc_id
  }
  if (!missing(drg_type)) {
    defaults$drg_type <- drg_type
  }
  assign('hf_d_diagnostic_grouping', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_dischg_disp <- function(dischg_disp_id, dischg_disp_code, dischg_disp_code_desc, beg_effective_dt_tm, end_effective_dt_tm) {
  defaults <- get('hf_d_dischg_disp', envir = defaultValues)
  if (!missing(dischg_disp_id)) {
    defaults$dischg_disp_id <- dischg_disp_id
  }
  if (!missing(dischg_disp_code)) {
    defaults$dischg_disp_code <- dischg_disp_code
  }
  if (!missing(dischg_disp_code_desc)) {
    defaults$dischg_disp_code_desc <- dischg_disp_code_desc
  }
  if (!missing(beg_effective_dt_tm)) {
    defaults$beg_effective_dt_tm <- beg_effective_dt_tm
  }
  if (!missing(end_effective_dt_tm)) {
    defaults$end_effective_dt_tm <- end_effective_dt_tm
  }
  assign('hf_d_dischg_disp', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_discontinue_reason <- function(discontinue_reason_id, discontinue_reason_code, discontinue_reason_desc) {
  defaults <- get('hf_d_discontinue_reason', envir = defaultValues)
  if (!missing(discontinue_reason_id)) {
    defaults$discontinue_reason_id <- discontinue_reason_id
  }
  if (!missing(discontinue_reason_code)) {
    defaults$discontinue_reason_code <- discontinue_reason_code
  }
  if (!missing(discontinue_reason_desc)) {
    defaults$discontinue_reason_desc <- discontinue_reason_desc
  }
  assign('hf_d_discontinue_reason', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_event_class <- function(event_class_id, event_class_desc) {
  defaults <- get('hf_d_event_class', envir = defaultValues)
  if (!missing(event_class_id)) {
    defaults$event_class_id <- event_class_id
  }
  if (!missing(event_class_desc)) {
    defaults$event_class_desc <- event_class_desc
  }
  assign('hf_d_event_class', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_event_code <- function(event_code_id, event_code_desc, event_code_display, event_code_group, event_code_category) {
  defaults <- get('hf_d_event_code', envir = defaultValues)
  if (!missing(event_code_id)) {
    defaults$event_code_id <- event_code_id
  }
  if (!missing(event_code_desc)) {
    defaults$event_code_desc <- event_code_desc
  }
  if (!missing(event_code_display)) {
    defaults$event_code_display <- event_code_display
  }
  if (!missing(event_code_group)) {
    defaults$event_code_group <- event_code_group
  }
  if (!missing(event_code_category)) {
    defaults$event_code_category <- event_code_category
  }
  assign('hf_d_event_code', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_event_reltn <- function(event_reltn_id, event_reltn_desc) {
  defaults <- get('hf_d_event_reltn', envir = defaultValues)
  if (!missing(event_reltn_id)) {
    defaults$event_reltn_id <- event_reltn_id
  }
  if (!missing(event_reltn_desc)) {
    defaults$event_reltn_desc <- event_reltn_desc
  }
  assign('hf_d_event_reltn', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_event_source <- function(event_source_id, event_source_desc) {
  defaults <- get('hf_d_event_source', envir = defaultValues)
  if (!missing(event_source_id)) {
    defaults$event_source_id <- event_source_id
  }
  if (!missing(event_source_desc)) {
    defaults$event_source_desc <- event_source_desc
  }
  assign('hf_d_event_source', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_formulary_type <- function(formulary_type_id, formulary_type_code, formulary_type_desc) {
  defaults <- get('hf_d_formulary_type', envir = defaultValues)
  if (!missing(formulary_type_id)) {
    defaults$formulary_type_id <- formulary_type_id
  }
  if (!missing(formulary_type_code)) {
    defaults$formulary_type_code <- formulary_type_code
  }
  if (!missing(formulary_type_desc)) {
    defaults$formulary_type_desc <- formulary_type_desc
  }
  assign('hf_d_formulary_type', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_frequency <- function(frequency_id, frequency_disp, frequency_desc) {
  defaults <- get('hf_d_frequency', envir = defaultValues)
  if (!missing(frequency_id)) {
    defaults$frequency_id <- frequency_id
  }
  if (!missing(frequency_disp)) {
    defaults$frequency_disp <- frequency_disp
  }
  if (!missing(frequency_desc)) {
    defaults$frequency_desc <- frequency_desc
  }
  assign('hf_d_frequency', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_hospital <- function(hospital_id, census_region, census_division, bed_size_range, teaching_facility_ind, cath_lab_full_ind, cath_lab_diagnostic_ind, urban_rural_status, acute_status, alt_hospital_id, alt_health_system_id) {
  defaults <- get('hf_d_hospital', envir = defaultValues)
  if (!missing(hospital_id)) {
    defaults$hospital_id <- hospital_id
  }
  if (!missing(census_region)) {
    defaults$census_region <- census_region
  }
  if (!missing(census_division)) {
    defaults$census_division <- census_division
  }
  if (!missing(bed_size_range)) {
    defaults$bed_size_range <- bed_size_range
  }
  if (!missing(teaching_facility_ind)) {
    defaults$teaching_facility_ind <- teaching_facility_ind
  }
  if (!missing(cath_lab_full_ind)) {
    defaults$cath_lab_full_ind <- cath_lab_full_ind
  }
  if (!missing(cath_lab_diagnostic_ind)) {
    defaults$cath_lab_diagnostic_ind <- cath_lab_diagnostic_ind
  }
  if (!missing(urban_rural_status)) {
    defaults$urban_rural_status <- urban_rural_status
  }
  if (!missing(acute_status)) {
    defaults$acute_status <- acute_status
  }
  if (!missing(alt_hospital_id)) {
    defaults$alt_hospital_id <- alt_hospital_id
  }
  if (!missing(alt_health_system_id)) {
    defaults$alt_health_system_id <- alt_health_system_id
  }
  assign('hf_d_hospital', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_interp_result <- function(interp_result_id, interp_result_desc) {
  defaults <- get('hf_d_interp_result', envir = defaultValues)
  if (!missing(interp_result_id)) {
    defaults$interp_result_id <- interp_result_id
  }
  if (!missing(interp_result_desc)) {
    defaults$interp_result_desc <- interp_result_desc
  }
  assign('hf_d_interp_result', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_isolate <- function(isolate_id, isolate_name, isolate_type, isolate_category, isolate_group, isolate_rept_category, phin_loinc_code, alt_loinc_code, snomed_code, snomedct_code) {
  defaults <- get('hf_d_isolate', envir = defaultValues)
  if (!missing(isolate_id)) {
    defaults$isolate_id <- isolate_id
  }
  if (!missing(isolate_name)) {
    defaults$isolate_name <- isolate_name
  }
  if (!missing(isolate_type)) {
    defaults$isolate_type <- isolate_type
  }
  if (!missing(isolate_category)) {
    defaults$isolate_category <- isolate_category
  }
  if (!missing(isolate_group)) {
    defaults$isolate_group <- isolate_group
  }
  if (!missing(isolate_rept_category)) {
    defaults$isolate_rept_category <- isolate_rept_category
  }
  if (!missing(phin_loinc_code)) {
    defaults$phin_loinc_code <- phin_loinc_code
  }
  if (!missing(alt_loinc_code)) {
    defaults$alt_loinc_code <- alt_loinc_code
  }
  if (!missing(snomed_code)) {
    defaults$snomed_code <- snomed_code
  }
  if (!missing(snomedct_code)) {
    defaults$snomedct_code <- snomedct_code
  }
  assign('hf_d_isolate', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_lab_procedure <- function(lab_procedure_id, lab_procedure_mnemonic, lab_procedure_name, lab_procedure_group, lab_super_group, loinc_code, loinc_ind, loinc_long, loinc_short) {
  defaults <- get('hf_d_lab_procedure', envir = defaultValues)
  if (!missing(lab_procedure_id)) {
    defaults$lab_procedure_id <- lab_procedure_id
  }
  if (!missing(lab_procedure_mnemonic)) {
    defaults$lab_procedure_mnemonic <- lab_procedure_mnemonic
  }
  if (!missing(lab_procedure_name)) {
    defaults$lab_procedure_name <- lab_procedure_name
  }
  if (!missing(lab_procedure_group)) {
    defaults$lab_procedure_group <- lab_procedure_group
  }
  if (!missing(lab_super_group)) {
    defaults$lab_super_group <- lab_super_group
  }
  if (!missing(loinc_code)) {
    defaults$loinc_code <- loinc_code
  }
  if (!missing(loinc_ind)) {
    defaults$loinc_ind <- loinc_ind
  }
  if (!missing(loinc_long)) {
    defaults$loinc_long <- loinc_long
  }
  if (!missing(loinc_short)) {
    defaults$loinc_short <- loinc_short
  }
  assign('hf_d_lab_procedure', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_lab_result_type <- function(lab_result_type_id, lab_result_type_desc) {
  defaults <- get('hf_d_lab_result_type', envir = defaultValues)
  if (!missing(lab_result_type_id)) {
    defaults$lab_result_type_id <- lab_result_type_id
  }
  if (!missing(lab_result_type_desc)) {
    defaults$lab_result_type_desc <- lab_result_type_desc
  }
  assign('hf_d_lab_result_type', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_manufacturer <- function(manufacturer_id, manufacturer_name, manufacturer_alt_name) {
  defaults <- get('hf_d_manufacturer', envir = defaultValues)
  if (!missing(manufacturer_id)) {
    defaults$manufacturer_id <- manufacturer_id
  }
  if (!missing(manufacturer_name)) {
    defaults$manufacturer_name <- manufacturer_name
  }
  if (!missing(manufacturer_alt_name)) {
    defaults$manufacturer_alt_name <- manufacturer_alt_name
  }
  assign('hf_d_manufacturer', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_med_order_status <- function(med_order_status_id, med_order_status_desc) {
  defaults <- get('hf_d_med_order_status', envir = defaultValues)
  if (!missing(med_order_status_id)) {
    defaults$med_order_status_id <- med_order_status_id
  }
  if (!missing(med_order_status_desc)) {
    defaults$med_order_status_desc <- med_order_status_desc
  }
  assign('hf_d_med_order_status', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_med_product <- function(med_product_id, drug_code, drug_mnemonic_code, drug_desc, drug_mnemonic_desc) {
  defaults <- get('hf_d_med_product', envir = defaultValues)
  if (!missing(med_product_id)) {
    defaults$med_product_id <- med_product_id
  }
  if (!missing(drug_code)) {
    defaults$drug_code <- drug_code
  }
  if (!missing(drug_mnemonic_code)) {
    defaults$drug_mnemonic_code <- drug_mnemonic_code
  }
  if (!missing(drug_desc)) {
    defaults$drug_desc <- drug_desc
  }
  if (!missing(drug_mnemonic_desc)) {
    defaults$drug_mnemonic_desc <- drug_mnemonic_desc
  }
  assign('hf_d_med_product', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_med_reason <- function(med_reason_id, med_reason_desc) {
  defaults <- get('hf_d_med_reason', envir = defaultValues)
  if (!missing(med_reason_id)) {
    defaults$med_reason_id <- med_reason_id
  }
  if (!missing(med_reason_desc)) {
    defaults$med_reason_desc <- med_reason_desc
  }
  assign('hf_d_med_reason', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_medication <- function(medication_id, ndc_code, brand_name, generic_name, product_strength_description, route_description, dose_form_description, obsolete_dt_tm) {
  defaults <- get('hf_d_medication', envir = defaultValues)
  if (!missing(medication_id)) {
    defaults$medication_id <- medication_id
  }
  if (!missing(ndc_code)) {
    defaults$ndc_code <- ndc_code
  }
  if (!missing(brand_name)) {
    defaults$brand_name <- brand_name
  }
  if (!missing(generic_name)) {
    defaults$generic_name <- generic_name
  }
  if (!missing(product_strength_description)) {
    defaults$product_strength_description <- product_strength_description
  }
  if (!missing(route_description)) {
    defaults$route_description <- route_description
  }
  if (!missing(dose_form_description)) {
    defaults$dose_form_description <- dose_form_description
  }
  if (!missing(obsolete_dt_tm)) {
    defaults$obsolete_dt_tm <- obsolete_dt_tm
  }
  assign('hf_d_medication', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_mic_order_status <- function(micro_order_status_id, micro_order_status_code, micro_order_status_desc) {
  defaults <- get('hf_d_mic_order_status', envir = defaultValues)
  if (!missing(micro_order_status_id)) {
    defaults$micro_order_status_id <- micro_order_status_id
  }
  if (!missing(micro_order_status_code)) {
    defaults$micro_order_status_code <- micro_order_status_code
  }
  if (!missing(micro_order_status_desc)) {
    defaults$micro_order_status_desc <- micro_order_status_desc
  }
  assign('hf_d_mic_order_status', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_micro_result_type <- function(micro_result_type_id, test_type, micro_result_type_code, micro_result_type_desc) {
  defaults <- get('hf_d_micro_result_type', envir = defaultValues)
  if (!missing(micro_result_type_id)) {
    defaults$micro_result_type_id <- micro_result_type_id
  }
  if (!missing(test_type)) {
    defaults$test_type <- test_type
  }
  if (!missing(micro_result_type_code)) {
    defaults$micro_result_type_code <- micro_result_type_code
  }
  if (!missing(micro_result_type_desc)) {
    defaults$micro_result_type_desc <- micro_result_type_desc
  }
  assign('hf_d_micro_result_type', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_normalcy <- function(normalcy_id, normalcy_desc) {
  defaults <- get('hf_d_normalcy', envir = defaultValues)
  if (!missing(normalcy_id)) {
    defaults$normalcy_id <- normalcy_id
  }
  if (!missing(normalcy_desc)) {
    defaults$normalcy_desc <- normalcy_desc
  }
  assign('hf_d_normalcy', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_normalcy_method <- function(normalcy_method_id, normalcy_method_desc) {
  defaults <- get('hf_d_normalcy_method', envir = defaultValues)
  if (!missing(normalcy_method_id)) {
    defaults$normalcy_method_id <- normalcy_method_id
  }
  if (!missing(normalcy_method_desc)) {
    defaults$normalcy_method_desc <- normalcy_method_desc
  }
  assign('hf_d_normalcy_method', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_order_stop_type <- function(order_stop_type_id, order_stop_type_desc) {
  defaults <- get('hf_d_order_stop_type', envir = defaultValues)
  if (!missing(order_stop_type_id)) {
    defaults$order_stop_type_id <- order_stop_type_id
  }
  if (!missing(order_stop_type_desc)) {
    defaults$order_stop_type_desc <- order_stop_type_desc
  }
  assign('hf_d_order_stop_type', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_order_type <- function(order_type_id, order_type_desc) {
  defaults <- get('hf_d_order_type', envir = defaultValues)
  if (!missing(order_type_id)) {
    defaults$order_type_id <- order_type_id
  }
  if (!missing(order_type_desc)) {
    defaults$order_type_desc <- order_type_desc
  }
  assign('hf_d_order_type', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_patient <- function(patient_id, patient_sk, race, gender, marital_status) {
  defaults <- get('hf_d_patient', envir = defaultValues)
  if (!missing(patient_id)) {
    defaults$patient_id <- patient_id
  }
  if (!missing(patient_sk)) {
    defaults$patient_sk <- patient_sk
  }
  if (!missing(race)) {
    defaults$race <- race
  }
  if (!missing(gender)) {
    defaults$gender <- gender
  }
  if (!missing(marital_status)) {
    defaults$marital_status <- marital_status
  }
  assign('hf_d_patient', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_patient_type <- function(patient_type_id, patient_type_desc) {
  defaults <- get('hf_d_patient_type', envir = defaultValues)
  if (!missing(patient_type_id)) {
    defaults$patient_type_id <- patient_type_id
  }
  if (!missing(patient_type_desc)) {
    defaults$patient_type_desc <- patient_type_desc
  }
  assign('hf_d_patient_type', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_payer <- function(payer_id, payer_code, payer_code_desc) {
  defaults <- get('hf_d_payer', envir = defaultValues)
  if (!missing(payer_id)) {
    defaults$payer_id <- payer_id
  }
  if (!missing(payer_code)) {
    defaults$payer_code <- payer_code
  }
  if (!missing(payer_code_desc)) {
    defaults$payer_code_desc <- payer_code_desc
  }
  assign('hf_d_payer', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_physician <- function(physician_id, medical_specialty) {
  defaults <- get('hf_d_physician', envir = defaultValues)
  if (!missing(physician_id)) {
    defaults$physician_id <- physician_id
  }
  if (!missing(medical_specialty)) {
    defaults$medical_specialty <- medical_specialty
  }
  assign('hf_d_physician', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_present_on_admit <- function(present_on_admit_id, present_on_admit_code, present_on_admit_desc) {
  defaults <- get('hf_d_present_on_admit', envir = defaultValues)
  if (!missing(present_on_admit_id)) {
    defaults$present_on_admit_id <- present_on_admit_id
  }
  if (!missing(present_on_admit_code)) {
    defaults$present_on_admit_code <- present_on_admit_code
  }
  if (!missing(present_on_admit_desc)) {
    defaults$present_on_admit_desc <- present_on_admit_desc
  }
  assign('hf_d_present_on_admit', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_procedure <- function(procedure_id, procedure_type, procedure_code, procedure_description) {
  defaults <- get('hf_d_procedure', envir = defaultValues)
  if (!missing(procedure_id)) {
    defaults$procedure_id <- procedure_id
  }
  if (!missing(procedure_type)) {
    defaults$procedure_type <- procedure_type
  }
  if (!missing(procedure_code)) {
    defaults$procedure_code <- procedure_code
  }
  if (!missing(procedure_description)) {
    defaults$procedure_description <- procedure_description
  }
  assign('hf_d_procedure', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_procedure_modifier <- function(procedure_modifier_id, procedure_modifier_desc) {
  defaults <- get('hf_d_procedure_modifier', envir = defaultValues)
  if (!missing(procedure_modifier_id)) {
    defaults$procedure_modifier_id <- procedure_modifier_id
  }
  if (!missing(procedure_modifier_desc)) {
    defaults$procedure_modifier_desc <- procedure_modifier_desc
  }
  assign('hf_d_procedure_modifier', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_reporting_priority <- function(reporting_priority_id, reporting_priority_code, reporting_priority_desc) {
  defaults <- get('hf_d_reporting_priority', envir = defaultValues)
  if (!missing(reporting_priority_id)) {
    defaults$reporting_priority_id <- reporting_priority_id
  }
  if (!missing(reporting_priority_code)) {
    defaults$reporting_priority_code <- reporting_priority_code
  }
  if (!missing(reporting_priority_desc)) {
    defaults$reporting_priority_desc <- reporting_priority_desc
  }
  assign('hf_d_reporting_priority', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_result_indicator <- function(result_indicator_id, result_indicator_desc) {
  defaults <- get('hf_d_result_indicator', envir = defaultValues)
  if (!missing(result_indicator_id)) {
    defaults$result_indicator_id <- result_indicator_id
  }
  if (!missing(result_indicator_desc)) {
    defaults$result_indicator_desc <- result_indicator_desc
  }
  assign('hf_d_result_indicator', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_result_type_proc <- function(result_type_proc_id, result_type_proc_desc) {
  defaults <- get('hf_d_result_type_proc', envir = defaultValues)
  if (!missing(result_type_proc_id)) {
    defaults$result_type_proc_id <- result_type_proc_id
  }
  if (!missing(result_type_proc_desc)) {
    defaults$result_type_proc_desc <- result_type_proc_desc
  }
  assign('hf_d_result_type_proc', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_route_admin <- function(route_admin_id, route_admin_display, route_admin_description) {
  defaults <- get('hf_d_route_admin', envir = defaultValues)
  if (!missing(route_admin_id)) {
    defaults$route_admin_id <- route_admin_id
  }
  if (!missing(route_admin_display)) {
    defaults$route_admin_display <- route_admin_display
  }
  if (!missing(route_admin_description)) {
    defaults$route_admin_description <- route_admin_description
  }
  assign('hf_d_route_admin', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_surgical_case_level <- function(surgical_case_level_id, surgical_case_level_desc) {
  defaults <- get('hf_d_surgical_case_level', envir = defaultValues)
  if (!missing(surgical_case_level_id)) {
    defaults$surgical_case_level_id <- surgical_case_level_id
  }
  if (!missing(surgical_case_level_desc)) {
    defaults$surgical_case_level_desc <- surgical_case_level_desc
  }
  assign('hf_d_surgical_case_level', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_surgical_procedure <- function(surgical_procedure_id, surgical_procedure_desc, order_type, order_specialty, anatomic_site, surgical_procedure_device, icd9_code, icd9_desc, revision_ind) {
  defaults <- get('hf_d_surgical_procedure', envir = defaultValues)
  if (!missing(surgical_procedure_id)) {
    defaults$surgical_procedure_id <- surgical_procedure_id
  }
  if (!missing(surgical_procedure_desc)) {
    defaults$surgical_procedure_desc <- surgical_procedure_desc
  }
  if (!missing(order_type)) {
    defaults$order_type <- order_type
  }
  if (!missing(order_specialty)) {
    defaults$order_specialty <- order_specialty
  }
  if (!missing(anatomic_site)) {
    defaults$anatomic_site <- anatomic_site
  }
  if (!missing(surgical_procedure_device)) {
    defaults$surgical_procedure_device <- surgical_procedure_device
  }
  if (!missing(icd9_code)) {
    defaults$icd9_code <- icd9_code
  }
  if (!missing(icd9_desc)) {
    defaults$icd9_desc <- icd9_desc
  }
  if (!missing(revision_ind)) {
    defaults$revision_ind <- revision_ind
  }
  assign('hf_d_surgical_procedure', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_surgical_specialty <- function(surgical_specialty_id, surgical_specialty_desc) {
  defaults <- get('hf_d_surgical_specialty', envir = defaultValues)
  if (!missing(surgical_specialty_id)) {
    defaults$surgical_specialty_id <- surgical_specialty_id
  }
  if (!missing(surgical_specialty_desc)) {
    defaults$surgical_specialty_desc <- surgical_specialty_desc
  }
  assign('hf_d_surgical_specialty', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_test_type <- function(test_type_id, test_type_mnemonic, test_type_desc) {
  defaults <- get('hf_d_test_type', envir = defaultValues)
  if (!missing(test_type_id)) {
    defaults$test_type_id <- test_type_id
  }
  if (!missing(test_type_mnemonic)) {
    defaults$test_type_mnemonic <- test_type_mnemonic
  }
  if (!missing(test_type_desc)) {
    defaults$test_type_desc <- test_type_desc
  }
  assign('hf_d_test_type', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_unit <- function(unit_id, unit_display, unit_desc) {
  defaults <- get('hf_d_unit', envir = defaultValues)
  if (!missing(unit_id)) {
    defaults$unit_id <- unit_id
  }
  if (!missing(unit_display)) {
    defaults$unit_display <- unit_display
  }
  if (!missing(unit_desc)) {
    defaults$unit_desc <- unit_desc
  }
  assign('hf_d_unit', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_d_wound_class <- function(wound_class_id, wound_class_desc) {
  defaults <- get('hf_d_wound_class', envir = defaultValues)
  if (!missing(wound_class_id)) {
    defaults$wound_class_id <- wound_class_id
  }
  if (!missing(wound_class_desc)) {
    defaults$wound_class_desc <- wound_class_desc
  }
  assign('hf_d_wound_class', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_f_clinical_event <- function(encounter_id, accession_nbr, lab_procedure_id, critical_high, critical_low, event_code_id, event_class_id, event_end_dt_tm, event_end_dt_id, event_reltn_id, event_start_dt_tm, event_start_dt_id, event_expiration_dt_tm, event_expiration_dt_id, event_normalcy_id, event_normalcy_method_id, normal_high, normal_low, performed_dt_tm, performed_dt_id, performed_prsnl_id, result_normalcy_flg, result_time_unit_id, result_units_id, result_value_dt_tm, result_value_dt_id, result_value_num, result_feasible_ind, result_inaccurate_ind, event_source_id, verified_dt_tm, verified_dt_id, verified_prsnl_id#, _extractyear
                                             ) {
  defaults <- get('hf_f_clinical_event', envir = defaultValues)
  if (!missing(encounter_id)) {
    defaults$encounter_id <- encounter_id
  }
  if (!missing(accession_nbr)) {
    defaults$accession_nbr <- accession_nbr
  }
  if (!missing(lab_procedure_id)) {
    defaults$lab_procedure_id <- lab_procedure_id
  }
  if (!missing(critical_high)) {
    defaults$critical_high <- critical_high
  }
  if (!missing(critical_low)) {
    defaults$critical_low <- critical_low
  }
  if (!missing(event_code_id)) {
    defaults$event_code_id <- event_code_id
  }
  if (!missing(event_class_id)) {
    defaults$event_class_id <- event_class_id
  }
  if (!missing(event_end_dt_tm)) {
    defaults$event_end_dt_tm <- event_end_dt_tm
  }
  if (!missing(event_end_dt_id)) {
    defaults$event_end_dt_id <- event_end_dt_id
  }
  if (!missing(event_reltn_id)) {
    defaults$event_reltn_id <- event_reltn_id
  }
  if (!missing(event_start_dt_tm)) {
    defaults$event_start_dt_tm <- event_start_dt_tm
  }
  if (!missing(event_start_dt_id)) {
    defaults$event_start_dt_id <- event_start_dt_id
  }
  if (!missing(event_expiration_dt_tm)) {
    defaults$event_expiration_dt_tm <- event_expiration_dt_tm
  }
  if (!missing(event_expiration_dt_id)) {
    defaults$event_expiration_dt_id <- event_expiration_dt_id
  }
  if (!missing(event_normalcy_id)) {
    defaults$event_normalcy_id <- event_normalcy_id
  }
  if (!missing(event_normalcy_method_id)) {
    defaults$event_normalcy_method_id <- event_normalcy_method_id
  }
  if (!missing(normal_high)) {
    defaults$normal_high <- normal_high
  }
  if (!missing(normal_low)) {
    defaults$normal_low <- normal_low
  }
  if (!missing(performed_dt_tm)) {
    defaults$performed_dt_tm <- performed_dt_tm
  }
  if (!missing(performed_dt_id)) {
    defaults$performed_dt_id <- performed_dt_id
  }
  if (!missing(performed_prsnl_id)) {
    defaults$performed_prsnl_id <- performed_prsnl_id
  }
  if (!missing(result_normalcy_flg)) {
    defaults$result_normalcy_flg <- result_normalcy_flg
  }
  if (!missing(result_time_unit_id)) {
    defaults$result_time_unit_id <- result_time_unit_id
  }
  if (!missing(result_units_id)) {
    defaults$result_units_id <- result_units_id
  }
  if (!missing(result_value_dt_tm)) {
    defaults$result_value_dt_tm <- result_value_dt_tm
  }
  if (!missing(result_value_dt_id)) {
    defaults$result_value_dt_id <- result_value_dt_id
  }
  if (!missing(result_value_num)) {
    defaults$result_value_num <- result_value_num
  }
  if (!missing(result_feasible_ind)) {
    defaults$result_feasible_ind <- result_feasible_ind
  }
  if (!missing(result_inaccurate_ind)) {
    defaults$result_inaccurate_ind <- result_inaccurate_ind
  }
  if (!missing(event_source_id)) {
    defaults$event_source_id <- event_source_id
  }
  if (!missing(verified_dt_tm)) {
    defaults$verified_dt_tm <- verified_dt_tm
  }
  if (!missing(verified_dt_id)) {
    defaults$verified_dt_id <- verified_dt_id
  }
  if (!missing(verified_prsnl_id)) {
    defaults$verified_prsnl_id <- verified_prsnl_id
  }
  # if (!missing(_extractyear)) {
  #   defaults$_extractyear <- _extractyear
  # }
  assign('hf_f_clinical_event', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_f_diagnosis <- function(encounter_id, diagnosis_id, diagnosis_priority, diagnosis_type_id, present_on_admit_id, third_party_ind#, _extractyear
                                        ) {
  defaults <- get('hf_f_diagnosis', envir = defaultValues)
  if (!missing(encounter_id)) {
    defaults$encounter_id <- encounter_id
  }
  if (!missing(diagnosis_id)) {
    defaults$diagnosis_id <- diagnosis_id
  }
  if (!missing(diagnosis_priority)) {
    defaults$diagnosis_priority <- diagnosis_priority
  }
  if (!missing(diagnosis_type_id)) {
    defaults$diagnosis_type_id <- diagnosis_type_id
  }
  if (!missing(present_on_admit_id)) {
    defaults$present_on_admit_id <- present_on_admit_id
  }
  if (!missing(third_party_ind)) {
    defaults$third_party_ind <- third_party_ind
  }
  # if (!missing(_extractyear)) {
  #   defaults$_extractyear <- _extractyear
  # }
  assign('hf_f_diagnosis', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_f_enc_history <- function(encounter_id, patient_type_id, caresetting_id, begin_dt_tm, end_dt_tm, begin_dt_id, end_dt_id, estimate_ind#, _extractyear
                                          ) {
  defaults <- get('hf_f_enc_history', envir = defaultValues)
  if (!missing(encounter_id)) {
    defaults$encounter_id <- encounter_id
  }
  if (!missing(patient_type_id)) {
    defaults$patient_type_id <- patient_type_id
  }
  if (!missing(caresetting_id)) {
    defaults$caresetting_id <- caresetting_id
  }
  if (!missing(begin_dt_tm)) {
    defaults$begin_dt_tm <- begin_dt_tm
  }
  if (!missing(end_dt_tm)) {
    defaults$end_dt_tm <- end_dt_tm
  }
  if (!missing(begin_dt_id)) {
    defaults$begin_dt_id <- begin_dt_id
  }
  if (!missing(end_dt_id)) {
    defaults$end_dt_id <- end_dt_id
  }
  if (!missing(estimate_ind)) {
    defaults$estimate_ind <- estimate_ind
  }
  # if (!missing(_extractyear)) {
  #   defaults$_extractyear <- _extractyear
  # }
  assign('hf_f_enc_history', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_f_encounter <- function(encounter_id, hospital_id, admitting_physician_id, discharge_caresetting_id, patient_id, patient_type_id, admitted_dt_id, discharged_dt_id, discharge_disposition_id, diagnostic_grouping_id, admission_source_id, admission_type_id, payer_id, age_in_years, age_in_months, age_in_weeks, age_in_days, age_in_hours, total_charges, billing_ind, weight, weight_unit_id, admitted_dt_tm, discharged_dt_tm, admitted_tm_valid_ind, discharged_tm_valid_ind#, _extractyear
                                        ) {
  defaults <- get('hf_f_encounter', envir = defaultValues)
  if (!missing(encounter_id)) {
    defaults$encounter_id <- encounter_id
  }
  if (!missing(hospital_id)) {
    defaults$hospital_id <- hospital_id
  }
  if (!missing(admitting_physician_id)) {
    defaults$admitting_physician_id <- admitting_physician_id
  }
  if (!missing(discharge_caresetting_id)) {
    defaults$discharge_caresetting_id <- discharge_caresetting_id
  }
  if (!missing(patient_id)) {
    defaults$patient_id <- patient_id
  }
  if (!missing(patient_type_id)) {
    defaults$patient_type_id <- patient_type_id
  }
  if (!missing(admitted_dt_id)) {
    defaults$admitted_dt_id <- admitted_dt_id
  }
  if (!missing(discharged_dt_id)) {
    defaults$discharged_dt_id <- discharged_dt_id
  }
  if (!missing(discharge_disposition_id)) {
    defaults$discharge_disposition_id <- discharge_disposition_id
  }
  if (!missing(diagnostic_grouping_id)) {
    defaults$diagnostic_grouping_id <- diagnostic_grouping_id
  }
  if (!missing(admission_source_id)) {
    defaults$admission_source_id <- admission_source_id
  }
  if (!missing(admission_type_id)) {
    defaults$admission_type_id <- admission_type_id
  }
  if (!missing(payer_id)) {
    defaults$payer_id <- payer_id
  }
  if (!missing(age_in_years)) {
    defaults$age_in_years <- age_in_years
  }
  if (!missing(age_in_months)) {
    defaults$age_in_months <- age_in_months
  }
  if (!missing(age_in_weeks)) {
    defaults$age_in_weeks <- age_in_weeks
  }
  if (!missing(age_in_days)) {
    defaults$age_in_days <- age_in_days
  }
  if (!missing(age_in_hours)) {
    defaults$age_in_hours <- age_in_hours
  }
  if (!missing(total_charges)) {
    defaults$total_charges <- total_charges
  }
  if (!missing(billing_ind)) {
    defaults$billing_ind <- billing_ind
  }
  if (!missing(weight)) {
    defaults$weight <- weight
  }
  if (!missing(weight_unit_id)) {
    defaults$weight_unit_id <- weight_unit_id
  }
  if (!missing(admitted_dt_tm)) {
    defaults$admitted_dt_tm <- admitted_dt_tm
  }
  if (!missing(discharged_dt_tm)) {
    defaults$discharged_dt_tm <- discharged_dt_tm
  }
  if (!missing(admitted_tm_valid_ind)) {
    defaults$admitted_tm_valid_ind <- admitted_tm_valid_ind
  }
  if (!missing(discharged_tm_valid_ind)) {
    defaults$discharged_tm_valid_ind <- discharged_tm_valid_ind
  }
  # if (!missing(_extractyear)) {
  #   defaults$_extractyear <- _extractyear
  # }
  assign('hf_f_encounter', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_f_implant_log <- function(manufacturer_id, expiration_dt_tm, expiration_dt_id, surgical_case_id, encounter_id#, _extractyear
                                          ) {
  defaults <- get('hf_f_implant_log', envir = defaultValues)
  if (!missing(manufacturer_id)) {
    defaults$manufacturer_id <- manufacturer_id
  }
  if (!missing(expiration_dt_tm)) {
    defaults$expiration_dt_tm <- expiration_dt_tm
  }
  if (!missing(expiration_dt_id)) {
    defaults$expiration_dt_id <- expiration_dt_id
  }
  if (!missing(surgical_case_id)) {
    defaults$surgical_case_id <- surgical_case_id
  }
  if (!missing(encounter_id)) {
    defaults$encounter_id <- encounter_id
  }
  # if (!missing(_extractyear)) {
  #   defaults$_extractyear <- _extractyear
  # }
  assign('hf_f_implant_log', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_f_lab_procedure <- function(encounter_id, detail_lab_procedure_id, order_lab_procedure_id, ordering_physician_id, lab_order_caresetting_id, reporting_priority_id, lab_result_type_id, result_indicator_id, lab_ordered_dt_id, lab_drawn_dt_id, lab_received_dt_id, lab_completed_dt_id, lab_cancelled_dt_id, lab_performed_dt_id, lab_verified_dt_id, accession, date_result_id, numeric_result, result_units_id, normal_range_low, normal_range_high, lab_ordered_dt_tm, lab_drawn_dt_tm, lab_received_dt_tm, lab_completed_dt_tm, lab_cancelled_dt_tm, lab_performed_dt_tm, lab_verified_dt_tm, lab_ordered_tm_vld_flg, lab_drawn_tm_vld_flg, lab_received_tm_vld_flg, lab_completed_tm_vld_flg, lab_cancelled_tm_vld_flg, lab_verified_tm_vld_flg, lab_performed_tm_vld_flg, lab_performed_caresetting_id, collection_source_id, collection_method_id#, _extractyear
                                            ) {
  defaults <- get('hf_f_lab_procedure', envir = defaultValues)
  if (!missing(encounter_id)) {
    defaults$encounter_id <- encounter_id
  }
  if (!missing(detail_lab_procedure_id)) {
    defaults$detail_lab_procedure_id <- detail_lab_procedure_id
  }
  if (!missing(order_lab_procedure_id)) {
    defaults$order_lab_procedure_id <- order_lab_procedure_id
  }
  if (!missing(ordering_physician_id)) {
    defaults$ordering_physician_id <- ordering_physician_id
  }
  if (!missing(lab_order_caresetting_id)) {
    defaults$lab_order_caresetting_id <- lab_order_caresetting_id
  }
  if (!missing(reporting_priority_id)) {
    defaults$reporting_priority_id <- reporting_priority_id
  }
  if (!missing(lab_result_type_id)) {
    defaults$lab_result_type_id <- lab_result_type_id
  }
  if (!missing(result_indicator_id)) {
    defaults$result_indicator_id <- result_indicator_id
  }
  if (!missing(lab_ordered_dt_id)) {
    defaults$lab_ordered_dt_id <- lab_ordered_dt_id
  }
  if (!missing(lab_drawn_dt_id)) {
    defaults$lab_drawn_dt_id <- lab_drawn_dt_id
  }
  if (!missing(lab_received_dt_id)) {
    defaults$lab_received_dt_id <- lab_received_dt_id
  }
  if (!missing(lab_completed_dt_id)) {
    defaults$lab_completed_dt_id <- lab_completed_dt_id
  }
  if (!missing(lab_cancelled_dt_id)) {
    defaults$lab_cancelled_dt_id <- lab_cancelled_dt_id
  }
  if (!missing(lab_performed_dt_id)) {
    defaults$lab_performed_dt_id <- lab_performed_dt_id
  }
  if (!missing(lab_verified_dt_id)) {
    defaults$lab_verified_dt_id <- lab_verified_dt_id
  }
  if (!missing(accession)) {
    defaults$accession <- accession
  }
  if (!missing(date_result_id)) {
    defaults$date_result_id <- date_result_id
  }
  if (!missing(numeric_result)) {
    defaults$numeric_result <- numeric_result
  }
  if (!missing(result_units_id)) {
    defaults$result_units_id <- result_units_id
  }
  if (!missing(normal_range_low)) {
    defaults$normal_range_low <- normal_range_low
  }
  if (!missing(normal_range_high)) {
    defaults$normal_range_high <- normal_range_high
  }
  if (!missing(lab_ordered_dt_tm)) {
    defaults$lab_ordered_dt_tm <- lab_ordered_dt_tm
  }
  if (!missing(lab_drawn_dt_tm)) {
    defaults$lab_drawn_dt_tm <- lab_drawn_dt_tm
  }
  if (!missing(lab_received_dt_tm)) {
    defaults$lab_received_dt_tm <- lab_received_dt_tm
  }
  if (!missing(lab_completed_dt_tm)) {
    defaults$lab_completed_dt_tm <- lab_completed_dt_tm
  }
  if (!missing(lab_cancelled_dt_tm)) {
    defaults$lab_cancelled_dt_tm <- lab_cancelled_dt_tm
  }
  if (!missing(lab_performed_dt_tm)) {
    defaults$lab_performed_dt_tm <- lab_performed_dt_tm
  }
  if (!missing(lab_verified_dt_tm)) {
    defaults$lab_verified_dt_tm <- lab_verified_dt_tm
  }
  if (!missing(lab_ordered_tm_vld_flg)) {
    defaults$lab_ordered_tm_vld_flg <- lab_ordered_tm_vld_flg
  }
  if (!missing(lab_drawn_tm_vld_flg)) {
    defaults$lab_drawn_tm_vld_flg <- lab_drawn_tm_vld_flg
  }
  if (!missing(lab_received_tm_vld_flg)) {
    defaults$lab_received_tm_vld_flg <- lab_received_tm_vld_flg
  }
  if (!missing(lab_completed_tm_vld_flg)) {
    defaults$lab_completed_tm_vld_flg <- lab_completed_tm_vld_flg
  }
  if (!missing(lab_cancelled_tm_vld_flg)) {
    defaults$lab_cancelled_tm_vld_flg <- lab_cancelled_tm_vld_flg
  }
  if (!missing(lab_verified_tm_vld_flg)) {
    defaults$lab_verified_tm_vld_flg <- lab_verified_tm_vld_flg
  }
  if (!missing(lab_performed_tm_vld_flg)) {
    defaults$lab_performed_tm_vld_flg <- lab_performed_tm_vld_flg
  }
  if (!missing(lab_performed_caresetting_id)) {
    defaults$lab_performed_caresetting_id <- lab_performed_caresetting_id
  }
  if (!missing(collection_source_id)) {
    defaults$collection_source_id <- collection_source_id
  }
  if (!missing(collection_method_id)) {
    defaults$collection_method_id <- collection_method_id
  }
  # if (!missing(_extractyear)) {
  #   defaults$_extractyear <- _extractyear
  # }
  assign('hf_f_lab_procedure', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_f_med_history <- function(encounter_id, ordering_physician_id, med_history_flg, req_start_dt_tm, req_start_dt_id, req_start_tm_vld_flg, prn_ind, route_administration_id, order_stop_type_id, med_stopped_dt_tm, med_stopped_dt_id, med_stopped_tm_vld_flg, frequency_id, collected_ind, order_strength, order_strength_units_id, order_volume, order_volume_units_id, total_dispensed_doses, duration, duration_unit_id, next_dose_dt_tm, next_dose_dt_id, next_dose_tm_vld_flg, infusion_rate, infusion_rate_units_id, med_reason_id, cancel_reason_id, dispensed_quantity, dispensed_quantity_units_id, compliance_status_id, med_entered_dt_tm, med_entered_dt_id, med_entered_tm_vld_flg, med_product_id#, _extractyear
                                          ) {
  defaults <- get('hf_f_med_history', envir = defaultValues)
  if (!missing(encounter_id)) {
    defaults$encounter_id <- encounter_id
  }
  if (!missing(ordering_physician_id)) {
    defaults$ordering_physician_id <- ordering_physician_id
  }
  if (!missing(med_history_flg)) {
    defaults$med_history_flg <- med_history_flg
  }
  if (!missing(req_start_dt_tm)) {
    defaults$req_start_dt_tm <- req_start_dt_tm
  }
  if (!missing(req_start_dt_id)) {
    defaults$req_start_dt_id <- req_start_dt_id
  }
  if (!missing(req_start_tm_vld_flg)) {
    defaults$req_start_tm_vld_flg <- req_start_tm_vld_flg
  }
  if (!missing(prn_ind)) {
    defaults$prn_ind <- prn_ind
  }
  if (!missing(route_administration_id)) {
    defaults$route_administration_id <- route_administration_id
  }
  if (!missing(order_stop_type_id)) {
    defaults$order_stop_type_id <- order_stop_type_id
  }
  if (!missing(med_stopped_dt_tm)) {
    defaults$med_stopped_dt_tm <- med_stopped_dt_tm
  }
  if (!missing(med_stopped_dt_id)) {
    defaults$med_stopped_dt_id <- med_stopped_dt_id
  }
  if (!missing(med_stopped_tm_vld_flg)) {
    defaults$med_stopped_tm_vld_flg <- med_stopped_tm_vld_flg
  }
  if (!missing(frequency_id)) {
    defaults$frequency_id <- frequency_id
  }
  if (!missing(collected_ind)) {
    defaults$collected_ind <- collected_ind
  }
  if (!missing(order_strength)) {
    defaults$order_strength <- order_strength
  }
  if (!missing(order_strength_units_id)) {
    defaults$order_strength_units_id <- order_strength_units_id
  }
  if (!missing(order_volume)) {
    defaults$order_volume <- order_volume
  }
  if (!missing(order_volume_units_id)) {
    defaults$order_volume_units_id <- order_volume_units_id
  }
  if (!missing(total_dispensed_doses)) {
    defaults$total_dispensed_doses <- total_dispensed_doses
  }
  if (!missing(duration)) {
    defaults$duration <- duration
  }
  if (!missing(duration_unit_id)) {
    defaults$duration_unit_id <- duration_unit_id
  }
  if (!missing(next_dose_dt_tm)) {
    defaults$next_dose_dt_tm <- next_dose_dt_tm
  }
  if (!missing(next_dose_dt_id)) {
    defaults$next_dose_dt_id <- next_dose_dt_id
  }
  if (!missing(next_dose_tm_vld_flg)) {
    defaults$next_dose_tm_vld_flg <- next_dose_tm_vld_flg
  }
  if (!missing(infusion_rate)) {
    defaults$infusion_rate <- infusion_rate
  }
  if (!missing(infusion_rate_units_id)) {
    defaults$infusion_rate_units_id <- infusion_rate_units_id
  }
  if (!missing(med_reason_id)) {
    defaults$med_reason_id <- med_reason_id
  }
  if (!missing(cancel_reason_id)) {
    defaults$cancel_reason_id <- cancel_reason_id
  }
  if (!missing(dispensed_quantity)) {
    defaults$dispensed_quantity <- dispensed_quantity
  }
  if (!missing(dispensed_quantity_units_id)) {
    defaults$dispensed_quantity_units_id <- dispensed_quantity_units_id
  }
  if (!missing(compliance_status_id)) {
    defaults$compliance_status_id <- compliance_status_id
  }
  if (!missing(med_entered_dt_tm)) {
    defaults$med_entered_dt_tm <- med_entered_dt_tm
  }
  if (!missing(med_entered_dt_id)) {
    defaults$med_entered_dt_id <- med_entered_dt_id
  }
  if (!missing(med_entered_tm_vld_flg)) {
    defaults$med_entered_tm_vld_flg <- med_entered_tm_vld_flg
  }
  if (!missing(med_product_id)) {
    defaults$med_product_id <- med_product_id
  }
  # if (!missing(_extractyear)) {
  #   defaults$_extractyear <- _extractyear
  # }
  assign('hf_f_med_history', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_f_medication <- function(encounter_id, medication_id, ordering_physician_id, med_dispensed_caresetting_id, med_request_caresetting_id, discontinue_reason_id, route_administration_id, formulary_type_id, frequency_id, order_stop_type_id, order_type_id, med_order_status_id, med_started_dt_id, med_entered_dt_id, med_stopped_dt_id, med_discontinued_dt_id, order_no, total_dispensed_doses, dose_quantity, initial_dose_quantity, dose_units_id, charge_quantity, credit_quantity, infusion_rate, infusion_time, infusion_time_units_id, order_strength, order_strength_units_id, order_volume, order_volume_units_id, total_volume, unit_cost, unit_price, med_started_dt_tm, med_entered_dt_tm, med_stopped_dt_tm, med_discontinued_dt_tm, med_started_tm_valid_flg, med_entered_tm_valid_flg, med_stopped_tm_valid_flg, med_discontinued_tm_valid_flg#, _extractyear
                                         ) {
  defaults <- get('hf_f_medication', envir = defaultValues)
  if (!missing(encounter_id)) {
    defaults$encounter_id <- encounter_id
  }
  if (!missing(medication_id)) {
    defaults$medication_id <- medication_id
  }
  if (!missing(ordering_physician_id)) {
    defaults$ordering_physician_id <- ordering_physician_id
  }
  if (!missing(med_dispensed_caresetting_id)) {
    defaults$med_dispensed_caresetting_id <- med_dispensed_caresetting_id
  }
  if (!missing(med_request_caresetting_id)) {
    defaults$med_request_caresetting_id <- med_request_caresetting_id
  }
  if (!missing(discontinue_reason_id)) {
    defaults$discontinue_reason_id <- discontinue_reason_id
  }
  if (!missing(route_administration_id)) {
    defaults$route_administration_id <- route_administration_id
  }
  if (!missing(formulary_type_id)) {
    defaults$formulary_type_id <- formulary_type_id
  }
  if (!missing(frequency_id)) {
    defaults$frequency_id <- frequency_id
  }
  if (!missing(order_stop_type_id)) {
    defaults$order_stop_type_id <- order_stop_type_id
  }
  if (!missing(order_type_id)) {
    defaults$order_type_id <- order_type_id
  }
  if (!missing(med_order_status_id)) {
    defaults$med_order_status_id <- med_order_status_id
  }
  if (!missing(med_started_dt_id)) {
    defaults$med_started_dt_id <- med_started_dt_id
  }
  if (!missing(med_entered_dt_id)) {
    defaults$med_entered_dt_id <- med_entered_dt_id
  }
  if (!missing(med_stopped_dt_id)) {
    defaults$med_stopped_dt_id <- med_stopped_dt_id
  }
  if (!missing(med_discontinued_dt_id)) {
    defaults$med_discontinued_dt_id <- med_discontinued_dt_id
  }
  if (!missing(order_no)) {
    defaults$order_no <- order_no
  }
  if (!missing(total_dispensed_doses)) {
    defaults$total_dispensed_doses <- total_dispensed_doses
  }
  if (!missing(dose_quantity)) {
    defaults$dose_quantity <- dose_quantity
  }
  if (!missing(initial_dose_quantity)) {
    defaults$initial_dose_quantity <- initial_dose_quantity
  }
  if (!missing(dose_units_id)) {
    defaults$dose_units_id <- dose_units_id
  }
  if (!missing(charge_quantity)) {
    defaults$charge_quantity <- charge_quantity
  }
  if (!missing(credit_quantity)) {
    defaults$credit_quantity <- credit_quantity
  }
  if (!missing(infusion_rate)) {
    defaults$infusion_rate <- infusion_rate
  }
  if (!missing(infusion_time)) {
    defaults$infusion_time <- infusion_time
  }
  if (!missing(infusion_time_units_id)) {
    defaults$infusion_time_units_id <- infusion_time_units_id
  }
  if (!missing(order_strength)) {
    defaults$order_strength <- order_strength
  }
  if (!missing(order_strength_units_id)) {
    defaults$order_strength_units_id <- order_strength_units_id
  }
  if (!missing(order_volume)) {
    defaults$order_volume <- order_volume
  }
  if (!missing(order_volume_units_id)) {
    defaults$order_volume_units_id <- order_volume_units_id
  }
  if (!missing(total_volume)) {
    defaults$total_volume <- total_volume
  }
  if (!missing(unit_cost)) {
    defaults$unit_cost <- unit_cost
  }
  if (!missing(unit_price)) {
    defaults$unit_price <- unit_price
  }
  if (!missing(med_started_dt_tm)) {
    defaults$med_started_dt_tm <- med_started_dt_tm
  }
  if (!missing(med_entered_dt_tm)) {
    defaults$med_entered_dt_tm <- med_entered_dt_tm
  }
  if (!missing(med_stopped_dt_tm)) {
    defaults$med_stopped_dt_tm <- med_stopped_dt_tm
  }
  if (!missing(med_discontinued_dt_tm)) {
    defaults$med_discontinued_dt_tm <- med_discontinued_dt_tm
  }
  if (!missing(med_started_tm_valid_flg)) {
    defaults$med_started_tm_valid_flg <- med_started_tm_valid_flg
  }
  if (!missing(med_entered_tm_valid_flg)) {
    defaults$med_entered_tm_valid_flg <- med_entered_tm_valid_flg
  }
  if (!missing(med_stopped_tm_valid_flg)) {
    defaults$med_stopped_tm_valid_flg <- med_stopped_tm_valid_flg
  }
  if (!missing(med_discontinued_tm_valid_flg)) {
    defaults$med_discontinued_tm_valid_flg <- med_discontinued_tm_valid_flg
  }
  # if (!missing(_extractyear)) {
  #   defaults$_extractyear <- _extractyear
  # }
  assign('hf_f_medication', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_f_micro_susceptibility <- function(encounter_id, order_lab_procedure_id, test_type_id, isolate_id, antimicrobial_id, interp_result_id, interp_perf_dt_id, interp_perf_dt_tm, interp_perf_tm_vld_flg, interp_verf_dt_id, interp_verf_dt_tm, interp_verf_tm_vld_flg, accession, numeric_result, numeric_result_perf_dt_id, numeric_result_perf_dt_tm, numeric_result_perf_tm_vld_flg, numeric_result_verf_dt_id, numeric_result_verf_dt_tm, numeric_result_verf_tm_vld_flg, result_units_id, collection_source_id, collection_site_id, collection_method_id#, _extractyear
                                                   ) {
  defaults <- get('hf_f_micro_susceptibility', envir = defaultValues)
  if (!missing(encounter_id)) {
    defaults$encounter_id <- encounter_id
  }
  if (!missing(order_lab_procedure_id)) {
    defaults$order_lab_procedure_id <- order_lab_procedure_id
  }
  if (!missing(test_type_id)) {
    defaults$test_type_id <- test_type_id
  }
  if (!missing(isolate_id)) {
    defaults$isolate_id <- isolate_id
  }
  if (!missing(antimicrobial_id)) {
    defaults$antimicrobial_id <- antimicrobial_id
  }
  if (!missing(interp_result_id)) {
    defaults$interp_result_id <- interp_result_id
  }
  if (!missing(interp_perf_dt_id)) {
    defaults$interp_perf_dt_id <- interp_perf_dt_id
  }
  if (!missing(interp_perf_dt_tm)) {
    defaults$interp_perf_dt_tm <- interp_perf_dt_tm
  }
  if (!missing(interp_perf_tm_vld_flg)) {
    defaults$interp_perf_tm_vld_flg <- interp_perf_tm_vld_flg
  }
  if (!missing(interp_verf_dt_id)) {
    defaults$interp_verf_dt_id <- interp_verf_dt_id
  }
  if (!missing(interp_verf_dt_tm)) {
    defaults$interp_verf_dt_tm <- interp_verf_dt_tm
  }
  if (!missing(interp_verf_tm_vld_flg)) {
    defaults$interp_verf_tm_vld_flg <- interp_verf_tm_vld_flg
  }
  if (!missing(accession)) {
    defaults$accession <- accession
  }
  if (!missing(numeric_result)) {
    defaults$numeric_result <- numeric_result
  }
  if (!missing(numeric_result_perf_dt_id)) {
    defaults$numeric_result_perf_dt_id <- numeric_result_perf_dt_id
  }
  if (!missing(numeric_result_perf_dt_tm)) {
    defaults$numeric_result_perf_dt_tm <- numeric_result_perf_dt_tm
  }
  if (!missing(numeric_result_perf_tm_vld_flg)) {
    defaults$numeric_result_perf_tm_vld_flg <- numeric_result_perf_tm_vld_flg
  }
  if (!missing(numeric_result_verf_dt_id)) {
    defaults$numeric_result_verf_dt_id <- numeric_result_verf_dt_id
  }
  if (!missing(numeric_result_verf_dt_tm)) {
    defaults$numeric_result_verf_dt_tm <- numeric_result_verf_dt_tm
  }
  if (!missing(numeric_result_verf_tm_vld_flg)) {
    defaults$numeric_result_verf_tm_vld_flg <- numeric_result_verf_tm_vld_flg
  }
  if (!missing(result_units_id)) {
    defaults$result_units_id <- result_units_id
  }
  if (!missing(collection_source_id)) {
    defaults$collection_source_id <- collection_source_id
  }
  if (!missing(collection_site_id)) {
    defaults$collection_site_id <- collection_site_id
  }
  if (!missing(collection_method_id)) {
    defaults$collection_method_id <- collection_method_id
  }
  # if (!missing(_extractyear)) {
  #   defaults$_extractyear <- _extractyear
  # }
  assign('hf_f_micro_susceptibility', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_f_microbiology <- function(encounter_id, order_lab_procedure_id, isolate_id, ordering_physician_id, micro_order_caresetting_id, micro_result_type_id, result_type_procedure_id, collection_source_id, collection_site_id, reporting_priority_id, micro_order_status_id, collection_status_id, micro_lab_ordered_dt_id, micro_lab_drawn_dt_id, micro_lab_received_dt_id, micro_lab_completed_dt_id, micro_lab_cancelled_dt_id, first_report_entered_dt_id, last_report_updated_dt_id, accession, false_positive_ind, total_report_updates, micro_lab_ordered_dt_tm, micro_lab_drawn_dt_tm, micro_lab_received_dt_tm, micro_lab_completed_dt_tm, micro_lab_cancelled_dt_tm, first_report_entered_dt_tm, last_report_updated_dt_tm, micro_lab_ordered_tm_vld_flg, micro_lab_drawn_tm_vld_flg, micro_lab_received_tm_vld_flg, micro_lab_complted_tm_vld_flg, micro_lab_cancelled_tm_vld_flg, first_rpt_entered_tm_vld_flg, last_rpt_updated_tm_vld_flg, collection_method_id#, _extractyear
                                           ) {
  defaults <- get('hf_f_microbiology', envir = defaultValues)
  if (!missing(encounter_id)) {
    defaults$encounter_id <- encounter_id
  }
  if (!missing(order_lab_procedure_id)) {
    defaults$order_lab_procedure_id <- order_lab_procedure_id
  }
  if (!missing(isolate_id)) {
    defaults$isolate_id <- isolate_id
  }
  if (!missing(ordering_physician_id)) {
    defaults$ordering_physician_id <- ordering_physician_id
  }
  if (!missing(micro_order_caresetting_id)) {
    defaults$micro_order_caresetting_id <- micro_order_caresetting_id
  }
  if (!missing(micro_result_type_id)) {
    defaults$micro_result_type_id <- micro_result_type_id
  }
  if (!missing(result_type_procedure_id)) {
    defaults$result_type_procedure_id <- result_type_procedure_id
  }
  if (!missing(collection_source_id)) {
    defaults$collection_source_id <- collection_source_id
  }
  if (!missing(collection_site_id)) {
    defaults$collection_site_id <- collection_site_id
  }
  if (!missing(reporting_priority_id)) {
    defaults$reporting_priority_id <- reporting_priority_id
  }
  if (!missing(micro_order_status_id)) {
    defaults$micro_order_status_id <- micro_order_status_id
  }
  if (!missing(collection_status_id)) {
    defaults$collection_status_id <- collection_status_id
  }
  if (!missing(micro_lab_ordered_dt_id)) {
    defaults$micro_lab_ordered_dt_id <- micro_lab_ordered_dt_id
  }
  if (!missing(micro_lab_drawn_dt_id)) {
    defaults$micro_lab_drawn_dt_id <- micro_lab_drawn_dt_id
  }
  if (!missing(micro_lab_received_dt_id)) {
    defaults$micro_lab_received_dt_id <- micro_lab_received_dt_id
  }
  if (!missing(micro_lab_completed_dt_id)) {
    defaults$micro_lab_completed_dt_id <- micro_lab_completed_dt_id
  }
  if (!missing(micro_lab_cancelled_dt_id)) {
    defaults$micro_lab_cancelled_dt_id <- micro_lab_cancelled_dt_id
  }
  if (!missing(first_report_entered_dt_id)) {
    defaults$first_report_entered_dt_id <- first_report_entered_dt_id
  }
  if (!missing(last_report_updated_dt_id)) {
    defaults$last_report_updated_dt_id <- last_report_updated_dt_id
  }
  if (!missing(accession)) {
    defaults$accession <- accession
  }
  if (!missing(false_positive_ind)) {
    defaults$false_positive_ind <- false_positive_ind
  }
  if (!missing(total_report_updates)) {
    defaults$total_report_updates <- total_report_updates
  }
  if (!missing(micro_lab_ordered_dt_tm)) {
    defaults$micro_lab_ordered_dt_tm <- micro_lab_ordered_dt_tm
  }
  if (!missing(micro_lab_drawn_dt_tm)) {
    defaults$micro_lab_drawn_dt_tm <- micro_lab_drawn_dt_tm
  }
  if (!missing(micro_lab_received_dt_tm)) {
    defaults$micro_lab_received_dt_tm <- micro_lab_received_dt_tm
  }
  if (!missing(micro_lab_completed_dt_tm)) {
    defaults$micro_lab_completed_dt_tm <- micro_lab_completed_dt_tm
  }
  if (!missing(micro_lab_cancelled_dt_tm)) {
    defaults$micro_lab_cancelled_dt_tm <- micro_lab_cancelled_dt_tm
  }
  if (!missing(first_report_entered_dt_tm)) {
    defaults$first_report_entered_dt_tm <- first_report_entered_dt_tm
  }
  if (!missing(last_report_updated_dt_tm)) {
    defaults$last_report_updated_dt_tm <- last_report_updated_dt_tm
  }
  if (!missing(micro_lab_ordered_tm_vld_flg)) {
    defaults$micro_lab_ordered_tm_vld_flg <- micro_lab_ordered_tm_vld_flg
  }
  if (!missing(micro_lab_drawn_tm_vld_flg)) {
    defaults$micro_lab_drawn_tm_vld_flg <- micro_lab_drawn_tm_vld_flg
  }
  if (!missing(micro_lab_received_tm_vld_flg)) {
    defaults$micro_lab_received_tm_vld_flg <- micro_lab_received_tm_vld_flg
  }
  if (!missing(micro_lab_complted_tm_vld_flg)) {
    defaults$micro_lab_complted_tm_vld_flg <- micro_lab_complted_tm_vld_flg
  }
  if (!missing(micro_lab_cancelled_tm_vld_flg)) {
    defaults$micro_lab_cancelled_tm_vld_flg <- micro_lab_cancelled_tm_vld_flg
  }
  if (!missing(first_rpt_entered_tm_vld_flg)) {
    defaults$first_rpt_entered_tm_vld_flg <- first_rpt_entered_tm_vld_flg
  }
  if (!missing(last_rpt_updated_tm_vld_flg)) {
    defaults$last_rpt_updated_tm_vld_flg <- last_rpt_updated_tm_vld_flg
  }
  if (!missing(collection_method_id)) {
    defaults$collection_method_id <- collection_method_id
  }
  # if (!missing(_extractyear)) {
  #   defaults$_extractyear <- _extractyear
  # }
  assign('hf_f_microbiology', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_f_procedure <- function(encounter_id, procedure_id, procedure_dt_id, procedure_dt_tm, procedure_priority, third_party_ind#, _extractyear
                                        ) {
  defaults <- get('hf_f_procedure', envir = defaultValues)
  if (!missing(encounter_id)) {
    defaults$encounter_id <- encounter_id
  }
  if (!missing(procedure_id)) {
    defaults$procedure_id <- procedure_id
  }
  if (!missing(procedure_dt_id)) {
    defaults$procedure_dt_id <- procedure_dt_id
  }
  if (!missing(procedure_dt_tm)) {
    defaults$procedure_dt_tm <- procedure_dt_tm
  }
  if (!missing(procedure_priority)) {
    defaults$procedure_priority <- procedure_priority
  }
  if (!missing(third_party_ind)) {
    defaults$third_party_ind <- third_party_ind
  }
  # if (!missing(_extractyear)) {
  #   defaults$_extractyear <- _extractyear
  # }
  assign('hf_f_procedure', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_f_surgical_case <- function(surgical_case_id, encounter_id, case_level_id, case_start_dt_tm, case_stop_dt_tm, case_start_dt_id, case_stop_dt_id, case_duration, scheduled_case_start_dt_tm, scheduled_case_stop_dt_tm, scheduled_case_start_dt_id, scheduled_case_stop_dt_id, scheduled_case_duration, case_specialty_id, case_completed_ind, case_cancelled_dt_tm, case_cancelled_dt_id, case_cancelled_reason_id, case_closing_start_dt_tm, case_closing_start_dt_id, transport_requested_dt_tm, transport_requested_dt_id, operating_room_setup_dt_tm, operating_room_ready_dt_tm, operating_room_setup_dt_id, operating_room_ready_dt_id, patient_in_preop_hold_dt_tm, patient_out_preop_hold_dt_tm, patient_in_preop_hold_dt_id, patient_out_preop_hold_dt_id, preop_antibiotic_admin_dt_tm, preop_antibiotic_admin_dt_id, patient_in_oper_room_dt_tm, patient_out_oper_room_dt_tm, patient_out_oper_room_dt_id, anesthesia_start_dt_tm, anesthesia_induct_dt_tm, anesthesia_stop_dt_tm, anesthesia_start_dt_id, anesthesia_induct_dt_id, anesthesia_stop_dt_id, anesthesia_induct_stop_duratn, surgeon_in_oper_room_dt_tm, surgeon_in_oper_room_dt_id, patient_in_pacu_dt_tm, patient_out_pacu_dt_tm, patient_in_pacu_ii_dt_tm, patient_out_pacu_ii_dt_tm, patient_in_pacu_dt_id, patient_out_pacu_dt_id, patient_in_pacu_ii_dt_id, patient_out_pacu_ii_dt_id, patient_in_oper_room_dt_id#, _extractyear
                                            ) {
  defaults <- get('hf_f_surgical_case', envir = defaultValues)
  if (!missing(surgical_case_id)) {
    defaults$surgical_case_id <- surgical_case_id
  }
  if (!missing(encounter_id)) {
    defaults$encounter_id <- encounter_id
  }
  if (!missing(case_level_id)) {
    defaults$case_level_id <- case_level_id
  }
  if (!missing(case_start_dt_tm)) {
    defaults$case_start_dt_tm <- case_start_dt_tm
  }
  if (!missing(case_stop_dt_tm)) {
    defaults$case_stop_dt_tm <- case_stop_dt_tm
  }
  if (!missing(case_start_dt_id)) {
    defaults$case_start_dt_id <- case_start_dt_id
  }
  if (!missing(case_stop_dt_id)) {
    defaults$case_stop_dt_id <- case_stop_dt_id
  }
  if (!missing(case_duration)) {
    defaults$case_duration <- case_duration
  }
  if (!missing(scheduled_case_start_dt_tm)) {
    defaults$scheduled_case_start_dt_tm <- scheduled_case_start_dt_tm
  }
  if (!missing(scheduled_case_stop_dt_tm)) {
    defaults$scheduled_case_stop_dt_tm <- scheduled_case_stop_dt_tm
  }
  if (!missing(scheduled_case_start_dt_id)) {
    defaults$scheduled_case_start_dt_id <- scheduled_case_start_dt_id
  }
  if (!missing(scheduled_case_stop_dt_id)) {
    defaults$scheduled_case_stop_dt_id <- scheduled_case_stop_dt_id
  }
  if (!missing(scheduled_case_duration)) {
    defaults$scheduled_case_duration <- scheduled_case_duration
  }
  if (!missing(case_specialty_id)) {
    defaults$case_specialty_id <- case_specialty_id
  }
  if (!missing(case_completed_ind)) {
    defaults$case_completed_ind <- case_completed_ind
  }
  if (!missing(case_cancelled_dt_tm)) {
    defaults$case_cancelled_dt_tm <- case_cancelled_dt_tm
  }
  if (!missing(case_cancelled_dt_id)) {
    defaults$case_cancelled_dt_id <- case_cancelled_dt_id
  }
  if (!missing(case_cancelled_reason_id)) {
    defaults$case_cancelled_reason_id <- case_cancelled_reason_id
  }
  if (!missing(case_closing_start_dt_tm)) {
    defaults$case_closing_start_dt_tm <- case_closing_start_dt_tm
  }
  if (!missing(case_closing_start_dt_id)) {
    defaults$case_closing_start_dt_id <- case_closing_start_dt_id
  }
  if (!missing(transport_requested_dt_tm)) {
    defaults$transport_requested_dt_tm <- transport_requested_dt_tm
  }
  if (!missing(transport_requested_dt_id)) {
    defaults$transport_requested_dt_id <- transport_requested_dt_id
  }
  if (!missing(operating_room_setup_dt_tm)) {
    defaults$operating_room_setup_dt_tm <- operating_room_setup_dt_tm
  }
  if (!missing(operating_room_ready_dt_tm)) {
    defaults$operating_room_ready_dt_tm <- operating_room_ready_dt_tm
  }
  if (!missing(operating_room_setup_dt_id)) {
    defaults$operating_room_setup_dt_id <- operating_room_setup_dt_id
  }
  if (!missing(operating_room_ready_dt_id)) {
    defaults$operating_room_ready_dt_id <- operating_room_ready_dt_id
  }
  if (!missing(patient_in_preop_hold_dt_tm)) {
    defaults$patient_in_preop_hold_dt_tm <- patient_in_preop_hold_dt_tm
  }
  if (!missing(patient_out_preop_hold_dt_tm)) {
    defaults$patient_out_preop_hold_dt_tm <- patient_out_preop_hold_dt_tm
  }
  if (!missing(patient_in_preop_hold_dt_id)) {
    defaults$patient_in_preop_hold_dt_id <- patient_in_preop_hold_dt_id
  }
  if (!missing(patient_out_preop_hold_dt_id)) {
    defaults$patient_out_preop_hold_dt_id <- patient_out_preop_hold_dt_id
  }
  if (!missing(preop_antibiotic_admin_dt_tm)) {
    defaults$preop_antibiotic_admin_dt_tm <- preop_antibiotic_admin_dt_tm
  }
  if (!missing(preop_antibiotic_admin_dt_id)) {
    defaults$preop_antibiotic_admin_dt_id <- preop_antibiotic_admin_dt_id
  }
  if (!missing(patient_in_oper_room_dt_tm)) {
    defaults$patient_in_oper_room_dt_tm <- patient_in_oper_room_dt_tm
  }
  if (!missing(patient_out_oper_room_dt_tm)) {
    defaults$patient_out_oper_room_dt_tm <- patient_out_oper_room_dt_tm
  }
  if (!missing(patient_out_oper_room_dt_id)) {
    defaults$patient_out_oper_room_dt_id <- patient_out_oper_room_dt_id
  }
  if (!missing(anesthesia_start_dt_tm)) {
    defaults$anesthesia_start_dt_tm <- anesthesia_start_dt_tm
  }
  if (!missing(anesthesia_induct_dt_tm)) {
    defaults$anesthesia_induct_dt_tm <- anesthesia_induct_dt_tm
  }
  if (!missing(anesthesia_stop_dt_tm)) {
    defaults$anesthesia_stop_dt_tm <- anesthesia_stop_dt_tm
  }
  if (!missing(anesthesia_start_dt_id)) {
    defaults$anesthesia_start_dt_id <- anesthesia_start_dt_id
  }
  if (!missing(anesthesia_induct_dt_id)) {
    defaults$anesthesia_induct_dt_id <- anesthesia_induct_dt_id
  }
  if (!missing(anesthesia_stop_dt_id)) {
    defaults$anesthesia_stop_dt_id <- anesthesia_stop_dt_id
  }
  if (!missing(anesthesia_induct_stop_duratn)) {
    defaults$anesthesia_induct_stop_duratn <- anesthesia_induct_stop_duratn
  }
  if (!missing(surgeon_in_oper_room_dt_tm)) {
    defaults$surgeon_in_oper_room_dt_tm <- surgeon_in_oper_room_dt_tm
  }
  if (!missing(surgeon_in_oper_room_dt_id)) {
    defaults$surgeon_in_oper_room_dt_id <- surgeon_in_oper_room_dt_id
  }
  if (!missing(patient_in_pacu_dt_tm)) {
    defaults$patient_in_pacu_dt_tm <- patient_in_pacu_dt_tm
  }
  if (!missing(patient_out_pacu_dt_tm)) {
    defaults$patient_out_pacu_dt_tm <- patient_out_pacu_dt_tm
  }
  if (!missing(patient_in_pacu_ii_dt_tm)) {
    defaults$patient_in_pacu_ii_dt_tm <- patient_in_pacu_ii_dt_tm
  }
  if (!missing(patient_out_pacu_ii_dt_tm)) {
    defaults$patient_out_pacu_ii_dt_tm <- patient_out_pacu_ii_dt_tm
  }
  if (!missing(patient_in_pacu_dt_id)) {
    defaults$patient_in_pacu_dt_id <- patient_in_pacu_dt_id
  }
  if (!missing(patient_out_pacu_dt_id)) {
    defaults$patient_out_pacu_dt_id <- patient_out_pacu_dt_id
  }
  if (!missing(patient_in_pacu_ii_dt_id)) {
    defaults$patient_in_pacu_ii_dt_id <- patient_in_pacu_ii_dt_id
  }
  if (!missing(patient_out_pacu_ii_dt_id)) {
    defaults$patient_out_pacu_ii_dt_id <- patient_out_pacu_ii_dt_id
  }
  if (!missing(patient_in_oper_room_dt_id)) {
    defaults$patient_in_oper_room_dt_id <- patient_in_oper_room_dt_id
  }
  # if (!missing(_extractyear)) {
  #   defaults$_extractyear <- _extractyear
  # }
  assign('hf_f_surgical_case', defaults, envir = defaultValues)
  invisible(defaults)
}

set_defaults_hf_f_surgical_procedure <- function(encounter_id, surgical_case_id, surgical_procedure_id, wound_class_id, asa_class_id, procedure_specialty_id, procedure_revision_ind, procedure_modifier_01_id, procedure_modifier_02_id, procedure_modifier_03_id, procedure_duration, procedure_start_dt_tm, procedure_stop_dt_tm, procedure_start_dt_id, procedure_stop_dt_id, primary_procedure_ind, scheduled_procedure_duration, procedure_completion_ind, concurrent_procedure_ind, anesthesia_type_id, expected_case_level_id, case_level_id#, _extractyear
                                                 ) {
  defaults <- get('hf_f_surgical_procedure', envir = defaultValues)
  if (!missing(encounter_id)) {
    defaults$encounter_id <- encounter_id
  }
  if (!missing(surgical_case_id)) {
    defaults$surgical_case_id <- surgical_case_id
  }
  if (!missing(surgical_procedure_id)) {
    defaults$surgical_procedure_id <- surgical_procedure_id
  }
  if (!missing(wound_class_id)) {
    defaults$wound_class_id <- wound_class_id
  }
  if (!missing(asa_class_id)) {
    defaults$asa_class_id <- asa_class_id
  }
  if (!missing(procedure_specialty_id)) {
    defaults$procedure_specialty_id <- procedure_specialty_id
  }
  if (!missing(procedure_revision_ind)) {
    defaults$procedure_revision_ind <- procedure_revision_ind
  }
  if (!missing(procedure_modifier_01_id)) {
    defaults$procedure_modifier_01_id <- procedure_modifier_01_id
  }
  if (!missing(procedure_modifier_02_id)) {
    defaults$procedure_modifier_02_id <- procedure_modifier_02_id
  }
  if (!missing(procedure_modifier_03_id)) {
    defaults$procedure_modifier_03_id <- procedure_modifier_03_id
  }
  if (!missing(procedure_duration)) {
    defaults$procedure_duration <- procedure_duration
  }
  if (!missing(procedure_start_dt_tm)) {
    defaults$procedure_start_dt_tm <- procedure_start_dt_tm
  }
  if (!missing(procedure_stop_dt_tm)) {
    defaults$procedure_stop_dt_tm <- procedure_stop_dt_tm
  }
  if (!missing(procedure_start_dt_id)) {
    defaults$procedure_start_dt_id <- procedure_start_dt_id
  }
  if (!missing(procedure_stop_dt_id)) {
    defaults$procedure_stop_dt_id <- procedure_stop_dt_id
  }
  if (!missing(primary_procedure_ind)) {
    defaults$primary_procedure_ind <- primary_procedure_ind
  }
  if (!missing(scheduled_procedure_duration)) {
    defaults$scheduled_procedure_duration <- scheduled_procedure_duration
  }
  if (!missing(procedure_completion_ind)) {
    defaults$procedure_completion_ind <- procedure_completion_ind
  }
  if (!missing(concurrent_procedure_ind)) {
    defaults$concurrent_procedure_ind <- concurrent_procedure_ind
  }
  if (!missing(anesthesia_type_id)) {
    defaults$anesthesia_type_id <- anesthesia_type_id
  }
  if (!missing(expected_case_level_id)) {
    defaults$expected_case_level_id <- expected_case_level_id
  }
  if (!missing(case_level_id)) {
    defaults$case_level_id <- case_level_id
  }
  # if (!missing(_extractyear)) {
  #   defaults$_extractyear <- _extractyear
  # }
  assign('hf_f_surgical_procedure', defaults, envir = defaultValues)
  invisible(defaults)
}

get_defaults_hf_d_admission_source <- function() {
  defaults <- get('hf_d_admission_source', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_admission_type <- function() {
  defaults <- get('hf_d_admission_type', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_anesthesia_type <- function() {
  defaults <- get('hf_d_anesthesia_type', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_antimicrobial <- function() {
  defaults <- get('hf_d_antimicrobial', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_asa_class <- function() {
  defaults <- get('hf_d_asa_class', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_cancel_reason <- function() {
  defaults <- get('hf_d_cancel_reason', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_caresetting <- function() {
  defaults <- get('hf_d_caresetting', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_collection_src_site <- function() {
  defaults <- get('hf_d_collection_src_site', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_collection_status <- function() {
  defaults <- get('hf_d_collection_status', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_compliance_status <- function() {
  defaults <- get('hf_d_compliance_status', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_date <- function() {
  defaults <- get('hf_d_date', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_diagnosis <- function() {
  defaults <- get('hf_d_diagnosis', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_diagnosis_type <- function() {
  defaults <- get('hf_d_diagnosis_type', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_diagnostic_grouping <- function() {
  defaults <- get('hf_d_diagnostic_grouping', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_dischg_disp <- function() {
  defaults <- get('hf_d_dischg_disp', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_discontinue_reason <- function() {
  defaults <- get('hf_d_discontinue_reason', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_event_class <- function() {
  defaults <- get('hf_d_event_class', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_event_code <- function() {
  defaults <- get('hf_d_event_code', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_event_reltn <- function() {
  defaults <- get('hf_d_event_reltn', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_event_source <- function() {
  defaults <- get('hf_d_event_source', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_formulary_type <- function() {
  defaults <- get('hf_d_formulary_type', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_frequency <- function() {
  defaults <- get('hf_d_frequency', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_hospital <- function() {
  defaults <- get('hf_d_hospital', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_interp_result <- function() {
  defaults <- get('hf_d_interp_result', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_isolate <- function() {
  defaults <- get('hf_d_isolate', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_lab_procedure <- function() {
  defaults <- get('hf_d_lab_procedure', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_lab_result_type <- function() {
  defaults <- get('hf_d_lab_result_type', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_manufacturer <- function() {
  defaults <- get('hf_d_manufacturer', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_med_order_status <- function() {
  defaults <- get('hf_d_med_order_status', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_med_product <- function() {
  defaults <- get('hf_d_med_product', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_med_reason <- function() {
  defaults <- get('hf_d_med_reason', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_medication <- function() {
  defaults <- get('hf_d_medication', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_mic_order_status <- function() {
  defaults <- get('hf_d_mic_order_status', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_micro_result_type <- function() {
  defaults <- get('hf_d_micro_result_type', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_normalcy <- function() {
  defaults <- get('hf_d_normalcy', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_normalcy_method <- function() {
  defaults <- get('hf_d_normalcy_method', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_order_stop_type <- function() {
  defaults <- get('hf_d_order_stop_type', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_order_type <- function() {
  defaults <- get('hf_d_order_type', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_patient <- function() {
  defaults <- get('hf_d_patient', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_patient_type <- function() {
  defaults <- get('hf_d_patient_type', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_payer <- function() {
  defaults <- get('hf_d_payer', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_physician <- function() {
  defaults <- get('hf_d_physician', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_present_on_admit <- function() {
  defaults <- get('hf_d_present_on_admit', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_procedure <- function() {
  defaults <- get('hf_d_procedure', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_procedure_modifier <- function() {
  defaults <- get('hf_d_procedure_modifier', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_reporting_priority <- function() {
  defaults <- get('hf_d_reporting_priority', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_result_indicator <- function() {
  defaults <- get('hf_d_result_indicator', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_result_type_proc <- function() {
  defaults <- get('hf_d_result_type_proc', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_route_admin <- function() {
  defaults <- get('hf_d_route_admin', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_surgical_case_level <- function() {
  defaults <- get('hf_d_surgical_case_level', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_surgical_procedure <- function() {
  defaults <- get('hf_d_surgical_procedure', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_surgical_specialty <- function() {
  defaults <- get('hf_d_surgical_specialty', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_test_type <- function() {
  defaults <- get('hf_d_test_type', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_unit <- function() {
  defaults <- get('hf_d_unit', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_d_wound_class <- function() {
  defaults <- get('hf_d_wound_class', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_f_clinical_event <- function() {
  defaults <- get('hf_f_clinical_event', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_f_diagnosis <- function() {
  defaults <- get('hf_f_diagnosis', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_f_enc_history <- function() {
  defaults <- get('hf_f_enc_history', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_f_encounter <- function() {
  defaults <- get('hf_f_encounter', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_f_implant_log <- function() {
  defaults <- get('hf_f_implant_log', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_f_lab_procedure <- function() {
  defaults <- get('hf_f_lab_procedure', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_f_med_history <- function() {
  defaults <- get('hf_f_med_history', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_f_medication <- function() {
  defaults <- get('hf_f_medication', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_f_micro_susceptibility <- function() {
  defaults <- get('hf_f_micro_susceptibility', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_f_microbiology <- function() {
  defaults <- get('hf_f_microbiology', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_f_procedure <- function() {
  defaults <- get('hf_f_procedure', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_f_surgical_case <- function() {
  defaults <- get('hf_f_surgical_case', envir = defaultValues)
  return(defaults)
}

get_defaults_hf_f_surgical_procedure <- function() {
  defaults <- get('hf_f_surgical_procedure', envir = defaultValues)
  return(defaults)
}

add_hf_d_admission_source <- function(admission_source_id, admission_source_code, admission_source_code_desc) {
  defaults <- get('hf_d_admission_source', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(admission_source_id)) {
    admission_source_id <- defaults$admission_source_id
  }
  if (!is.null(admission_source_id)) {
    insertFields <- c(insertFields, "admission_source_id")
    insertValues <- c(insertValues, admission_source_id)
  }

  if (missing(admission_source_code)) {
    admission_source_code <- defaults$admission_source_code
  }
  if (!is.null(admission_source_code)) {
    insertFields <- c(insertFields, "admission_source_code")
    insertValues <- c(insertValues, admission_source_code)
  }

  if (missing(admission_source_code_desc)) {
    admission_source_code_desc <- defaults$admission_source_code_desc
  }
  if (!is.null(admission_source_code_desc)) {
    insertFields <- c(insertFields, "admission_source_code_desc")
    insertValues <- c(insertValues, admission_source_code_desc)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_admission_source', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_admission_source (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_admission_source', statement)
  invisible(statement)
}

add_hf_d_admission_type <- function(admission_type_id, admission_type_code, admission_type_code_desc) {
  defaults <- get('hf_d_admission_type', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(admission_type_id)) {
    admission_type_id <- defaults$admission_type_id
  }
  if (!is.null(admission_type_id)) {
    insertFields <- c(insertFields, "admission_type_id")
    insertValues <- c(insertValues, admission_type_id)
  }

  if (missing(admission_type_code)) {
    admission_type_code <- defaults$admission_type_code
  }
  if (!is.null(admission_type_code)) {
    insertFields <- c(insertFields, "admission_type_code")
    insertValues <- c(insertValues, admission_type_code)
  }

  if (missing(admission_type_code_desc)) {
    admission_type_code_desc <- defaults$admission_type_code_desc
  }
  if (!is.null(admission_type_code_desc)) {
    insertFields <- c(insertFields, "admission_type_code_desc")
    insertValues <- c(insertValues, admission_type_code_desc)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_admission_type', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_admission_type (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_admission_type', statement)
  invisible(statement)
}

add_hf_d_anesthesia_type <- function(anesthesia_type_id, anesthesia_type_desc) {
  defaults <- get('hf_d_anesthesia_type', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(anesthesia_type_id)) {
    anesthesia_type_id <- defaults$anesthesia_type_id
  }
  if (!is.null(anesthesia_type_id)) {
    insertFields <- c(insertFields, "anesthesia_type_id")
    insertValues <- c(insertValues, anesthesia_type_id)
  }

  if (missing(anesthesia_type_desc)) {
    anesthesia_type_desc <- defaults$anesthesia_type_desc
  }
  if (!is.null(anesthesia_type_desc)) {
    insertFields <- c(insertFields, "anesthesia_type_desc")
    insertValues <- c(insertValues, anesthesia_type_desc)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_anesthesia_type', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_anesthesia_type (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_anesthesia_type', statement)
  invisible(statement)
}

add_hf_d_antimicrobial <- function(antimicrobial_id, antimicrobial_dcode, antimicrobial_desc, drug_classification, antibiogram_class, antimicrobial_mnemonic, loinc_long, loinc_short) {
  defaults <- get('hf_d_antimicrobial', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(antimicrobial_id)) {
    antimicrobial_id <- defaults$antimicrobial_id
  }
  if (!is.null(antimicrobial_id)) {
    insertFields <- c(insertFields, "antimicrobial_id")
    insertValues <- c(insertValues, antimicrobial_id)
  }

  if (missing(antimicrobial_dcode)) {
    antimicrobial_dcode <- defaults$antimicrobial_dcode
  }
  if (!is.null(antimicrobial_dcode)) {
    insertFields <- c(insertFields, "antimicrobial_dcode")
    insertValues <- c(insertValues, antimicrobial_dcode)
  }

  if (missing(antimicrobial_desc)) {
    antimicrobial_desc <- defaults$antimicrobial_desc
  }
  if (!is.null(antimicrobial_desc)) {
    insertFields <- c(insertFields, "antimicrobial_desc")
    insertValues <- c(insertValues, antimicrobial_desc)
  }

  if (missing(drug_classification)) {
    drug_classification <- defaults$drug_classification
  }
  if (!is.null(drug_classification)) {
    insertFields <- c(insertFields, "drug_classification")
    insertValues <- c(insertValues, drug_classification)
  }

  if (missing(antibiogram_class)) {
    antibiogram_class <- defaults$antibiogram_class
  }
  if (!is.null(antibiogram_class)) {
    insertFields <- c(insertFields, "antibiogram_class")
    insertValues <- c(insertValues, antibiogram_class)
  }

  if (missing(antimicrobial_mnemonic)) {
    antimicrobial_mnemonic <- defaults$antimicrobial_mnemonic
  }
  if (!is.null(antimicrobial_mnemonic)) {
    insertFields <- c(insertFields, "antimicrobial_mnemonic")
    insertValues <- c(insertValues, antimicrobial_mnemonic)
  }

  if (missing(loinc_long)) {
    loinc_long <- defaults$loinc_long
  }
  if (!is.null(loinc_long)) {
    insertFields <- c(insertFields, "loinc_long")
    insertValues <- c(insertValues, loinc_long)
  }

  if (missing(loinc_short)) {
    loinc_short <- defaults$loinc_short
  }
  if (!is.null(loinc_short)) {
    insertFields <- c(insertFields, "loinc_short")
    insertValues <- c(insertValues, loinc_short)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_antimicrobial', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_antimicrobial (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_antimicrobial', statement)
  invisible(statement)
}

add_hf_d_asa_class <- function(asa_class_id, asa_class_code, asa_class_desc) {
  defaults <- get('hf_d_asa_class', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(asa_class_id)) {
    asa_class_id <- defaults$asa_class_id
  }
  if (!is.null(asa_class_id)) {
    insertFields <- c(insertFields, "asa_class_id")
    insertValues <- c(insertValues, asa_class_id)
  }

  if (missing(asa_class_code)) {
    asa_class_code <- defaults$asa_class_code
  }
  if (!is.null(asa_class_code)) {
    insertFields <- c(insertFields, "asa_class_code")
    insertValues <- c(insertValues, asa_class_code)
  }

  if (missing(asa_class_desc)) {
    asa_class_desc <- defaults$asa_class_desc
  }
  if (!is.null(asa_class_desc)) {
    insertFields <- c(insertFields, "asa_class_desc")
    insertValues <- c(insertValues, asa_class_desc)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_asa_class', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_asa_class (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_asa_class', statement)
  invisible(statement)
}

add_hf_d_cancel_reason <- function(cancel_reason_id, cancel_reason_desc) {
  defaults <- get('hf_d_cancel_reason', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(cancel_reason_id)) {
    cancel_reason_id <- defaults$cancel_reason_id
  }
  if (!is.null(cancel_reason_id)) {
    insertFields <- c(insertFields, "cancel_reason_id")
    insertValues <- c(insertValues, cancel_reason_id)
  }

  if (missing(cancel_reason_desc)) {
    cancel_reason_desc <- defaults$cancel_reason_desc
  }
  if (!is.null(cancel_reason_desc)) {
    insertFields <- c(insertFields, "cancel_reason_desc")
    insertValues <- c(insertValues, cancel_reason_desc)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_cancel_reason', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_cancel_reason (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_cancel_reason', statement)
  invisible(statement)
}

add_hf_d_caresetting <- function(caresetting_id, caresetting_desc) {
  defaults <- get('hf_d_caresetting', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(caresetting_id)) {
    caresetting_id <- defaults$caresetting_id
  }
  if (!is.null(caresetting_id)) {
    insertFields <- c(insertFields, "caresetting_id")
    insertValues <- c(insertValues, caresetting_id)
  }

  if (missing(caresetting_desc)) {
    caresetting_desc <- defaults$caresetting_desc
  }
  if (!is.null(caresetting_desc)) {
    insertFields <- c(insertFields, "caresetting_desc")
    insertValues <- c(insertValues, caresetting_desc)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_caresetting', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_caresetting (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_caresetting', statement)
  invisible(statement)
}

add_hf_d_collection_src_site <- function(collection_source_site_id, snomed_code, collection_source_site_desc, source_type) {
  defaults <- get('hf_d_collection_src_site', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(collection_source_site_id)) {
    collection_source_site_id <- defaults$collection_source_site_id
  }
  if (!is.null(collection_source_site_id)) {
    insertFields <- c(insertFields, "collection_source_site_id")
    insertValues <- c(insertValues, collection_source_site_id)
  }

  if (missing(snomed_code)) {
    snomed_code <- defaults$snomed_code
  }
  if (!is.null(snomed_code)) {
    insertFields <- c(insertFields, "snomed_code")
    insertValues <- c(insertValues, snomed_code)
  }

  if (missing(collection_source_site_desc)) {
    collection_source_site_desc <- defaults$collection_source_site_desc
  }
  if (!is.null(collection_source_site_desc)) {
    insertFields <- c(insertFields, "collection_source_site_desc")
    insertValues <- c(insertValues, collection_source_site_desc)
  }

  if (missing(source_type)) {
    source_type <- defaults$source_type
  }
  if (!is.null(source_type)) {
    insertFields <- c(insertFields, "source_type")
    insertValues <- c(insertValues, source_type)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_collection_src_site', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_collection_src_site (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_collection_src_site', statement)
  invisible(statement)
}

add_hf_d_collection_status <- function(collection_status_id, collection_status_code, collection_status_desc) {
  defaults <- get('hf_d_collection_status', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(collection_status_id)) {
    collection_status_id <- defaults$collection_status_id
  }
  if (!is.null(collection_status_id)) {
    insertFields <- c(insertFields, "collection_status_id")
    insertValues <- c(insertValues, collection_status_id)
  }

  if (missing(collection_status_code)) {
    collection_status_code <- defaults$collection_status_code
  }
  if (!is.null(collection_status_code)) {
    insertFields <- c(insertFields, "collection_status_code")
    insertValues <- c(insertValues, collection_status_code)
  }

  if (missing(collection_status_desc)) {
    collection_status_desc <- defaults$collection_status_desc
  }
  if (!is.null(collection_status_desc)) {
    insertFields <- c(insertFields, "collection_status_desc")
    insertValues <- c(insertValues, collection_status_desc)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_collection_status', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_collection_status (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_collection_status', statement)
  invisible(statement)
}

add_hf_d_compliance_status <- function(compliance_status_id, compliance_desc) {
  defaults <- get('hf_d_compliance_status', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(compliance_status_id)) {
    compliance_status_id <- defaults$compliance_status_id
  }
  if (!is.null(compliance_status_id)) {
    insertFields <- c(insertFields, "compliance_status_id")
    insertValues <- c(insertValues, compliance_status_id)
  }

  if (missing(compliance_desc)) {
    compliance_desc <- defaults$compliance_desc
  }
  if (!is.null(compliance_desc)) {
    insertFields <- c(insertFields, "compliance_desc")
    insertValues <- c(insertValues, compliance_desc)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_compliance_status', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_compliance_status (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_compliance_status', statement)
  invisible(statement)
}

add_hf_d_date <- function(date_id, year, quarter, month, month_name, day_number_in_month, week_number_in_year, day_of_week, day_number_of_week, holiday_ind, weekday_ind) {
  defaults <- get('hf_d_date', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(date_id)) {
    date_id <- defaults$date_id
  }
  if (!is.null(date_id)) {
    insertFields <- c(insertFields, "date_id")
    insertValues <- c(insertValues, date_id)
  }

  if (missing(year)) {
    year <- defaults$year
  }
  if (!is.null(year)) {
    insertFields <- c(insertFields, "year")
    insertValues <- c(insertValues, year)
  }

  if (missing(quarter)) {
    quarter <- defaults$quarter
  }
  if (!is.null(quarter)) {
    insertFields <- c(insertFields, "quarter")
    insertValues <- c(insertValues, quarter)
  }

  if (missing(month)) {
    month <- defaults$month
  }
  if (!is.null(month)) {
    insertFields <- c(insertFields, "month")
    insertValues <- c(insertValues, month)
  }

  if (missing(month_name)) {
    month_name <- defaults$month_name
  }
  if (!is.null(month_name)) {
    insertFields <- c(insertFields, "month_name")
    insertValues <- c(insertValues, month_name)
  }

  if (missing(day_number_in_month)) {
    day_number_in_month <- defaults$day_number_in_month
  }
  if (!is.null(day_number_in_month)) {
    insertFields <- c(insertFields, "day_number_in_month")
    insertValues <- c(insertValues, day_number_in_month)
  }

  if (missing(week_number_in_year)) {
    week_number_in_year <- defaults$week_number_in_year
  }
  if (!is.null(week_number_in_year)) {
    insertFields <- c(insertFields, "week_number_in_year")
    insertValues <- c(insertValues, week_number_in_year)
  }

  if (missing(day_of_week)) {
    day_of_week <- defaults$day_of_week
  }
  if (!is.null(day_of_week)) {
    insertFields <- c(insertFields, "day_of_week")
    insertValues <- c(insertValues, day_of_week)
  }

  if (missing(day_number_of_week)) {
    day_number_of_week <- defaults$day_number_of_week
  }
  if (!is.null(day_number_of_week)) {
    insertFields <- c(insertFields, "day_number_of_week")
    insertValues <- c(insertValues, day_number_of_week)
  }

  if (missing(holiday_ind)) {
    holiday_ind <- defaults$holiday_ind
  }
  if (!is.null(holiday_ind)) {
    insertFields <- c(insertFields, "holiday_ind")
    insertValues <- c(insertValues, holiday_ind)
  }

  if (missing(weekday_ind)) {
    weekday_ind <- defaults$weekday_ind
  }
  if (!is.null(weekday_ind)) {
    insertFields <- c(insertFields, "weekday_ind")
    insertValues <- c(insertValues, weekday_ind)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_date', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_date (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_date', statement)
  invisible(statement)
}

add_hf_d_diagnosis <- function(diagnosis_id, diagnosis_type, diagnosis_code, diagnosis_description) {
  defaults <- get('hf_d_diagnosis', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(diagnosis_id)) {
    diagnosis_id <- defaults$diagnosis_id
  }
  if (!is.null(diagnosis_id)) {
    insertFields <- c(insertFields, "diagnosis_id")
    insertValues <- c(insertValues, diagnosis_id)
  }

  if (missing(diagnosis_type)) {
    diagnosis_type <- defaults$diagnosis_type
  }
  if (!is.null(diagnosis_type)) {
    insertFields <- c(insertFields, "diagnosis_type")
    insertValues <- c(insertValues, diagnosis_type)
  }

  if (missing(diagnosis_code)) {
    diagnosis_code <- defaults$diagnosis_code
  }
  if (!is.null(diagnosis_code)) {
    insertFields <- c(insertFields, "diagnosis_code")
    insertValues <- c(insertValues, diagnosis_code)
  }

  if (missing(diagnosis_description)) {
    diagnosis_description <- defaults$diagnosis_description
  }
  if (!is.null(diagnosis_description)) {
    insertFields <- c(insertFields, "diagnosis_description")
    insertValues <- c(insertValues, diagnosis_description)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_diagnosis', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_diagnosis (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_diagnosis', statement)
  invisible(statement)
}

add_hf_d_diagnosis_type <- function(diagnosis_type_id, diagnosis_type_display) {
  defaults <- get('hf_d_diagnosis_type', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(diagnosis_type_id)) {
    diagnosis_type_id <- defaults$diagnosis_type_id
  }
  if (!is.null(diagnosis_type_id)) {
    insertFields <- c(insertFields, "diagnosis_type_id")
    insertValues <- c(insertValues, diagnosis_type_id)
  }

  if (missing(diagnosis_type_display)) {
    diagnosis_type_display <- defaults$diagnosis_type_display
  }
  if (!is.null(diagnosis_type_display)) {
    insertFields <- c(insertFields, "diagnosis_type_display")
    insertValues <- c(insertValues, diagnosis_type_display)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_diagnosis_type', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_diagnosis_type (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_diagnosis_type', statement)
  invisible(statement)
}

add_hf_d_diagnostic_grouping <- function(diagnostic_grouping_id, mdc_code, mdc_code_desc, drg_code, drg_code_desc, drg_id, mdc_id, drg_type) {
  defaults <- get('hf_d_diagnostic_grouping', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(diagnostic_grouping_id)) {
    diagnostic_grouping_id <- defaults$diagnostic_grouping_id
  }
  if (!is.null(diagnostic_grouping_id)) {
    insertFields <- c(insertFields, "diagnostic_grouping_id")
    insertValues <- c(insertValues, diagnostic_grouping_id)
  }

  if (missing(mdc_code)) {
    mdc_code <- defaults$mdc_code
  }
  if (!is.null(mdc_code)) {
    insertFields <- c(insertFields, "mdc_code")
    insertValues <- c(insertValues, mdc_code)
  }

  if (missing(mdc_code_desc)) {
    mdc_code_desc <- defaults$mdc_code_desc
  }
  if (!is.null(mdc_code_desc)) {
    insertFields <- c(insertFields, "mdc_code_desc")
    insertValues <- c(insertValues, mdc_code_desc)
  }

  if (missing(drg_code)) {
    drg_code <- defaults$drg_code
  }
  if (!is.null(drg_code)) {
    insertFields <- c(insertFields, "drg_code")
    insertValues <- c(insertValues, drg_code)
  }

  if (missing(drg_code_desc)) {
    drg_code_desc <- defaults$drg_code_desc
  }
  if (!is.null(drg_code_desc)) {
    insertFields <- c(insertFields, "drg_code_desc")
    insertValues <- c(insertValues, drg_code_desc)
  }

  if (missing(drg_id)) {
    drg_id <- defaults$drg_id
  }
  if (!is.null(drg_id)) {
    insertFields <- c(insertFields, "drg_id")
    insertValues <- c(insertValues, drg_id)
  }

  if (missing(mdc_id)) {
    mdc_id <- defaults$mdc_id
  }
  if (!is.null(mdc_id)) {
    insertFields <- c(insertFields, "mdc_id")
    insertValues <- c(insertValues, mdc_id)
  }

  if (missing(drg_type)) {
    drg_type <- defaults$drg_type
  }
  if (!is.null(drg_type)) {
    insertFields <- c(insertFields, "drg_type")
    insertValues <- c(insertValues, drg_type)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_diagnostic_grouping', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_diagnostic_grouping (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_diagnostic_grouping', statement)
  invisible(statement)
}

add_hf_d_dischg_disp <- function(dischg_disp_id, dischg_disp_code, dischg_disp_code_desc, beg_effective_dt_tm, end_effective_dt_tm) {
  defaults <- get('hf_d_dischg_disp', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(dischg_disp_id)) {
    dischg_disp_id <- defaults$dischg_disp_id
  }
  if (!is.null(dischg_disp_id)) {
    insertFields <- c(insertFields, "dischg_disp_id")
    insertValues <- c(insertValues, dischg_disp_id)
  }

  if (missing(dischg_disp_code)) {
    dischg_disp_code <- defaults$dischg_disp_code
  }
  if (!is.null(dischg_disp_code)) {
    insertFields <- c(insertFields, "dischg_disp_code")
    insertValues <- c(insertValues, dischg_disp_code)
  }

  if (missing(dischg_disp_code_desc)) {
    dischg_disp_code_desc <- defaults$dischg_disp_code_desc
  }
  if (!is.null(dischg_disp_code_desc)) {
    insertFields <- c(insertFields, "dischg_disp_code_desc")
    insertValues <- c(insertValues, dischg_disp_code_desc)
  }

  if (missing(beg_effective_dt_tm)) {
    beg_effective_dt_tm <- defaults$beg_effective_dt_tm
  }
  if (!is.null(beg_effective_dt_tm)) {
    insertFields <- c(insertFields, "beg_effective_dt_tm")
    insertValues <- c(insertValues, beg_effective_dt_tm)
  }

  if (missing(end_effective_dt_tm)) {
    end_effective_dt_tm <- defaults$end_effective_dt_tm
  }
  if (!is.null(end_effective_dt_tm)) {
    insertFields <- c(insertFields, "end_effective_dt_tm")
    insertValues <- c(insertValues, end_effective_dt_tm)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_dischg_disp', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_dischg_disp (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_dischg_disp', statement)
  invisible(statement)
}

add_hf_d_discontinue_reason <- function(discontinue_reason_id, discontinue_reason_code, discontinue_reason_desc) {
  defaults <- get('hf_d_discontinue_reason', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(discontinue_reason_id)) {
    discontinue_reason_id <- defaults$discontinue_reason_id
  }
  if (!is.null(discontinue_reason_id)) {
    insertFields <- c(insertFields, "discontinue_reason_id")
    insertValues <- c(insertValues, discontinue_reason_id)
  }

  if (missing(discontinue_reason_code)) {
    discontinue_reason_code <- defaults$discontinue_reason_code
  }
  if (!is.null(discontinue_reason_code)) {
    insertFields <- c(insertFields, "discontinue_reason_code")
    insertValues <- c(insertValues, discontinue_reason_code)
  }

  if (missing(discontinue_reason_desc)) {
    discontinue_reason_desc <- defaults$discontinue_reason_desc
  }
  if (!is.null(discontinue_reason_desc)) {
    insertFields <- c(insertFields, "discontinue_reason_desc")
    insertValues <- c(insertValues, discontinue_reason_desc)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_discontinue_reason', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_discontinue_reason (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_discontinue_reason', statement)
  invisible(statement)
}

add_hf_d_event_class <- function(event_class_id, event_class_desc) {
  defaults <- get('hf_d_event_class', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(event_class_id)) {
    event_class_id <- defaults$event_class_id
  }
  if (!is.null(event_class_id)) {
    insertFields <- c(insertFields, "event_class_id")
    insertValues <- c(insertValues, event_class_id)
  }

  if (missing(event_class_desc)) {
    event_class_desc <- defaults$event_class_desc
  }
  if (!is.null(event_class_desc)) {
    insertFields <- c(insertFields, "event_class_desc")
    insertValues <- c(insertValues, event_class_desc)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_event_class', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_event_class (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_event_class', statement)
  invisible(statement)
}

add_hf_d_event_code <- function(event_code_id, event_code_desc, event_code_display, event_code_group, event_code_category) {
  defaults <- get('hf_d_event_code', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(event_code_id)) {
    event_code_id <- defaults$event_code_id
  }
  if (!is.null(event_code_id)) {
    insertFields <- c(insertFields, "event_code_id")
    insertValues <- c(insertValues, event_code_id)
  }

  if (missing(event_code_desc)) {
    event_code_desc <- defaults$event_code_desc
  }
  if (!is.null(event_code_desc)) {
    insertFields <- c(insertFields, "event_code_desc")
    insertValues <- c(insertValues, event_code_desc)
  }

  if (missing(event_code_display)) {
    event_code_display <- defaults$event_code_display
  }
  if (!is.null(event_code_display)) {
    insertFields <- c(insertFields, "event_code_display")
    insertValues <- c(insertValues, event_code_display)
  }

  if (missing(event_code_group)) {
    event_code_group <- defaults$event_code_group
  }
  if (!is.null(event_code_group)) {
    insertFields <- c(insertFields, "event_code_group")
    insertValues <- c(insertValues, event_code_group)
  }

  if (missing(event_code_category)) {
    event_code_category <- defaults$event_code_category
  }
  if (!is.null(event_code_category)) {
    insertFields <- c(insertFields, "event_code_category")
    insertValues <- c(insertValues, event_code_category)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_event_code', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_event_code (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_event_code', statement)
  invisible(statement)
}

add_hf_d_event_reltn <- function(event_reltn_id, event_reltn_desc) {
  defaults <- get('hf_d_event_reltn', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(event_reltn_id)) {
    event_reltn_id <- defaults$event_reltn_id
  }
  if (!is.null(event_reltn_id)) {
    insertFields <- c(insertFields, "event_reltn_id")
    insertValues <- c(insertValues, event_reltn_id)
  }

  if (missing(event_reltn_desc)) {
    event_reltn_desc <- defaults$event_reltn_desc
  }
  if (!is.null(event_reltn_desc)) {
    insertFields <- c(insertFields, "event_reltn_desc")
    insertValues <- c(insertValues, event_reltn_desc)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_event_reltn', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_event_reltn (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_event_reltn', statement)
  invisible(statement)
}

add_hf_d_event_source <- function(event_source_id, event_source_desc) {
  defaults <- get('hf_d_event_source', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(event_source_id)) {
    event_source_id <- defaults$event_source_id
  }
  if (!is.null(event_source_id)) {
    insertFields <- c(insertFields, "event_source_id")
    insertValues <- c(insertValues, event_source_id)
  }

  if (missing(event_source_desc)) {
    event_source_desc <- defaults$event_source_desc
  }
  if (!is.null(event_source_desc)) {
    insertFields <- c(insertFields, "event_source_desc")
    insertValues <- c(insertValues, event_source_desc)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_event_source', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_event_source (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_event_source', statement)
  invisible(statement)
}

add_hf_d_formulary_type <- function(formulary_type_id, formulary_type_code, formulary_type_desc) {
  defaults <- get('hf_d_formulary_type', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(formulary_type_id)) {
    formulary_type_id <- defaults$formulary_type_id
  }
  if (!is.null(formulary_type_id)) {
    insertFields <- c(insertFields, "formulary_type_id")
    insertValues <- c(insertValues, formulary_type_id)
  }

  if (missing(formulary_type_code)) {
    formulary_type_code <- defaults$formulary_type_code
  }
  if (!is.null(formulary_type_code)) {
    insertFields <- c(insertFields, "formulary_type_code")
    insertValues <- c(insertValues, formulary_type_code)
  }

  if (missing(formulary_type_desc)) {
    formulary_type_desc <- defaults$formulary_type_desc
  }
  if (!is.null(formulary_type_desc)) {
    insertFields <- c(insertFields, "formulary_type_desc")
    insertValues <- c(insertValues, formulary_type_desc)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_formulary_type', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_formulary_type (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_formulary_type', statement)
  invisible(statement)
}

add_hf_d_frequency <- function(frequency_id, frequency_disp, frequency_desc) {
  defaults <- get('hf_d_frequency', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(frequency_id)) {
    frequency_id <- defaults$frequency_id
  }
  if (!is.null(frequency_id)) {
    insertFields <- c(insertFields, "frequency_id")
    insertValues <- c(insertValues, frequency_id)
  }

  if (missing(frequency_disp)) {
    frequency_disp <- defaults$frequency_disp
  }
  if (!is.null(frequency_disp)) {
    insertFields <- c(insertFields, "frequency_disp")
    insertValues <- c(insertValues, frequency_disp)
  }

  if (missing(frequency_desc)) {
    frequency_desc <- defaults$frequency_desc
  }
  if (!is.null(frequency_desc)) {
    insertFields <- c(insertFields, "frequency_desc")
    insertValues <- c(insertValues, frequency_desc)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_frequency', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_frequency (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_frequency', statement)
  invisible(statement)
}

add_hf_d_hospital <- function(hospital_id, census_region, census_division, bed_size_range, teaching_facility_ind, cath_lab_full_ind, cath_lab_diagnostic_ind, urban_rural_status, acute_status, alt_hospital_id, alt_health_system_id) {
  defaults <- get('hf_d_hospital', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(hospital_id)) {
    hospital_id <- defaults$hospital_id
  }
  if (!is.null(hospital_id)) {
    insertFields <- c(insertFields, "hospital_id")
    insertValues <- c(insertValues, hospital_id)
  }

  if (missing(census_region)) {
    census_region <- defaults$census_region
  }
  if (!is.null(census_region)) {
    insertFields <- c(insertFields, "census_region")
    insertValues <- c(insertValues, census_region)
  }

  if (missing(census_division)) {
    census_division <- defaults$census_division
  }
  if (!is.null(census_division)) {
    insertFields <- c(insertFields, "census_division")
    insertValues <- c(insertValues, census_division)
  }

  if (missing(bed_size_range)) {
    bed_size_range <- defaults$bed_size_range
  }
  if (!is.null(bed_size_range)) {
    insertFields <- c(insertFields, "bed_size_range")
    insertValues <- c(insertValues, bed_size_range)
  }

  if (missing(teaching_facility_ind)) {
    teaching_facility_ind <- defaults$teaching_facility_ind
  }
  if (!is.null(teaching_facility_ind)) {
    insertFields <- c(insertFields, "teaching_facility_ind")
    insertValues <- c(insertValues, teaching_facility_ind)
  }

  if (missing(cath_lab_full_ind)) {
    cath_lab_full_ind <- defaults$cath_lab_full_ind
  }
  if (!is.null(cath_lab_full_ind)) {
    insertFields <- c(insertFields, "cath_lab_full_ind")
    insertValues <- c(insertValues, cath_lab_full_ind)
  }

  if (missing(cath_lab_diagnostic_ind)) {
    cath_lab_diagnostic_ind <- defaults$cath_lab_diagnostic_ind
  }
  if (!is.null(cath_lab_diagnostic_ind)) {
    insertFields <- c(insertFields, "cath_lab_diagnostic_ind")
    insertValues <- c(insertValues, cath_lab_diagnostic_ind)
  }

  if (missing(urban_rural_status)) {
    urban_rural_status <- defaults$urban_rural_status
  }
  if (!is.null(urban_rural_status)) {
    insertFields <- c(insertFields, "urban_rural_status")
    insertValues <- c(insertValues, urban_rural_status)
  }

  if (missing(acute_status)) {
    acute_status <- defaults$acute_status
  }
  if (!is.null(acute_status)) {
    insertFields <- c(insertFields, "acute_status")
    insertValues <- c(insertValues, acute_status)
  }

  if (missing(alt_hospital_id)) {
    alt_hospital_id <- defaults$alt_hospital_id
  }
  if (!is.null(alt_hospital_id)) {
    insertFields <- c(insertFields, "alt_hospital_id")
    insertValues <- c(insertValues, alt_hospital_id)
  }

  if (missing(alt_health_system_id)) {
    alt_health_system_id <- defaults$alt_health_system_id
  }
  if (!is.null(alt_health_system_id)) {
    insertFields <- c(insertFields, "alt_health_system_id")
    insertValues <- c(insertValues, alt_health_system_id)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_hospital', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_hospital (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_hospital', statement)
  invisible(statement)
}

add_hf_d_interp_result <- function(interp_result_id, interp_result_desc) {
  defaults <- get('hf_d_interp_result', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(interp_result_id)) {
    interp_result_id <- defaults$interp_result_id
  }
  if (!is.null(interp_result_id)) {
    insertFields <- c(insertFields, "interp_result_id")
    insertValues <- c(insertValues, interp_result_id)
  }

  if (missing(interp_result_desc)) {
    interp_result_desc <- defaults$interp_result_desc
  }
  if (!is.null(interp_result_desc)) {
    insertFields <- c(insertFields, "interp_result_desc")
    insertValues <- c(insertValues, interp_result_desc)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_interp_result', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_interp_result (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_interp_result', statement)
  invisible(statement)
}

add_hf_d_isolate <- function(isolate_id, isolate_name, isolate_type, isolate_category, isolate_group, isolate_rept_category, phin_loinc_code, alt_loinc_code, snomed_code, snomedct_code) {
  defaults <- get('hf_d_isolate', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(isolate_id)) {
    isolate_id <- defaults$isolate_id
  }
  if (!is.null(isolate_id)) {
    insertFields <- c(insertFields, "isolate_id")
    insertValues <- c(insertValues, isolate_id)
  }

  if (missing(isolate_name)) {
    isolate_name <- defaults$isolate_name
  }
  if (!is.null(isolate_name)) {
    insertFields <- c(insertFields, "isolate_name")
    insertValues <- c(insertValues, isolate_name)
  }

  if (missing(isolate_type)) {
    isolate_type <- defaults$isolate_type
  }
  if (!is.null(isolate_type)) {
    insertFields <- c(insertFields, "isolate_type")
    insertValues <- c(insertValues, isolate_type)
  }

  if (missing(isolate_category)) {
    isolate_category <- defaults$isolate_category
  }
  if (!is.null(isolate_category)) {
    insertFields <- c(insertFields, "isolate_category")
    insertValues <- c(insertValues, isolate_category)
  }

  if (missing(isolate_group)) {
    isolate_group <- defaults$isolate_group
  }
  if (!is.null(isolate_group)) {
    insertFields <- c(insertFields, "isolate_group")
    insertValues <- c(insertValues, isolate_group)
  }

  if (missing(isolate_rept_category)) {
    isolate_rept_category <- defaults$isolate_rept_category
  }
  if (!is.null(isolate_rept_category)) {
    insertFields <- c(insertFields, "isolate_rept_category")
    insertValues <- c(insertValues, isolate_rept_category)
  }

  if (missing(phin_loinc_code)) {
    phin_loinc_code <- defaults$phin_loinc_code
  }
  if (!is.null(phin_loinc_code)) {
    insertFields <- c(insertFields, "phin_loinc_code")
    insertValues <- c(insertValues, phin_loinc_code)
  }

  if (missing(alt_loinc_code)) {
    alt_loinc_code <- defaults$alt_loinc_code
  }
  if (!is.null(alt_loinc_code)) {
    insertFields <- c(insertFields, "alt_loinc_code")
    insertValues <- c(insertValues, alt_loinc_code)
  }

  if (missing(snomed_code)) {
    snomed_code <- defaults$snomed_code
  }
  if (!is.null(snomed_code)) {
    insertFields <- c(insertFields, "snomed_code")
    insertValues <- c(insertValues, snomed_code)
  }

  if (missing(snomedct_code)) {
    snomedct_code <- defaults$snomedct_code
  }
  if (!is.null(snomedct_code)) {
    insertFields <- c(insertFields, "snomedct_code")
    insertValues <- c(insertValues, snomedct_code)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_isolate', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_isolate (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_isolate', statement)
  invisible(statement)
}

add_hf_d_lab_procedure <- function(lab_procedure_id, lab_procedure_mnemonic, lab_procedure_name, lab_procedure_group, lab_super_group, loinc_code, loinc_ind, loinc_long, loinc_short) {
  defaults <- get('hf_d_lab_procedure', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(lab_procedure_id)) {
    lab_procedure_id <- defaults$lab_procedure_id
  }
  if (!is.null(lab_procedure_id)) {
    insertFields <- c(insertFields, "lab_procedure_id")
    insertValues <- c(insertValues, lab_procedure_id)
  }

  if (missing(lab_procedure_mnemonic)) {
    lab_procedure_mnemonic <- defaults$lab_procedure_mnemonic
  }
  if (!is.null(lab_procedure_mnemonic)) {
    insertFields <- c(insertFields, "lab_procedure_mnemonic")
    insertValues <- c(insertValues, lab_procedure_mnemonic)
  }

  if (missing(lab_procedure_name)) {
    lab_procedure_name <- defaults$lab_procedure_name
  }
  if (!is.null(lab_procedure_name)) {
    insertFields <- c(insertFields, "lab_procedure_name")
    insertValues <- c(insertValues, lab_procedure_name)
  }

  if (missing(lab_procedure_group)) {
    lab_procedure_group <- defaults$lab_procedure_group
  }
  if (!is.null(lab_procedure_group)) {
    insertFields <- c(insertFields, "lab_procedure_group")
    insertValues <- c(insertValues, lab_procedure_group)
  }

  if (missing(lab_super_group)) {
    lab_super_group <- defaults$lab_super_group
  }
  if (!is.null(lab_super_group)) {
    insertFields <- c(insertFields, "lab_super_group")
    insertValues <- c(insertValues, lab_super_group)
  }

  if (missing(loinc_code)) {
    loinc_code <- defaults$loinc_code
  }
  if (!is.null(loinc_code)) {
    insertFields <- c(insertFields, "loinc_code")
    insertValues <- c(insertValues, loinc_code)
  }

  if (missing(loinc_ind)) {
    loinc_ind <- defaults$loinc_ind
  }
  if (!is.null(loinc_ind)) {
    insertFields <- c(insertFields, "loinc_ind")
    insertValues <- c(insertValues, loinc_ind)
  }

  if (missing(loinc_long)) {
    loinc_long <- defaults$loinc_long
  }
  if (!is.null(loinc_long)) {
    insertFields <- c(insertFields, "loinc_long")
    insertValues <- c(insertValues, loinc_long)
  }

  if (missing(loinc_short)) {
    loinc_short <- defaults$loinc_short
  }
  if (!is.null(loinc_short)) {
    insertFields <- c(insertFields, "loinc_short")
    insertValues <- c(insertValues, loinc_short)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_lab_procedure', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_lab_procedure (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_lab_procedure', statement)
  invisible(statement)
}

add_hf_d_lab_result_type <- function(lab_result_type_id, lab_result_type_desc) {
  defaults <- get('hf_d_lab_result_type', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(lab_result_type_id)) {
    lab_result_type_id <- defaults$lab_result_type_id
  }
  if (!is.null(lab_result_type_id)) {
    insertFields <- c(insertFields, "lab_result_type_id")
    insertValues <- c(insertValues, lab_result_type_id)
  }

  if (missing(lab_result_type_desc)) {
    lab_result_type_desc <- defaults$lab_result_type_desc
  }
  if (!is.null(lab_result_type_desc)) {
    insertFields <- c(insertFields, "lab_result_type_desc")
    insertValues <- c(insertValues, lab_result_type_desc)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_lab_result_type', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_lab_result_type (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_lab_result_type', statement)
  invisible(statement)
}

add_hf_d_manufacturer <- function(manufacturer_id, manufacturer_name, manufacturer_alt_name) {
  defaults <- get('hf_d_manufacturer', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(manufacturer_id)) {
    manufacturer_id <- defaults$manufacturer_id
  }
  if (!is.null(manufacturer_id)) {
    insertFields <- c(insertFields, "manufacturer_id")
    insertValues <- c(insertValues, manufacturer_id)
  }

  if (missing(manufacturer_name)) {
    manufacturer_name <- defaults$manufacturer_name
  }
  if (!is.null(manufacturer_name)) {
    insertFields <- c(insertFields, "manufacturer_name")
    insertValues <- c(insertValues, manufacturer_name)
  }

  if (missing(manufacturer_alt_name)) {
    manufacturer_alt_name <- defaults$manufacturer_alt_name
  }
  if (!is.null(manufacturer_alt_name)) {
    insertFields <- c(insertFields, "manufacturer_alt_name")
    insertValues <- c(insertValues, manufacturer_alt_name)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_manufacturer', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_manufacturer (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_manufacturer', statement)
  invisible(statement)
}

add_hf_d_med_order_status <- function(med_order_status_id, med_order_status_desc) {
  defaults <- get('hf_d_med_order_status', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(med_order_status_id)) {
    med_order_status_id <- defaults$med_order_status_id
  }
  if (!is.null(med_order_status_id)) {
    insertFields <- c(insertFields, "med_order_status_id")
    insertValues <- c(insertValues, med_order_status_id)
  }

  if (missing(med_order_status_desc)) {
    med_order_status_desc <- defaults$med_order_status_desc
  }
  if (!is.null(med_order_status_desc)) {
    insertFields <- c(insertFields, "med_order_status_desc")
    insertValues <- c(insertValues, med_order_status_desc)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_med_order_status', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_med_order_status (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_med_order_status', statement)
  invisible(statement)
}

add_hf_d_med_product <- function(med_product_id, drug_code, drug_mnemonic_code, drug_desc, drug_mnemonic_desc) {
  defaults <- get('hf_d_med_product', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(med_product_id)) {
    med_product_id <- defaults$med_product_id
  }
  if (!is.null(med_product_id)) {
    insertFields <- c(insertFields, "med_product_id")
    insertValues <- c(insertValues, med_product_id)
  }

  if (missing(drug_code)) {
    drug_code <- defaults$drug_code
  }
  if (!is.null(drug_code)) {
    insertFields <- c(insertFields, "drug_code")
    insertValues <- c(insertValues, drug_code)
  }

  if (missing(drug_mnemonic_code)) {
    drug_mnemonic_code <- defaults$drug_mnemonic_code
  }
  if (!is.null(drug_mnemonic_code)) {
    insertFields <- c(insertFields, "drug_mnemonic_code")
    insertValues <- c(insertValues, drug_mnemonic_code)
  }

  if (missing(drug_desc)) {
    drug_desc <- defaults$drug_desc
  }
  if (!is.null(drug_desc)) {
    insertFields <- c(insertFields, "drug_desc")
    insertValues <- c(insertValues, drug_desc)
  }

  if (missing(drug_mnemonic_desc)) {
    drug_mnemonic_desc <- defaults$drug_mnemonic_desc
  }
  if (!is.null(drug_mnemonic_desc)) {
    insertFields <- c(insertFields, "drug_mnemonic_desc")
    insertValues <- c(insertValues, drug_mnemonic_desc)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_med_product', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_med_product (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_med_product', statement)
  invisible(statement)
}

add_hf_d_med_reason <- function(med_reason_id, med_reason_desc) {
  defaults <- get('hf_d_med_reason', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(med_reason_id)) {
    med_reason_id <- defaults$med_reason_id
  }
  if (!is.null(med_reason_id)) {
    insertFields <- c(insertFields, "med_reason_id")
    insertValues <- c(insertValues, med_reason_id)
  }

  if (missing(med_reason_desc)) {
    med_reason_desc <- defaults$med_reason_desc
  }
  if (!is.null(med_reason_desc)) {
    insertFields <- c(insertFields, "med_reason_desc")
    insertValues <- c(insertValues, med_reason_desc)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_med_reason', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_med_reason (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_med_reason', statement)
  invisible(statement)
}

add_hf_d_medication <- function(medication_id, ndc_code, brand_name, generic_name, product_strength_description, route_description, dose_form_description, obsolete_dt_tm) {
  defaults <- get('hf_d_medication', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(medication_id)) {
    medication_id <- defaults$medication_id
  }
  if (!is.null(medication_id)) {
    insertFields <- c(insertFields, "medication_id")
    insertValues <- c(insertValues, medication_id)
  }

  if (missing(ndc_code)) {
    ndc_code <- defaults$ndc_code
  }
  if (!is.null(ndc_code)) {
    insertFields <- c(insertFields, "ndc_code")
    insertValues <- c(insertValues, ndc_code)
  }

  if (missing(brand_name)) {
    brand_name <- defaults$brand_name
  }
  if (!is.null(brand_name)) {
    insertFields <- c(insertFields, "brand_name")
    insertValues <- c(insertValues, brand_name)
  }

  if (missing(generic_name)) {
    generic_name <- defaults$generic_name
  }
  if (!is.null(generic_name)) {
    insertFields <- c(insertFields, "generic_name")
    insertValues <- c(insertValues, generic_name)
  }

  if (missing(product_strength_description)) {
    product_strength_description <- defaults$product_strength_description
  }
  if (!is.null(product_strength_description)) {
    insertFields <- c(insertFields, "product_strength_description")
    insertValues <- c(insertValues, product_strength_description)
  }

  if (missing(route_description)) {
    route_description <- defaults$route_description
  }
  if (!is.null(route_description)) {
    insertFields <- c(insertFields, "route_description")
    insertValues <- c(insertValues, route_description)
  }

  if (missing(dose_form_description)) {
    dose_form_description <- defaults$dose_form_description
  }
  if (!is.null(dose_form_description)) {
    insertFields <- c(insertFields, "dose_form_description")
    insertValues <- c(insertValues, dose_form_description)
  }

  if (missing(obsolete_dt_tm)) {
    obsolete_dt_tm <- defaults$obsolete_dt_tm
  }
  if (!is.null(obsolete_dt_tm)) {
    insertFields <- c(insertFields, "obsolete_dt_tm")
    insertValues <- c(insertValues, obsolete_dt_tm)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_medication', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_medication (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_medication', statement)
  invisible(statement)
}

add_hf_d_mic_order_status <- function(micro_order_status_id, micro_order_status_code, micro_order_status_desc) {
  defaults <- get('hf_d_mic_order_status', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(micro_order_status_id)) {
    micro_order_status_id <- defaults$micro_order_status_id
  }
  if (!is.null(micro_order_status_id)) {
    insertFields <- c(insertFields, "micro_order_status_id")
    insertValues <- c(insertValues, micro_order_status_id)
  }

  if (missing(micro_order_status_code)) {
    micro_order_status_code <- defaults$micro_order_status_code
  }
  if (!is.null(micro_order_status_code)) {
    insertFields <- c(insertFields, "micro_order_status_code")
    insertValues <- c(insertValues, micro_order_status_code)
  }

  if (missing(micro_order_status_desc)) {
    micro_order_status_desc <- defaults$micro_order_status_desc
  }
  if (!is.null(micro_order_status_desc)) {
    insertFields <- c(insertFields, "micro_order_status_desc")
    insertValues <- c(insertValues, micro_order_status_desc)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_mic_order_status', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_mic_order_status (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_mic_order_status', statement)
  invisible(statement)
}

add_hf_d_micro_result_type <- function(micro_result_type_id, test_type, micro_result_type_code, micro_result_type_desc) {
  defaults <- get('hf_d_micro_result_type', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(micro_result_type_id)) {
    micro_result_type_id <- defaults$micro_result_type_id
  }
  if (!is.null(micro_result_type_id)) {
    insertFields <- c(insertFields, "micro_result_type_id")
    insertValues <- c(insertValues, micro_result_type_id)
  }

  if (missing(test_type)) {
    test_type <- defaults$test_type
  }
  if (!is.null(test_type)) {
    insertFields <- c(insertFields, "test_type")
    insertValues <- c(insertValues, test_type)
  }

  if (missing(micro_result_type_code)) {
    micro_result_type_code <- defaults$micro_result_type_code
  }
  if (!is.null(micro_result_type_code)) {
    insertFields <- c(insertFields, "micro_result_type_code")
    insertValues <- c(insertValues, micro_result_type_code)
  }

  if (missing(micro_result_type_desc)) {
    micro_result_type_desc <- defaults$micro_result_type_desc
  }
  if (!is.null(micro_result_type_desc)) {
    insertFields <- c(insertFields, "micro_result_type_desc")
    insertValues <- c(insertValues, micro_result_type_desc)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_micro_result_type', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_micro_result_type (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_micro_result_type', statement)
  invisible(statement)
}

add_hf_d_normalcy <- function(normalcy_id, normalcy_desc) {
  defaults <- get('hf_d_normalcy', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(normalcy_id)) {
    normalcy_id <- defaults$normalcy_id
  }
  if (!is.null(normalcy_id)) {
    insertFields <- c(insertFields, "normalcy_id")
    insertValues <- c(insertValues, normalcy_id)
  }

  if (missing(normalcy_desc)) {
    normalcy_desc <- defaults$normalcy_desc
  }
  if (!is.null(normalcy_desc)) {
    insertFields <- c(insertFields, "normalcy_desc")
    insertValues <- c(insertValues, normalcy_desc)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_normalcy', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_normalcy (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_normalcy', statement)
  invisible(statement)
}

add_hf_d_normalcy_method <- function(normalcy_method_id, normalcy_method_desc) {
  defaults <- get('hf_d_normalcy_method', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(normalcy_method_id)) {
    normalcy_method_id <- defaults$normalcy_method_id
  }
  if (!is.null(normalcy_method_id)) {
    insertFields <- c(insertFields, "normalcy_method_id")
    insertValues <- c(insertValues, normalcy_method_id)
  }

  if (missing(normalcy_method_desc)) {
    normalcy_method_desc <- defaults$normalcy_method_desc
  }
  if (!is.null(normalcy_method_desc)) {
    insertFields <- c(insertFields, "normalcy_method_desc")
    insertValues <- c(insertValues, normalcy_method_desc)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_normalcy_method', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_normalcy_method (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_normalcy_method', statement)
  invisible(statement)
}

add_hf_d_order_stop_type <- function(order_stop_type_id, order_stop_type_desc) {
  defaults <- get('hf_d_order_stop_type', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(order_stop_type_id)) {
    order_stop_type_id <- defaults$order_stop_type_id
  }
  if (!is.null(order_stop_type_id)) {
    insertFields <- c(insertFields, "order_stop_type_id")
    insertValues <- c(insertValues, order_stop_type_id)
  }

  if (missing(order_stop_type_desc)) {
    order_stop_type_desc <- defaults$order_stop_type_desc
  }
  if (!is.null(order_stop_type_desc)) {
    insertFields <- c(insertFields, "order_stop_type_desc")
    insertValues <- c(insertValues, order_stop_type_desc)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_order_stop_type', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_order_stop_type (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_order_stop_type', statement)
  invisible(statement)
}

add_hf_d_order_type <- function(order_type_id, order_type_desc) {
  defaults <- get('hf_d_order_type', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(order_type_id)) {
    order_type_id <- defaults$order_type_id
  }
  if (!is.null(order_type_id)) {
    insertFields <- c(insertFields, "order_type_id")
    insertValues <- c(insertValues, order_type_id)
  }

  if (missing(order_type_desc)) {
    order_type_desc <- defaults$order_type_desc
  }
  if (!is.null(order_type_desc)) {
    insertFields <- c(insertFields, "order_type_desc")
    insertValues <- c(insertValues, order_type_desc)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_order_type', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_order_type (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_order_type', statement)
  invisible(statement)
}

add_hf_d_patient <- function(patient_id, patient_sk, race, gender, marital_status) {
  defaults <- get('hf_d_patient', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(patient_id)) {
    patient_id <- defaults$patient_id
  }
  if (!is.null(patient_id)) {
    insertFields <- c(insertFields, "patient_id")
    insertValues <- c(insertValues, patient_id)
  }

  if (missing(patient_sk)) {
    patient_sk <- defaults$patient_sk
  }
  if (!is.null(patient_sk)) {
    insertFields <- c(insertFields, "patient_sk")
    insertValues <- c(insertValues, patient_sk)
  }

  if (missing(race)) {
    race <- defaults$race
  }
  if (!is.null(race)) {
    insertFields <- c(insertFields, "race")
    insertValues <- c(insertValues, race)
  }

  if (missing(gender)) {
    gender <- defaults$gender
  }
  if (!is.null(gender)) {
    insertFields <- c(insertFields, "gender")
    insertValues <- c(insertValues, gender)
  }

  if (missing(marital_status)) {
    marital_status <- defaults$marital_status
  }
  if (!is.null(marital_status)) {
    insertFields <- c(insertFields, "marital_status")
    insertValues <- c(insertValues, marital_status)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_patient', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_patient (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_patient', statement)
  invisible(statement)
}

add_hf_d_patient_type <- function(patient_type_id, patient_type_desc) {
  defaults <- get('hf_d_patient_type', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(patient_type_id)) {
    patient_type_id <- defaults$patient_type_id
  }
  if (!is.null(patient_type_id)) {
    insertFields <- c(insertFields, "patient_type_id")
    insertValues <- c(insertValues, patient_type_id)
  }

  if (missing(patient_type_desc)) {
    patient_type_desc <- defaults$patient_type_desc
  }
  if (!is.null(patient_type_desc)) {
    insertFields <- c(insertFields, "patient_type_desc")
    insertValues <- c(insertValues, patient_type_desc)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_patient_type', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_patient_type (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_patient_type', statement)
  invisible(statement)
}

add_hf_d_payer <- function(payer_id, payer_code, payer_code_desc) {
  defaults <- get('hf_d_payer', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(payer_id)) {
    payer_id <- defaults$payer_id
  }
  if (!is.null(payer_id)) {
    insertFields <- c(insertFields, "payer_id")
    insertValues <- c(insertValues, payer_id)
  }

  if (missing(payer_code)) {
    payer_code <- defaults$payer_code
  }
  if (!is.null(payer_code)) {
    insertFields <- c(insertFields, "payer_code")
    insertValues <- c(insertValues, payer_code)
  }

  if (missing(payer_code_desc)) {
    payer_code_desc <- defaults$payer_code_desc
  }
  if (!is.null(payer_code_desc)) {
    insertFields <- c(insertFields, "payer_code_desc")
    insertValues <- c(insertValues, payer_code_desc)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_payer', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_payer (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_payer', statement)
  invisible(statement)
}

add_hf_d_physician <- function(physician_id, medical_specialty) {
  defaults <- get('hf_d_physician', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(physician_id)) {
    physician_id <- defaults$physician_id
  }
  if (!is.null(physician_id)) {
    insertFields <- c(insertFields, "physician_id")
    insertValues <- c(insertValues, physician_id)
  }

  if (missing(medical_specialty)) {
    medical_specialty <- defaults$medical_specialty
  }
  if (!is.null(medical_specialty)) {
    insertFields <- c(insertFields, "medical_specialty")
    insertValues <- c(insertValues, medical_specialty)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_physician', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_physician (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_physician', statement)
  invisible(statement)
}

add_hf_d_present_on_admit <- function(present_on_admit_id, present_on_admit_code, present_on_admit_desc) {
  defaults <- get('hf_d_present_on_admit', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(present_on_admit_id)) {
    present_on_admit_id <- defaults$present_on_admit_id
  }
  if (!is.null(present_on_admit_id)) {
    insertFields <- c(insertFields, "present_on_admit_id")
    insertValues <- c(insertValues, present_on_admit_id)
  }

  if (missing(present_on_admit_code)) {
    present_on_admit_code <- defaults$present_on_admit_code
  }
  if (!is.null(present_on_admit_code)) {
    insertFields <- c(insertFields, "present_on_admit_code")
    insertValues <- c(insertValues, present_on_admit_code)
  }

  if (missing(present_on_admit_desc)) {
    present_on_admit_desc <- defaults$present_on_admit_desc
  }
  if (!is.null(present_on_admit_desc)) {
    insertFields <- c(insertFields, "present_on_admit_desc")
    insertValues <- c(insertValues, present_on_admit_desc)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_present_on_admit', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_present_on_admit (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_present_on_admit', statement)
  invisible(statement)
}

add_hf_d_procedure <- function(procedure_id, procedure_type, procedure_code, procedure_description) {
  defaults <- get('hf_d_procedure', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(procedure_id)) {
    procedure_id <- defaults$procedure_id
  }
  if (!is.null(procedure_id)) {
    insertFields <- c(insertFields, "procedure_id")
    insertValues <- c(insertValues, procedure_id)
  }

  if (missing(procedure_type)) {
    procedure_type <- defaults$procedure_type
  }
  if (!is.null(procedure_type)) {
    insertFields <- c(insertFields, "procedure_type")
    insertValues <- c(insertValues, procedure_type)
  }

  if (missing(procedure_code)) {
    procedure_code <- defaults$procedure_code
  }
  if (!is.null(procedure_code)) {
    insertFields <- c(insertFields, "procedure_code")
    insertValues <- c(insertValues, procedure_code)
  }

  if (missing(procedure_description)) {
    procedure_description <- defaults$procedure_description
  }
  if (!is.null(procedure_description)) {
    insertFields <- c(insertFields, "procedure_description")
    insertValues <- c(insertValues, procedure_description)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_procedure', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_procedure (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_procedure', statement)
  invisible(statement)
}

add_hf_d_procedure_modifier <- function(procedure_modifier_id, procedure_modifier_desc) {
  defaults <- get('hf_d_procedure_modifier', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(procedure_modifier_id)) {
    procedure_modifier_id <- defaults$procedure_modifier_id
  }
  if (!is.null(procedure_modifier_id)) {
    insertFields <- c(insertFields, "procedure_modifier_id")
    insertValues <- c(insertValues, procedure_modifier_id)
  }

  if (missing(procedure_modifier_desc)) {
    procedure_modifier_desc <- defaults$procedure_modifier_desc
  }
  if (!is.null(procedure_modifier_desc)) {
    insertFields <- c(insertFields, "procedure_modifier_desc")
    insertValues <- c(insertValues, procedure_modifier_desc)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_procedure_modifier', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_procedure_modifier (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_procedure_modifier', statement)
  invisible(statement)
}

add_hf_d_reporting_priority <- function(reporting_priority_id, reporting_priority_code, reporting_priority_desc) {
  defaults <- get('hf_d_reporting_priority', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(reporting_priority_id)) {
    reporting_priority_id <- defaults$reporting_priority_id
  }
  if (!is.null(reporting_priority_id)) {
    insertFields <- c(insertFields, "reporting_priority_id")
    insertValues <- c(insertValues, reporting_priority_id)
  }

  if (missing(reporting_priority_code)) {
    reporting_priority_code <- defaults$reporting_priority_code
  }
  if (!is.null(reporting_priority_code)) {
    insertFields <- c(insertFields, "reporting_priority_code")
    insertValues <- c(insertValues, reporting_priority_code)
  }

  if (missing(reporting_priority_desc)) {
    reporting_priority_desc <- defaults$reporting_priority_desc
  }
  if (!is.null(reporting_priority_desc)) {
    insertFields <- c(insertFields, "reporting_priority_desc")
    insertValues <- c(insertValues, reporting_priority_desc)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_reporting_priority', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_reporting_priority (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_reporting_priority', statement)
  invisible(statement)
}

add_hf_d_result_indicator <- function(result_indicator_id, result_indicator_desc) {
  defaults <- get('hf_d_result_indicator', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(result_indicator_id)) {
    result_indicator_id <- defaults$result_indicator_id
  }
  if (!is.null(result_indicator_id)) {
    insertFields <- c(insertFields, "result_indicator_id")
    insertValues <- c(insertValues, result_indicator_id)
  }

  if (missing(result_indicator_desc)) {
    result_indicator_desc <- defaults$result_indicator_desc
  }
  if (!is.null(result_indicator_desc)) {
    insertFields <- c(insertFields, "result_indicator_desc")
    insertValues <- c(insertValues, result_indicator_desc)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_result_indicator', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_result_indicator (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_result_indicator', statement)
  invisible(statement)
}

add_hf_d_result_type_proc <- function(result_type_proc_id, result_type_proc_desc) {
  defaults <- get('hf_d_result_type_proc', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(result_type_proc_id)) {
    result_type_proc_id <- defaults$result_type_proc_id
  }
  if (!is.null(result_type_proc_id)) {
    insertFields <- c(insertFields, "result_type_proc_id")
    insertValues <- c(insertValues, result_type_proc_id)
  }

  if (missing(result_type_proc_desc)) {
    result_type_proc_desc <- defaults$result_type_proc_desc
  }
  if (!is.null(result_type_proc_desc)) {
    insertFields <- c(insertFields, "result_type_proc_desc")
    insertValues <- c(insertValues, result_type_proc_desc)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_result_type_proc', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_result_type_proc (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_result_type_proc', statement)
  invisible(statement)
}

add_hf_d_route_admin <- function(route_admin_id, route_admin_display, route_admin_description) {
  defaults <- get('hf_d_route_admin', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(route_admin_id)) {
    route_admin_id <- defaults$route_admin_id
  }
  if (!is.null(route_admin_id)) {
    insertFields <- c(insertFields, "route_admin_id")
    insertValues <- c(insertValues, route_admin_id)
  }

  if (missing(route_admin_display)) {
    route_admin_display <- defaults$route_admin_display
  }
  if (!is.null(route_admin_display)) {
    insertFields <- c(insertFields, "route_admin_display")
    insertValues <- c(insertValues, route_admin_display)
  }

  if (missing(route_admin_description)) {
    route_admin_description <- defaults$route_admin_description
  }
  if (!is.null(route_admin_description)) {
    insertFields <- c(insertFields, "route_admin_description")
    insertValues <- c(insertValues, route_admin_description)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_route_admin', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_route_admin (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_route_admin', statement)
  invisible(statement)
}

add_hf_d_surgical_case_level <- function(surgical_case_level_id, surgical_case_level_desc) {
  defaults <- get('hf_d_surgical_case_level', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(surgical_case_level_id)) {
    surgical_case_level_id <- defaults$surgical_case_level_id
  }
  if (!is.null(surgical_case_level_id)) {
    insertFields <- c(insertFields, "surgical_case_level_id")
    insertValues <- c(insertValues, surgical_case_level_id)
  }

  if (missing(surgical_case_level_desc)) {
    surgical_case_level_desc <- defaults$surgical_case_level_desc
  }
  if (!is.null(surgical_case_level_desc)) {
    insertFields <- c(insertFields, "surgical_case_level_desc")
    insertValues <- c(insertValues, surgical_case_level_desc)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_surgical_case_level', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_surgical_case_level (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_surgical_case_level', statement)
  invisible(statement)
}

add_hf_d_surgical_procedure <- function(surgical_procedure_id, surgical_procedure_desc, order_type, order_specialty, anatomic_site, surgical_procedure_device, icd9_code, icd9_desc, revision_ind) {
  defaults <- get('hf_d_surgical_procedure', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(surgical_procedure_id)) {
    surgical_procedure_id <- defaults$surgical_procedure_id
  }
  if (!is.null(surgical_procedure_id)) {
    insertFields <- c(insertFields, "surgical_procedure_id")
    insertValues <- c(insertValues, surgical_procedure_id)
  }

  if (missing(surgical_procedure_desc)) {
    surgical_procedure_desc <- defaults$surgical_procedure_desc
  }
  if (!is.null(surgical_procedure_desc)) {
    insertFields <- c(insertFields, "surgical_procedure_desc")
    insertValues <- c(insertValues, surgical_procedure_desc)
  }

  if (missing(order_type)) {
    order_type <- defaults$order_type
  }
  if (!is.null(order_type)) {
    insertFields <- c(insertFields, "order_type")
    insertValues <- c(insertValues, order_type)
  }

  if (missing(order_specialty)) {
    order_specialty <- defaults$order_specialty
  }
  if (!is.null(order_specialty)) {
    insertFields <- c(insertFields, "order_specialty")
    insertValues <- c(insertValues, order_specialty)
  }

  if (missing(anatomic_site)) {
    anatomic_site <- defaults$anatomic_site
  }
  if (!is.null(anatomic_site)) {
    insertFields <- c(insertFields, "anatomic_site")
    insertValues <- c(insertValues, anatomic_site)
  }

  if (missing(surgical_procedure_device)) {
    surgical_procedure_device <- defaults$surgical_procedure_device
  }
  if (!is.null(surgical_procedure_device)) {
    insertFields <- c(insertFields, "surgical_procedure_device")
    insertValues <- c(insertValues, surgical_procedure_device)
  }

  if (missing(icd9_code)) {
    icd9_code <- defaults$icd9_code
  }
  if (!is.null(icd9_code)) {
    insertFields <- c(insertFields, "icd9_code")
    insertValues <- c(insertValues, icd9_code)
  }

  if (missing(icd9_desc)) {
    icd9_desc <- defaults$icd9_desc
  }
  if (!is.null(icd9_desc)) {
    insertFields <- c(insertFields, "icd9_desc")
    insertValues <- c(insertValues, icd9_desc)
  }

  if (missing(revision_ind)) {
    revision_ind <- defaults$revision_ind
  }
  if (!is.null(revision_ind)) {
    insertFields <- c(insertFields, "revision_ind")
    insertValues <- c(insertValues, revision_ind)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_surgical_procedure', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_surgical_procedure (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_surgical_procedure', statement)
  invisible(statement)
}

add_hf_d_surgical_specialty <- function(surgical_specialty_id, surgical_specialty_desc) {
  defaults <- get('hf_d_surgical_specialty', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(surgical_specialty_id)) {
    surgical_specialty_id <- defaults$surgical_specialty_id
  }
  if (!is.null(surgical_specialty_id)) {
    insertFields <- c(insertFields, "surgical_specialty_id")
    insertValues <- c(insertValues, surgical_specialty_id)
  }

  if (missing(surgical_specialty_desc)) {
    surgical_specialty_desc <- defaults$surgical_specialty_desc
  }
  if (!is.null(surgical_specialty_desc)) {
    insertFields <- c(insertFields, "surgical_specialty_desc")
    insertValues <- c(insertValues, surgical_specialty_desc)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_surgical_specialty', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_surgical_specialty (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_surgical_specialty', statement)
  invisible(statement)
}

add_hf_d_test_type <- function(test_type_id, test_type_mnemonic, test_type_desc) {
  defaults <- get('hf_d_test_type', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(test_type_id)) {
    test_type_id <- defaults$test_type_id
  }
  if (!is.null(test_type_id)) {
    insertFields <- c(insertFields, "test_type_id")
    insertValues <- c(insertValues, test_type_id)
  }

  if (missing(test_type_mnemonic)) {
    test_type_mnemonic <- defaults$test_type_mnemonic
  }
  if (!is.null(test_type_mnemonic)) {
    insertFields <- c(insertFields, "test_type_mnemonic")
    insertValues <- c(insertValues, test_type_mnemonic)
  }

  if (missing(test_type_desc)) {
    test_type_desc <- defaults$test_type_desc
  }
  if (!is.null(test_type_desc)) {
    insertFields <- c(insertFields, "test_type_desc")
    insertValues <- c(insertValues, test_type_desc)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_test_type', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_test_type (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_test_type', statement)
  invisible(statement)
}

add_hf_d_unit <- function(unit_id, unit_display, unit_desc) {
  defaults <- get('hf_d_unit', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(unit_id)) {
    unit_id <- defaults$unit_id
  }
  if (!is.null(unit_id)) {
    insertFields <- c(insertFields, "unit_id")
    insertValues <- c(insertValues, unit_id)
  }

  if (missing(unit_display)) {
    unit_display <- defaults$unit_display
  }
  if (!is.null(unit_display)) {
    insertFields <- c(insertFields, "unit_display")
    insertValues <- c(insertValues, unit_display)
  }

  if (missing(unit_desc)) {
    unit_desc <- defaults$unit_desc
  }
  if (!is.null(unit_desc)) {
    insertFields <- c(insertFields, "unit_desc")
    insertValues <- c(insertValues, unit_desc)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_unit', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_unit (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_unit', statement)
  invisible(statement)
}

add_hf_d_wound_class <- function(wound_class_id, wound_class_desc) {
  defaults <- get('hf_d_wound_class', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(wound_class_id)) {
    wound_class_id <- defaults$wound_class_id
  }
  if (!is.null(wound_class_id)) {
    insertFields <- c(insertFields, "wound_class_id")
    insertValues <- c(insertValues, wound_class_id)
  }

  if (missing(wound_class_desc)) {
    wound_class_desc <- defaults$wound_class_desc
  }
  if (!is.null(wound_class_desc)) {
    insertFields <- c(insertFields, "wound_class_desc")
    insertValues <- c(insertValues, wound_class_desc)
  }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_d_wound_class', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_d_wound_class (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_d_wound_class', statement)
  invisible(statement)
}

add_hf_f_clinical_event <- function(encounter_id, accession_nbr, lab_procedure_id, critical_high, critical_low, event_code_id, event_class_id, event_end_dt_tm, event_end_dt_id, event_reltn_id, event_start_dt_tm, event_start_dt_id, event_expiration_dt_tm, event_expiration_dt_id, event_normalcy_id, event_normalcy_method_id, normal_high, normal_low, performed_dt_tm, performed_dt_id, performed_prsnl_id, result_normalcy_flg, result_time_unit_id, result_units_id, result_value_dt_tm, result_value_dt_id, result_value_num, result_feasible_ind, result_inaccurate_ind, event_source_id, verified_dt_tm, verified_dt_id, verified_prsnl_id#, _extractyear
                                    ) {
  defaults <- get('hf_f_clinical_event', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(encounter_id)) {
    encounter_id <- defaults$encounter_id
  }
  if (!is.null(encounter_id)) {
    insertFields <- c(insertFields, "encounter_id")
    insertValues <- c(insertValues, encounter_id)
  }

  if (missing(accession_nbr)) {
    accession_nbr <- defaults$accession_nbr
  }
  if (!is.null(accession_nbr)) {
    insertFields <- c(insertFields, "accession_nbr")
    insertValues <- c(insertValues, accession_nbr)
  }

  if (missing(lab_procedure_id)) {
    lab_procedure_id <- defaults$lab_procedure_id
  }
  if (!is.null(lab_procedure_id)) {
    insertFields <- c(insertFields, "lab_procedure_id")
    insertValues <- c(insertValues, lab_procedure_id)
  }

  if (missing(critical_high)) {
    critical_high <- defaults$critical_high
  }
  if (!is.null(critical_high)) {
    insertFields <- c(insertFields, "critical_high")
    insertValues <- c(insertValues, critical_high)
  }

  if (missing(critical_low)) {
    critical_low <- defaults$critical_low
  }
  if (!is.null(critical_low)) {
    insertFields <- c(insertFields, "critical_low")
    insertValues <- c(insertValues, critical_low)
  }

  if (missing(event_code_id)) {
    event_code_id <- defaults$event_code_id
  }
  if (!is.null(event_code_id)) {
    insertFields <- c(insertFields, "event_code_id")
    insertValues <- c(insertValues, event_code_id)
  }

  if (missing(event_class_id)) {
    event_class_id <- defaults$event_class_id
  }
  if (!is.null(event_class_id)) {
    insertFields <- c(insertFields, "event_class_id")
    insertValues <- c(insertValues, event_class_id)
  }

  if (missing(event_end_dt_tm)) {
    event_end_dt_tm <- defaults$event_end_dt_tm
  }
  if (!is.null(event_end_dt_tm)) {
    insertFields <- c(insertFields, "event_end_dt_tm")
    insertValues <- c(insertValues, event_end_dt_tm)
  }

  if (missing(event_end_dt_id)) {
    event_end_dt_id <- defaults$event_end_dt_id
  }
  if (!is.null(event_end_dt_id)) {
    insertFields <- c(insertFields, "event_end_dt_id")
    insertValues <- c(insertValues, event_end_dt_id)
  }

  if (missing(event_reltn_id)) {
    event_reltn_id <- defaults$event_reltn_id
  }
  if (!is.null(event_reltn_id)) {
    insertFields <- c(insertFields, "event_reltn_id")
    insertValues <- c(insertValues, event_reltn_id)
  }

  if (missing(event_start_dt_tm)) {
    event_start_dt_tm <- defaults$event_start_dt_tm
  }
  if (!is.null(event_start_dt_tm)) {
    insertFields <- c(insertFields, "event_start_dt_tm")
    insertValues <- c(insertValues, event_start_dt_tm)
  }

  if (missing(event_start_dt_id)) {
    event_start_dt_id <- defaults$event_start_dt_id
  }
  if (!is.null(event_start_dt_id)) {
    insertFields <- c(insertFields, "event_start_dt_id")
    insertValues <- c(insertValues, event_start_dt_id)
  }

  if (missing(event_expiration_dt_tm)) {
    event_expiration_dt_tm <- defaults$event_expiration_dt_tm
  }
  if (!is.null(event_expiration_dt_tm)) {
    insertFields <- c(insertFields, "event_expiration_dt_tm")
    insertValues <- c(insertValues, event_expiration_dt_tm)
  }

  if (missing(event_expiration_dt_id)) {
    event_expiration_dt_id <- defaults$event_expiration_dt_id
  }
  if (!is.null(event_expiration_dt_id)) {
    insertFields <- c(insertFields, "event_expiration_dt_id")
    insertValues <- c(insertValues, event_expiration_dt_id)
  }

  if (missing(event_normalcy_id)) {
    event_normalcy_id <- defaults$event_normalcy_id
  }
  if (!is.null(event_normalcy_id)) {
    insertFields <- c(insertFields, "event_normalcy_id")
    insertValues <- c(insertValues, event_normalcy_id)
  }

  if (missing(event_normalcy_method_id)) {
    event_normalcy_method_id <- defaults$event_normalcy_method_id
  }
  if (!is.null(event_normalcy_method_id)) {
    insertFields <- c(insertFields, "event_normalcy_method_id")
    insertValues <- c(insertValues, event_normalcy_method_id)
  }

  if (missing(normal_high)) {
    normal_high <- defaults$normal_high
  }
  if (!is.null(normal_high)) {
    insertFields <- c(insertFields, "normal_high")
    insertValues <- c(insertValues, normal_high)
  }

  if (missing(normal_low)) {
    normal_low <- defaults$normal_low
  }
  if (!is.null(normal_low)) {
    insertFields <- c(insertFields, "normal_low")
    insertValues <- c(insertValues, normal_low)
  }

  if (missing(performed_dt_tm)) {
    performed_dt_tm <- defaults$performed_dt_tm
  }
  if (!is.null(performed_dt_tm)) {
    insertFields <- c(insertFields, "performed_dt_tm")
    insertValues <- c(insertValues, performed_dt_tm)
  }

  if (missing(performed_dt_id)) {
    performed_dt_id <- defaults$performed_dt_id
  }
  if (!is.null(performed_dt_id)) {
    insertFields <- c(insertFields, "performed_dt_id")
    insertValues <- c(insertValues, performed_dt_id)
  }

  if (missing(performed_prsnl_id)) {
    performed_prsnl_id <- defaults$performed_prsnl_id
  }
  if (!is.null(performed_prsnl_id)) {
    insertFields <- c(insertFields, "performed_prsnl_id")
    insertValues <- c(insertValues, performed_prsnl_id)
  }

  if (missing(result_normalcy_flg)) {
    result_normalcy_flg <- defaults$result_normalcy_flg
  }
  if (!is.null(result_normalcy_flg)) {
    insertFields <- c(insertFields, "result_normalcy_flg")
    insertValues <- c(insertValues, result_normalcy_flg)
  }

  if (missing(result_time_unit_id)) {
    result_time_unit_id <- defaults$result_time_unit_id
  }
  if (!is.null(result_time_unit_id)) {
    insertFields <- c(insertFields, "result_time_unit_id")
    insertValues <- c(insertValues, result_time_unit_id)
  }

  if (missing(result_units_id)) {
    result_units_id <- defaults$result_units_id
  }
  if (!is.null(result_units_id)) {
    insertFields <- c(insertFields, "result_units_id")
    insertValues <- c(insertValues, result_units_id)
  }

  if (missing(result_value_dt_tm)) {
    result_value_dt_tm <- defaults$result_value_dt_tm
  }
  if (!is.null(result_value_dt_tm)) {
    insertFields <- c(insertFields, "result_value_dt_tm")
    insertValues <- c(insertValues, result_value_dt_tm)
  }

  if (missing(result_value_dt_id)) {
    result_value_dt_id <- defaults$result_value_dt_id
  }
  if (!is.null(result_value_dt_id)) {
    insertFields <- c(insertFields, "result_value_dt_id")
    insertValues <- c(insertValues, result_value_dt_id)
  }

  if (missing(result_value_num)) {
    result_value_num <- defaults$result_value_num
  }
  if (!is.null(result_value_num)) {
    insertFields <- c(insertFields, "result_value_num")
    insertValues <- c(insertValues, result_value_num)
  }

  if (missing(result_feasible_ind)) {
    result_feasible_ind <- defaults$result_feasible_ind
  }
  if (!is.null(result_feasible_ind)) {
    insertFields <- c(insertFields, "result_feasible_ind")
    insertValues <- c(insertValues, result_feasible_ind)
  }

  if (missing(result_inaccurate_ind)) {
    result_inaccurate_ind <- defaults$result_inaccurate_ind
  }
  if (!is.null(result_inaccurate_ind)) {
    insertFields <- c(insertFields, "result_inaccurate_ind")
    insertValues <- c(insertValues, result_inaccurate_ind)
  }

  if (missing(event_source_id)) {
    event_source_id <- defaults$event_source_id
  }
  if (!is.null(event_source_id)) {
    insertFields <- c(insertFields, "event_source_id")
    insertValues <- c(insertValues, event_source_id)
  }

  if (missing(verified_dt_tm)) {
    verified_dt_tm <- defaults$verified_dt_tm
  }
  if (!is.null(verified_dt_tm)) {
    insertFields <- c(insertFields, "verified_dt_tm")
    insertValues <- c(insertValues, verified_dt_tm)
  }

  if (missing(verified_dt_id)) {
    verified_dt_id <- defaults$verified_dt_id
  }
  if (!is.null(verified_dt_id)) {
    insertFields <- c(insertFields, "verified_dt_id")
    insertValues <- c(insertValues, verified_dt_id)
  }

  if (missing(verified_prsnl_id)) {
    verified_prsnl_id <- defaults$verified_prsnl_id
  }
  if (!is.null(verified_prsnl_id)) {
    insertFields <- c(insertFields, "verified_prsnl_id")
    insertValues <- c(insertValues, verified_prsnl_id)
  }

  # if (missing(_extractyear)) {
  #   _extractyear <- defaults$_extractyear
  # }
  # if (!is.null(_extractyear)) {
  #   insertFields <- c(insertFields, "_extractyear")
  #   insertValues <- c(insertValues, _extractyear)
  # }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_f_clinical_event', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_f_clinical_event (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_f_clinical_event', statement)
  invisible(statement)
}

add_hf_f_diagnosis <- function(encounter_id, diagnosis_id, diagnosis_priority, diagnosis_type_id, present_on_admit_id, third_party_ind#, _extractyear
                               ) {
  defaults <- get('hf_f_diagnosis', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(encounter_id)) {
    encounter_id <- defaults$encounter_id
  }
  if (!is.null(encounter_id)) {
    insertFields <- c(insertFields, "encounter_id")
    insertValues <- c(insertValues, encounter_id)
  }

  if (missing(diagnosis_id)) {
    diagnosis_id <- defaults$diagnosis_id
  }
  if (!is.null(diagnosis_id)) {
    insertFields <- c(insertFields, "diagnosis_id")
    insertValues <- c(insertValues, diagnosis_id)
  }

  if (missing(diagnosis_priority)) {
    diagnosis_priority <- defaults$diagnosis_priority
  }
  if (!is.null(diagnosis_priority)) {
    insertFields <- c(insertFields, "diagnosis_priority")
    insertValues <- c(insertValues, diagnosis_priority)
  }

  if (missing(diagnosis_type_id)) {
    diagnosis_type_id <- defaults$diagnosis_type_id
  }
  if (!is.null(diagnosis_type_id)) {
    insertFields <- c(insertFields, "diagnosis_type_id")
    insertValues <- c(insertValues, diagnosis_type_id)
  }

  if (missing(present_on_admit_id)) {
    present_on_admit_id <- defaults$present_on_admit_id
  }
  if (!is.null(present_on_admit_id)) {
    insertFields <- c(insertFields, "present_on_admit_id")
    insertValues <- c(insertValues, present_on_admit_id)
  }

  if (missing(third_party_ind)) {
    third_party_ind <- defaults$third_party_ind
  }
  if (!is.null(third_party_ind)) {
    insertFields <- c(insertFields, "third_party_ind")
    insertValues <- c(insertValues, third_party_ind)
  }

  # if (missing(_extractyear)) {
  #   _extractyear <- defaults$_extractyear
  # }
  # if (!is.null(_extractyear)) {
  #   insertFields <- c(insertFields, "_extractyear")
  #   insertValues <- c(insertValues, _extractyear)
  # }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_f_diagnosis', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_f_diagnosis (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_f_diagnosis', statement)
  invisible(statement)
}

add_hf_f_enc_history <- function(encounter_id, patient_type_id, caresetting_id, begin_dt_tm, end_dt_tm, begin_dt_id, end_dt_id, estimate_ind#, _extractyear
                                 ) {
  defaults <- get('hf_f_enc_history', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(encounter_id)) {
    encounter_id <- defaults$encounter_id
  }
  if (!is.null(encounter_id)) {
    insertFields <- c(insertFields, "encounter_id")
    insertValues <- c(insertValues, encounter_id)
  }

  if (missing(patient_type_id)) {
    patient_type_id <- defaults$patient_type_id
  }
  if (!is.null(patient_type_id)) {
    insertFields <- c(insertFields, "patient_type_id")
    insertValues <- c(insertValues, patient_type_id)
  }

  if (missing(caresetting_id)) {
    caresetting_id <- defaults$caresetting_id
  }
  if (!is.null(caresetting_id)) {
    insertFields <- c(insertFields, "caresetting_id")
    insertValues <- c(insertValues, caresetting_id)
  }

  if (missing(begin_dt_tm)) {
    begin_dt_tm <- defaults$begin_dt_tm
  }
  if (!is.null(begin_dt_tm)) {
    insertFields <- c(insertFields, "begin_dt_tm")
    insertValues <- c(insertValues, begin_dt_tm)
  }

  if (missing(end_dt_tm)) {
    end_dt_tm <- defaults$end_dt_tm
  }
  if (!is.null(end_dt_tm)) {
    insertFields <- c(insertFields, "end_dt_tm")
    insertValues <- c(insertValues, end_dt_tm)
  }

  if (missing(begin_dt_id)) {
    begin_dt_id <- defaults$begin_dt_id
  }
  if (!is.null(begin_dt_id)) {
    insertFields <- c(insertFields, "begin_dt_id")
    insertValues <- c(insertValues, begin_dt_id)
  }

  if (missing(end_dt_id)) {
    end_dt_id <- defaults$end_dt_id
  }
  if (!is.null(end_dt_id)) {
    insertFields <- c(insertFields, "end_dt_id")
    insertValues <- c(insertValues, end_dt_id)
  }

  if (missing(estimate_ind)) {
    estimate_ind <- defaults$estimate_ind
  }
  if (!is.null(estimate_ind)) {
    insertFields <- c(insertFields, "estimate_ind")
    insertValues <- c(insertValues, estimate_ind)
  }

  # if (missing(_extractyear)) {
  #   _extractyear <- defaults$_extractyear
  # }
  # if (!is.null(_extractyear)) {
  #   insertFields <- c(insertFields, "_extractyear")
  #   insertValues <- c(insertValues, _extractyear)
  # }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_f_enc_history', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_f_enc_history (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_f_enc_history', statement)
  invisible(statement)
}

add_hf_f_encounter <- function(encounter_id, hospital_id, admitting_physician_id, discharge_caresetting_id, patient_id, patient_type_id, admitted_dt_id, discharged_dt_id, discharge_disposition_id, diagnostic_grouping_id, admission_source_id, admission_type_id, payer_id, age_in_years, age_in_months, age_in_weeks, age_in_days, age_in_hours, total_charges, billing_ind, weight, weight_unit_id, admitted_dt_tm, discharged_dt_tm, admitted_tm_valid_ind, discharged_tm_valid_ind#, _extractyear
                               ) {
  defaults <- get('hf_f_encounter', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(encounter_id)) {
    encounter_id <- defaults$encounter_id
  }
  if (!is.null(encounter_id)) {
    insertFields <- c(insertFields, "encounter_id")
    insertValues <- c(insertValues, encounter_id)
  }

  if (missing(hospital_id)) {
    hospital_id <- defaults$hospital_id
  }
  if (!is.null(hospital_id)) {
    insertFields <- c(insertFields, "hospital_id")
    insertValues <- c(insertValues, hospital_id)
  }

  if (missing(admitting_physician_id)) {
    admitting_physician_id <- defaults$admitting_physician_id
  }
  if (!is.null(admitting_physician_id)) {
    insertFields <- c(insertFields, "admitting_physician_id")
    insertValues <- c(insertValues, admitting_physician_id)
  }

  if (missing(discharge_caresetting_id)) {
    discharge_caresetting_id <- defaults$discharge_caresetting_id
  }
  if (!is.null(discharge_caresetting_id)) {
    insertFields <- c(insertFields, "discharge_caresetting_id")
    insertValues <- c(insertValues, discharge_caresetting_id)
  }

  if (missing(patient_id)) {
    patient_id <- defaults$patient_id
  }
  if (!is.null(patient_id)) {
    insertFields <- c(insertFields, "patient_id")
    insertValues <- c(insertValues, patient_id)
  }

  if (missing(patient_type_id)) {
    patient_type_id <- defaults$patient_type_id
  }
  if (!is.null(patient_type_id)) {
    insertFields <- c(insertFields, "patient_type_id")
    insertValues <- c(insertValues, patient_type_id)
  }

  if (missing(admitted_dt_id)) {
    admitted_dt_id <- defaults$admitted_dt_id
  }
  if (!is.null(admitted_dt_id)) {
    insertFields <- c(insertFields, "admitted_dt_id")
    insertValues <- c(insertValues, admitted_dt_id)
  }

  if (missing(discharged_dt_id)) {
    discharged_dt_id <- defaults$discharged_dt_id
  }
  if (!is.null(discharged_dt_id)) {
    insertFields <- c(insertFields, "discharged_dt_id")
    insertValues <- c(insertValues, discharged_dt_id)
  }

  if (missing(discharge_disposition_id)) {
    discharge_disposition_id <- defaults$discharge_disposition_id
  }
  if (!is.null(discharge_disposition_id)) {
    insertFields <- c(insertFields, "discharge_disposition_id")
    insertValues <- c(insertValues, discharge_disposition_id)
  }

  if (missing(diagnostic_grouping_id)) {
    diagnostic_grouping_id <- defaults$diagnostic_grouping_id
  }
  if (!is.null(diagnostic_grouping_id)) {
    insertFields <- c(insertFields, "diagnostic_grouping_id")
    insertValues <- c(insertValues, diagnostic_grouping_id)
  }

  if (missing(admission_source_id)) {
    admission_source_id <- defaults$admission_source_id
  }
  if (!is.null(admission_source_id)) {
    insertFields <- c(insertFields, "admission_source_id")
    insertValues <- c(insertValues, admission_source_id)
  }

  if (missing(admission_type_id)) {
    admission_type_id <- defaults$admission_type_id
  }
  if (!is.null(admission_type_id)) {
    insertFields <- c(insertFields, "admission_type_id")
    insertValues <- c(insertValues, admission_type_id)
  }

  if (missing(payer_id)) {
    payer_id <- defaults$payer_id
  }
  if (!is.null(payer_id)) {
    insertFields <- c(insertFields, "payer_id")
    insertValues <- c(insertValues, payer_id)
  }

  if (missing(age_in_years)) {
    age_in_years <- defaults$age_in_years
  }
  if (!is.null(age_in_years)) {
    insertFields <- c(insertFields, "age_in_years")
    insertValues <- c(insertValues, age_in_years)
  }

  if (missing(age_in_months)) {
    age_in_months <- defaults$age_in_months
  }
  if (!is.null(age_in_months)) {
    insertFields <- c(insertFields, "age_in_months")
    insertValues <- c(insertValues, age_in_months)
  }

  if (missing(age_in_weeks)) {
    age_in_weeks <- defaults$age_in_weeks
  }
  if (!is.null(age_in_weeks)) {
    insertFields <- c(insertFields, "age_in_weeks")
    insertValues <- c(insertValues, age_in_weeks)
  }

  if (missing(age_in_days)) {
    age_in_days <- defaults$age_in_days
  }
  if (!is.null(age_in_days)) {
    insertFields <- c(insertFields, "age_in_days")
    insertValues <- c(insertValues, age_in_days)
  }

  if (missing(age_in_hours)) {
    age_in_hours <- defaults$age_in_hours
  }
  if (!is.null(age_in_hours)) {
    insertFields <- c(insertFields, "age_in_hours")
    insertValues <- c(insertValues, age_in_hours)
  }

  if (missing(total_charges)) {
    total_charges <- defaults$total_charges
  }
  if (!is.null(total_charges)) {
    insertFields <- c(insertFields, "total_charges")
    insertValues <- c(insertValues, total_charges)
  }

  if (missing(billing_ind)) {
    billing_ind <- defaults$billing_ind
  }
  if (!is.null(billing_ind)) {
    insertFields <- c(insertFields, "billing_ind")
    insertValues <- c(insertValues, billing_ind)
  }

  if (missing(weight)) {
    weight <- defaults$weight
  }
  if (!is.null(weight)) {
    insertFields <- c(insertFields, "weight")
    insertValues <- c(insertValues, weight)
  }

  if (missing(weight_unit_id)) {
    weight_unit_id <- defaults$weight_unit_id
  }
  if (!is.null(weight_unit_id)) {
    insertFields <- c(insertFields, "weight_unit_id")
    insertValues <- c(insertValues, weight_unit_id)
  }

  if (missing(admitted_dt_tm)) {
    admitted_dt_tm <- defaults$admitted_dt_tm
  }
  if (!is.null(admitted_dt_tm)) {
    insertFields <- c(insertFields, "admitted_dt_tm")
    insertValues <- c(insertValues, admitted_dt_tm)
  }

  if (missing(discharged_dt_tm)) {
    discharged_dt_tm <- defaults$discharged_dt_tm
  }
  if (!is.null(discharged_dt_tm)) {
    insertFields <- c(insertFields, "discharged_dt_tm")
    insertValues <- c(insertValues, discharged_dt_tm)
  }

  if (missing(admitted_tm_valid_ind)) {
    admitted_tm_valid_ind <- defaults$admitted_tm_valid_ind
  }
  if (!is.null(admitted_tm_valid_ind)) {
    insertFields <- c(insertFields, "admitted_tm_valid_ind")
    insertValues <- c(insertValues, admitted_tm_valid_ind)
  }

  if (missing(discharged_tm_valid_ind)) {
    discharged_tm_valid_ind <- defaults$discharged_tm_valid_ind
  }
  if (!is.null(discharged_tm_valid_ind)) {
    insertFields <- c(insertFields, "discharged_tm_valid_ind")
    insertValues <- c(insertValues, discharged_tm_valid_ind)
  }

  # if (missing(_extractyear)) {
  #   _extractyear <- defaults$_extractyear
  # }
  # if (!is.null(_extractyear)) {
  #   insertFields <- c(insertFields, "_extractyear")
  #   insertValues <- c(insertValues, _extractyear)
  # }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_f_encounter', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_f_encounter (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_f_encounter', statement)
  invisible(statement)
}

add_hf_f_implant_log <- function(manufacturer_id, expiration_dt_tm, expiration_dt_id, surgical_case_id, encounter_id#, _extractyear
                                 ) {
  defaults <- get('hf_f_implant_log', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(manufacturer_id)) {
    manufacturer_id <- defaults$manufacturer_id
  }
  if (!is.null(manufacturer_id)) {
    insertFields <- c(insertFields, "manufacturer_id")
    insertValues <- c(insertValues, manufacturer_id)
  }

  if (missing(expiration_dt_tm)) {
    expiration_dt_tm <- defaults$expiration_dt_tm
  }
  if (!is.null(expiration_dt_tm)) {
    insertFields <- c(insertFields, "expiration_dt_tm")
    insertValues <- c(insertValues, expiration_dt_tm)
  }

  if (missing(expiration_dt_id)) {
    expiration_dt_id <- defaults$expiration_dt_id
  }
  if (!is.null(expiration_dt_id)) {
    insertFields <- c(insertFields, "expiration_dt_id")
    insertValues <- c(insertValues, expiration_dt_id)
  }

  if (missing(surgical_case_id)) {
    surgical_case_id <- defaults$surgical_case_id
  }
  if (!is.null(surgical_case_id)) {
    insertFields <- c(insertFields, "surgical_case_id")
    insertValues <- c(insertValues, surgical_case_id)
  }

  if (missing(encounter_id)) {
    encounter_id <- defaults$encounter_id
  }
  if (!is.null(encounter_id)) {
    insertFields <- c(insertFields, "encounter_id")
    insertValues <- c(insertValues, encounter_id)
  }

  # if (missing(_extractyear)) {
  #   _extractyear <- defaults$_extractyear
  # }
  # if (!is.null(_extractyear)) {
  #   insertFields <- c(insertFields, "_extractyear")
  #   insertValues <- c(insertValues, _extractyear)
  # }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_f_implant_log', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_f_implant_log (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_f_implant_log', statement)
  invisible(statement)
}

add_hf_f_lab_procedure <- function(encounter_id, detail_lab_procedure_id, order_lab_procedure_id, ordering_physician_id, lab_order_caresetting_id, reporting_priority_id, lab_result_type_id, result_indicator_id, lab_ordered_dt_id, lab_drawn_dt_id, lab_received_dt_id, lab_completed_dt_id, lab_cancelled_dt_id, lab_performed_dt_id, lab_verified_dt_id, accession, date_result_id, numeric_result, result_units_id, normal_range_low, normal_range_high, lab_ordered_dt_tm, lab_drawn_dt_tm, lab_received_dt_tm, lab_completed_dt_tm, lab_cancelled_dt_tm, lab_performed_dt_tm, lab_verified_dt_tm, lab_ordered_tm_vld_flg, lab_drawn_tm_vld_flg, lab_received_tm_vld_flg, lab_completed_tm_vld_flg, lab_cancelled_tm_vld_flg, lab_verified_tm_vld_flg, lab_performed_tm_vld_flg, lab_performed_caresetting_id, collection_source_id, collection_method_id#, _extractyear
                                   ) {
  defaults <- get('hf_f_lab_procedure', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(encounter_id)) {
    encounter_id <- defaults$encounter_id
  }
  if (!is.null(encounter_id)) {
    insertFields <- c(insertFields, "encounter_id")
    insertValues <- c(insertValues, encounter_id)
  }

  if (missing(detail_lab_procedure_id)) {
    detail_lab_procedure_id <- defaults$detail_lab_procedure_id
  }
  if (!is.null(detail_lab_procedure_id)) {
    insertFields <- c(insertFields, "detail_lab_procedure_id")
    insertValues <- c(insertValues, detail_lab_procedure_id)
  }

  if (missing(order_lab_procedure_id)) {
    order_lab_procedure_id <- defaults$order_lab_procedure_id
  }
  if (!is.null(order_lab_procedure_id)) {
    insertFields <- c(insertFields, "order_lab_procedure_id")
    insertValues <- c(insertValues, order_lab_procedure_id)
  }

  if (missing(ordering_physician_id)) {
    ordering_physician_id <- defaults$ordering_physician_id
  }
  if (!is.null(ordering_physician_id)) {
    insertFields <- c(insertFields, "ordering_physician_id")
    insertValues <- c(insertValues, ordering_physician_id)
  }

  if (missing(lab_order_caresetting_id)) {
    lab_order_caresetting_id <- defaults$lab_order_caresetting_id
  }
  if (!is.null(lab_order_caresetting_id)) {
    insertFields <- c(insertFields, "lab_order_caresetting_id")
    insertValues <- c(insertValues, lab_order_caresetting_id)
  }

  if (missing(reporting_priority_id)) {
    reporting_priority_id <- defaults$reporting_priority_id
  }
  if (!is.null(reporting_priority_id)) {
    insertFields <- c(insertFields, "reporting_priority_id")
    insertValues <- c(insertValues, reporting_priority_id)
  }

  if (missing(lab_result_type_id)) {
    lab_result_type_id <- defaults$lab_result_type_id
  }
  if (!is.null(lab_result_type_id)) {
    insertFields <- c(insertFields, "lab_result_type_id")
    insertValues <- c(insertValues, lab_result_type_id)
  }

  if (missing(result_indicator_id)) {
    result_indicator_id <- defaults$result_indicator_id
  }
  if (!is.null(result_indicator_id)) {
    insertFields <- c(insertFields, "result_indicator_id")
    insertValues <- c(insertValues, result_indicator_id)
  }

  if (missing(lab_ordered_dt_id)) {
    lab_ordered_dt_id <- defaults$lab_ordered_dt_id
  }
  if (!is.null(lab_ordered_dt_id)) {
    insertFields <- c(insertFields, "lab_ordered_dt_id")
    insertValues <- c(insertValues, lab_ordered_dt_id)
  }

  if (missing(lab_drawn_dt_id)) {
    lab_drawn_dt_id <- defaults$lab_drawn_dt_id
  }
  if (!is.null(lab_drawn_dt_id)) {
    insertFields <- c(insertFields, "lab_drawn_dt_id")
    insertValues <- c(insertValues, lab_drawn_dt_id)
  }

  if (missing(lab_received_dt_id)) {
    lab_received_dt_id <- defaults$lab_received_dt_id
  }
  if (!is.null(lab_received_dt_id)) {
    insertFields <- c(insertFields, "lab_received_dt_id")
    insertValues <- c(insertValues, lab_received_dt_id)
  }

  if (missing(lab_completed_dt_id)) {
    lab_completed_dt_id <- defaults$lab_completed_dt_id
  }
  if (!is.null(lab_completed_dt_id)) {
    insertFields <- c(insertFields, "lab_completed_dt_id")
    insertValues <- c(insertValues, lab_completed_dt_id)
  }

  if (missing(lab_cancelled_dt_id)) {
    lab_cancelled_dt_id <- defaults$lab_cancelled_dt_id
  }
  if (!is.null(lab_cancelled_dt_id)) {
    insertFields <- c(insertFields, "lab_cancelled_dt_id")
    insertValues <- c(insertValues, lab_cancelled_dt_id)
  }

  if (missing(lab_performed_dt_id)) {
    lab_performed_dt_id <- defaults$lab_performed_dt_id
  }
  if (!is.null(lab_performed_dt_id)) {
    insertFields <- c(insertFields, "lab_performed_dt_id")
    insertValues <- c(insertValues, lab_performed_dt_id)
  }

  if (missing(lab_verified_dt_id)) {
    lab_verified_dt_id <- defaults$lab_verified_dt_id
  }
  if (!is.null(lab_verified_dt_id)) {
    insertFields <- c(insertFields, "lab_verified_dt_id")
    insertValues <- c(insertValues, lab_verified_dt_id)
  }

  if (missing(accession)) {
    accession <- defaults$accession
  }
  if (!is.null(accession)) {
    insertFields <- c(insertFields, "accession")
    insertValues <- c(insertValues, accession)
  }

  if (missing(date_result_id)) {
    date_result_id <- defaults$date_result_id
  }
  if (!is.null(date_result_id)) {
    insertFields <- c(insertFields, "date_result_id")
    insertValues <- c(insertValues, date_result_id)
  }

  if (missing(numeric_result)) {
    numeric_result <- defaults$numeric_result
  }
  if (!is.null(numeric_result)) {
    insertFields <- c(insertFields, "numeric_result")
    insertValues <- c(insertValues, numeric_result)
  }

  if (missing(result_units_id)) {
    result_units_id <- defaults$result_units_id
  }
  if (!is.null(result_units_id)) {
    insertFields <- c(insertFields, "result_units_id")
    insertValues <- c(insertValues, result_units_id)
  }

  if (missing(normal_range_low)) {
    normal_range_low <- defaults$normal_range_low
  }
  if (!is.null(normal_range_low)) {
    insertFields <- c(insertFields, "normal_range_low")
    insertValues <- c(insertValues, normal_range_low)
  }

  if (missing(normal_range_high)) {
    normal_range_high <- defaults$normal_range_high
  }
  if (!is.null(normal_range_high)) {
    insertFields <- c(insertFields, "normal_range_high")
    insertValues <- c(insertValues, normal_range_high)
  }

  if (missing(lab_ordered_dt_tm)) {
    lab_ordered_dt_tm <- defaults$lab_ordered_dt_tm
  }
  if (!is.null(lab_ordered_dt_tm)) {
    insertFields <- c(insertFields, "lab_ordered_dt_tm")
    insertValues <- c(insertValues, lab_ordered_dt_tm)
  }

  if (missing(lab_drawn_dt_tm)) {
    lab_drawn_dt_tm <- defaults$lab_drawn_dt_tm
  }
  if (!is.null(lab_drawn_dt_tm)) {
    insertFields <- c(insertFields, "lab_drawn_dt_tm")
    insertValues <- c(insertValues, lab_drawn_dt_tm)
  }

  if (missing(lab_received_dt_tm)) {
    lab_received_dt_tm <- defaults$lab_received_dt_tm
  }
  if (!is.null(lab_received_dt_tm)) {
    insertFields <- c(insertFields, "lab_received_dt_tm")
    insertValues <- c(insertValues, lab_received_dt_tm)
  }

  if (missing(lab_completed_dt_tm)) {
    lab_completed_dt_tm <- defaults$lab_completed_dt_tm
  }
  if (!is.null(lab_completed_dt_tm)) {
    insertFields <- c(insertFields, "lab_completed_dt_tm")
    insertValues <- c(insertValues, lab_completed_dt_tm)
  }

  if (missing(lab_cancelled_dt_tm)) {
    lab_cancelled_dt_tm <- defaults$lab_cancelled_dt_tm
  }
  if (!is.null(lab_cancelled_dt_tm)) {
    insertFields <- c(insertFields, "lab_cancelled_dt_tm")
    insertValues <- c(insertValues, lab_cancelled_dt_tm)
  }

  if (missing(lab_performed_dt_tm)) {
    lab_performed_dt_tm <- defaults$lab_performed_dt_tm
  }
  if (!is.null(lab_performed_dt_tm)) {
    insertFields <- c(insertFields, "lab_performed_dt_tm")
    insertValues <- c(insertValues, lab_performed_dt_tm)
  }

  if (missing(lab_verified_dt_tm)) {
    lab_verified_dt_tm <- defaults$lab_verified_dt_tm
  }
  if (!is.null(lab_verified_dt_tm)) {
    insertFields <- c(insertFields, "lab_verified_dt_tm")
    insertValues <- c(insertValues, lab_verified_dt_tm)
  }

  if (missing(lab_ordered_tm_vld_flg)) {
    lab_ordered_tm_vld_flg <- defaults$lab_ordered_tm_vld_flg
  }
  if (!is.null(lab_ordered_tm_vld_flg)) {
    insertFields <- c(insertFields, "lab_ordered_tm_vld_flg")
    insertValues <- c(insertValues, lab_ordered_tm_vld_flg)
  }

  if (missing(lab_drawn_tm_vld_flg)) {
    lab_drawn_tm_vld_flg <- defaults$lab_drawn_tm_vld_flg
  }
  if (!is.null(lab_drawn_tm_vld_flg)) {
    insertFields <- c(insertFields, "lab_drawn_tm_vld_flg")
    insertValues <- c(insertValues, lab_drawn_tm_vld_flg)
  }

  if (missing(lab_received_tm_vld_flg)) {
    lab_received_tm_vld_flg <- defaults$lab_received_tm_vld_flg
  }
  if (!is.null(lab_received_tm_vld_flg)) {
    insertFields <- c(insertFields, "lab_received_tm_vld_flg")
    insertValues <- c(insertValues, lab_received_tm_vld_flg)
  }

  if (missing(lab_completed_tm_vld_flg)) {
    lab_completed_tm_vld_flg <- defaults$lab_completed_tm_vld_flg
  }
  if (!is.null(lab_completed_tm_vld_flg)) {
    insertFields <- c(insertFields, "lab_completed_tm_vld_flg")
    insertValues <- c(insertValues, lab_completed_tm_vld_flg)
  }

  if (missing(lab_cancelled_tm_vld_flg)) {
    lab_cancelled_tm_vld_flg <- defaults$lab_cancelled_tm_vld_flg
  }
  if (!is.null(lab_cancelled_tm_vld_flg)) {
    insertFields <- c(insertFields, "lab_cancelled_tm_vld_flg")
    insertValues <- c(insertValues, lab_cancelled_tm_vld_flg)
  }

  if (missing(lab_verified_tm_vld_flg)) {
    lab_verified_tm_vld_flg <- defaults$lab_verified_tm_vld_flg
  }
  if (!is.null(lab_verified_tm_vld_flg)) {
    insertFields <- c(insertFields, "lab_verified_tm_vld_flg")
    insertValues <- c(insertValues, lab_verified_tm_vld_flg)
  }

  if (missing(lab_performed_tm_vld_flg)) {
    lab_performed_tm_vld_flg <- defaults$lab_performed_tm_vld_flg
  }
  if (!is.null(lab_performed_tm_vld_flg)) {
    insertFields <- c(insertFields, "lab_performed_tm_vld_flg")
    insertValues <- c(insertValues, lab_performed_tm_vld_flg)
  }

  if (missing(lab_performed_caresetting_id)) {
    lab_performed_caresetting_id <- defaults$lab_performed_caresetting_id
  }
  if (!is.null(lab_performed_caresetting_id)) {
    insertFields <- c(insertFields, "lab_performed_caresetting_id")
    insertValues <- c(insertValues, lab_performed_caresetting_id)
  }

  if (missing(collection_source_id)) {
    collection_source_id <- defaults$collection_source_id
  }
  if (!is.null(collection_source_id)) {
    insertFields <- c(insertFields, "collection_source_id")
    insertValues <- c(insertValues, collection_source_id)
  }

  if (missing(collection_method_id)) {
    collection_method_id <- defaults$collection_method_id
  }
  if (!is.null(collection_method_id)) {
    insertFields <- c(insertFields, "collection_method_id")
    insertValues <- c(insertValues, collection_method_id)
  }

  # if (missing(_extractyear)) {
  #   _extractyear <- defaults$_extractyear
  # }
  # if (!is.null(_extractyear)) {
  #   insertFields <- c(insertFields, "_extractyear")
  #   insertValues <- c(insertValues, _extractyear)
  # }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_f_lab_procedure', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_f_lab_procedure (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_f_lab_procedure', statement)
  invisible(statement)
}

add_hf_f_med_history <- function(encounter_id, ordering_physician_id, med_history_flg, req_start_dt_tm, req_start_dt_id, req_start_tm_vld_flg, prn_ind, route_administration_id, order_stop_type_id, med_stopped_dt_tm, med_stopped_dt_id, med_stopped_tm_vld_flg, frequency_id, collected_ind, order_strength, order_strength_units_id, order_volume, order_volume_units_id, total_dispensed_doses, duration, duration_unit_id, next_dose_dt_tm, next_dose_dt_id, next_dose_tm_vld_flg, infusion_rate, infusion_rate_units_id, med_reason_id, cancel_reason_id, dispensed_quantity, dispensed_quantity_units_id, compliance_status_id, med_entered_dt_tm, med_entered_dt_id, med_entered_tm_vld_flg, med_product_id #, _extractyear
                                 ) {
  defaults <- get('hf_f_med_history', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(encounter_id)) {
    encounter_id <- defaults$encounter_id
  }
  if (!is.null(encounter_id)) {
    insertFields <- c(insertFields, "encounter_id")
    insertValues <- c(insertValues, encounter_id)
  }

  if (missing(ordering_physician_id)) {
    ordering_physician_id <- defaults$ordering_physician_id
  }
  if (!is.null(ordering_physician_id)) {
    insertFields <- c(insertFields, "ordering_physician_id")
    insertValues <- c(insertValues, ordering_physician_id)
  }

  if (missing(med_history_flg)) {
    med_history_flg <- defaults$med_history_flg
  }
  if (!is.null(med_history_flg)) {
    insertFields <- c(insertFields, "med_history_flg")
    insertValues <- c(insertValues, med_history_flg)
  }

  if (missing(req_start_dt_tm)) {
    req_start_dt_tm <- defaults$req_start_dt_tm
  }
  if (!is.null(req_start_dt_tm)) {
    insertFields <- c(insertFields, "req_start_dt_tm")
    insertValues <- c(insertValues, req_start_dt_tm)
  }

  if (missing(req_start_dt_id)) {
    req_start_dt_id <- defaults$req_start_dt_id
  }
  if (!is.null(req_start_dt_id)) {
    insertFields <- c(insertFields, "req_start_dt_id")
    insertValues <- c(insertValues, req_start_dt_id)
  }

  if (missing(req_start_tm_vld_flg)) {
    req_start_tm_vld_flg <- defaults$req_start_tm_vld_flg
  }
  if (!is.null(req_start_tm_vld_flg)) {
    insertFields <- c(insertFields, "req_start_tm_vld_flg")
    insertValues <- c(insertValues, req_start_tm_vld_flg)
  }

  if (missing(prn_ind)) {
    prn_ind <- defaults$prn_ind
  }
  if (!is.null(prn_ind)) {
    insertFields <- c(insertFields, "prn_ind")
    insertValues <- c(insertValues, prn_ind)
  }

  if (missing(route_administration_id)) {
    route_administration_id <- defaults$route_administration_id
  }
  if (!is.null(route_administration_id)) {
    insertFields <- c(insertFields, "route_administration_id")
    insertValues <- c(insertValues, route_administration_id)
  }

  if (missing(order_stop_type_id)) {
    order_stop_type_id <- defaults$order_stop_type_id
  }
  if (!is.null(order_stop_type_id)) {
    insertFields <- c(insertFields, "order_stop_type_id")
    insertValues <- c(insertValues, order_stop_type_id)
  }

  if (missing(med_stopped_dt_tm)) {
    med_stopped_dt_tm <- defaults$med_stopped_dt_tm
  }
  if (!is.null(med_stopped_dt_tm)) {
    insertFields <- c(insertFields, "med_stopped_dt_tm")
    insertValues <- c(insertValues, med_stopped_dt_tm)
  }

  if (missing(med_stopped_dt_id)) {
    med_stopped_dt_id <- defaults$med_stopped_dt_id
  }
  if (!is.null(med_stopped_dt_id)) {
    insertFields <- c(insertFields, "med_stopped_dt_id")
    insertValues <- c(insertValues, med_stopped_dt_id)
  }

  if (missing(med_stopped_tm_vld_flg)) {
    med_stopped_tm_vld_flg <- defaults$med_stopped_tm_vld_flg
  }
  if (!is.null(med_stopped_tm_vld_flg)) {
    insertFields <- c(insertFields, "med_stopped_tm_vld_flg")
    insertValues <- c(insertValues, med_stopped_tm_vld_flg)
  }

  if (missing(frequency_id)) {
    frequency_id <- defaults$frequency_id
  }
  if (!is.null(frequency_id)) {
    insertFields <- c(insertFields, "frequency_id")
    insertValues <- c(insertValues, frequency_id)
  }

  if (missing(collected_ind)) {
    collected_ind <- defaults$collected_ind
  }
  if (!is.null(collected_ind)) {
    insertFields <- c(insertFields, "collected_ind")
    insertValues <- c(insertValues, collected_ind)
  }

  if (missing(order_strength)) {
    order_strength <- defaults$order_strength
  }
  if (!is.null(order_strength)) {
    insertFields <- c(insertFields, "order_strength")
    insertValues <- c(insertValues, order_strength)
  }

  if (missing(order_strength_units_id)) {
    order_strength_units_id <- defaults$order_strength_units_id
  }
  if (!is.null(order_strength_units_id)) {
    insertFields <- c(insertFields, "order_strength_units_id")
    insertValues <- c(insertValues, order_strength_units_id)
  }

  if (missing(order_volume)) {
    order_volume <- defaults$order_volume
  }
  if (!is.null(order_volume)) {
    insertFields <- c(insertFields, "order_volume")
    insertValues <- c(insertValues, order_volume)
  }

  if (missing(order_volume_units_id)) {
    order_volume_units_id <- defaults$order_volume_units_id
  }
  if (!is.null(order_volume_units_id)) {
    insertFields <- c(insertFields, "order_volume_units_id")
    insertValues <- c(insertValues, order_volume_units_id)
  }

  if (missing(total_dispensed_doses)) {
    total_dispensed_doses <- defaults$total_dispensed_doses
  }
  if (!is.null(total_dispensed_doses)) {
    insertFields <- c(insertFields, "total_dispensed_doses")
    insertValues <- c(insertValues, total_dispensed_doses)
  }

  if (missing(duration)) {
    duration <- defaults$duration
  }
  if (!is.null(duration)) {
    insertFields <- c(insertFields, "duration")
    insertValues <- c(insertValues, duration)
  }

  if (missing(duration_unit_id)) {
    duration_unit_id <- defaults$duration_unit_id
  }
  if (!is.null(duration_unit_id)) {
    insertFields <- c(insertFields, "duration_unit_id")
    insertValues <- c(insertValues, duration_unit_id)
  }

  if (missing(next_dose_dt_tm)) {
    next_dose_dt_tm <- defaults$next_dose_dt_tm
  }
  if (!is.null(next_dose_dt_tm)) {
    insertFields <- c(insertFields, "next_dose_dt_tm")
    insertValues <- c(insertValues, next_dose_dt_tm)
  }

  if (missing(next_dose_dt_id)) {
    next_dose_dt_id <- defaults$next_dose_dt_id
  }
  if (!is.null(next_dose_dt_id)) {
    insertFields <- c(insertFields, "next_dose_dt_id")
    insertValues <- c(insertValues, next_dose_dt_id)
  }

  if (missing(next_dose_tm_vld_flg)) {
    next_dose_tm_vld_flg <- defaults$next_dose_tm_vld_flg
  }
  if (!is.null(next_dose_tm_vld_flg)) {
    insertFields <- c(insertFields, "next_dose_tm_vld_flg")
    insertValues <- c(insertValues, next_dose_tm_vld_flg)
  }

  if (missing(infusion_rate)) {
    infusion_rate <- defaults$infusion_rate
  }
  if (!is.null(infusion_rate)) {
    insertFields <- c(insertFields, "infusion_rate")
    insertValues <- c(insertValues, infusion_rate)
  }

  if (missing(infusion_rate_units_id)) {
    infusion_rate_units_id <- defaults$infusion_rate_units_id
  }
  if (!is.null(infusion_rate_units_id)) {
    insertFields <- c(insertFields, "infusion_rate_units_id")
    insertValues <- c(insertValues, infusion_rate_units_id)
  }

  if (missing(med_reason_id)) {
    med_reason_id <- defaults$med_reason_id
  }
  if (!is.null(med_reason_id)) {
    insertFields <- c(insertFields, "med_reason_id")
    insertValues <- c(insertValues, med_reason_id)
  }

  if (missing(cancel_reason_id)) {
    cancel_reason_id <- defaults$cancel_reason_id
  }
  if (!is.null(cancel_reason_id)) {
    insertFields <- c(insertFields, "cancel_reason_id")
    insertValues <- c(insertValues, cancel_reason_id)
  }

  if (missing(dispensed_quantity)) {
    dispensed_quantity <- defaults$dispensed_quantity
  }
  if (!is.null(dispensed_quantity)) {
    insertFields <- c(insertFields, "dispensed_quantity")
    insertValues <- c(insertValues, dispensed_quantity)
  }

  if (missing(dispensed_quantity_units_id)) {
    dispensed_quantity_units_id <- defaults$dispensed_quantity_units_id
  }
  if (!is.null(dispensed_quantity_units_id)) {
    insertFields <- c(insertFields, "dispensed_quantity_units_id")
    insertValues <- c(insertValues, dispensed_quantity_units_id)
  }

  if (missing(compliance_status_id)) {
    compliance_status_id <- defaults$compliance_status_id
  }
  if (!is.null(compliance_status_id)) {
    insertFields <- c(insertFields, "compliance_status_id")
    insertValues <- c(insertValues, compliance_status_id)
  }

  if (missing(med_entered_dt_tm)) {
    med_entered_dt_tm <- defaults$med_entered_dt_tm
  }
  if (!is.null(med_entered_dt_tm)) {
    insertFields <- c(insertFields, "med_entered_dt_tm")
    insertValues <- c(insertValues, med_entered_dt_tm)
  }

  if (missing(med_entered_dt_id)) {
    med_entered_dt_id <- defaults$med_entered_dt_id
  }
  if (!is.null(med_entered_dt_id)) {
    insertFields <- c(insertFields, "med_entered_dt_id")
    insertValues <- c(insertValues, med_entered_dt_id)
  }

  if (missing(med_entered_tm_vld_flg)) {
    med_entered_tm_vld_flg <- defaults$med_entered_tm_vld_flg
  }
  if (!is.null(med_entered_tm_vld_flg)) {
    insertFields <- c(insertFields, "med_entered_tm_vld_flg")
    insertValues <- c(insertValues, med_entered_tm_vld_flg)
  }

  if (missing(med_product_id)) {
    med_product_id <- defaults$med_product_id
  }
  if (!is.null(med_product_id)) {
    insertFields <- c(insertFields, "med_product_id")
    insertValues <- c(insertValues, med_product_id)
  }

  # if (missing(_extractyear)) {
  #   _extractyear <- defaults$_extractyear
  # }
  # if (!is.null(_extractyear)) {
  #   insertFields <- c(insertFields, "_extractyear")
  #   insertValues <- c(insertValues, _extractyear)
  # }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_f_med_history', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_f_med_history (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_f_med_history', statement)
  invisible(statement)
}

add_hf_f_medication <- function(encounter_id, medication_id, ordering_physician_id, med_dispensed_caresetting_id, med_request_caresetting_id, discontinue_reason_id, route_administration_id, formulary_type_id, frequency_id, order_stop_type_id, order_type_id, med_order_status_id, med_started_dt_id, med_entered_dt_id, med_stopped_dt_id, med_discontinued_dt_id, order_no, total_dispensed_doses, dose_quantity, initial_dose_quantity, dose_units_id, charge_quantity, credit_quantity, infusion_rate, infusion_time, infusion_time_units_id, order_strength, order_strength_units_id, order_volume, order_volume_units_id, total_volume, unit_cost, unit_price, med_started_dt_tm, med_entered_dt_tm, med_stopped_dt_tm, med_discontinued_dt_tm, med_started_tm_valid_flg, med_entered_tm_valid_flg, med_stopped_tm_valid_flg, med_discontinued_tm_valid_flg #, _extractyear
                                ) {
  defaults <- get('hf_f_medication', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(encounter_id)) {
    encounter_id <- defaults$encounter_id
  }
  if (!is.null(encounter_id)) {
    insertFields <- c(insertFields, "encounter_id")
    insertValues <- c(insertValues, encounter_id)
  }

  if (missing(medication_id)) {
    medication_id <- defaults$medication_id
  }
  if (!is.null(medication_id)) {
    insertFields <- c(insertFields, "medication_id")
    insertValues <- c(insertValues, medication_id)
  }

  if (missing(ordering_physician_id)) {
    ordering_physician_id <- defaults$ordering_physician_id
  }
  if (!is.null(ordering_physician_id)) {
    insertFields <- c(insertFields, "ordering_physician_id")
    insertValues <- c(insertValues, ordering_physician_id)
  }

  if (missing(med_dispensed_caresetting_id)) {
    med_dispensed_caresetting_id <- defaults$med_dispensed_caresetting_id
  }
  if (!is.null(med_dispensed_caresetting_id)) {
    insertFields <- c(insertFields, "med_dispensed_caresetting_id")
    insertValues <- c(insertValues, med_dispensed_caresetting_id)
  }

  if (missing(med_request_caresetting_id)) {
    med_request_caresetting_id <- defaults$med_request_caresetting_id
  }
  if (!is.null(med_request_caresetting_id)) {
    insertFields <- c(insertFields, "med_request_caresetting_id")
    insertValues <- c(insertValues, med_request_caresetting_id)
  }

  if (missing(discontinue_reason_id)) {
    discontinue_reason_id <- defaults$discontinue_reason_id
  }
  if (!is.null(discontinue_reason_id)) {
    insertFields <- c(insertFields, "discontinue_reason_id")
    insertValues <- c(insertValues, discontinue_reason_id)
  }

  if (missing(route_administration_id)) {
    route_administration_id <- defaults$route_administration_id
  }
  if (!is.null(route_administration_id)) {
    insertFields <- c(insertFields, "route_administration_id")
    insertValues <- c(insertValues, route_administration_id)
  }

  if (missing(formulary_type_id)) {
    formulary_type_id <- defaults$formulary_type_id
  }
  if (!is.null(formulary_type_id)) {
    insertFields <- c(insertFields, "formulary_type_id")
    insertValues <- c(insertValues, formulary_type_id)
  }

  if (missing(frequency_id)) {
    frequency_id <- defaults$frequency_id
  }
  if (!is.null(frequency_id)) {
    insertFields <- c(insertFields, "frequency_id")
    insertValues <- c(insertValues, frequency_id)
  }

  if (missing(order_stop_type_id)) {
    order_stop_type_id <- defaults$order_stop_type_id
  }
  if (!is.null(order_stop_type_id)) {
    insertFields <- c(insertFields, "order_stop_type_id")
    insertValues <- c(insertValues, order_stop_type_id)
  }

  if (missing(order_type_id)) {
    order_type_id <- defaults$order_type_id
  }
  if (!is.null(order_type_id)) {
    insertFields <- c(insertFields, "order_type_id")
    insertValues <- c(insertValues, order_type_id)
  }

  if (missing(med_order_status_id)) {
    med_order_status_id <- defaults$med_order_status_id
  }
  if (!is.null(med_order_status_id)) {
    insertFields <- c(insertFields, "med_order_status_id")
    insertValues <- c(insertValues, med_order_status_id)
  }

  if (missing(med_started_dt_id)) {
    med_started_dt_id <- defaults$med_started_dt_id
  }
  if (!is.null(med_started_dt_id)) {
    insertFields <- c(insertFields, "med_started_dt_id")
    insertValues <- c(insertValues, med_started_dt_id)
  }

  if (missing(med_entered_dt_id)) {
    med_entered_dt_id <- defaults$med_entered_dt_id
  }
  if (!is.null(med_entered_dt_id)) {
    insertFields <- c(insertFields, "med_entered_dt_id")
    insertValues <- c(insertValues, med_entered_dt_id)
  }

  if (missing(med_stopped_dt_id)) {
    med_stopped_dt_id <- defaults$med_stopped_dt_id
  }
  if (!is.null(med_stopped_dt_id)) {
    insertFields <- c(insertFields, "med_stopped_dt_id")
    insertValues <- c(insertValues, med_stopped_dt_id)
  }

  if (missing(med_discontinued_dt_id)) {
    med_discontinued_dt_id <- defaults$med_discontinued_dt_id
  }
  if (!is.null(med_discontinued_dt_id)) {
    insertFields <- c(insertFields, "med_discontinued_dt_id")
    insertValues <- c(insertValues, med_discontinued_dt_id)
  }

  if (missing(order_no)) {
    order_no <- defaults$order_no
  }
  if (!is.null(order_no)) {
    insertFields <- c(insertFields, "order_no")
    insertValues <- c(insertValues, order_no)
  }

  if (missing(total_dispensed_doses)) {
    total_dispensed_doses <- defaults$total_dispensed_doses
  }
  if (!is.null(total_dispensed_doses)) {
    insertFields <- c(insertFields, "total_dispensed_doses")
    insertValues <- c(insertValues, total_dispensed_doses)
  }

  if (missing(dose_quantity)) {
    dose_quantity <- defaults$dose_quantity
  }
  if (!is.null(dose_quantity)) {
    insertFields <- c(insertFields, "dose_quantity")
    insertValues <- c(insertValues, dose_quantity)
  }

  if (missing(initial_dose_quantity)) {
    initial_dose_quantity <- defaults$initial_dose_quantity
  }
  if (!is.null(initial_dose_quantity)) {
    insertFields <- c(insertFields, "initial_dose_quantity")
    insertValues <- c(insertValues, initial_dose_quantity)
  }

  if (missing(dose_units_id)) {
    dose_units_id <- defaults$dose_units_id
  }
  if (!is.null(dose_units_id)) {
    insertFields <- c(insertFields, "dose_units_id")
    insertValues <- c(insertValues, dose_units_id)
  }

  if (missing(charge_quantity)) {
    charge_quantity <- defaults$charge_quantity
  }
  if (!is.null(charge_quantity)) {
    insertFields <- c(insertFields, "charge_quantity")
    insertValues <- c(insertValues, charge_quantity)
  }

  if (missing(credit_quantity)) {
    credit_quantity <- defaults$credit_quantity
  }
  if (!is.null(credit_quantity)) {
    insertFields <- c(insertFields, "credit_quantity")
    insertValues <- c(insertValues, credit_quantity)
  }

  if (missing(infusion_rate)) {
    infusion_rate <- defaults$infusion_rate
  }
  if (!is.null(infusion_rate)) {
    insertFields <- c(insertFields, "infusion_rate")
    insertValues <- c(insertValues, infusion_rate)
  }

  if (missing(infusion_time)) {
    infusion_time <- defaults$infusion_time
  }
  if (!is.null(infusion_time)) {
    insertFields <- c(insertFields, "infusion_time")
    insertValues <- c(insertValues, infusion_time)
  }

  if (missing(infusion_time_units_id)) {
    infusion_time_units_id <- defaults$infusion_time_units_id
  }
  if (!is.null(infusion_time_units_id)) {
    insertFields <- c(insertFields, "infusion_time_units_id")
    insertValues <- c(insertValues, infusion_time_units_id)
  }

  if (missing(order_strength)) {
    order_strength <- defaults$order_strength
  }
  if (!is.null(order_strength)) {
    insertFields <- c(insertFields, "order_strength")
    insertValues <- c(insertValues, order_strength)
  }

  if (missing(order_strength_units_id)) {
    order_strength_units_id <- defaults$order_strength_units_id
  }
  if (!is.null(order_strength_units_id)) {
    insertFields <- c(insertFields, "order_strength_units_id")
    insertValues <- c(insertValues, order_strength_units_id)
  }

  if (missing(order_volume)) {
    order_volume <- defaults$order_volume
  }
  if (!is.null(order_volume)) {
    insertFields <- c(insertFields, "order_volume")
    insertValues <- c(insertValues, order_volume)
  }

  if (missing(order_volume_units_id)) {
    order_volume_units_id <- defaults$order_volume_units_id
  }
  if (!is.null(order_volume_units_id)) {
    insertFields <- c(insertFields, "order_volume_units_id")
    insertValues <- c(insertValues, order_volume_units_id)
  }

  if (missing(total_volume)) {
    total_volume <- defaults$total_volume
  }
  if (!is.null(total_volume)) {
    insertFields <- c(insertFields, "total_volume")
    insertValues <- c(insertValues, total_volume)
  }

  if (missing(unit_cost)) {
    unit_cost <- defaults$unit_cost
  }
  if (!is.null(unit_cost)) {
    insertFields <- c(insertFields, "unit_cost")
    insertValues <- c(insertValues, unit_cost)
  }

  if (missing(unit_price)) {
    unit_price <- defaults$unit_price
  }
  if (!is.null(unit_price)) {
    insertFields <- c(insertFields, "unit_price")
    insertValues <- c(insertValues, unit_price)
  }

  if (missing(med_started_dt_tm)) {
    med_started_dt_tm <- defaults$med_started_dt_tm
  }
  if (!is.null(med_started_dt_tm)) {
    insertFields <- c(insertFields, "med_started_dt_tm")
    insertValues <- c(insertValues, med_started_dt_tm)
  }

  if (missing(med_entered_dt_tm)) {
    med_entered_dt_tm <- defaults$med_entered_dt_tm
  }
  if (!is.null(med_entered_dt_tm)) {
    insertFields <- c(insertFields, "med_entered_dt_tm")
    insertValues <- c(insertValues, med_entered_dt_tm)
  }

  if (missing(med_stopped_dt_tm)) {
    med_stopped_dt_tm <- defaults$med_stopped_dt_tm
  }
  if (!is.null(med_stopped_dt_tm)) {
    insertFields <- c(insertFields, "med_stopped_dt_tm")
    insertValues <- c(insertValues, med_stopped_dt_tm)
  }

  if (missing(med_discontinued_dt_tm)) {
    med_discontinued_dt_tm <- defaults$med_discontinued_dt_tm
  }
  if (!is.null(med_discontinued_dt_tm)) {
    insertFields <- c(insertFields, "med_discontinued_dt_tm")
    insertValues <- c(insertValues, med_discontinued_dt_tm)
  }

  if (missing(med_started_tm_valid_flg)) {
    med_started_tm_valid_flg <- defaults$med_started_tm_valid_flg
  }
  if (!is.null(med_started_tm_valid_flg)) {
    insertFields <- c(insertFields, "med_started_tm_valid_flg")
    insertValues <- c(insertValues, med_started_tm_valid_flg)
  }

  if (missing(med_entered_tm_valid_flg)) {
    med_entered_tm_valid_flg <- defaults$med_entered_tm_valid_flg
  }
  if (!is.null(med_entered_tm_valid_flg)) {
    insertFields <- c(insertFields, "med_entered_tm_valid_flg")
    insertValues <- c(insertValues, med_entered_tm_valid_flg)
  }

  if (missing(med_stopped_tm_valid_flg)) {
    med_stopped_tm_valid_flg <- defaults$med_stopped_tm_valid_flg
  }
  if (!is.null(med_stopped_tm_valid_flg)) {
    insertFields <- c(insertFields, "med_stopped_tm_valid_flg")
    insertValues <- c(insertValues, med_stopped_tm_valid_flg)
  }

  if (missing(med_discontinued_tm_valid_flg)) {
    med_discontinued_tm_valid_flg <- defaults$med_discontinued_tm_valid_flg
  }
  if (!is.null(med_discontinued_tm_valid_flg)) {
    insertFields <- c(insertFields, "med_discontinued_tm_valid_flg")
    insertValues <- c(insertValues, med_discontinued_tm_valid_flg)
  }

  # if (missing(_extractyear)) {
  #   _extractyear <- defaults$_extractyear
  # }
  # if (!is.null(_extractyear)) {
  #   insertFields <- c(insertFields, "_extractyear")
  #   insertValues <- c(insertValues, _extractyear)
  # }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_f_medication', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_f_medication (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_f_medication', statement)
  invisible(statement)
}

add_hf_f_micro_susceptibility <- function(encounter_id, order_lab_procedure_id, test_type_id, isolate_id, antimicrobial_id, interp_result_id, interp_perf_dt_id, interp_perf_dt_tm, interp_perf_tm_vld_flg, interp_verf_dt_id, interp_verf_dt_tm, interp_verf_tm_vld_flg, accession, numeric_result, numeric_result_perf_dt_id, numeric_result_perf_dt_tm, numeric_result_perf_tm_vld_flg, numeric_result_verf_dt_id, numeric_result_verf_dt_tm, numeric_result_verf_tm_vld_flg, result_units_id, collection_source_id, collection_site_id, collection_method_id #, _extractyear
                                          ) {
  defaults <- get('hf_f_micro_susceptibility', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(encounter_id)) {
    encounter_id <- defaults$encounter_id
  }
  if (!is.null(encounter_id)) {
    insertFields <- c(insertFields, "encounter_id")
    insertValues <- c(insertValues, encounter_id)
  }

  if (missing(order_lab_procedure_id)) {
    order_lab_procedure_id <- defaults$order_lab_procedure_id
  }
  if (!is.null(order_lab_procedure_id)) {
    insertFields <- c(insertFields, "order_lab_procedure_id")
    insertValues <- c(insertValues, order_lab_procedure_id)
  }

  if (missing(test_type_id)) {
    test_type_id <- defaults$test_type_id
  }
  if (!is.null(test_type_id)) {
    insertFields <- c(insertFields, "test_type_id")
    insertValues <- c(insertValues, test_type_id)
  }

  if (missing(isolate_id)) {
    isolate_id <- defaults$isolate_id
  }
  if (!is.null(isolate_id)) {
    insertFields <- c(insertFields, "isolate_id")
    insertValues <- c(insertValues, isolate_id)
  }

  if (missing(antimicrobial_id)) {
    antimicrobial_id <- defaults$antimicrobial_id
  }
  if (!is.null(antimicrobial_id)) {
    insertFields <- c(insertFields, "antimicrobial_id")
    insertValues <- c(insertValues, antimicrobial_id)
  }

  if (missing(interp_result_id)) {
    interp_result_id <- defaults$interp_result_id
  }
  if (!is.null(interp_result_id)) {
    insertFields <- c(insertFields, "interp_result_id")
    insertValues <- c(insertValues, interp_result_id)
  }

  if (missing(interp_perf_dt_id)) {
    interp_perf_dt_id <- defaults$interp_perf_dt_id
  }
  if (!is.null(interp_perf_dt_id)) {
    insertFields <- c(insertFields, "interp_perf_dt_id")
    insertValues <- c(insertValues, interp_perf_dt_id)
  }

  if (missing(interp_perf_dt_tm)) {
    interp_perf_dt_tm <- defaults$interp_perf_dt_tm
  }
  if (!is.null(interp_perf_dt_tm)) {
    insertFields <- c(insertFields, "interp_perf_dt_tm")
    insertValues <- c(insertValues, interp_perf_dt_tm)
  }

  if (missing(interp_perf_tm_vld_flg)) {
    interp_perf_tm_vld_flg <- defaults$interp_perf_tm_vld_flg
  }
  if (!is.null(interp_perf_tm_vld_flg)) {
    insertFields <- c(insertFields, "interp_perf_tm_vld_flg")
    insertValues <- c(insertValues, interp_perf_tm_vld_flg)
  }

  if (missing(interp_verf_dt_id)) {
    interp_verf_dt_id <- defaults$interp_verf_dt_id
  }
  if (!is.null(interp_verf_dt_id)) {
    insertFields <- c(insertFields, "interp_verf_dt_id")
    insertValues <- c(insertValues, interp_verf_dt_id)
  }

  if (missing(interp_verf_dt_tm)) {
    interp_verf_dt_tm <- defaults$interp_verf_dt_tm
  }
  if (!is.null(interp_verf_dt_tm)) {
    insertFields <- c(insertFields, "interp_verf_dt_tm")
    insertValues <- c(insertValues, interp_verf_dt_tm)
  }

  if (missing(interp_verf_tm_vld_flg)) {
    interp_verf_tm_vld_flg <- defaults$interp_verf_tm_vld_flg
  }
  if (!is.null(interp_verf_tm_vld_flg)) {
    insertFields <- c(insertFields, "interp_verf_tm_vld_flg")
    insertValues <- c(insertValues, interp_verf_tm_vld_flg)
  }

  if (missing(accession)) {
    accession <- defaults$accession
  }
  if (!is.null(accession)) {
    insertFields <- c(insertFields, "accession")
    insertValues <- c(insertValues, accession)
  }

  if (missing(numeric_result)) {
    numeric_result <- defaults$numeric_result
  }
  if (!is.null(numeric_result)) {
    insertFields <- c(insertFields, "numeric_result")
    insertValues <- c(insertValues, numeric_result)
  }

  if (missing(numeric_result_perf_dt_id)) {
    numeric_result_perf_dt_id <- defaults$numeric_result_perf_dt_id
  }
  if (!is.null(numeric_result_perf_dt_id)) {
    insertFields <- c(insertFields, "numeric_result_perf_dt_id")
    insertValues <- c(insertValues, numeric_result_perf_dt_id)
  }

  if (missing(numeric_result_perf_dt_tm)) {
    numeric_result_perf_dt_tm <- defaults$numeric_result_perf_dt_tm
  }
  if (!is.null(numeric_result_perf_dt_tm)) {
    insertFields <- c(insertFields, "numeric_result_perf_dt_tm")
    insertValues <- c(insertValues, numeric_result_perf_dt_tm)
  }

  if (missing(numeric_result_perf_tm_vld_flg)) {
    numeric_result_perf_tm_vld_flg <- defaults$numeric_result_perf_tm_vld_flg
  }
  if (!is.null(numeric_result_perf_tm_vld_flg)) {
    insertFields <- c(insertFields, "numeric_result_perf_tm_vld_flg")
    insertValues <- c(insertValues, numeric_result_perf_tm_vld_flg)
  }

  if (missing(numeric_result_verf_dt_id)) {
    numeric_result_verf_dt_id <- defaults$numeric_result_verf_dt_id
  }
  if (!is.null(numeric_result_verf_dt_id)) {
    insertFields <- c(insertFields, "numeric_result_verf_dt_id")
    insertValues <- c(insertValues, numeric_result_verf_dt_id)
  }

  if (missing(numeric_result_verf_dt_tm)) {
    numeric_result_verf_dt_tm <- defaults$numeric_result_verf_dt_tm
  }
  if (!is.null(numeric_result_verf_dt_tm)) {
    insertFields <- c(insertFields, "numeric_result_verf_dt_tm")
    insertValues <- c(insertValues, numeric_result_verf_dt_tm)
  }

  if (missing(numeric_result_verf_tm_vld_flg)) {
    numeric_result_verf_tm_vld_flg <- defaults$numeric_result_verf_tm_vld_flg
  }
  if (!is.null(numeric_result_verf_tm_vld_flg)) {
    insertFields <- c(insertFields, "numeric_result_verf_tm_vld_flg")
    insertValues <- c(insertValues, numeric_result_verf_tm_vld_flg)
  }

  if (missing(result_units_id)) {
    result_units_id <- defaults$result_units_id
  }
  if (!is.null(result_units_id)) {
    insertFields <- c(insertFields, "result_units_id")
    insertValues <- c(insertValues, result_units_id)
  }

  if (missing(collection_source_id)) {
    collection_source_id <- defaults$collection_source_id
  }
  if (!is.null(collection_source_id)) {
    insertFields <- c(insertFields, "collection_source_id")
    insertValues <- c(insertValues, collection_source_id)
  }

  if (missing(collection_site_id)) {
    collection_site_id <- defaults$collection_site_id
  }
  if (!is.null(collection_site_id)) {
    insertFields <- c(insertFields, "collection_site_id")
    insertValues <- c(insertValues, collection_site_id)
  }

  if (missing(collection_method_id)) {
    collection_method_id <- defaults$collection_method_id
  }
  if (!is.null(collection_method_id)) {
    insertFields <- c(insertFields, "collection_method_id")
    insertValues <- c(insertValues, collection_method_id)
  }

  # if (missing(_extractyear)) {
  #   _extractyear <- defaults$_extractyear
  # }
  # if (!is.null(_extractyear)) {
  #   insertFields <- c(insertFields, "_extractyear")
  #   insertValues <- c(insertValues, _extractyear)
  # }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_f_micro_susceptibility', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_f_micro_susceptibility (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_f_micro_susceptibility', statement)
  invisible(statement)
}

add_hf_f_microbiology <- function(encounter_id, order_lab_procedure_id, isolate_id, ordering_physician_id, micro_order_caresetting_id, micro_result_type_id, result_type_procedure_id, collection_source_id, collection_site_id, reporting_priority_id, micro_order_status_id, collection_status_id, micro_lab_ordered_dt_id, micro_lab_drawn_dt_id, micro_lab_received_dt_id, micro_lab_completed_dt_id, micro_lab_cancelled_dt_id, first_report_entered_dt_id, last_report_updated_dt_id, accession, false_positive_ind, total_report_updates, micro_lab_ordered_dt_tm, micro_lab_drawn_dt_tm, micro_lab_received_dt_tm, micro_lab_completed_dt_tm, micro_lab_cancelled_dt_tm, first_report_entered_dt_tm, last_report_updated_dt_tm, micro_lab_ordered_tm_vld_flg, micro_lab_drawn_tm_vld_flg, micro_lab_received_tm_vld_flg, micro_lab_complted_tm_vld_flg, micro_lab_cancelled_tm_vld_flg, first_rpt_entered_tm_vld_flg, last_rpt_updated_tm_vld_flg, collection_method_id #, _extractyear
                                  ) {
  defaults <- get('hf_f_microbiology', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(encounter_id)) {
    encounter_id <- defaults$encounter_id
  }
  if (!is.null(encounter_id)) {
    insertFields <- c(insertFields, "encounter_id")
    insertValues <- c(insertValues, encounter_id)
  }

  if (missing(order_lab_procedure_id)) {
    order_lab_procedure_id <- defaults$order_lab_procedure_id
  }
  if (!is.null(order_lab_procedure_id)) {
    insertFields <- c(insertFields, "order_lab_procedure_id")
    insertValues <- c(insertValues, order_lab_procedure_id)
  }

  if (missing(isolate_id)) {
    isolate_id <- defaults$isolate_id
  }
  if (!is.null(isolate_id)) {
    insertFields <- c(insertFields, "isolate_id")
    insertValues <- c(insertValues, isolate_id)
  }

  if (missing(ordering_physician_id)) {
    ordering_physician_id <- defaults$ordering_physician_id
  }
  if (!is.null(ordering_physician_id)) {
    insertFields <- c(insertFields, "ordering_physician_id")
    insertValues <- c(insertValues, ordering_physician_id)
  }

  if (missing(micro_order_caresetting_id)) {
    micro_order_caresetting_id <- defaults$micro_order_caresetting_id
  }
  if (!is.null(micro_order_caresetting_id)) {
    insertFields <- c(insertFields, "micro_order_caresetting_id")
    insertValues <- c(insertValues, micro_order_caresetting_id)
  }

  if (missing(micro_result_type_id)) {
    micro_result_type_id <- defaults$micro_result_type_id
  }
  if (!is.null(micro_result_type_id)) {
    insertFields <- c(insertFields, "micro_result_type_id")
    insertValues <- c(insertValues, micro_result_type_id)
  }

  if (missing(result_type_procedure_id)) {
    result_type_procedure_id <- defaults$result_type_procedure_id
  }
  if (!is.null(result_type_procedure_id)) {
    insertFields <- c(insertFields, "result_type_procedure_id")
    insertValues <- c(insertValues, result_type_procedure_id)
  }

  if (missing(collection_source_id)) {
    collection_source_id <- defaults$collection_source_id
  }
  if (!is.null(collection_source_id)) {
    insertFields <- c(insertFields, "collection_source_id")
    insertValues <- c(insertValues, collection_source_id)
  }

  if (missing(collection_site_id)) {
    collection_site_id <- defaults$collection_site_id
  }
  if (!is.null(collection_site_id)) {
    insertFields <- c(insertFields, "collection_site_id")
    insertValues <- c(insertValues, collection_site_id)
  }

  if (missing(reporting_priority_id)) {
    reporting_priority_id <- defaults$reporting_priority_id
  }
  if (!is.null(reporting_priority_id)) {
    insertFields <- c(insertFields, "reporting_priority_id")
    insertValues <- c(insertValues, reporting_priority_id)
  }

  if (missing(micro_order_status_id)) {
    micro_order_status_id <- defaults$micro_order_status_id
  }
  if (!is.null(micro_order_status_id)) {
    insertFields <- c(insertFields, "micro_order_status_id")
    insertValues <- c(insertValues, micro_order_status_id)
  }

  if (missing(collection_status_id)) {
    collection_status_id <- defaults$collection_status_id
  }
  if (!is.null(collection_status_id)) {
    insertFields <- c(insertFields, "collection_status_id")
    insertValues <- c(insertValues, collection_status_id)
  }

  if (missing(micro_lab_ordered_dt_id)) {
    micro_lab_ordered_dt_id <- defaults$micro_lab_ordered_dt_id
  }
  if (!is.null(micro_lab_ordered_dt_id)) {
    insertFields <- c(insertFields, "micro_lab_ordered_dt_id")
    insertValues <- c(insertValues, micro_lab_ordered_dt_id)
  }

  if (missing(micro_lab_drawn_dt_id)) {
    micro_lab_drawn_dt_id <- defaults$micro_lab_drawn_dt_id
  }
  if (!is.null(micro_lab_drawn_dt_id)) {
    insertFields <- c(insertFields, "micro_lab_drawn_dt_id")
    insertValues <- c(insertValues, micro_lab_drawn_dt_id)
  }

  if (missing(micro_lab_received_dt_id)) {
    micro_lab_received_dt_id <- defaults$micro_lab_received_dt_id
  }
  if (!is.null(micro_lab_received_dt_id)) {
    insertFields <- c(insertFields, "micro_lab_received_dt_id")
    insertValues <- c(insertValues, micro_lab_received_dt_id)
  }

  if (missing(micro_lab_completed_dt_id)) {
    micro_lab_completed_dt_id <- defaults$micro_lab_completed_dt_id
  }
  if (!is.null(micro_lab_completed_dt_id)) {
    insertFields <- c(insertFields, "micro_lab_completed_dt_id")
    insertValues <- c(insertValues, micro_lab_completed_dt_id)
  }

  if (missing(micro_lab_cancelled_dt_id)) {
    micro_lab_cancelled_dt_id <- defaults$micro_lab_cancelled_dt_id
  }
  if (!is.null(micro_lab_cancelled_dt_id)) {
    insertFields <- c(insertFields, "micro_lab_cancelled_dt_id")
    insertValues <- c(insertValues, micro_lab_cancelled_dt_id)
  }

  if (missing(first_report_entered_dt_id)) {
    first_report_entered_dt_id <- defaults$first_report_entered_dt_id
  }
  if (!is.null(first_report_entered_dt_id)) {
    insertFields <- c(insertFields, "first_report_entered_dt_id")
    insertValues <- c(insertValues, first_report_entered_dt_id)
  }

  if (missing(last_report_updated_dt_id)) {
    last_report_updated_dt_id <- defaults$last_report_updated_dt_id
  }
  if (!is.null(last_report_updated_dt_id)) {
    insertFields <- c(insertFields, "last_report_updated_dt_id")
    insertValues <- c(insertValues, last_report_updated_dt_id)
  }

  if (missing(accession)) {
    accession <- defaults$accession
  }
  if (!is.null(accession)) {
    insertFields <- c(insertFields, "accession")
    insertValues <- c(insertValues, accession)
  }

  if (missing(false_positive_ind)) {
    false_positive_ind <- defaults$false_positive_ind
  }
  if (!is.null(false_positive_ind)) {
    insertFields <- c(insertFields, "false_positive_ind")
    insertValues <- c(insertValues, false_positive_ind)
  }

  if (missing(total_report_updates)) {
    total_report_updates <- defaults$total_report_updates
  }
  if (!is.null(total_report_updates)) {
    insertFields <- c(insertFields, "total_report_updates")
    insertValues <- c(insertValues, total_report_updates)
  }

  if (missing(micro_lab_ordered_dt_tm)) {
    micro_lab_ordered_dt_tm <- defaults$micro_lab_ordered_dt_tm
  }
  if (!is.null(micro_lab_ordered_dt_tm)) {
    insertFields <- c(insertFields, "micro_lab_ordered_dt_tm")
    insertValues <- c(insertValues, micro_lab_ordered_dt_tm)
  }

  if (missing(micro_lab_drawn_dt_tm)) {
    micro_lab_drawn_dt_tm <- defaults$micro_lab_drawn_dt_tm
  }
  if (!is.null(micro_lab_drawn_dt_tm)) {
    insertFields <- c(insertFields, "micro_lab_drawn_dt_tm")
    insertValues <- c(insertValues, micro_lab_drawn_dt_tm)
  }

  if (missing(micro_lab_received_dt_tm)) {
    micro_lab_received_dt_tm <- defaults$micro_lab_received_dt_tm
  }
  if (!is.null(micro_lab_received_dt_tm)) {
    insertFields <- c(insertFields, "micro_lab_received_dt_tm")
    insertValues <- c(insertValues, micro_lab_received_dt_tm)
  }

  if (missing(micro_lab_completed_dt_tm)) {
    micro_lab_completed_dt_tm <- defaults$micro_lab_completed_dt_tm
  }
  if (!is.null(micro_lab_completed_dt_tm)) {
    insertFields <- c(insertFields, "micro_lab_completed_dt_tm")
    insertValues <- c(insertValues, micro_lab_completed_dt_tm)
  }

  if (missing(micro_lab_cancelled_dt_tm)) {
    micro_lab_cancelled_dt_tm <- defaults$micro_lab_cancelled_dt_tm
  }
  if (!is.null(micro_lab_cancelled_dt_tm)) {
    insertFields <- c(insertFields, "micro_lab_cancelled_dt_tm")
    insertValues <- c(insertValues, micro_lab_cancelled_dt_tm)
  }

  if (missing(first_report_entered_dt_tm)) {
    first_report_entered_dt_tm <- defaults$first_report_entered_dt_tm
  }
  if (!is.null(first_report_entered_dt_tm)) {
    insertFields <- c(insertFields, "first_report_entered_dt_tm")
    insertValues <- c(insertValues, first_report_entered_dt_tm)
  }

  if (missing(last_report_updated_dt_tm)) {
    last_report_updated_dt_tm <- defaults$last_report_updated_dt_tm
  }
  if (!is.null(last_report_updated_dt_tm)) {
    insertFields <- c(insertFields, "last_report_updated_dt_tm")
    insertValues <- c(insertValues, last_report_updated_dt_tm)
  }

  if (missing(micro_lab_ordered_tm_vld_flg)) {
    micro_lab_ordered_tm_vld_flg <- defaults$micro_lab_ordered_tm_vld_flg
  }
  if (!is.null(micro_lab_ordered_tm_vld_flg)) {
    insertFields <- c(insertFields, "micro_lab_ordered_tm_vld_flg")
    insertValues <- c(insertValues, micro_lab_ordered_tm_vld_flg)
  }

  if (missing(micro_lab_drawn_tm_vld_flg)) {
    micro_lab_drawn_tm_vld_flg <- defaults$micro_lab_drawn_tm_vld_flg
  }
  if (!is.null(micro_lab_drawn_tm_vld_flg)) {
    insertFields <- c(insertFields, "micro_lab_drawn_tm_vld_flg")
    insertValues <- c(insertValues, micro_lab_drawn_tm_vld_flg)
  }

  if (missing(micro_lab_received_tm_vld_flg)) {
    micro_lab_received_tm_vld_flg <- defaults$micro_lab_received_tm_vld_flg
  }
  if (!is.null(micro_lab_received_tm_vld_flg)) {
    insertFields <- c(insertFields, "micro_lab_received_tm_vld_flg")
    insertValues <- c(insertValues, micro_lab_received_tm_vld_flg)
  }

  if (missing(micro_lab_complted_tm_vld_flg)) {
    micro_lab_complted_tm_vld_flg <- defaults$micro_lab_complted_tm_vld_flg
  }
  if (!is.null(micro_lab_complted_tm_vld_flg)) {
    insertFields <- c(insertFields, "micro_lab_complted_tm_vld_flg")
    insertValues <- c(insertValues, micro_lab_complted_tm_vld_flg)
  }

  if (missing(micro_lab_cancelled_tm_vld_flg)) {
    micro_lab_cancelled_tm_vld_flg <- defaults$micro_lab_cancelled_tm_vld_flg
  }
  if (!is.null(micro_lab_cancelled_tm_vld_flg)) {
    insertFields <- c(insertFields, "micro_lab_cancelled_tm_vld_flg")
    insertValues <- c(insertValues, micro_lab_cancelled_tm_vld_flg)
  }

  if (missing(first_rpt_entered_tm_vld_flg)) {
    first_rpt_entered_tm_vld_flg <- defaults$first_rpt_entered_tm_vld_flg
  }
  if (!is.null(first_rpt_entered_tm_vld_flg)) {
    insertFields <- c(insertFields, "first_rpt_entered_tm_vld_flg")
    insertValues <- c(insertValues, first_rpt_entered_tm_vld_flg)
  }

  if (missing(last_rpt_updated_tm_vld_flg)) {
    last_rpt_updated_tm_vld_flg <- defaults$last_rpt_updated_tm_vld_flg
  }
  if (!is.null(last_rpt_updated_tm_vld_flg)) {
    insertFields <- c(insertFields, "last_rpt_updated_tm_vld_flg")
    insertValues <- c(insertValues, last_rpt_updated_tm_vld_flg)
  }

  if (missing(collection_method_id)) {
    collection_method_id <- defaults$collection_method_id
  }
  if (!is.null(collection_method_id)) {
    insertFields <- c(insertFields, "collection_method_id")
    insertValues <- c(insertValues, collection_method_id)
  }

  # if (missing(_extractyear)) {
  #   _extractyear <- defaults$_extractyear
  # }
  # if (!is.null(_extractyear)) {
  #   insertFields <- c(insertFields, "_extractyear")
  #   insertValues <- c(insertValues, _extractyear)
  # }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_f_microbiology', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_f_microbiology (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_f_microbiology', statement)
  invisible(statement)
}

add_hf_f_procedure <- function(encounter_id, procedure_id, procedure_dt_id, procedure_dt_tm, procedure_priority, third_party_ind #, _extractyear
                               ) {
  defaults <- get('hf_f_procedure', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(encounter_id)) {
    encounter_id <- defaults$encounter_id
  }
  if (!is.null(encounter_id)) {
    insertFields <- c(insertFields, "encounter_id")
    insertValues <- c(insertValues, encounter_id)
  }

  if (missing(procedure_id)) {
    procedure_id <- defaults$procedure_id
  }
  if (!is.null(procedure_id)) {
    insertFields <- c(insertFields, "procedure_id")
    insertValues <- c(insertValues, procedure_id)
  }

  if (missing(procedure_dt_id)) {
    procedure_dt_id <- defaults$procedure_dt_id
  }
  if (!is.null(procedure_dt_id)) {
    insertFields <- c(insertFields, "procedure_dt_id")
    insertValues <- c(insertValues, procedure_dt_id)
  }

  if (missing(procedure_dt_tm)) {
    procedure_dt_tm <- defaults$procedure_dt_tm
  }
  if (!is.null(procedure_dt_tm)) {
    insertFields <- c(insertFields, "procedure_dt_tm")
    insertValues <- c(insertValues, procedure_dt_tm)
  }

  if (missing(procedure_priority)) {
    procedure_priority <- defaults$procedure_priority
  }
  if (!is.null(procedure_priority)) {
    insertFields <- c(insertFields, "procedure_priority")
    insertValues <- c(insertValues, procedure_priority)
  }

  if (missing(third_party_ind)) {
    third_party_ind <- defaults$third_party_ind
  }
  if (!is.null(third_party_ind)) {
    insertFields <- c(insertFields, "third_party_ind")
    insertValues <- c(insertValues, third_party_ind)
  }

  # if (missing(_extractyear)) {
  #   _extractyear <- defaults$_extractyear
  # }
  # if (!is.null(_extractyear)) {
  #   insertFields <- c(insertFields, "_extractyear")
  #   insertValues <- c(insertValues, _extractyear)
  # }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_f_procedure', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_f_procedure (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_f_procedure', statement)
  invisible(statement)
}

add_hf_f_surgical_case <- function(surgical_case_id, encounter_id, case_level_id, case_start_dt_tm, case_stop_dt_tm, case_start_dt_id, case_stop_dt_id, case_duration, scheduled_case_start_dt_tm, scheduled_case_stop_dt_tm, scheduled_case_start_dt_id, scheduled_case_stop_dt_id, scheduled_case_duration, case_specialty_id, case_completed_ind, case_cancelled_dt_tm, case_cancelled_dt_id, case_cancelled_reason_id, case_closing_start_dt_tm, case_closing_start_dt_id, transport_requested_dt_tm, transport_requested_dt_id, operating_room_setup_dt_tm, operating_room_ready_dt_tm, operating_room_setup_dt_id, operating_room_ready_dt_id, patient_in_preop_hold_dt_tm, patient_out_preop_hold_dt_tm, patient_in_preop_hold_dt_id, patient_out_preop_hold_dt_id, preop_antibiotic_admin_dt_tm, preop_antibiotic_admin_dt_id, patient_in_oper_room_dt_tm, patient_out_oper_room_dt_tm, patient_out_oper_room_dt_id, anesthesia_start_dt_tm, anesthesia_induct_dt_tm, anesthesia_stop_dt_tm, anesthesia_start_dt_id, anesthesia_induct_dt_id, anesthesia_stop_dt_id, anesthesia_induct_stop_duratn, surgeon_in_oper_room_dt_tm, surgeon_in_oper_room_dt_id, patient_in_pacu_dt_tm, patient_out_pacu_dt_tm, patient_in_pacu_ii_dt_tm, patient_out_pacu_ii_dt_tm, patient_in_pacu_dt_id, patient_out_pacu_dt_id, patient_in_pacu_ii_dt_id, patient_out_pacu_ii_dt_id, patient_in_oper_room_dt_id #, _extractyear
                                   ) {
  defaults <- get('hf_f_surgical_case', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(surgical_case_id)) {
    surgical_case_id <- defaults$surgical_case_id
  }
  if (!is.null(surgical_case_id)) {
    insertFields <- c(insertFields, "surgical_case_id")
    insertValues <- c(insertValues, surgical_case_id)
  }

  if (missing(encounter_id)) {
    encounter_id <- defaults$encounter_id
  }
  if (!is.null(encounter_id)) {
    insertFields <- c(insertFields, "encounter_id")
    insertValues <- c(insertValues, encounter_id)
  }

  if (missing(case_level_id)) {
    case_level_id <- defaults$case_level_id
  }
  if (!is.null(case_level_id)) {
    insertFields <- c(insertFields, "case_level_id")
    insertValues <- c(insertValues, case_level_id)
  }

  if (missing(case_start_dt_tm)) {
    case_start_dt_tm <- defaults$case_start_dt_tm
  }
  if (!is.null(case_start_dt_tm)) {
    insertFields <- c(insertFields, "case_start_dt_tm")
    insertValues <- c(insertValues, case_start_dt_tm)
  }

  if (missing(case_stop_dt_tm)) {
    case_stop_dt_tm <- defaults$case_stop_dt_tm
  }
  if (!is.null(case_stop_dt_tm)) {
    insertFields <- c(insertFields, "case_stop_dt_tm")
    insertValues <- c(insertValues, case_stop_dt_tm)
  }

  if (missing(case_start_dt_id)) {
    case_start_dt_id <- defaults$case_start_dt_id
  }
  if (!is.null(case_start_dt_id)) {
    insertFields <- c(insertFields, "case_start_dt_id")
    insertValues <- c(insertValues, case_start_dt_id)
  }

  if (missing(case_stop_dt_id)) {
    case_stop_dt_id <- defaults$case_stop_dt_id
  }
  if (!is.null(case_stop_dt_id)) {
    insertFields <- c(insertFields, "case_stop_dt_id")
    insertValues <- c(insertValues, case_stop_dt_id)
  }

  if (missing(case_duration)) {
    case_duration <- defaults$case_duration
  }
  if (!is.null(case_duration)) {
    insertFields <- c(insertFields, "case_duration")
    insertValues <- c(insertValues, case_duration)
  }

  if (missing(scheduled_case_start_dt_tm)) {
    scheduled_case_start_dt_tm <- defaults$scheduled_case_start_dt_tm
  }
  if (!is.null(scheduled_case_start_dt_tm)) {
    insertFields <- c(insertFields, "scheduled_case_start_dt_tm")
    insertValues <- c(insertValues, scheduled_case_start_dt_tm)
  }

  if (missing(scheduled_case_stop_dt_tm)) {
    scheduled_case_stop_dt_tm <- defaults$scheduled_case_stop_dt_tm
  }
  if (!is.null(scheduled_case_stop_dt_tm)) {
    insertFields <- c(insertFields, "scheduled_case_stop_dt_tm")
    insertValues <- c(insertValues, scheduled_case_stop_dt_tm)
  }

  if (missing(scheduled_case_start_dt_id)) {
    scheduled_case_start_dt_id <- defaults$scheduled_case_start_dt_id
  }
  if (!is.null(scheduled_case_start_dt_id)) {
    insertFields <- c(insertFields, "scheduled_case_start_dt_id")
    insertValues <- c(insertValues, scheduled_case_start_dt_id)
  }

  if (missing(scheduled_case_stop_dt_id)) {
    scheduled_case_stop_dt_id <- defaults$scheduled_case_stop_dt_id
  }
  if (!is.null(scheduled_case_stop_dt_id)) {
    insertFields <- c(insertFields, "scheduled_case_stop_dt_id")
    insertValues <- c(insertValues, scheduled_case_stop_dt_id)
  }

  if (missing(scheduled_case_duration)) {
    scheduled_case_duration <- defaults$scheduled_case_duration
  }
  if (!is.null(scheduled_case_duration)) {
    insertFields <- c(insertFields, "scheduled_case_duration")
    insertValues <- c(insertValues, scheduled_case_duration)
  }

  if (missing(case_specialty_id)) {
    case_specialty_id <- defaults$case_specialty_id
  }
  if (!is.null(case_specialty_id)) {
    insertFields <- c(insertFields, "case_specialty_id")
    insertValues <- c(insertValues, case_specialty_id)
  }

  if (missing(case_completed_ind)) {
    case_completed_ind <- defaults$case_completed_ind
  }
  if (!is.null(case_completed_ind)) {
    insertFields <- c(insertFields, "case_completed_ind")
    insertValues <- c(insertValues, case_completed_ind)
  }

  if (missing(case_cancelled_dt_tm)) {
    case_cancelled_dt_tm <- defaults$case_cancelled_dt_tm
  }
  if (!is.null(case_cancelled_dt_tm)) {
    insertFields <- c(insertFields, "case_cancelled_dt_tm")
    insertValues <- c(insertValues, case_cancelled_dt_tm)
  }

  if (missing(case_cancelled_dt_id)) {
    case_cancelled_dt_id <- defaults$case_cancelled_dt_id
  }
  if (!is.null(case_cancelled_dt_id)) {
    insertFields <- c(insertFields, "case_cancelled_dt_id")
    insertValues <- c(insertValues, case_cancelled_dt_id)
  }

  if (missing(case_cancelled_reason_id)) {
    case_cancelled_reason_id <- defaults$case_cancelled_reason_id
  }
  if (!is.null(case_cancelled_reason_id)) {
    insertFields <- c(insertFields, "case_cancelled_reason_id")
    insertValues <- c(insertValues, case_cancelled_reason_id)
  }

  if (missing(case_closing_start_dt_tm)) {
    case_closing_start_dt_tm <- defaults$case_closing_start_dt_tm
  }
  if (!is.null(case_closing_start_dt_tm)) {
    insertFields <- c(insertFields, "case_closing_start_dt_tm")
    insertValues <- c(insertValues, case_closing_start_dt_tm)
  }

  if (missing(case_closing_start_dt_id)) {
    case_closing_start_dt_id <- defaults$case_closing_start_dt_id
  }
  if (!is.null(case_closing_start_dt_id)) {
    insertFields <- c(insertFields, "case_closing_start_dt_id")
    insertValues <- c(insertValues, case_closing_start_dt_id)
  }

  if (missing(transport_requested_dt_tm)) {
    transport_requested_dt_tm <- defaults$transport_requested_dt_tm
  }
  if (!is.null(transport_requested_dt_tm)) {
    insertFields <- c(insertFields, "transport_requested_dt_tm")
    insertValues <- c(insertValues, transport_requested_dt_tm)
  }

  if (missing(transport_requested_dt_id)) {
    transport_requested_dt_id <- defaults$transport_requested_dt_id
  }
  if (!is.null(transport_requested_dt_id)) {
    insertFields <- c(insertFields, "transport_requested_dt_id")
    insertValues <- c(insertValues, transport_requested_dt_id)
  }

  if (missing(operating_room_setup_dt_tm)) {
    operating_room_setup_dt_tm <- defaults$operating_room_setup_dt_tm
  }
  if (!is.null(operating_room_setup_dt_tm)) {
    insertFields <- c(insertFields, "operating_room_setup_dt_tm")
    insertValues <- c(insertValues, operating_room_setup_dt_tm)
  }

  if (missing(operating_room_ready_dt_tm)) {
    operating_room_ready_dt_tm <- defaults$operating_room_ready_dt_tm
  }
  if (!is.null(operating_room_ready_dt_tm)) {
    insertFields <- c(insertFields, "operating_room_ready_dt_tm")
    insertValues <- c(insertValues, operating_room_ready_dt_tm)
  }

  if (missing(operating_room_setup_dt_id)) {
    operating_room_setup_dt_id <- defaults$operating_room_setup_dt_id
  }
  if (!is.null(operating_room_setup_dt_id)) {
    insertFields <- c(insertFields, "operating_room_setup_dt_id")
    insertValues <- c(insertValues, operating_room_setup_dt_id)
  }

  if (missing(operating_room_ready_dt_id)) {
    operating_room_ready_dt_id <- defaults$operating_room_ready_dt_id
  }
  if (!is.null(operating_room_ready_dt_id)) {
    insertFields <- c(insertFields, "operating_room_ready_dt_id")
    insertValues <- c(insertValues, operating_room_ready_dt_id)
  }

  if (missing(patient_in_preop_hold_dt_tm)) {
    patient_in_preop_hold_dt_tm <- defaults$patient_in_preop_hold_dt_tm
  }
  if (!is.null(patient_in_preop_hold_dt_tm)) {
    insertFields <- c(insertFields, "patient_in_preop_hold_dt_tm")
    insertValues <- c(insertValues, patient_in_preop_hold_dt_tm)
  }

  if (missing(patient_out_preop_hold_dt_tm)) {
    patient_out_preop_hold_dt_tm <- defaults$patient_out_preop_hold_dt_tm
  }
  if (!is.null(patient_out_preop_hold_dt_tm)) {
    insertFields <- c(insertFields, "patient_out_preop_hold_dt_tm")
    insertValues <- c(insertValues, patient_out_preop_hold_dt_tm)
  }

  if (missing(patient_in_preop_hold_dt_id)) {
    patient_in_preop_hold_dt_id <- defaults$patient_in_preop_hold_dt_id
  }
  if (!is.null(patient_in_preop_hold_dt_id)) {
    insertFields <- c(insertFields, "patient_in_preop_hold_dt_id")
    insertValues <- c(insertValues, patient_in_preop_hold_dt_id)
  }

  if (missing(patient_out_preop_hold_dt_id)) {
    patient_out_preop_hold_dt_id <- defaults$patient_out_preop_hold_dt_id
  }
  if (!is.null(patient_out_preop_hold_dt_id)) {
    insertFields <- c(insertFields, "patient_out_preop_hold_dt_id")
    insertValues <- c(insertValues, patient_out_preop_hold_dt_id)
  }

  if (missing(preop_antibiotic_admin_dt_tm)) {
    preop_antibiotic_admin_dt_tm <- defaults$preop_antibiotic_admin_dt_tm
  }
  if (!is.null(preop_antibiotic_admin_dt_tm)) {
    insertFields <- c(insertFields, "preop_antibiotic_admin_dt_tm")
    insertValues <- c(insertValues, preop_antibiotic_admin_dt_tm)
  }

  if (missing(preop_antibiotic_admin_dt_id)) {
    preop_antibiotic_admin_dt_id <- defaults$preop_antibiotic_admin_dt_id
  }
  if (!is.null(preop_antibiotic_admin_dt_id)) {
    insertFields <- c(insertFields, "preop_antibiotic_admin_dt_id")
    insertValues <- c(insertValues, preop_antibiotic_admin_dt_id)
  }

  if (missing(patient_in_oper_room_dt_tm)) {
    patient_in_oper_room_dt_tm <- defaults$patient_in_oper_room_dt_tm
  }
  if (!is.null(patient_in_oper_room_dt_tm)) {
    insertFields <- c(insertFields, "patient_in_oper_room_dt_tm")
    insertValues <- c(insertValues, patient_in_oper_room_dt_tm)
  }

  if (missing(patient_out_oper_room_dt_tm)) {
    patient_out_oper_room_dt_tm <- defaults$patient_out_oper_room_dt_tm
  }
  if (!is.null(patient_out_oper_room_dt_tm)) {
    insertFields <- c(insertFields, "patient_out_oper_room_dt_tm")
    insertValues <- c(insertValues, patient_out_oper_room_dt_tm)
  }

  if (missing(patient_out_oper_room_dt_id)) {
    patient_out_oper_room_dt_id <- defaults$patient_out_oper_room_dt_id
  }
  if (!is.null(patient_out_oper_room_dt_id)) {
    insertFields <- c(insertFields, "patient_out_oper_room_dt_id")
    insertValues <- c(insertValues, patient_out_oper_room_dt_id)
  }

  if (missing(anesthesia_start_dt_tm)) {
    anesthesia_start_dt_tm <- defaults$anesthesia_start_dt_tm
  }
  if (!is.null(anesthesia_start_dt_tm)) {
    insertFields <- c(insertFields, "anesthesia_start_dt_tm")
    insertValues <- c(insertValues, anesthesia_start_dt_tm)
  }

  if (missing(anesthesia_induct_dt_tm)) {
    anesthesia_induct_dt_tm <- defaults$anesthesia_induct_dt_tm
  }
  if (!is.null(anesthesia_induct_dt_tm)) {
    insertFields <- c(insertFields, "anesthesia_induct_dt_tm")
    insertValues <- c(insertValues, anesthesia_induct_dt_tm)
  }

  if (missing(anesthesia_stop_dt_tm)) {
    anesthesia_stop_dt_tm <- defaults$anesthesia_stop_dt_tm
  }
  if (!is.null(anesthesia_stop_dt_tm)) {
    insertFields <- c(insertFields, "anesthesia_stop_dt_tm")
    insertValues <- c(insertValues, anesthesia_stop_dt_tm)
  }

  if (missing(anesthesia_start_dt_id)) {
    anesthesia_start_dt_id <- defaults$anesthesia_start_dt_id
  }
  if (!is.null(anesthesia_start_dt_id)) {
    insertFields <- c(insertFields, "anesthesia_start_dt_id")
    insertValues <- c(insertValues, anesthesia_start_dt_id)
  }

  if (missing(anesthesia_induct_dt_id)) {
    anesthesia_induct_dt_id <- defaults$anesthesia_induct_dt_id
  }
  if (!is.null(anesthesia_induct_dt_id)) {
    insertFields <- c(insertFields, "anesthesia_induct_dt_id")
    insertValues <- c(insertValues, anesthesia_induct_dt_id)
  }

  if (missing(anesthesia_stop_dt_id)) {
    anesthesia_stop_dt_id <- defaults$anesthesia_stop_dt_id
  }
  if (!is.null(anesthesia_stop_dt_id)) {
    insertFields <- c(insertFields, "anesthesia_stop_dt_id")
    insertValues <- c(insertValues, anesthesia_stop_dt_id)
  }

  if (missing(anesthesia_induct_stop_duratn)) {
    anesthesia_induct_stop_duratn <- defaults$anesthesia_induct_stop_duratn
  }
  if (!is.null(anesthesia_induct_stop_duratn)) {
    insertFields <- c(insertFields, "anesthesia_induct_stop_duratn")
    insertValues <- c(insertValues, anesthesia_induct_stop_duratn)
  }

  if (missing(surgeon_in_oper_room_dt_tm)) {
    surgeon_in_oper_room_dt_tm <- defaults$surgeon_in_oper_room_dt_tm
  }
  if (!is.null(surgeon_in_oper_room_dt_tm)) {
    insertFields <- c(insertFields, "surgeon_in_oper_room_dt_tm")
    insertValues <- c(insertValues, surgeon_in_oper_room_dt_tm)
  }

  if (missing(surgeon_in_oper_room_dt_id)) {
    surgeon_in_oper_room_dt_id <- defaults$surgeon_in_oper_room_dt_id
  }
  if (!is.null(surgeon_in_oper_room_dt_id)) {
    insertFields <- c(insertFields, "surgeon_in_oper_room_dt_id")
    insertValues <- c(insertValues, surgeon_in_oper_room_dt_id)
  }

  if (missing(patient_in_pacu_dt_tm)) {
    patient_in_pacu_dt_tm <- defaults$patient_in_pacu_dt_tm
  }
  if (!is.null(patient_in_pacu_dt_tm)) {
    insertFields <- c(insertFields, "patient_in_pacu_dt_tm")
    insertValues <- c(insertValues, patient_in_pacu_dt_tm)
  }

  if (missing(patient_out_pacu_dt_tm)) {
    patient_out_pacu_dt_tm <- defaults$patient_out_pacu_dt_tm
  }
  if (!is.null(patient_out_pacu_dt_tm)) {
    insertFields <- c(insertFields, "patient_out_pacu_dt_tm")
    insertValues <- c(insertValues, patient_out_pacu_dt_tm)
  }

  if (missing(patient_in_pacu_ii_dt_tm)) {
    patient_in_pacu_ii_dt_tm <- defaults$patient_in_pacu_ii_dt_tm
  }
  if (!is.null(patient_in_pacu_ii_dt_tm)) {
    insertFields <- c(insertFields, "patient_in_pacu_ii_dt_tm")
    insertValues <- c(insertValues, patient_in_pacu_ii_dt_tm)
  }

  if (missing(patient_out_pacu_ii_dt_tm)) {
    patient_out_pacu_ii_dt_tm <- defaults$patient_out_pacu_ii_dt_tm
  }
  if (!is.null(patient_out_pacu_ii_dt_tm)) {
    insertFields <- c(insertFields, "patient_out_pacu_ii_dt_tm")
    insertValues <- c(insertValues, patient_out_pacu_ii_dt_tm)
  }

  if (missing(patient_in_pacu_dt_id)) {
    patient_in_pacu_dt_id <- defaults$patient_in_pacu_dt_id
  }
  if (!is.null(patient_in_pacu_dt_id)) {
    insertFields <- c(insertFields, "patient_in_pacu_dt_id")
    insertValues <- c(insertValues, patient_in_pacu_dt_id)
  }

  if (missing(patient_out_pacu_dt_id)) {
    patient_out_pacu_dt_id <- defaults$patient_out_pacu_dt_id
  }
  if (!is.null(patient_out_pacu_dt_id)) {
    insertFields <- c(insertFields, "patient_out_pacu_dt_id")
    insertValues <- c(insertValues, patient_out_pacu_dt_id)
  }

  if (missing(patient_in_pacu_ii_dt_id)) {
    patient_in_pacu_ii_dt_id <- defaults$patient_in_pacu_ii_dt_id
  }
  if (!is.null(patient_in_pacu_ii_dt_id)) {
    insertFields <- c(insertFields, "patient_in_pacu_ii_dt_id")
    insertValues <- c(insertValues, patient_in_pacu_ii_dt_id)
  }

  if (missing(patient_out_pacu_ii_dt_id)) {
    patient_out_pacu_ii_dt_id <- defaults$patient_out_pacu_ii_dt_id
  }
  if (!is.null(patient_out_pacu_ii_dt_id)) {
    insertFields <- c(insertFields, "patient_out_pacu_ii_dt_id")
    insertValues <- c(insertValues, patient_out_pacu_ii_dt_id)
  }

  if (missing(patient_in_oper_room_dt_id)) {
    patient_in_oper_room_dt_id <- defaults$patient_in_oper_room_dt_id
  }
  if (!is.null(patient_in_oper_room_dt_id)) {
    insertFields <- c(insertFields, "patient_in_oper_room_dt_id")
    insertValues <- c(insertValues, patient_in_oper_room_dt_id)
  }

  # if (missing(_extractyear)) {
  #   _extractyear <- defaults$_extractyear
  # }
  # if (!is.null(_extractyear)) {
  #   insertFields <- c(insertFields, "_extractyear")
  #   insertValues <- c(insertValues, _extractyear)
  # }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_f_surgical_case', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_f_surgical_case (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_f_surgical_case', statement)
  invisible(statement)
}

add_hf_f_surgical_procedure <- function(encounter_id, surgical_case_id, surgical_procedure_id, wound_class_id, asa_class_id, procedure_specialty_id, procedure_revision_ind, procedure_modifier_01_id, procedure_modifier_02_id, procedure_modifier_03_id, procedure_duration, procedure_start_dt_tm, procedure_stop_dt_tm, procedure_start_dt_id, procedure_stop_dt_id, primary_procedure_ind, scheduled_procedure_duration, procedure_completion_ind, concurrent_procedure_ind, anesthesia_type_id, expected_case_level_id, case_level_id#, _extractyear
                                        ) {
  defaults <- get('hf_f_surgical_procedure', envir = defaultValues)
  insertFields <- c()
  insertValues <- c()
  if (missing(encounter_id)) {
    encounter_id <- defaults$encounter_id
  }
  if (!is.null(encounter_id)) {
    insertFields <- c(insertFields, "encounter_id")
    insertValues <- c(insertValues, encounter_id)
  }

  if (missing(surgical_case_id)) {
    surgical_case_id <- defaults$surgical_case_id
  }
  if (!is.null(surgical_case_id)) {
    insertFields <- c(insertFields, "surgical_case_id")
    insertValues <- c(insertValues, surgical_case_id)
  }

  if (missing(surgical_procedure_id)) {
    surgical_procedure_id <- defaults$surgical_procedure_id
  }
  if (!is.null(surgical_procedure_id)) {
    insertFields <- c(insertFields, "surgical_procedure_id")
    insertValues <- c(insertValues, surgical_procedure_id)
  }

  if (missing(wound_class_id)) {
    wound_class_id <- defaults$wound_class_id
  }
  if (!is.null(wound_class_id)) {
    insertFields <- c(insertFields, "wound_class_id")
    insertValues <- c(insertValues, wound_class_id)
  }

  if (missing(asa_class_id)) {
    asa_class_id <- defaults$asa_class_id
  }
  if (!is.null(asa_class_id)) {
    insertFields <- c(insertFields, "asa_class_id")
    insertValues <- c(insertValues, asa_class_id)
  }

  if (missing(procedure_specialty_id)) {
    procedure_specialty_id <- defaults$procedure_specialty_id
  }
  if (!is.null(procedure_specialty_id)) {
    insertFields <- c(insertFields, "procedure_specialty_id")
    insertValues <- c(insertValues, procedure_specialty_id)
  }

  if (missing(procedure_revision_ind)) {
    procedure_revision_ind <- defaults$procedure_revision_ind
  }
  if (!is.null(procedure_revision_ind)) {
    insertFields <- c(insertFields, "procedure_revision_ind")
    insertValues <- c(insertValues, procedure_revision_ind)
  }

  if (missing(procedure_modifier_01_id)) {
    procedure_modifier_01_id <- defaults$procedure_modifier_01_id
  }
  if (!is.null(procedure_modifier_01_id)) {
    insertFields <- c(insertFields, "procedure_modifier_01_id")
    insertValues <- c(insertValues, procedure_modifier_01_id)
  }

  if (missing(procedure_modifier_02_id)) {
    procedure_modifier_02_id <- defaults$procedure_modifier_02_id
  }
  if (!is.null(procedure_modifier_02_id)) {
    insertFields <- c(insertFields, "procedure_modifier_02_id")
    insertValues <- c(insertValues, procedure_modifier_02_id)
  }

  if (missing(procedure_modifier_03_id)) {
    procedure_modifier_03_id <- defaults$procedure_modifier_03_id
  }
  if (!is.null(procedure_modifier_03_id)) {
    insertFields <- c(insertFields, "procedure_modifier_03_id")
    insertValues <- c(insertValues, procedure_modifier_03_id)
  }

  if (missing(procedure_duration)) {
    procedure_duration <- defaults$procedure_duration
  }
  if (!is.null(procedure_duration)) {
    insertFields <- c(insertFields, "procedure_duration")
    insertValues <- c(insertValues, procedure_duration)
  }

  if (missing(procedure_start_dt_tm)) {
    procedure_start_dt_tm <- defaults$procedure_start_dt_tm
  }
  if (!is.null(procedure_start_dt_tm)) {
    insertFields <- c(insertFields, "procedure_start_dt_tm")
    insertValues <- c(insertValues, procedure_start_dt_tm)
  }

  if (missing(procedure_stop_dt_tm)) {
    procedure_stop_dt_tm <- defaults$procedure_stop_dt_tm
  }
  if (!is.null(procedure_stop_dt_tm)) {
    insertFields <- c(insertFields, "procedure_stop_dt_tm")
    insertValues <- c(insertValues, procedure_stop_dt_tm)
  }

  if (missing(procedure_start_dt_id)) {
    procedure_start_dt_id <- defaults$procedure_start_dt_id
  }
  if (!is.null(procedure_start_dt_id)) {
    insertFields <- c(insertFields, "procedure_start_dt_id")
    insertValues <- c(insertValues, procedure_start_dt_id)
  }

  if (missing(procedure_stop_dt_id)) {
    procedure_stop_dt_id <- defaults$procedure_stop_dt_id
  }
  if (!is.null(procedure_stop_dt_id)) {
    insertFields <- c(insertFields, "procedure_stop_dt_id")
    insertValues <- c(insertValues, procedure_stop_dt_id)
  }

  if (missing(primary_procedure_ind)) {
    primary_procedure_ind <- defaults$primary_procedure_ind
  }
  if (!is.null(primary_procedure_ind)) {
    insertFields <- c(insertFields, "primary_procedure_ind")
    insertValues <- c(insertValues, primary_procedure_ind)
  }

  if (missing(scheduled_procedure_duration)) {
    scheduled_procedure_duration <- defaults$scheduled_procedure_duration
  }
  if (!is.null(scheduled_procedure_duration)) {
    insertFields <- c(insertFields, "scheduled_procedure_duration")
    insertValues <- c(insertValues, scheduled_procedure_duration)
  }

  if (missing(procedure_completion_ind)) {
    procedure_completion_ind <- defaults$procedure_completion_ind
  }
  if (!is.null(procedure_completion_ind)) {
    insertFields <- c(insertFields, "procedure_completion_ind")
    insertValues <- c(insertValues, procedure_completion_ind)
  }

  if (missing(concurrent_procedure_ind)) {
    concurrent_procedure_ind <- defaults$concurrent_procedure_ind
  }
  if (!is.null(concurrent_procedure_ind)) {
    insertFields <- c(insertFields, "concurrent_procedure_ind")
    insertValues <- c(insertValues, concurrent_procedure_ind)
  }

  if (missing(anesthesia_type_id)) {
    anesthesia_type_id <- defaults$anesthesia_type_id
  }
  if (!is.null(anesthesia_type_id)) {
    insertFields <- c(insertFields, "anesthesia_type_id")
    insertValues <- c(insertValues, anesthesia_type_id)
  }

  if (missing(expected_case_level_id)) {
    expected_case_level_id <- defaults$expected_case_level_id
  }
  if (!is.null(expected_case_level_id)) {
    insertFields <- c(insertFields, "expected_case_level_id")
    insertValues <- c(insertValues, expected_case_level_id)
  }

  if (missing(case_level_id)) {
    case_level_id <- defaults$case_level_id
  }
  if (!is.null(case_level_id)) {
    insertFields <- c(insertFields, "case_level_id")
    insertValues <- c(insertValues, case_level_id)
  }

  # if (missing(_extractyear)) {
  #   _extractyear <- defaults$_extractyear
  # }
  # if (!is.null(_extractyear)) {
  #   insertFields <- c(insertFields, "_extractyear")
  #   insertValues <- c(insertValues, _extractyear)
  # }

  if (exists('testNewAdded', where = globalenv()) && get('testNewAdded'))
  {
    assign('testNewAdded', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    insertDf[nrow(insertDf) + 1,] <<- c('hf_f_surgical_procedure', comment)
  }
  statement <- paste0("INSERT INTO @nativeDatabaseSchema.hf_f_surgical_procedure (", paste(insertFields, collapse = ", "), ") VALUES ('", paste(insertValues, collapse = "', '"), "');")
  insertDf[nrow(insertDf) + 1,] <<- c('hf_f_surgical_procedure', statement)
  invisible(statement)
}

expect_condition_occurrence <- function(condition_occurrence_id, person_id, condition_concept_id, condition_start_date, condition_start_datetime, condition_end_date, condition_end_datetime, condition_type_concept_id, stop_reason, provider_id, visit_occurrence_id, visit_detail_id, condition_source_value, condition_source_concept_id, condition_status_source_value, condition_status_concept_id) {

  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect condition_occurrence' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.condition_occurrence WHERE")
  first <- TRUE
  if (!missing(condition_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_occurrence_id)) {
      statement <- paste0(statement, ' condition_occurrence_id IS NULL')
    } else if (is(condition_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' condition_occurrence_id = (', as.character(condition_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " condition_occurrence_id = '", condition_occurrence_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(condition_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_concept_id)) {
      statement <- paste0(statement, ' condition_concept_id IS NULL')
    } else if (is(condition_concept_id, 'subQuery')){
      statement <- paste0(statement, ' condition_concept_id = (', as.character(condition_concept_id), ')')
    } else {
      statement <- paste0(statement, " condition_concept_id = '", condition_concept_id,"'")
    }
  }

  if (!missing(condition_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_start_date)) {
      statement <- paste0(statement, ' condition_start_date IS NULL')
    } else if (is(condition_start_date, 'subQuery')){
      statement <- paste0(statement, ' condition_start_date = (', as.character(condition_start_date), ')')
    } else {
      statement <- paste0(statement, " condition_start_date = '", condition_start_date,"'")
    }
  }

  if (!missing(condition_start_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_start_datetime)) {
      statement <- paste0(statement, ' condition_start_datetime IS NULL')
    } else if (is(condition_start_datetime, 'subQuery')){
      statement <- paste0(statement, ' condition_start_datetime = (', as.character(condition_start_datetime), ')')
    } else {
      statement <- paste0(statement, " condition_start_datetime = '", condition_start_datetime,"'")
    }
  }

  if (!missing(condition_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_end_date)) {
      statement <- paste0(statement, ' condition_end_date IS NULL')
    } else if (is(condition_end_date, 'subQuery')){
      statement <- paste0(statement, ' condition_end_date = (', as.character(condition_end_date), ')')
    } else {
      statement <- paste0(statement, " condition_end_date = '", condition_end_date,"'")
    }
  }

  if (!missing(condition_end_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_end_datetime)) {
      statement <- paste0(statement, ' condition_end_datetime IS NULL')
    } else if (is(condition_end_datetime, 'subQuery')){
      statement <- paste0(statement, ' condition_end_datetime = (', as.character(condition_end_datetime), ')')
    } else {
      statement <- paste0(statement, " condition_end_datetime = '", condition_end_datetime,"'")
    }
  }

  if (!missing(condition_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_type_concept_id)) {
      statement <- paste0(statement, ' condition_type_concept_id IS NULL')
    } else if (is(condition_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' condition_type_concept_id = (', as.character(condition_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " condition_type_concept_id = '", condition_type_concept_id,"'")
    }
  }

  if (!missing(stop_reason)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(stop_reason)) {
      statement <- paste0(statement, ' stop_reason IS NULL')
    } else if (is(stop_reason, 'subQuery')){
      statement <- paste0(statement, ' stop_reason = (', as.character(stop_reason), ')')
    } else {
      statement <- paste0(statement, " stop_reason = '", stop_reason,"'")
    }
  }

  if (!missing(provider_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_id)) {
      statement <- paste0(statement, ' provider_id IS NULL')
    } else if (is(provider_id, 'subQuery')){
      statement <- paste0(statement, ' provider_id = (', as.character(provider_id), ')')
    } else {
      statement <- paste0(statement, " provider_id = '", provider_id,"'")
    }
  }

  if (!missing(visit_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_occurrence_id)) {
      statement <- paste0(statement, ' visit_occurrence_id IS NULL')
    } else if (is(visit_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' visit_occurrence_id = (', as.character(visit_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " visit_occurrence_id = '", visit_occurrence_id,"'")
    }
  }

  if (!missing(visit_detail_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_detail_id)) {
      statement <- paste0(statement, ' visit_detail_id IS NULL')
    } else if (is(visit_detail_id, 'subQuery')){
      statement <- paste0(statement, ' visit_detail_id = (', as.character(visit_detail_id), ')')
    } else {
      statement <- paste0(statement, " visit_detail_id = '", visit_detail_id,"'")
    }
  }

  if (!missing(condition_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_source_value)) {
      statement <- paste0(statement, ' condition_source_value IS NULL')
    } else if (is(condition_source_value, 'subQuery')){
      statement <- paste0(statement, ' condition_source_value = (', as.character(condition_source_value), ')')
    } else {
      statement <- paste0(statement, " condition_source_value = '", condition_source_value,"'")
    }
  }

  if (!missing(condition_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_source_concept_id)) {
      statement <- paste0(statement, ' condition_source_concept_id IS NULL')
    } else if (is(condition_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' condition_source_concept_id = (', as.character(condition_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " condition_source_concept_id = '", condition_source_concept_id,"'")
    }
  }

  if (!missing(condition_status_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_status_source_value)) {
      statement <- paste0(statement, ' condition_status_source_value IS NULL')
    } else if (is(condition_status_source_value, 'subQuery')){
      statement <- paste0(statement, ' condition_status_source_value = (', as.character(condition_status_source_value), ')')
    } else {
      statement <- paste0(statement, " condition_status_source_value = '", condition_status_source_value,"'")
    }
  }

  if (!missing(condition_status_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_status_concept_id)) {
      statement <- paste0(statement, ' condition_status_concept_id IS NULL')
    } else if (is(condition_status_concept_id, 'subQuery')){
      statement <- paste0(statement, ' condition_status_concept_id = (', as.character(condition_status_concept_id), ')')
    } else {
      statement <- paste0(statement, " condition_status_concept_id = '", condition_status_concept_id,"'")
    }
  }

  statement <- paste0(statement, ") = 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_death <- function(person_id, death_date, death_datetime, death_type_concept_id, cause_concept_id, cause_source_value, cause_source_concept_id) {

  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect death' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.death WHERE")
  first <- TRUE
  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(death_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(death_date)) {
      statement <- paste0(statement, ' death_date IS NULL')
    } else if (is(death_date, 'subQuery')){
      statement <- paste0(statement, ' death_date = (', as.character(death_date), ')')
    } else {
      statement <- paste0(statement, " death_date = '", death_date,"'")
    }
  }

  if (!missing(death_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(death_datetime)) {
      statement <- paste0(statement, ' death_datetime IS NULL')
    } else if (is(death_datetime, 'subQuery')){
      statement <- paste0(statement, ' death_datetime = (', as.character(death_datetime), ')')
    } else {
      statement <- paste0(statement, " death_datetime = '", death_datetime,"'")
    }
  }

  if (!missing(death_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(death_type_concept_id)) {
      statement <- paste0(statement, ' death_type_concept_id IS NULL')
    } else if (is(death_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' death_type_concept_id = (', as.character(death_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " death_type_concept_id = '", death_type_concept_id,"'")
    }
  }

  if (!missing(cause_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cause_concept_id)) {
      statement <- paste0(statement, ' cause_concept_id IS NULL')
    } else if (is(cause_concept_id, 'subQuery')){
      statement <- paste0(statement, ' cause_concept_id = (', as.character(cause_concept_id), ')')
    } else {
      statement <- paste0(statement, " cause_concept_id = '", cause_concept_id,"'")
    }
  }

  if (!missing(cause_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cause_source_value)) {
      statement <- paste0(statement, ' cause_source_value IS NULL')
    } else if (is(cause_source_value, 'subQuery')){
      statement <- paste0(statement, ' cause_source_value = (', as.character(cause_source_value), ')')
    } else {
      statement <- paste0(statement, " cause_source_value = '", cause_source_value,"'")
    }
  }

  if (!missing(cause_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cause_source_concept_id)) {
      statement <- paste0(statement, ' cause_source_concept_id IS NULL')
    } else if (is(cause_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' cause_source_concept_id = (', as.character(cause_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " cause_source_concept_id = '", cause_source_concept_id,"'")
    }
  }

  statement <- paste0(statement, ") = 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_device_exposure <- function(device_exposure_id, person_id, device_concept_id, device_exposure_start_date, device_exposure_start_datetime, device_exposure_end_date, device_exposure_end_datetime, device_type_concept_id, unique_device_id, quantity, provider_id, visit_occurrence_id, device_source_value, device_source__concept_id, visit_detail_id) {

  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect device_exposure' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.device_exposure WHERE")
  first <- TRUE
  if (!missing(device_exposure_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(device_exposure_id)) {
      statement <- paste0(statement, ' device_exposure_id IS NULL')
    } else if (is(device_exposure_id, 'subQuery')){
      statement <- paste0(statement, ' device_exposure_id = (', as.character(device_exposure_id), ')')
    } else {
      statement <- paste0(statement, " device_exposure_id = '", device_exposure_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(device_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(device_concept_id)) {
      statement <- paste0(statement, ' device_concept_id IS NULL')
    } else if (is(device_concept_id, 'subQuery')){
      statement <- paste0(statement, ' device_concept_id = (', as.character(device_concept_id), ')')
    } else {
      statement <- paste0(statement, " device_concept_id = '", device_concept_id,"'")
    }
  }

  if (!missing(device_exposure_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(device_exposure_start_date)) {
      statement <- paste0(statement, ' device_exposure_start_date IS NULL')
    } else if (is(device_exposure_start_date, 'subQuery')){
      statement <- paste0(statement, ' device_exposure_start_date = (', as.character(device_exposure_start_date), ')')
    } else {
      statement <- paste0(statement, " device_exposure_start_date = '", device_exposure_start_date,"'")
    }
  }

  if (!missing(device_exposure_start_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(device_exposure_start_datetime)) {
      statement <- paste0(statement, ' device_exposure_start_datetime IS NULL')
    } else if (is(device_exposure_start_datetime, 'subQuery')){
      statement <- paste0(statement, ' device_exposure_start_datetime = (', as.character(device_exposure_start_datetime), ')')
    } else {
      statement <- paste0(statement, " device_exposure_start_datetime = '", device_exposure_start_datetime,"'")
    }
  }

  if (!missing(device_exposure_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(device_exposure_end_date)) {
      statement <- paste0(statement, ' device_exposure_end_date IS NULL')
    } else if (is(device_exposure_end_date, 'subQuery')){
      statement <- paste0(statement, ' device_exposure_end_date = (', as.character(device_exposure_end_date), ')')
    } else {
      statement <- paste0(statement, " device_exposure_end_date = '", device_exposure_end_date,"'")
    }
  }

  if (!missing(device_exposure_end_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(device_exposure_end_datetime)) {
      statement <- paste0(statement, ' device_exposure_end_datetime IS NULL')
    } else if (is(device_exposure_end_datetime, 'subQuery')){
      statement <- paste0(statement, ' device_exposure_end_datetime = (', as.character(device_exposure_end_datetime), ')')
    } else {
      statement <- paste0(statement, " device_exposure_end_datetime = '", device_exposure_end_datetime,"'")
    }
  }

  if (!missing(device_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(device_type_concept_id)) {
      statement <- paste0(statement, ' device_type_concept_id IS NULL')
    } else if (is(device_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' device_type_concept_id = (', as.character(device_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " device_type_concept_id = '", device_type_concept_id,"'")
    }
  }

  if (!missing(unique_device_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(unique_device_id)) {
      statement <- paste0(statement, ' unique_device_id IS NULL')
    } else if (is(unique_device_id, 'subQuery')){
      statement <- paste0(statement, ' unique_device_id = (', as.character(unique_device_id), ')')
    } else {
      statement <- paste0(statement, " unique_device_id = '", unique_device_id,"'")
    }
  }

  if (!missing(quantity)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(quantity)) {
      statement <- paste0(statement, ' quantity IS NULL')
    } else if (is(quantity, 'subQuery')){
      statement <- paste0(statement, ' quantity = (', as.character(quantity), ')')
    } else {
      statement <- paste0(statement, " quantity = '", quantity,"'")
    }
  }

  if (!missing(provider_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_id)) {
      statement <- paste0(statement, ' provider_id IS NULL')
    } else if (is(provider_id, 'subQuery')){
      statement <- paste0(statement, ' provider_id = (', as.character(provider_id), ')')
    } else {
      statement <- paste0(statement, " provider_id = '", provider_id,"'")
    }
  }

  if (!missing(visit_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_occurrence_id)) {
      statement <- paste0(statement, ' visit_occurrence_id IS NULL')
    } else if (is(visit_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' visit_occurrence_id = (', as.character(visit_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " visit_occurrence_id = '", visit_occurrence_id,"'")
    }
  }

  if (!missing(device_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(device_source_value)) {
      statement <- paste0(statement, ' device_source_value IS NULL')
    } else if (is(device_source_value, 'subQuery')){
      statement <- paste0(statement, ' device_source_value = (', as.character(device_source_value), ')')
    } else {
      statement <- paste0(statement, " device_source_value = '", device_source_value,"'")
    }
  }

  if (!missing(device_source__concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(device_source__concept_id)) {
      statement <- paste0(statement, ' [device_source_ concept_id] IS NULL')
    } else if (is(device_source__concept_id, 'subQuery')){
      statement <- paste0(statement, ' [device_source_ concept_id] = (', as.character(device_source__concept_id), ')')
    } else {
      statement <- paste0(statement, " [device_source_ concept_id] = '", device_source__concept_id,"'")
    }
  }

  if (!missing(visit_detail_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_detail_id)) {
      statement <- paste0(statement, ' visit_detail_id IS NULL')
    } else if (is(visit_detail_id, 'subQuery')){
      statement <- paste0(statement, ' visit_detail_id = (', as.character(visit_detail_id), ')')
    } else {
      statement <- paste0(statement, " visit_detail_id = '", visit_detail_id,"'")
    }
  }

  statement <- paste0(statement, ") = 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_drug_exposure <- function(drug_exposure_id, person_id, drug_concept_id, drug_exposure_start_date, drug_exposure_start_datetime, drug_exposure_end_date, drug_exposure_end_datetime, verbatim_end_date, drug_type_concept_id, stop_reason, refills, quantity, days_supply, sig, route_concept_id, lot_number, provider_id, visit_occurrence_id, drug_source_value, drug_source_concept_id, route_source_value, dose_unit_source_value, visit_detail_id) {

  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect drug_exposure' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.drug_exposure WHERE")
  first <- TRUE
  if (!missing(drug_exposure_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_exposure_id)) {
      statement <- paste0(statement, ' drug_exposure_id IS NULL')
    } else if (is(drug_exposure_id, 'subQuery')){
      statement <- paste0(statement, ' drug_exposure_id = (', as.character(drug_exposure_id), ')')
    } else {
      statement <- paste0(statement, " drug_exposure_id = '", drug_exposure_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(drug_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_concept_id)) {
      statement <- paste0(statement, ' drug_concept_id IS NULL')
    } else if (is(drug_concept_id, 'subQuery')){
      statement <- paste0(statement, ' drug_concept_id = (', as.character(drug_concept_id), ')')
    } else {
      statement <- paste0(statement, " drug_concept_id = '", drug_concept_id,"'")
    }
  }

  if (!missing(drug_exposure_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_exposure_start_date)) {
      statement <- paste0(statement, ' drug_exposure_start_date IS NULL')
    } else if (is(drug_exposure_start_date, 'subQuery')){
      statement <- paste0(statement, ' drug_exposure_start_date = (', as.character(drug_exposure_start_date), ')')
    } else {
      statement <- paste0(statement, " drug_exposure_start_date = '", drug_exposure_start_date,"'")
    }
  }

  if (!missing(drug_exposure_start_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_exposure_start_datetime)) {
      statement <- paste0(statement, ' drug_exposure_start_datetime IS NULL')
    } else if (is(drug_exposure_start_datetime, 'subQuery')){
      statement <- paste0(statement, ' drug_exposure_start_datetime = (', as.character(drug_exposure_start_datetime), ')')
    } else {
      statement <- paste0(statement, " drug_exposure_start_datetime = '", drug_exposure_start_datetime,"'")
    }
  }

  if (!missing(drug_exposure_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_exposure_end_date)) {
      statement <- paste0(statement, ' drug_exposure_end_date IS NULL')
    } else if (is(drug_exposure_end_date, 'subQuery')){
      statement <- paste0(statement, ' drug_exposure_end_date = (', as.character(drug_exposure_end_date), ')')
    } else {
      statement <- paste0(statement, " drug_exposure_end_date = '", drug_exposure_end_date,"'")
    }
  }

  if (!missing(drug_exposure_end_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_exposure_end_datetime)) {
      statement <- paste0(statement, ' drug_exposure_end_datetime IS NULL')
    } else if (is(drug_exposure_end_datetime, 'subQuery')){
      statement <- paste0(statement, ' drug_exposure_end_datetime = (', as.character(drug_exposure_end_datetime), ')')
    } else {
      statement <- paste0(statement, " drug_exposure_end_datetime = '", drug_exposure_end_datetime,"'")
    }
  }

  if (!missing(verbatim_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(verbatim_end_date)) {
      statement <- paste0(statement, ' verbatim_end_date IS NULL')
    } else if (is(verbatim_end_date, 'subQuery')){
      statement <- paste0(statement, ' verbatim_end_date = (', as.character(verbatim_end_date), ')')
    } else {
      statement <- paste0(statement, " verbatim_end_date = '", verbatim_end_date,"'")
    }
  }

  if (!missing(drug_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_type_concept_id)) {
      statement <- paste0(statement, ' drug_type_concept_id IS NULL')
    } else if (is(drug_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' drug_type_concept_id = (', as.character(drug_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " drug_type_concept_id = '", drug_type_concept_id,"'")
    }
  }

  if (!missing(stop_reason)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(stop_reason)) {
      statement <- paste0(statement, ' stop_reason IS NULL')
    } else if (is(stop_reason, 'subQuery')){
      statement <- paste0(statement, ' stop_reason = (', as.character(stop_reason), ')')
    } else {
      statement <- paste0(statement, " stop_reason = '", stop_reason,"'")
    }
  }

  if (!missing(refills)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(refills)) {
      statement <- paste0(statement, ' refills IS NULL')
    } else if (is(refills, 'subQuery')){
      statement <- paste0(statement, ' refills = (', as.character(refills), ')')
    } else {
      statement <- paste0(statement, " refills = '", refills,"'")
    }
  }

  if (!missing(quantity)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(quantity)) {
      statement <- paste0(statement, ' quantity IS NULL')
    } else if (is(quantity, 'subQuery')){
      statement <- paste0(statement, ' quantity = (', as.character(quantity), ')')
    } else {
      statement <- paste0(statement, " quantity = '", quantity,"'")
    }
  }

  if (!missing(days_supply)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(days_supply)) {
      statement <- paste0(statement, ' days_supply IS NULL')
    } else if (is(days_supply, 'subQuery')){
      statement <- paste0(statement, ' days_supply = (', as.character(days_supply), ')')
    } else {
      statement <- paste0(statement, " days_supply = '", days_supply,"'")
    }
  }

  if (!missing(sig)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(sig)) {
      statement <- paste0(statement, ' sig IS NULL')
    } else if (is(sig, 'subQuery')){
      statement <- paste0(statement, ' sig = (', as.character(sig), ')')
    } else {
      statement <- paste0(statement, " sig = '", sig,"'")
    }
  }

  if (!missing(route_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(route_concept_id)) {
      statement <- paste0(statement, ' route_concept_id IS NULL')
    } else if (is(route_concept_id, 'subQuery')){
      statement <- paste0(statement, ' route_concept_id = (', as.character(route_concept_id), ')')
    } else {
      statement <- paste0(statement, " route_concept_id = '", route_concept_id,"'")
    }
  }

  if (!missing(lot_number)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(lot_number)) {
      statement <- paste0(statement, ' lot_number IS NULL')
    } else if (is(lot_number, 'subQuery')){
      statement <- paste0(statement, ' lot_number = (', as.character(lot_number), ')')
    } else {
      statement <- paste0(statement, " lot_number = '", lot_number,"'")
    }
  }

  if (!missing(provider_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_id)) {
      statement <- paste0(statement, ' provider_id IS NULL')
    } else if (is(provider_id, 'subQuery')){
      statement <- paste0(statement, ' provider_id = (', as.character(provider_id), ')')
    } else {
      statement <- paste0(statement, " provider_id = '", provider_id,"'")
    }
  }

  if (!missing(visit_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_occurrence_id)) {
      statement <- paste0(statement, ' visit_occurrence_id IS NULL')
    } else if (is(visit_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' visit_occurrence_id = (', as.character(visit_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " visit_occurrence_id = '", visit_occurrence_id,"'")
    }
  }

  if (!missing(drug_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_source_value)) {
      statement <- paste0(statement, ' drug_source_value IS NULL')
    } else if (is(drug_source_value, 'subQuery')){
      statement <- paste0(statement, ' drug_source_value = (', as.character(drug_source_value), ')')
    } else {
      statement <- paste0(statement, " drug_source_value = '", drug_source_value,"'")
    }
  }

  if (!missing(drug_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_source_concept_id)) {
      statement <- paste0(statement, ' drug_source_concept_id IS NULL')
    } else if (is(drug_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' drug_source_concept_id = (', as.character(drug_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " drug_source_concept_id = '", drug_source_concept_id,"'")
    }
  }

  if (!missing(route_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(route_source_value)) {
      statement <- paste0(statement, ' route_source_value IS NULL')
    } else if (is(route_source_value, 'subQuery')){
      statement <- paste0(statement, ' route_source_value = (', as.character(route_source_value), ')')
    } else {
      statement <- paste0(statement, " route_source_value = '", route_source_value,"'")
    }
  }

  if (!missing(dose_unit_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(dose_unit_source_value)) {
      statement <- paste0(statement, ' dose_unit_source_value IS NULL')
    } else if (is(dose_unit_source_value, 'subQuery')){
      statement <- paste0(statement, ' dose_unit_source_value = (', as.character(dose_unit_source_value), ')')
    } else {
      statement <- paste0(statement, " dose_unit_source_value = '", dose_unit_source_value,"'")
    }
  }

  if (!missing(visit_detail_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_detail_id)) {
      statement <- paste0(statement, ' visit_detail_id IS NULL')
    } else if (is(visit_detail_id, 'subQuery')){
      statement <- paste0(statement, ' visit_detail_id = (', as.character(visit_detail_id), ')')
    } else {
      statement <- paste0(statement, " visit_detail_id = '", visit_detail_id,"'")
    }
  }

  statement <- paste0(statement, ") = 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_fact_relationship <- function(domain_concept_id_1, fact_id_1, domain_concept_id_2, fact_id_2, relationship_concept_id) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect fact_relationship' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.fact_relationship WHERE")
  first <- TRUE
  if (!missing(domain_concept_id_1)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(domain_concept_id_1)) {
      statement <- paste0(statement, ' domain_concept_id_1 IS NULL')
    } else if (is(domain_concept_id_1, 'subQuery')){
      statement <- paste0(statement, ' domain_concept_id_1 = (', as.character(domain_concept_id_1), ')')
    } else {
      statement <- paste0(statement, " domain_concept_id_1 = '", domain_concept_id_1,"'")
    }
  }

  if (!missing(fact_id_1)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(fact_id_1)) {
      statement <- paste0(statement, ' fact_id_1 IS NULL')
    } else if (is(fact_id_1, 'subQuery')){
      statement <- paste0(statement, ' fact_id_1 = (', as.character(fact_id_1), ')')
    } else {
      statement <- paste0(statement, " fact_id_1 = '", fact_id_1,"'")
    }
  }

  if (!missing(domain_concept_id_2)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(domain_concept_id_2)) {
      statement <- paste0(statement, ' domain_concept_id_2 IS NULL')
    } else if (is(domain_concept_id_2, 'subQuery')){
      statement <- paste0(statement, ' domain_concept_id_2 = (', as.character(domain_concept_id_2), ')')
    } else {
      statement <- paste0(statement, " domain_concept_id_2 = '", domain_concept_id_2,"'")
    }
  }

  if (!missing(fact_id_2)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(fact_id_2)) {
      statement <- paste0(statement, ' fact_id_2 IS NULL')
    } else if (is(fact_id_2, 'subQuery')){
      statement <- paste0(statement, ' fact_id_2 = (', as.character(fact_id_2), ')')
    } else {
      statement <- paste0(statement, " fact_id_2 = '", fact_id_2,"'")
    }
  }

  if (!missing(relationship_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(relationship_concept_id)) {
      statement <- paste0(statement, ' relationship_concept_id IS NULL')
    } else if (is(relationship_concept_id, 'subQuery')){
      statement <- paste0(statement, ' relationship_concept_id = (', as.character(relationship_concept_id), ')')
    } else {
      statement <- paste0(statement, " relationship_concept_id = '", relationship_concept_id,"'")
    }
  }

  statement <- paste0(statement, ") = 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_measurement <- function(measurement_id, person_id, measurement_concept_id, measurement_date, measurement_datetime, measurement_type_concept_id, operator_concept_id, value_as_number, value_as_concept_id, unit_concept_id, range_low, range_high, provider_id, visit_occurrence_id, visit_detail_id, measurement_source_value, measurement_source_concept_id, unit_source_value, value_source_value) {

  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect measurement' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.measurement WHERE")
  first <- TRUE
  if (!missing(measurement_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(measurement_id)) {
      statement <- paste0(statement, ' measurement_id IS NULL')
    } else if (is(measurement_id, 'subQuery')){
      statement <- paste0(statement, ' measurement_id = (', as.character(measurement_id), ')')
    } else {
      statement <- paste0(statement, " measurement_id = '", measurement_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(measurement_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(measurement_concept_id)) {
      statement <- paste0(statement, ' measurement_concept_id IS NULL')
    } else if (is(measurement_concept_id, 'subQuery')){
      statement <- paste0(statement, ' measurement_concept_id = (', as.character(measurement_concept_id), ')')
    } else {
      statement <- paste0(statement, " measurement_concept_id = '", measurement_concept_id,"'")
    }
  }

  if (!missing(measurement_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(measurement_date)) {
      statement <- paste0(statement, ' measurement_date IS NULL')
    } else if (is(measurement_date, 'subQuery')){
      statement <- paste0(statement, ' measurement_date = (', as.character(measurement_date), ')')
    } else {
      statement <- paste0(statement, " measurement_date = '", measurement_date,"'")
    }
  }

  if (!missing(measurement_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(measurement_datetime)) {
      statement <- paste0(statement, ' measurement_datetime IS NULL')
    } else if (is(measurement_datetime, 'subQuery')){
      statement <- paste0(statement, ' measurement_datetime = (', as.character(measurement_datetime), ')')
    } else {
      statement <- paste0(statement, " measurement_datetime = '", measurement_datetime,"'")
    }
  }

  if (!missing(measurement_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(measurement_type_concept_id)) {
      statement <- paste0(statement, ' measurement_type_concept_id IS NULL')
    } else if (is(measurement_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' measurement_type_concept_id = (', as.character(measurement_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " measurement_type_concept_id = '", measurement_type_concept_id,"'")
    }
  }

  if (!missing(operator_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(operator_concept_id)) {
      statement <- paste0(statement, ' operator_concept_id IS NULL')
    } else if (is(operator_concept_id, 'subQuery')){
      statement <- paste0(statement, ' operator_concept_id = (', as.character(operator_concept_id), ')')
    } else {
      statement <- paste0(statement, " operator_concept_id = '", operator_concept_id,"'")
    }
  }

  if (!missing(value_as_number)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(value_as_number)) {
      statement <- paste0(statement, ' value_as_number IS NULL')
    } else if (is(value_as_number, 'subQuery')){
      statement <- paste0(statement, ' value_as_number = (', as.character(value_as_number), ')')
    } else {
      statement <- paste0(statement, " value_as_number = '", value_as_number,"'")
    }
  }

  if (!missing(value_as_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(value_as_concept_id)) {
      statement <- paste0(statement, ' value_as_concept_id IS NULL')
    } else if (is(value_as_concept_id, 'subQuery')){
      statement <- paste0(statement, ' value_as_concept_id = (', as.character(value_as_concept_id), ')')
    } else {
      statement <- paste0(statement, " value_as_concept_id = '", value_as_concept_id,"'")
    }
  }

  if (!missing(unit_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(unit_concept_id)) {
      statement <- paste0(statement, ' unit_concept_id IS NULL')
    } else if (is(unit_concept_id, 'subQuery')){
      statement <- paste0(statement, ' unit_concept_id = (', as.character(unit_concept_id), ')')
    } else {
      statement <- paste0(statement, " unit_concept_id = '", unit_concept_id,"'")
    }
  }

  if (!missing(range_low)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(range_low)) {
      statement <- paste0(statement, ' range_low IS NULL')
    } else if (is(range_low, 'subQuery')){
      statement <- paste0(statement, ' range_low = (', as.character(range_low), ')')
    } else {
      statement <- paste0(statement, " range_low = '", range_low,"'")
    }
  }

  if (!missing(range_high)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(range_high)) {
      statement <- paste0(statement, ' range_high IS NULL')
    } else if (is(range_high, 'subQuery')){
      statement <- paste0(statement, ' range_high = (', as.character(range_high), ')')
    } else {
      statement <- paste0(statement, " range_high = '", range_high,"'")
    }
  }

  if (!missing(provider_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_id)) {
      statement <- paste0(statement, ' provider_id IS NULL')
    } else if (is(provider_id, 'subQuery')){
      statement <- paste0(statement, ' provider_id = (', as.character(provider_id), ')')
    } else {
      statement <- paste0(statement, " provider_id = '", provider_id,"'")
    }
  }

  if (!missing(visit_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_occurrence_id)) {
      statement <- paste0(statement, ' visit_occurrence_id IS NULL')
    } else if (is(visit_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' visit_occurrence_id = (', as.character(visit_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " visit_occurrence_id = '", visit_occurrence_id,"'")
    }
  }

  if (!missing(visit_detail_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_detail_id)) {
      statement <- paste0(statement, ' visit_detail_id IS NULL')
    } else if (is(visit_detail_id, 'subQuery')){
      statement <- paste0(statement, ' visit_detail_id = (', as.character(visit_detail_id), ')')
    } else {
      statement <- paste0(statement, " visit_detail_id = '", visit_detail_id,"'")
    }
  }

  if (!missing(measurement_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(measurement_source_value)) {
      statement <- paste0(statement, ' measurement_source_value IS NULL')
    } else if (is(measurement_source_value, 'subQuery')){
      statement <- paste0(statement, ' measurement_source_value = (', as.character(measurement_source_value), ')')
    } else {
      statement <- paste0(statement, " measurement_source_value = '", measurement_source_value,"'")
    }
  }

  if (!missing(measurement_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(measurement_source_concept_id)) {
      statement <- paste0(statement, ' measurement_source_concept_id IS NULL')
    } else if (is(measurement_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' measurement_source_concept_id = (', as.character(measurement_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " measurement_source_concept_id = '", measurement_source_concept_id,"'")
    }
  }

  if (!missing(unit_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(unit_source_value)) {
      statement <- paste0(statement, ' unit_source_value IS NULL')
    } else if (is(unit_source_value, 'subQuery')){
      statement <- paste0(statement, ' unit_source_value = (', as.character(unit_source_value), ')')
    } else {
      statement <- paste0(statement, " unit_source_value = '", unit_source_value,"'")
    }
  }

  if (!missing(value_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(value_source_value)) {
      statement <- paste0(statement, ' value_source_value IS NULL')
    } else if (is(value_source_value, 'subQuery')){
      statement <- paste0(statement, ' value_source_value = (', as.character(value_source_value), ')')
    } else {
      statement <- paste0(statement, " value_source_value = '", value_source_value,"'")
    }
  }

  statement <- paste0(statement, ") = 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_note <- function(note_id, person_id, note_date, note_datetime, note_type_concept_id, note_class_concept_id, note_title, note_text, encoding_concept_id, language_concept_id, provider_id, note_source_value, visit_occurrence_id) {

  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect note' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.note WHERE")
  first <- TRUE
  if (!missing(note_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_id)) {
      statement <- paste0(statement, ' note_id IS NULL')
    } else if (is(note_id, 'subQuery')){
      statement <- paste0(statement, ' note_id = (', as.character(note_id), ')')
    } else {
      statement <- paste0(statement, " note_id = '", note_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(note_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_date)) {
      statement <- paste0(statement, ' note_date IS NULL')
    } else if (is(note_date, 'subQuery')){
      statement <- paste0(statement, ' note_date = (', as.character(note_date), ')')
    } else {
      statement <- paste0(statement, " note_date = '", note_date,"'")
    }
  }

  if (!missing(note_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_datetime)) {
      statement <- paste0(statement, ' note_datetime IS NULL')
    } else if (is(note_datetime, 'subQuery')){
      statement <- paste0(statement, ' note_datetime = (', as.character(note_datetime), ')')
    } else {
      statement <- paste0(statement, " note_datetime = '", note_datetime,"'")
    }
  }

  if (!missing(note_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_type_concept_id)) {
      statement <- paste0(statement, ' note_type_concept_id IS NULL')
    } else if (is(note_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' note_type_concept_id = (', as.character(note_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " note_type_concept_id = '", note_type_concept_id,"'")
    }
  }

  if (!missing(note_class_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_class_concept_id)) {
      statement <- paste0(statement, ' note_class_concept_id IS NULL')
    } else if (is(note_class_concept_id, 'subQuery')){
      statement <- paste0(statement, ' note_class_concept_id = (', as.character(note_class_concept_id), ')')
    } else {
      statement <- paste0(statement, " note_class_concept_id = '", note_class_concept_id,"'")
    }
  }

  if (!missing(note_title)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_title)) {
      statement <- paste0(statement, ' note_title IS NULL')
    } else if (is(note_title, 'subQuery')){
      statement <- paste0(statement, ' note_title = (', as.character(note_title), ')')
    } else {
      statement <- paste0(statement, " note_title = '", note_title,"'")
    }
  }

  if (!missing(note_text)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_text)) {
      statement <- paste0(statement, ' note_text IS NULL')
    } else if (is(note_text, 'subQuery')){
      statement <- paste0(statement, ' note_text = (', as.character(note_text), ')')
    } else {
      statement <- paste0(statement, " note_text = '", note_text,"'")
    }
  }

  if (!missing(encoding_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(encoding_concept_id)) {
      statement <- paste0(statement, ' encoding_concept_id IS NULL')
    } else if (is(encoding_concept_id, 'subQuery')){
      statement <- paste0(statement, ' encoding_concept_id = (', as.character(encoding_concept_id), ')')
    } else {
      statement <- paste0(statement, " encoding_concept_id = '", encoding_concept_id,"'")
    }
  }

  if (!missing(language_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(language_concept_id)) {
      statement <- paste0(statement, ' language_concept_id IS NULL')
    } else if (is(language_concept_id, 'subQuery')){
      statement <- paste0(statement, ' language_concept_id = (', as.character(language_concept_id), ')')
    } else {
      statement <- paste0(statement, " language_concept_id = '", language_concept_id,"'")
    }
  }

  if (!missing(provider_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_id)) {
      statement <- paste0(statement, ' provider_id IS NULL')
    } else if (is(provider_id, 'subQuery')){
      statement <- paste0(statement, ' provider_id = (', as.character(provider_id), ')')
    } else {
      statement <- paste0(statement, " provider_id = '", provider_id,"'")
    }
  }

  if (!missing(note_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_source_value)) {
      statement <- paste0(statement, ' note_source_value IS NULL')
    } else if (is(note_source_value, 'subQuery')){
      statement <- paste0(statement, ' note_source_value = (', as.character(note_source_value), ')')
    } else {
      statement <- paste0(statement, " note_source_value = '", note_source_value,"'")
    }
  }

  if (!missing(visit_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_occurrence_id)) {
      statement <- paste0(statement, ' visit_occurrence_id IS NULL')
    } else if (is(visit_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' visit_occurrence_id = (', as.character(visit_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " visit_occurrence_id = '", visit_occurrence_id,"'")
    }
  }

  statement <- paste0(statement, ") = 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_note_nlp <- function(note_nlp_id, note_id, section_concept_id, snippet, offset, lexical_variant, note_nlp_concept_id, note_nlp_source_concept_id, nlp_system, nlp_date, nlp_date_time, term_exists, term_temporal, term_modifiers) {

    source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect note_nlp' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.note_nlp WHERE")
  first <- TRUE
  if (!missing(note_nlp_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_nlp_id)) {
      statement <- paste0(statement, ' note_nlp_id IS NULL')
    } else if (is(note_nlp_id, 'subQuery')){
      statement <- paste0(statement, ' note_nlp_id = (', as.character(note_nlp_id), ')')
    } else {
      statement <- paste0(statement, " note_nlp_id = '", note_nlp_id,"'")
    }
  }

  if (!missing(note_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_id)) {
      statement <- paste0(statement, ' note_id IS NULL')
    } else if (is(note_id, 'subQuery')){
      statement <- paste0(statement, ' note_id = (', as.character(note_id), ')')
    } else {
      statement <- paste0(statement, " note_id = '", note_id,"'")
    }
  }

  if (!missing(section_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(section_concept_id)) {
      statement <- paste0(statement, ' section_concept_id IS NULL')
    } else if (is(section_concept_id, 'subQuery')){
      statement <- paste0(statement, ' section_concept_id = (', as.character(section_concept_id), ')')
    } else {
      statement <- paste0(statement, " section_concept_id = '", section_concept_id,"'")
    }
  }

  if (!missing(snippet)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(snippet)) {
      statement <- paste0(statement, ' snippet IS NULL')
    } else if (is(snippet, 'subQuery')){
      statement <- paste0(statement, ' snippet = (', as.character(snippet), ')')
    } else {
      statement <- paste0(statement, " snippet = '", snippet,"'")
    }
  }

  if (!missing(offset)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(offset)) {
      statement <- paste0(statement, ' offset IS NULL')
    } else if (is(offset, 'subQuery')){
      statement <- paste0(statement, ' offset = (', as.character(offset), ')')
    } else {
      statement <- paste0(statement, " offset = '", offset,"'")
    }
  }

  if (!missing(lexical_variant)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(lexical_variant)) {
      statement <- paste0(statement, ' lexical_variant IS NULL')
    } else if (is(lexical_variant, 'subQuery')){
      statement <- paste0(statement, ' lexical_variant = (', as.character(lexical_variant), ')')
    } else {
      statement <- paste0(statement, " lexical_variant = '", lexical_variant,"'")
    }
  }

  if (!missing(note_nlp_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_nlp_concept_id)) {
      statement <- paste0(statement, ' note_nlp_concept_id IS NULL')
    } else if (is(note_nlp_concept_id, 'subQuery')){
      statement <- paste0(statement, ' note_nlp_concept_id = (', as.character(note_nlp_concept_id), ')')
    } else {
      statement <- paste0(statement, " note_nlp_concept_id = '", note_nlp_concept_id,"'")
    }
  }

  if (!missing(note_nlp_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_nlp_source_concept_id)) {
      statement <- paste0(statement, ' note_nlp_source_concept_id IS NULL')
    } else if (is(note_nlp_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' note_nlp_source_concept_id = (', as.character(note_nlp_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " note_nlp_source_concept_id = '", note_nlp_source_concept_id,"'")
    }
  }

  if (!missing(nlp_system)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(nlp_system)) {
      statement <- paste0(statement, ' nlp_system IS NULL')
    } else if (is(nlp_system, 'subQuery')){
      statement <- paste0(statement, ' nlp_system = (', as.character(nlp_system), ')')
    } else {
      statement <- paste0(statement, " nlp_system = '", nlp_system,"'")
    }
  }

  if (!missing(nlp_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(nlp_date)) {
      statement <- paste0(statement, ' nlp_date IS NULL')
    } else if (is(nlp_date, 'subQuery')){
      statement <- paste0(statement, ' nlp_date = (', as.character(nlp_date), ')')
    } else {
      statement <- paste0(statement, " nlp_date = '", nlp_date,"'")
    }
  }

  if (!missing(nlp_date_time)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(nlp_date_time)) {
      statement <- paste0(statement, ' nlp_date_time IS NULL')
    } else if (is(nlp_date_time, 'subQuery')){
      statement <- paste0(statement, ' nlp_date_time = (', as.character(nlp_date_time), ')')
    } else {
      statement <- paste0(statement, " nlp_date_time = '", nlp_date_time,"'")
    }
  }

  if (!missing(term_exists)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(term_exists)) {
      statement <- paste0(statement, ' term_exists IS NULL')
    } else if (is(term_exists, 'subQuery')){
      statement <- paste0(statement, ' term_exists = (', as.character(term_exists), ')')
    } else {
      statement <- paste0(statement, " term_exists = '", term_exists,"'")
    }
  }

  if (!missing(term_temporal)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(term_temporal)) {
      statement <- paste0(statement, ' term_temporal IS NULL')
    } else if (is(term_temporal, 'subQuery')){
      statement <- paste0(statement, ' term_temporal = (', as.character(term_temporal), ')')
    } else {
      statement <- paste0(statement, " term_temporal = '", term_temporal,"'")
    }
  }

  if (!missing(term_modifiers)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(term_modifiers)) {
      statement <- paste0(statement, ' term_modifiers IS NULL')
    } else if (is(term_modifiers, 'subQuery')){
      statement <- paste0(statement, ' term_modifiers = (', as.character(term_modifiers), ')')
    } else {
      statement <- paste0(statement, " term_modifiers = '", term_modifiers,"'")
    }
  }

  statement <- paste0(statement, ") = 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_observation <- function(observation_id, person_id, observation_concept_id, observation_date, observation_datetime, observation_type_concept_id, value_as_number, value_as_string, value_as_concept_id, qualifier_concept_id, unit_concept_id, provider_id, visit_occurrence_id, visit_detail_id, observation_source_value, observation_source_concept_id, unit_source_value, qualifier_source_value) {

  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect observation' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.observation WHERE")
  first <- TRUE
  if (!missing(observation_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(observation_id)) {
      statement <- paste0(statement, ' observation_id IS NULL')
    } else if (is(observation_id, 'subQuery')){
      statement <- paste0(statement, ' observation_id = (', as.character(observation_id), ')')
    } else {
      statement <- paste0(statement, " observation_id = '", observation_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(observation_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(observation_concept_id)) {
      statement <- paste0(statement, ' observation_concept_id IS NULL')
    } else if (is(observation_concept_id, 'subQuery')){
      statement <- paste0(statement, ' observation_concept_id = (', as.character(observation_concept_id), ')')
    } else {
      statement <- paste0(statement, " observation_concept_id = '", observation_concept_id,"'")
    }
  }

  if (!missing(observation_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(observation_date)) {
      statement <- paste0(statement, ' observation_date IS NULL')
    } else if (is(observation_date, 'subQuery')){
      statement <- paste0(statement, ' observation_date = (', as.character(observation_date), ')')
    } else {
      statement <- paste0(statement, " observation_date = '", observation_date,"'")
    }
  }

  if (!missing(observation_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(observation_datetime)) {
      statement <- paste0(statement, ' observation_datetime IS NULL')
    } else if (is(observation_datetime, 'subQuery')){
      statement <- paste0(statement, ' observation_datetime = (', as.character(observation_datetime), ')')
    } else {
      statement <- paste0(statement, " observation_datetime = '", observation_datetime,"'")
    }
  }

  if (!missing(observation_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(observation_type_concept_id)) {
      statement <- paste0(statement, ' observation_type_concept_id IS NULL')
    } else if (is(observation_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' observation_type_concept_id = (', as.character(observation_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " observation_type_concept_id = '", observation_type_concept_id,"'")
    }
  }

  if (!missing(value_as_number)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(value_as_number)) {
      statement <- paste0(statement, ' value_as_number IS NULL')
    } else if (is(value_as_number, 'subQuery')){
      statement <- paste0(statement, ' value_as_number = (', as.character(value_as_number), ')')
    } else {
      statement <- paste0(statement, " value_as_number = '", value_as_number,"'")
    }
  }

  if (!missing(value_as_string)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(value_as_string)) {
      statement <- paste0(statement, ' value_as_string IS NULL')
    } else if (is(value_as_string, 'subQuery')){
      statement <- paste0(statement, ' value_as_string = (', as.character(value_as_string), ')')
    } else {
      statement <- paste0(statement, " value_as_string = '", value_as_string,"'")
    }
  }

  if (!missing(value_as_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(value_as_concept_id)) {
      statement <- paste0(statement, ' value_as_concept_id IS NULL')
    } else if (is(value_as_concept_id, 'subQuery')){
      statement <- paste0(statement, ' value_as_concept_id = (', as.character(value_as_concept_id), ')')
    } else {
      statement <- paste0(statement, " value_as_concept_id = '", value_as_concept_id,"'")
    }
  }

  if (!missing(qualifier_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(qualifier_concept_id)) {
      statement <- paste0(statement, ' qualifier_concept_id IS NULL')
    } else if (is(qualifier_concept_id, 'subQuery')){
      statement <- paste0(statement, ' qualifier_concept_id = (', as.character(qualifier_concept_id), ')')
    } else {
      statement <- paste0(statement, " qualifier_concept_id = '", qualifier_concept_id,"'")
    }
  }

  if (!missing(unit_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(unit_concept_id)) {
      statement <- paste0(statement, ' unit_concept_id IS NULL')
    } else if (is(unit_concept_id, 'subQuery')){
      statement <- paste0(statement, ' unit_concept_id = (', as.character(unit_concept_id), ')')
    } else {
      statement <- paste0(statement, " unit_concept_id = '", unit_concept_id,"'")
    }
  }

  if (!missing(provider_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_id)) {
      statement <- paste0(statement, ' provider_id IS NULL')
    } else if (is(provider_id, 'subQuery')){
      statement <- paste0(statement, ' provider_id = (', as.character(provider_id), ')')
    } else {
      statement <- paste0(statement, " provider_id = '", provider_id,"'")
    }
  }

  if (!missing(visit_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_occurrence_id)) {
      statement <- paste0(statement, ' visit_occurrence_id IS NULL')
    } else if (is(visit_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' visit_occurrence_id = (', as.character(visit_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " visit_occurrence_id = '", visit_occurrence_id,"'")
    }
  }

  if (!missing(visit_detail_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_detail_id)) {
      statement <- paste0(statement, ' visit_detail_id IS NULL')
    } else if (is(visit_detail_id, 'subQuery')){
      statement <- paste0(statement, ' visit_detail_id = (', as.character(visit_detail_id), ')')
    } else {
      statement <- paste0(statement, " visit_detail_id = '", visit_detail_id,"'")
    }
  }

  if (!missing(observation_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(observation_source_value)) {
      statement <- paste0(statement, ' observation_source_value IS NULL')
    } else if (is(observation_source_value, 'subQuery')){
      statement <- paste0(statement, ' observation_source_value = (', as.character(observation_source_value), ')')
    } else {
      statement <- paste0(statement, " observation_source_value = '", observation_source_value,"'")
    }
  }

  if (!missing(observation_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(observation_source_concept_id)) {
      statement <- paste0(statement, ' observation_source_concept_id IS NULL')
    } else if (is(observation_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' observation_source_concept_id = (', as.character(observation_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " observation_source_concept_id = '", observation_source_concept_id,"'")
    }
  }

  if (!missing(unit_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(unit_source_value)) {
      statement <- paste0(statement, ' unit_source_value IS NULL')
    } else if (is(unit_source_value, 'subQuery')){
      statement <- paste0(statement, ' unit_source_value = (', as.character(unit_source_value), ')')
    } else {
      statement <- paste0(statement, " unit_source_value = '", unit_source_value,"'")
    }
  }

  if (!missing(qualifier_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(qualifier_source_value)) {
      statement <- paste0(statement, ' qualifier_source_value IS NULL')
    } else if (is(qualifier_source_value, 'subQuery')){
      statement <- paste0(statement, ' qualifier_source_value = (', as.character(qualifier_source_value), ')')
    } else {
      statement <- paste0(statement, " qualifier_source_value = '", qualifier_source_value,"'")
    }
  }

  statement <- paste0(statement, ") = 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_observation_period <- function(observation_period_id, person_id, observation_period_start_date, observation_period_end_date, period_type_concept_id) {

  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect observation_period' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.observation_period WHERE")
  first <- TRUE
  if (!missing(observation_period_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(observation_period_id)) {
      statement <- paste0(statement, ' observation_period_id IS NULL')
    } else if (is(observation_period_id, 'subQuery')){
      statement <- paste0(statement, ' observation_period_id = (', as.character(observation_period_id), ')')
    } else {
      statement <- paste0(statement, " observation_period_id = '", observation_period_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(observation_period_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(observation_period_start_date)) {
      statement <- paste0(statement, ' observation_period_start_date IS NULL')
    } else if (is(observation_period_start_date, 'subQuery')){
      statement <- paste0(statement, ' observation_period_start_date = (', as.character(observation_period_start_date), ')')
    } else {
      statement <- paste0(statement, " observation_period_start_date = '", observation_period_start_date,"'")
    }
  }

  if (!missing(observation_period_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(observation_period_end_date)) {
      statement <- paste0(statement, ' observation_period_end_date IS NULL')
    } else if (is(observation_period_end_date, 'subQuery')){
      statement <- paste0(statement, ' observation_period_end_date = (', as.character(observation_period_end_date), ')')
    } else {
      statement <- paste0(statement, " observation_period_end_date = '", observation_period_end_date,"'")
    }
  }

  if (!missing(period_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(period_type_concept_id)) {
      statement <- paste0(statement, ' period_type_concept_id IS NULL')
    } else if (is(period_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' period_type_concept_id = (', as.character(period_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " period_type_concept_id = '", period_type_concept_id,"'")
    }
  }

  statement <- paste0(statement, ") = 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_person <- function(person_id, gender_concept_id, year_of_birth, month_of_birth, day_of_birth, birth_datetime, race_concept_id, ethnicity_concept_id, location_id, provider_id, care_site_id, person_source_value, gender_source_value, gender_source_concept_id, race_source_value, race_source_concept_id, ethnicity_source_value, ethnicity_source_concept_id) {

  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect person' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.person WHERE")
  first <- TRUE
  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(gender_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(gender_concept_id)) {
      statement <- paste0(statement, ' gender_concept_id IS NULL')
    } else if (is(gender_concept_id, 'subQuery')){
      statement <- paste0(statement, ' gender_concept_id = (', as.character(gender_concept_id), ')')
    } else {
      statement <- paste0(statement, " gender_concept_id = '", gender_concept_id,"'")
    }
  }

  if (!missing(year_of_birth)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(year_of_birth)) {
      statement <- paste0(statement, ' year_of_birth IS NULL')
    } else if (is(year_of_birth, 'subQuery')){
      statement <- paste0(statement, ' year_of_birth = (', as.character(year_of_birth), ')')
    } else {
      statement <- paste0(statement, " year_of_birth = '", year_of_birth,"'")
    }
  }

  if (!missing(month_of_birth)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(month_of_birth)) {
      statement <- paste0(statement, ' month_of_birth IS NULL')
    } else if (is(month_of_birth, 'subQuery')){
      statement <- paste0(statement, ' month_of_birth = (', as.character(month_of_birth), ')')
    } else {
      statement <- paste0(statement, " month_of_birth = '", month_of_birth,"'")
    }
  }

  if (!missing(day_of_birth)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(day_of_birth)) {
      statement <- paste0(statement, ' day_of_birth IS NULL')
    } else if (is(day_of_birth, 'subQuery')){
      statement <- paste0(statement, ' day_of_birth = (', as.character(day_of_birth), ')')
    } else {
      statement <- paste0(statement, " day_of_birth = '", day_of_birth,"'")
    }
  }

  if (!missing(birth_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(birth_datetime)) {
      statement <- paste0(statement, ' birth_datetime IS NULL')
    } else if (is(birth_datetime, 'subQuery')){
      statement <- paste0(statement, ' birth_datetime = (', as.character(birth_datetime), ')')
    } else {
      statement <- paste0(statement, " birth_datetime = '", birth_datetime,"'")
    }
  }

  if (!missing(race_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(race_concept_id)) {
      statement <- paste0(statement, ' race_concept_id IS NULL')
    } else if (is(race_concept_id, 'subQuery')){
      statement <- paste0(statement, ' race_concept_id = (', as.character(race_concept_id), ')')
    } else {
      statement <- paste0(statement, " race_concept_id = '", race_concept_id,"'")
    }
  }

  if (!missing(ethnicity_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(ethnicity_concept_id)) {
      statement <- paste0(statement, ' ethnicity_concept_id IS NULL')
    } else if (is(ethnicity_concept_id, 'subQuery')){
      statement <- paste0(statement, ' ethnicity_concept_id = (', as.character(ethnicity_concept_id), ')')
    } else {
      statement <- paste0(statement, " ethnicity_concept_id = '", ethnicity_concept_id,"'")
    }
  }

  if (!missing(location_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(location_id)) {
      statement <- paste0(statement, ' location_id IS NULL')
    } else if (is(location_id, 'subQuery')){
      statement <- paste0(statement, ' location_id = (', as.character(location_id), ')')
    } else {
      statement <- paste0(statement, " location_id = '", location_id,"'")
    }
  }

  if (!missing(provider_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_id)) {
      statement <- paste0(statement, ' provider_id IS NULL')
    } else if (is(provider_id, 'subQuery')){
      statement <- paste0(statement, ' provider_id = (', as.character(provider_id), ')')
    } else {
      statement <- paste0(statement, " provider_id = '", provider_id,"'")
    }
  }

  if (!missing(care_site_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(care_site_id)) {
      statement <- paste0(statement, ' care_site_id IS NULL')
    } else if (is(care_site_id, 'subQuery')){
      statement <- paste0(statement, ' care_site_id = (', as.character(care_site_id), ')')
    } else {
      statement <- paste0(statement, " care_site_id = '", care_site_id,"'")
    }
  }

  if (!missing(person_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_source_value)) {
      statement <- paste0(statement, ' person_source_value IS NULL')
    } else if (is(person_source_value, 'subQuery')){
      statement <- paste0(statement, ' person_source_value = (', as.character(person_source_value), ')')
    } else {
      statement <- paste0(statement, " person_source_value = '", person_source_value,"'")
    }
  }

  if (!missing(gender_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(gender_source_value)) {
      statement <- paste0(statement, ' gender_source_value IS NULL')
    } else if (is(gender_source_value, 'subQuery')){
      statement <- paste0(statement, ' gender_source_value = (', as.character(gender_source_value), ')')
    } else {
      statement <- paste0(statement, " gender_source_value = '", gender_source_value,"'")
    }
  }

  if (!missing(gender_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(gender_source_concept_id)) {
      statement <- paste0(statement, ' gender_source_concept_id IS NULL')
    } else if (is(gender_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' gender_source_concept_id = (', as.character(gender_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " gender_source_concept_id = '", gender_source_concept_id,"'")
    }
  }

  if (!missing(race_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(race_source_value)) {
      statement <- paste0(statement, ' race_source_value IS NULL')
    } else if (is(race_source_value, 'subQuery')){
      statement <- paste0(statement, ' race_source_value = (', as.character(race_source_value), ')')
    } else {
      statement <- paste0(statement, " race_source_value = '", race_source_value,"'")
    }
  }

  if (!missing(race_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(race_source_concept_id)) {
      statement <- paste0(statement, ' race_source_concept_id IS NULL')
    } else if (is(race_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' race_source_concept_id = (', as.character(race_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " race_source_concept_id = '", race_source_concept_id,"'")
    }
  }

  if (!missing(ethnicity_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(ethnicity_source_value)) {
      statement <- paste0(statement, ' ethnicity_source_value IS NULL')
    } else if (is(ethnicity_source_value, 'subQuery')){
      statement <- paste0(statement, ' ethnicity_source_value = (', as.character(ethnicity_source_value), ')')
    } else {
      statement <- paste0(statement, " ethnicity_source_value = '", ethnicity_source_value,"'")
    }
  }

  if (!missing(ethnicity_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(ethnicity_source_concept_id)) {
      statement <- paste0(statement, ' ethnicity_source_concept_id IS NULL')
    } else if (is(ethnicity_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' ethnicity_source_concept_id = (', as.character(ethnicity_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " ethnicity_source_concept_id = '", ethnicity_source_concept_id,"'")
    }
  }

  statement <- paste0(statement, ") = 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_procedure_occurrence <- function(procedure_occurrence_id, person_id, procedure_concept_id, procedure_date, procedure_datetime, procedure_type_concept_id, modifier_concept_id, quantity, provider_id, visit_occurrence_id, procedure_source_value, procedure_source_concept_id, qualifier_source_value, visit_detail_id) {

  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect procedure_occurrence' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.procedure_occurrence WHERE")
  first <- TRUE
  if (!missing(procedure_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(procedure_occurrence_id)) {
      statement <- paste0(statement, ' procedure_occurrence_id IS NULL')
    } else if (is(procedure_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' procedure_occurrence_id = (', as.character(procedure_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " procedure_occurrence_id = '", procedure_occurrence_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(procedure_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(procedure_concept_id)) {
      statement <- paste0(statement, ' procedure_concept_id IS NULL')
    } else if (is(procedure_concept_id, 'subQuery')){
      statement <- paste0(statement, ' procedure_concept_id = (', as.character(procedure_concept_id), ')')
    } else {
      statement <- paste0(statement, " procedure_concept_id = '", procedure_concept_id,"'")
    }
  }

  if (!missing(procedure_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(procedure_date)) {
      statement <- paste0(statement, ' procedure_date IS NULL')
    } else if (is(procedure_date, 'subQuery')){
      statement <- paste0(statement, ' procedure_date = (', as.character(procedure_date), ')')
    } else {
      statement <- paste0(statement, " procedure_date = '", procedure_date,"'")
    }
  }

  if (!missing(procedure_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(procedure_datetime)) {
      statement <- paste0(statement, ' procedure_datetime IS NULL')
    } else if (is(procedure_datetime, 'subQuery')){
      statement <- paste0(statement, ' procedure_datetime = (', as.character(procedure_datetime), ')')
    } else {
      statement <- paste0(statement, " procedure_datetime = '", procedure_datetime,"'")
    }
  }

  if (!missing(procedure_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(procedure_type_concept_id)) {
      statement <- paste0(statement, ' procedure_type_concept_id IS NULL')
    } else if (is(procedure_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' procedure_type_concept_id = (', as.character(procedure_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " procedure_type_concept_id = '", procedure_type_concept_id,"'")
    }
  }

  if (!missing(modifier_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(modifier_concept_id)) {
      statement <- paste0(statement, ' modifier_concept_id IS NULL')
    } else if (is(modifier_concept_id, 'subQuery')){
      statement <- paste0(statement, ' modifier_concept_id = (', as.character(modifier_concept_id), ')')
    } else {
      statement <- paste0(statement, " modifier_concept_id = '", modifier_concept_id,"'")
    }
  }

  if (!missing(quantity)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(quantity)) {
      statement <- paste0(statement, ' quantity IS NULL')
    } else if (is(quantity, 'subQuery')){
      statement <- paste0(statement, ' quantity = (', as.character(quantity), ')')
    } else {
      statement <- paste0(statement, " quantity = '", quantity,"'")
    }
  }

  if (!missing(provider_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_id)) {
      statement <- paste0(statement, ' provider_id IS NULL')
    } else if (is(provider_id, 'subQuery')){
      statement <- paste0(statement, ' provider_id = (', as.character(provider_id), ')')
    } else {
      statement <- paste0(statement, " provider_id = '", provider_id,"'")
    }
  }

  if (!missing(visit_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_occurrence_id)) {
      statement <- paste0(statement, ' visit_occurrence_id IS NULL')
    } else if (is(visit_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' visit_occurrence_id = (', as.character(visit_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " visit_occurrence_id = '", visit_occurrence_id,"'")
    }
  }

  if (!missing(procedure_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(procedure_source_value)) {
      statement <- paste0(statement, ' procedure_source_value IS NULL')
    } else if (is(procedure_source_value, 'subQuery')){
      statement <- paste0(statement, ' procedure_source_value = (', as.character(procedure_source_value), ')')
    } else {
      statement <- paste0(statement, " procedure_source_value = '", procedure_source_value,"'")
    }
  }

  if (!missing(procedure_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(procedure_source_concept_id)) {
      statement <- paste0(statement, ' procedure_source_concept_id IS NULL')
    } else if (is(procedure_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' procedure_source_concept_id = (', as.character(procedure_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " procedure_source_concept_id = '", procedure_source_concept_id,"'")
    }
  }

  if (!missing(qualifier_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(qualifier_source_value)) {
      statement <- paste0(statement, ' qualifier_source_value IS NULL')
    } else if (is(qualifier_source_value, 'subQuery')){
      statement <- paste0(statement, ' qualifier_source_value = (', as.character(qualifier_source_value), ')')
    } else {
      statement <- paste0(statement, " qualifier_source_value = '", qualifier_source_value,"'")
    }
  }

  if (!missing(visit_detail_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_detail_id)) {
      statement <- paste0(statement, ' visit_detail_id IS NULL')
    } else if (is(visit_detail_id, 'subQuery')){
      statement <- paste0(statement, ' visit_detail_id = (', as.character(visit_detail_id), ')')
    } else {
      statement <- paste0(statement, " visit_detail_id = '", visit_detail_id,"'")
    }
  }

  statement <- paste0(statement, ") = 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_specimen <- function(specimen_id, person_id, specimen_concept_id, specimen_type_concept_id, specimen_date, specimen_datetime, quantity, unit_concept_id, anatomic_site_concept_id, disease_status_concept_id, specimen_source_id, specimen_source_value, unit_source_value, anatomic_site_source_value, disease_status_source_value) {

  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect specimen' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.specimen WHERE")
  first <- TRUE
  if (!missing(specimen_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(specimen_id)) {
      statement <- paste0(statement, ' specimen_id IS NULL')
    } else if (is(specimen_id, 'subQuery')){
      statement <- paste0(statement, ' specimen_id = (', as.character(specimen_id), ')')
    } else {
      statement <- paste0(statement, " specimen_id = '", specimen_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(specimen_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(specimen_concept_id)) {
      statement <- paste0(statement, ' specimen_concept_id IS NULL')
    } else if (is(specimen_concept_id, 'subQuery')){
      statement <- paste0(statement, ' specimen_concept_id = (', as.character(specimen_concept_id), ')')
    } else {
      statement <- paste0(statement, " specimen_concept_id = '", specimen_concept_id,"'")
    }
  }

  if (!missing(specimen_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(specimen_type_concept_id)) {
      statement <- paste0(statement, ' specimen_type_concept_id IS NULL')
    } else if (is(specimen_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' specimen_type_concept_id = (', as.character(specimen_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " specimen_type_concept_id = '", specimen_type_concept_id,"'")
    }
  }

  if (!missing(specimen_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(specimen_date)) {
      statement <- paste0(statement, ' specimen_date IS NULL')
    } else if (is(specimen_date, 'subQuery')){
      statement <- paste0(statement, ' specimen_date = (', as.character(specimen_date), ')')
    } else {
      statement <- paste0(statement, " specimen_date = '", specimen_date,"'")
    }
  }

  if (!missing(specimen_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(specimen_datetime)) {
      statement <- paste0(statement, ' specimen_datetime IS NULL')
    } else if (is(specimen_datetime, 'subQuery')){
      statement <- paste0(statement, ' specimen_datetime = (', as.character(specimen_datetime), ')')
    } else {
      statement <- paste0(statement, " specimen_datetime = '", specimen_datetime,"'")
    }
  }

  if (!missing(quantity)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(quantity)) {
      statement <- paste0(statement, ' quantity IS NULL')
    } else if (is(quantity, 'subQuery')){
      statement <- paste0(statement, ' quantity = (', as.character(quantity), ')')
    } else {
      statement <- paste0(statement, " quantity = '", quantity,"'")
    }
  }

  if (!missing(unit_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(unit_concept_id)) {
      statement <- paste0(statement, ' unit_concept_id IS NULL')
    } else if (is(unit_concept_id, 'subQuery')){
      statement <- paste0(statement, ' unit_concept_id = (', as.character(unit_concept_id), ')')
    } else {
      statement <- paste0(statement, " unit_concept_id = '", unit_concept_id,"'")
    }
  }

  if (!missing(anatomic_site_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(anatomic_site_concept_id)) {
      statement <- paste0(statement, ' anatomic_site_concept_id IS NULL')
    } else if (is(anatomic_site_concept_id, 'subQuery')){
      statement <- paste0(statement, ' anatomic_site_concept_id = (', as.character(anatomic_site_concept_id), ')')
    } else {
      statement <- paste0(statement, " anatomic_site_concept_id = '", anatomic_site_concept_id,"'")
    }
  }

  if (!missing(disease_status_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(disease_status_concept_id)) {
      statement <- paste0(statement, ' disease_status_concept_id IS NULL')
    } else if (is(disease_status_concept_id, 'subQuery')){
      statement <- paste0(statement, ' disease_status_concept_id = (', as.character(disease_status_concept_id), ')')
    } else {
      statement <- paste0(statement, " disease_status_concept_id = '", disease_status_concept_id,"'")
    }
  }

  if (!missing(specimen_source_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(specimen_source_id)) {
      statement <- paste0(statement, ' specimen_source_id IS NULL')
    } else if (is(specimen_source_id, 'subQuery')){
      statement <- paste0(statement, ' specimen_source_id = (', as.character(specimen_source_id), ')')
    } else {
      statement <- paste0(statement, " specimen_source_id = '", specimen_source_id,"'")
    }
  }

  if (!missing(specimen_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(specimen_source_value)) {
      statement <- paste0(statement, ' specimen_source_value IS NULL')
    } else if (is(specimen_source_value, 'subQuery')){
      statement <- paste0(statement, ' specimen_source_value = (', as.character(specimen_source_value), ')')
    } else {
      statement <- paste0(statement, " specimen_source_value = '", specimen_source_value,"'")
    }
  }

  if (!missing(unit_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(unit_source_value)) {
      statement <- paste0(statement, ' unit_source_value IS NULL')
    } else if (is(unit_source_value, 'subQuery')){
      statement <- paste0(statement, ' unit_source_value = (', as.character(unit_source_value), ')')
    } else {
      statement <- paste0(statement, " unit_source_value = '", unit_source_value,"'")
    }
  }

  if (!missing(anatomic_site_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(anatomic_site_source_value)) {
      statement <- paste0(statement, ' anatomic_site_source_value IS NULL')
    } else if (is(anatomic_site_source_value, 'subQuery')){
      statement <- paste0(statement, ' anatomic_site_source_value = (', as.character(anatomic_site_source_value), ')')
    } else {
      statement <- paste0(statement, " anatomic_site_source_value = '", anatomic_site_source_value,"'")
    }
  }

  if (!missing(disease_status_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(disease_status_source_value)) {
      statement <- paste0(statement, ' disease_status_source_value IS NULL')
    } else if (is(disease_status_source_value, 'subQuery')){
      statement <- paste0(statement, ' disease_status_source_value = (', as.character(disease_status_source_value), ')')
    } else {
      statement <- paste0(statement, " disease_status_source_value = '", disease_status_source_value,"'")
    }
  }

  statement <- paste0(statement, ") = 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_visit_detail <- function(visit_detail_id, person_id, visit_concept_id, visit_start_date, visit_start_datetime, visit_end_date, visit_end_datetime, visit_type_concept_id, provider_id, care_site_id, visit_source_value, visit_source_concept_id, admitting_source_value, admitting_source_concept_id, discharge_to_source_value, discharge_to_concept_id, preceding_visit_detail_id, visit_detail_parent_id, visit_occurrence_id) {

  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect visit_detail' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.visit_detail WHERE")
  first <- TRUE
  if (!missing(visit_detail_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_detail_id)) {
      statement <- paste0(statement, ' visit_detail_id IS NULL')
    } else if (is(visit_detail_id, 'subQuery')){
      statement <- paste0(statement, ' visit_detail_id = (', as.character(visit_detail_id), ')')
    } else {
      statement <- paste0(statement, " visit_detail_id = '", visit_detail_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(visit_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_concept_id)) {
      statement <- paste0(statement, ' visit_concept_id IS NULL')
    } else if (is(visit_concept_id, 'subQuery')){
      statement <- paste0(statement, ' visit_concept_id = (', as.character(visit_concept_id), ')')
    } else {
      statement <- paste0(statement, " visit_concept_id = '", visit_concept_id,"'")
    }
  }

  if (!missing(visit_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_start_date)) {
      statement <- paste0(statement, ' visit_start_date IS NULL')
    } else if (is(visit_start_date, 'subQuery')){
      statement <- paste0(statement, ' visit_start_date = (', as.character(visit_start_date), ')')
    } else {
      statement <- paste0(statement, " visit_start_date = '", visit_start_date,"'")
    }
  }

  if (!missing(visit_start_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_start_datetime)) {
      statement <- paste0(statement, ' visit_start_datetime IS NULL')
    } else if (is(visit_start_datetime, 'subQuery')){
      statement <- paste0(statement, ' visit_start_datetime = (', as.character(visit_start_datetime), ')')
    } else {
      statement <- paste0(statement, " visit_start_datetime = '", visit_start_datetime,"'")
    }
  }

  if (!missing(visit_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_end_date)) {
      statement <- paste0(statement, ' visit_end_date IS NULL')
    } else if (is(visit_end_date, 'subQuery')){
      statement <- paste0(statement, ' visit_end_date = (', as.character(visit_end_date), ')')
    } else {
      statement <- paste0(statement, " visit_end_date = '", visit_end_date,"'")
    }
  }

  if (!missing(visit_end_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_end_datetime)) {
      statement <- paste0(statement, ' visit_end_datetime IS NULL')
    } else if (is(visit_end_datetime, 'subQuery')){
      statement <- paste0(statement, ' visit_end_datetime = (', as.character(visit_end_datetime), ')')
    } else {
      statement <- paste0(statement, " visit_end_datetime = '", visit_end_datetime,"'")
    }
  }

  if (!missing(visit_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_type_concept_id)) {
      statement <- paste0(statement, ' visit_type_concept_id IS NULL')
    } else if (is(visit_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' visit_type_concept_id = (', as.character(visit_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " visit_type_concept_id = '", visit_type_concept_id,"'")
    }
  }

  if (!missing(provider_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_id)) {
      statement <- paste0(statement, ' provider_id IS NULL')
    } else if (is(provider_id, 'subQuery')){
      statement <- paste0(statement, ' provider_id = (', as.character(provider_id), ')')
    } else {
      statement <- paste0(statement, " provider_id = '", provider_id,"'")
    }
  }

  if (!missing(care_site_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(care_site_id)) {
      statement <- paste0(statement, ' care_site_id IS NULL')
    } else if (is(care_site_id, 'subQuery')){
      statement <- paste0(statement, ' care_site_id = (', as.character(care_site_id), ')')
    } else {
      statement <- paste0(statement, " care_site_id = '", care_site_id,"'")
    }
  }

  if (!missing(visit_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_source_value)) {
      statement <- paste0(statement, ' visit_source_value IS NULL')
    } else if (is(visit_source_value, 'subQuery')){
      statement <- paste0(statement, ' visit_source_value = (', as.character(visit_source_value), ')')
    } else {
      statement <- paste0(statement, " visit_source_value = '", visit_source_value,"'")
    }
  }

  if (!missing(visit_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_source_concept_id)) {
      statement <- paste0(statement, ' visit_source_concept_id IS NULL')
    } else if (is(visit_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' visit_source_concept_id = (', as.character(visit_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " visit_source_concept_id = '", visit_source_concept_id,"'")
    }
  }

  if (!missing(admitting_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(admitting_source_value)) {
      statement <- paste0(statement, ' admitting_source_value IS NULL')
    } else if (is(admitting_source_value, 'subQuery')){
      statement <- paste0(statement, ' admitting_source_value = (', as.character(admitting_source_value), ')')
    } else {
      statement <- paste0(statement, " admitting_source_value = '", admitting_source_value,"'")
    }
  }

  if (!missing(admitting_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(admitting_source_concept_id)) {
      statement <- paste0(statement, ' admitting_source_concept_id IS NULL')
    } else if (is(admitting_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' admitting_source_concept_id = (', as.character(admitting_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " admitting_source_concept_id = '", admitting_source_concept_id,"'")
    }
  }

  if (!missing(discharge_to_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(discharge_to_source_value)) {
      statement <- paste0(statement, ' discharge_to_source_value IS NULL')
    } else if (is(discharge_to_source_value, 'subQuery')){
      statement <- paste0(statement, ' discharge_to_source_value = (', as.character(discharge_to_source_value), ')')
    } else {
      statement <- paste0(statement, " discharge_to_source_value = '", discharge_to_source_value,"'")
    }
  }

  if (!missing(discharge_to_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(discharge_to_concept_id)) {
      statement <- paste0(statement, ' discharge_to_concept_id IS NULL')
    } else if (is(discharge_to_concept_id, 'subQuery')){
      statement <- paste0(statement, ' discharge_to_concept_id = (', as.character(discharge_to_concept_id), ')')
    } else {
      statement <- paste0(statement, " discharge_to_concept_id = '", discharge_to_concept_id,"'")
    }
  }

  if (!missing(preceding_visit_detail_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(preceding_visit_detail_id)) {
      statement <- paste0(statement, ' preceding_visit_detail_id IS NULL')
    } else if (is(preceding_visit_detail_id, 'subQuery')){
      statement <- paste0(statement, ' preceding_visit_detail_id = (', as.character(preceding_visit_detail_id), ')')
    } else {
      statement <- paste0(statement, " preceding_visit_detail_id = '", preceding_visit_detail_id,"'")
    }
  }

  if (!missing(visit_detail_parent_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_detail_parent_id)) {
      statement <- paste0(statement, ' visit_detail_parent_id IS NULL')
    } else if (is(visit_detail_parent_id, 'subQuery')){
      statement <- paste0(statement, ' visit_detail_parent_id = (', as.character(visit_detail_parent_id), ')')
    } else {
      statement <- paste0(statement, " visit_detail_parent_id = '", visit_detail_parent_id,"'")
    }
  }

  if (!missing(visit_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_occurrence_id)) {
      statement <- paste0(statement, ' visit_occurrence_id IS NULL')
    } else if (is(visit_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' visit_occurrence_id = (', as.character(visit_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " visit_occurrence_id = '", visit_occurrence_id,"'")
    }
  }

  statement <- paste0(statement, ") = 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_visit_occurrence <- function(visit_occurrence_id, person_id, visit_concept_id, visit_start_date, visit_start_datetime, visit_end_date, visit_end_datetime, visit_type_concept_id, provider_id, care_site_id, visit_source_value, visit_source_concept_id, admitting_source_concept_id, admitting_source_value, discharge_to_concept_id, discharge_to_source_value, preceding_visit_occurrence_id) {

  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect visit_occurrence' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.visit_occurrence WHERE")
  first <- TRUE
  if (!missing(visit_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_occurrence_id)) {
      statement <- paste0(statement, ' visit_occurrence_id IS NULL')
    } else if (is(visit_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' visit_occurrence_id = (', as.character(visit_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " visit_occurrence_id = '", visit_occurrence_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(visit_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_concept_id)) {
      statement <- paste0(statement, ' visit_concept_id IS NULL')
    } else if (is(visit_concept_id, 'subQuery')){
      statement <- paste0(statement, ' visit_concept_id = (', as.character(visit_concept_id), ')')
    } else {
      statement <- paste0(statement, " visit_concept_id = '", visit_concept_id,"'")
    }
  }

  if (!missing(visit_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_start_date)) {
      statement <- paste0(statement, ' visit_start_date IS NULL')
    } else if (is(visit_start_date, 'subQuery')){
      statement <- paste0(statement, ' visit_start_date = (', as.character(visit_start_date), ')')
    } else {
      statement <- paste0(statement, " visit_start_date = '", visit_start_date,"'")
    }
  }

  if (!missing(visit_start_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_start_datetime)) {
      statement <- paste0(statement, ' visit_start_datetime IS NULL')
    } else if (is(visit_start_datetime, 'subQuery')){
      statement <- paste0(statement, ' visit_start_datetime = (', as.character(visit_start_datetime), ')')
    } else {
      statement <- paste0(statement, " visit_start_datetime = '", visit_start_datetime,"'")
    }
  }

  if (!missing(visit_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_end_date)) {
      statement <- paste0(statement, ' visit_end_date IS NULL')
    } else if (is(visit_end_date, 'subQuery')){
      statement <- paste0(statement, ' visit_end_date = (', as.character(visit_end_date), ')')
    } else {
      statement <- paste0(statement, " visit_end_date = '", visit_end_date,"'")
    }
  }

  if (!missing(visit_end_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_end_datetime)) {
      statement <- paste0(statement, ' visit_end_datetime IS NULL')
    } else if (is(visit_end_datetime, 'subQuery')){
      statement <- paste0(statement, ' visit_end_datetime = (', as.character(visit_end_datetime), ')')
    } else {
      statement <- paste0(statement, " visit_end_datetime = '", visit_end_datetime,"'")
    }
  }

  if (!missing(visit_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_type_concept_id)) {
      statement <- paste0(statement, ' visit_type_concept_id IS NULL')
    } else if (is(visit_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' visit_type_concept_id = (', as.character(visit_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " visit_type_concept_id = '", visit_type_concept_id,"'")
    }
  }

  if (!missing(provider_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_id)) {
      statement <- paste0(statement, ' provider_id IS NULL')
    } else if (is(provider_id, 'subQuery')){
      statement <- paste0(statement, ' provider_id = (', as.character(provider_id), ')')
    } else {
      statement <- paste0(statement, " provider_id = '", provider_id,"'")
    }
  }

  if (!missing(care_site_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(care_site_id)) {
      statement <- paste0(statement, ' care_site_id IS NULL')
    } else if (is(care_site_id, 'subQuery')){
      statement <- paste0(statement, ' care_site_id = (', as.character(care_site_id), ')')
    } else {
      statement <- paste0(statement, " care_site_id = '", care_site_id,"'")
    }
  }

  if (!missing(visit_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_source_value)) {
      statement <- paste0(statement, ' visit_source_value IS NULL')
    } else if (is(visit_source_value, 'subQuery')){
      statement <- paste0(statement, ' visit_source_value = (', as.character(visit_source_value), ')')
    } else {
      statement <- paste0(statement, " visit_source_value = '", visit_source_value,"'")
    }
  }

  if (!missing(visit_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_source_concept_id)) {
      statement <- paste0(statement, ' visit_source_concept_id IS NULL')
    } else if (is(visit_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' visit_source_concept_id = (', as.character(visit_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " visit_source_concept_id = '", visit_source_concept_id,"'")
    }
  }

  if (!missing(admitting_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(admitting_source_concept_id)) {
      statement <- paste0(statement, ' admitting_source_concept_id IS NULL')
    } else if (is(admitting_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' admitting_source_concept_id = (', as.character(admitting_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " admitting_source_concept_id = '", admitting_source_concept_id,"'")
    }
  }

  if (!missing(admitting_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(admitting_source_value)) {
      statement <- paste0(statement, ' admitting_source_value IS NULL')
    } else if (is(admitting_source_value, 'subQuery')){
      statement <- paste0(statement, ' admitting_source_value = (', as.character(admitting_source_value), ')')
    } else {
      statement <- paste0(statement, " admitting_source_value = '", admitting_source_value,"'")
    }
  }

  if (!missing(discharge_to_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(discharge_to_concept_id)) {
      statement <- paste0(statement, ' discharge_to_concept_id IS NULL')
    } else if (is(discharge_to_concept_id, 'subQuery')){
      statement <- paste0(statement, ' discharge_to_concept_id = (', as.character(discharge_to_concept_id), ')')
    } else {
      statement <- paste0(statement, " discharge_to_concept_id = '", discharge_to_concept_id,"'")
    }
  }

  if (!missing(discharge_to_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(discharge_to_source_value)) {
      statement <- paste0(statement, ' discharge_to_source_value IS NULL')
    } else if (is(discharge_to_source_value, 'subQuery')){
      statement <- paste0(statement, ' discharge_to_source_value = (', as.character(discharge_to_source_value), ')')
    } else {
      statement <- paste0(statement, " discharge_to_source_value = '", discharge_to_source_value,"'")
    }
  }

  if (!missing(preceding_visit_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(preceding_visit_occurrence_id)) {
      statement <- paste0(statement, ' preceding_visit_occurrence_id IS NULL')
    } else if (is(preceding_visit_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' preceding_visit_occurrence_id = (', as.character(preceding_visit_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " preceding_visit_occurrence_id = '", preceding_visit_occurrence_id,"'")
    }
  }

  statement <- paste0(statement, ") = 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_cohort <- function(cohort_definition_id, subject_id, cohort_start_date, cohort_end_date) {

  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect cohort' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.cohort WHERE")
  first <- TRUE
  if (!missing(cohort_definition_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cohort_definition_id)) {
      statement <- paste0(statement, ' cohort_definition_id IS NULL')
    } else if (is(cohort_definition_id, 'subQuery')){
      statement <- paste0(statement, ' cohort_definition_id = (', as.character(cohort_definition_id), ')')
    } else {
      statement <- paste0(statement, " cohort_definition_id = '", cohort_definition_id,"'")
    }
  }

  if (!missing(subject_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(subject_id)) {
      statement <- paste0(statement, ' subject_id IS NULL')
    } else if (is(subject_id, 'subQuery')){
      statement <- paste0(statement, ' subject_id = (', as.character(subject_id), ')')
    } else {
      statement <- paste0(statement, " subject_id = '", subject_id,"'")
    }
  }

  if (!missing(cohort_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cohort_start_date)) {
      statement <- paste0(statement, ' cohort_start_date IS NULL')
    } else if (is(cohort_start_date, 'subQuery')){
      statement <- paste0(statement, ' cohort_start_date = (', as.character(cohort_start_date), ')')
    } else {
      statement <- paste0(statement, " cohort_start_date = '", cohort_start_date,"'")
    }
  }

  if (!missing(cohort_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cohort_end_date)) {
      statement <- paste0(statement, ' cohort_end_date IS NULL')
    } else if (is(cohort_end_date, 'subQuery')){
      statement <- paste0(statement, ' cohort_end_date = (', as.character(cohort_end_date), ')')
    } else {
      statement <- paste0(statement, " cohort_end_date = '", cohort_end_date,"'")
    }
  }

  statement <- paste0(statement, ") = 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_cohort_attribute <- function(cohort_definition_id, subject_id, cohort_start_date, cohort_end_date, attribute_definition_id, value_as_number, value_as_concept_id) {

  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect cohort_attribute' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.cohort_attribute WHERE")
  first <- TRUE
  if (!missing(cohort_definition_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cohort_definition_id)) {
      statement <- paste0(statement, ' cohort_definition_id IS NULL')
    } else if (is(cohort_definition_id, 'subQuery')){
      statement <- paste0(statement, ' cohort_definition_id = (', as.character(cohort_definition_id), ')')
    } else {
      statement <- paste0(statement, " cohort_definition_id = '", cohort_definition_id,"'")
    }
  }

  if (!missing(subject_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(subject_id)) {
      statement <- paste0(statement, ' subject_id IS NULL')
    } else if (is(subject_id, 'subQuery')){
      statement <- paste0(statement, ' subject_id = (', as.character(subject_id), ')')
    } else {
      statement <- paste0(statement, " subject_id = '", subject_id,"'")
    }
  }

  if (!missing(cohort_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cohort_start_date)) {
      statement <- paste0(statement, ' cohort_start_date IS NULL')
    } else if (is(cohort_start_date, 'subQuery')){
      statement <- paste0(statement, ' cohort_start_date = (', as.character(cohort_start_date), ')')
    } else {
      statement <- paste0(statement, " cohort_start_date = '", cohort_start_date,"'")
    }
  }

  if (!missing(cohort_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cohort_end_date)) {
      statement <- paste0(statement, ' cohort_end_date IS NULL')
    } else if (is(cohort_end_date, 'subQuery')){
      statement <- paste0(statement, ' cohort_end_date = (', as.character(cohort_end_date), ')')
    } else {
      statement <- paste0(statement, " cohort_end_date = '", cohort_end_date,"'")
    }
  }

  if (!missing(attribute_definition_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(attribute_definition_id)) {
      statement <- paste0(statement, ' attribute_definition_id IS NULL')
    } else if (is(attribute_definition_id, 'subQuery')){
      statement <- paste0(statement, ' attribute_definition_id = (', as.character(attribute_definition_id), ')')
    } else {
      statement <- paste0(statement, " attribute_definition_id = '", attribute_definition_id,"'")
    }
  }

  if (!missing(value_as_number)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(value_as_number)) {
      statement <- paste0(statement, ' value_as_number IS NULL')
    } else if (is(value_as_number, 'subQuery')){
      statement <- paste0(statement, ' value_as_number = (', as.character(value_as_number), ')')
    } else {
      statement <- paste0(statement, " value_as_number = '", value_as_number,"'")
    }
  }

  if (!missing(value_as_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(value_as_concept_id)) {
      statement <- paste0(statement, ' value_as_concept_id IS NULL')
    } else if (is(value_as_concept_id, 'subQuery')){
      statement <- paste0(statement, ' value_as_concept_id = (', as.character(value_as_concept_id), ')')
    } else {
      statement <- paste0(statement, " value_as_concept_id = '", value_as_concept_id,"'")
    }
  }

  statement <- paste0(statement, ") = 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_condition_era <- function(condition_era_id, person_id, condition_concept_id, condition_era_start_date, condition_era_end_date, condition_occurrence_count) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect condition_era' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.condition_era WHERE")
  first <- TRUE
  if (!missing(condition_era_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_era_id)) {
      statement <- paste0(statement, ' condition_era_id IS NULL')
    } else if (is(condition_era_id, 'subQuery')){
      statement <- paste0(statement, ' condition_era_id = (', as.character(condition_era_id), ')')
    } else {
      statement <- paste0(statement, " condition_era_id = '", condition_era_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(condition_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_concept_id)) {
      statement <- paste0(statement, ' condition_concept_id IS NULL')
    } else if (is(condition_concept_id, 'subQuery')){
      statement <- paste0(statement, ' condition_concept_id = (', as.character(condition_concept_id), ')')
    } else {
      statement <- paste0(statement, " condition_concept_id = '", condition_concept_id,"'")
    }
  }

  if (!missing(condition_era_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_era_start_date)) {
      statement <- paste0(statement, ' condition_era_start_date IS NULL')
    } else if (is(condition_era_start_date, 'subQuery')){
      statement <- paste0(statement, ' condition_era_start_date = (', as.character(condition_era_start_date), ')')
    } else {
      statement <- paste0(statement, " condition_era_start_date = '", condition_era_start_date,"'")
    }
  }

  if (!missing(condition_era_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_era_end_date)) {
      statement <- paste0(statement, ' condition_era_end_date IS NULL')
    } else if (is(condition_era_end_date, 'subQuery')){
      statement <- paste0(statement, ' condition_era_end_date = (', as.character(condition_era_end_date), ')')
    } else {
      statement <- paste0(statement, " condition_era_end_date = '", condition_era_end_date,"'")
    }
  }

  if (!missing(condition_occurrence_count)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_occurrence_count)) {
      statement <- paste0(statement, ' condition_occurrence_count IS NULL')
    } else if (is(condition_occurrence_count, 'subQuery')){
      statement <- paste0(statement, ' condition_occurrence_count = (', as.character(condition_occurrence_count), ')')
    } else {
      statement <- paste0(statement, " condition_occurrence_count = '", condition_occurrence_count,"'")
    }
  }

  statement <- paste0(statement, ") = 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_dose_era <- function(dose_era_id, person_id, drug_concept_id, unit_concept_id, dose_value, dose_era_start_date, dose_era_end_date) {

  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect dose_era' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.dose_era WHERE")
  first <- TRUE
  if (!missing(dose_era_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(dose_era_id)) {
      statement <- paste0(statement, ' dose_era_id IS NULL')
    } else if (is(dose_era_id, 'subQuery')){
      statement <- paste0(statement, ' dose_era_id = (', as.character(dose_era_id), ')')
    } else {
      statement <- paste0(statement, " dose_era_id = '", dose_era_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(drug_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_concept_id)) {
      statement <- paste0(statement, ' drug_concept_id IS NULL')
    } else if (is(drug_concept_id, 'subQuery')){
      statement <- paste0(statement, ' drug_concept_id = (', as.character(drug_concept_id), ')')
    } else {
      statement <- paste0(statement, " drug_concept_id = '", drug_concept_id,"'")
    }
  }

  if (!missing(unit_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(unit_concept_id)) {
      statement <- paste0(statement, ' unit_concept_id IS NULL')
    } else if (is(unit_concept_id, 'subQuery')){
      statement <- paste0(statement, ' unit_concept_id = (', as.character(unit_concept_id), ')')
    } else {
      statement <- paste0(statement, " unit_concept_id = '", unit_concept_id,"'")
    }
  }

  if (!missing(dose_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(dose_value)) {
      statement <- paste0(statement, ' dose_value IS NULL')
    } else if (is(dose_value, 'subQuery')){
      statement <- paste0(statement, ' dose_value = (', as.character(dose_value), ')')
    } else {
      statement <- paste0(statement, " dose_value = '", dose_value,"'")
    }
  }

  if (!missing(dose_era_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(dose_era_start_date)) {
      statement <- paste0(statement, ' dose_era_start_date IS NULL')
    } else if (is(dose_era_start_date, 'subQuery')){
      statement <- paste0(statement, ' dose_era_start_date = (', as.character(dose_era_start_date), ')')
    } else {
      statement <- paste0(statement, " dose_era_start_date = '", dose_era_start_date,"'")
    }
  }

  if (!missing(dose_era_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(dose_era_end_date)) {
      statement <- paste0(statement, ' dose_era_end_date IS NULL')
    } else if (is(dose_era_end_date, 'subQuery')){
      statement <- paste0(statement, ' dose_era_end_date = (', as.character(dose_era_end_date), ')')
    } else {
      statement <- paste0(statement, " dose_era_end_date = '", dose_era_end_date,"'")
    }
  }

  statement <- paste0(statement, ") = 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_drug_era <- function(drug_era_id, person_id, drug_concept_id, drug_era_start_date, drug_era_end_date, drug_exposure_count, gap_days) {

  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect drug_era' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.drug_era WHERE")
  first <- TRUE
  if (!missing(drug_era_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_era_id)) {
      statement <- paste0(statement, ' drug_era_id IS NULL')
    } else if (is(drug_era_id, 'subQuery')){
      statement <- paste0(statement, ' drug_era_id = (', as.character(drug_era_id), ')')
    } else {
      statement <- paste0(statement, " drug_era_id = '", drug_era_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(drug_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_concept_id)) {
      statement <- paste0(statement, ' drug_concept_id IS NULL')
    } else if (is(drug_concept_id, 'subQuery')){
      statement <- paste0(statement, ' drug_concept_id = (', as.character(drug_concept_id), ')')
    } else {
      statement <- paste0(statement, " drug_concept_id = '", drug_concept_id,"'")
    }
  }

  if (!missing(drug_era_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_era_start_date)) {
      statement <- paste0(statement, ' drug_era_start_date IS NULL')
    } else if (is(drug_era_start_date, 'subQuery')){
      statement <- paste0(statement, ' drug_era_start_date = (', as.character(drug_era_start_date), ')')
    } else {
      statement <- paste0(statement, " drug_era_start_date = '", drug_era_start_date,"'")
    }
  }

  if (!missing(drug_era_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_era_end_date)) {
      statement <- paste0(statement, ' drug_era_end_date IS NULL')
    } else if (is(drug_era_end_date, 'subQuery')){
      statement <- paste0(statement, ' drug_era_end_date = (', as.character(drug_era_end_date), ')')
    } else {
      statement <- paste0(statement, " drug_era_end_date = '", drug_era_end_date,"'")
    }
  }

  if (!missing(drug_exposure_count)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_exposure_count)) {
      statement <- paste0(statement, ' drug_exposure_count IS NULL')
    } else if (is(drug_exposure_count, 'subQuery')){
      statement <- paste0(statement, ' drug_exposure_count = (', as.character(drug_exposure_count), ')')
    } else {
      statement <- paste0(statement, " drug_exposure_count = '", drug_exposure_count,"'")
    }
  }

  if (!missing(gap_days)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(gap_days)) {
      statement <- paste0(statement, ' gap_days IS NULL')
    } else if (is(gap_days, 'subQuery')){
      statement <- paste0(statement, ' gap_days = (', as.character(gap_days), ')')
    } else {
      statement <- paste0(statement, " gap_days = '", gap_days,"'")
    }
  }

  statement <- paste0(statement, ") = 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_cost <- function(cost_id, cost_event_id, cost_domain_id, cost_type_concept_id, currency_concept_id, total_charge, total_cost, total_paid, paid_by_payer, paid_by_patient, paid_patient_copay, paid_patient_coinsurance, paid_patient_deductible, paid_by_primary, paid_ingredient_cost, paid_dispensing_fee, payer_plan_period_id, amount_allowed, revenue_code_concept_id, revenue_code_source_value, drg_concept_id, drg_source_value) {

  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect cost' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.cost WHERE")
  first <- TRUE
  if (!missing(cost_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cost_id)) {
      statement <- paste0(statement, ' cost_id IS NULL')
    } else if (is(cost_id, 'subQuery')){
      statement <- paste0(statement, ' cost_id = (', as.character(cost_id), ')')
    } else {
      statement <- paste0(statement, " cost_id = '", cost_id,"'")
    }
  }

  if (!missing(cost_event_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cost_event_id)) {
      statement <- paste0(statement, ' cost_event_id IS NULL')
    } else if (is(cost_event_id, 'subQuery')){
      statement <- paste0(statement, ' cost_event_id = (', as.character(cost_event_id), ')')
    } else {
      statement <- paste0(statement, " cost_event_id = '", cost_event_id,"'")
    }
  }

  if (!missing(cost_domain_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cost_domain_id)) {
      statement <- paste0(statement, ' cost_domain_id IS NULL')
    } else if (is(cost_domain_id, 'subQuery')){
      statement <- paste0(statement, ' cost_domain_id = (', as.character(cost_domain_id), ')')
    } else {
      statement <- paste0(statement, " cost_domain_id = '", cost_domain_id,"'")
    }
  }

  if (!missing(cost_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cost_type_concept_id)) {
      statement <- paste0(statement, ' cost_type_concept_id IS NULL')
    } else if (is(cost_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' cost_type_concept_id = (', as.character(cost_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " cost_type_concept_id = '", cost_type_concept_id,"'")
    }
  }

  if (!missing(currency_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(currency_concept_id)) {
      statement <- paste0(statement, ' currency_concept_id IS NULL')
    } else if (is(currency_concept_id, 'subQuery')){
      statement <- paste0(statement, ' currency_concept_id = (', as.character(currency_concept_id), ')')
    } else {
      statement <- paste0(statement, " currency_concept_id = '", currency_concept_id,"'")
    }
  }

  if (!missing(total_charge)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(total_charge)) {
      statement <- paste0(statement, ' total_charge IS NULL')
    } else if (is(total_charge, 'subQuery')){
      statement <- paste0(statement, ' total_charge = (', as.character(total_charge), ')')
    } else {
      statement <- paste0(statement, " total_charge = '", total_charge,"'")
    }
  }

  if (!missing(total_cost)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(total_cost)) {
      statement <- paste0(statement, ' total_cost IS NULL')
    } else if (is(total_cost, 'subQuery')){
      statement <- paste0(statement, ' total_cost = (', as.character(total_cost), ')')
    } else {
      statement <- paste0(statement, " total_cost = '", total_cost,"'")
    }
  }

  if (!missing(total_paid)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(total_paid)) {
      statement <- paste0(statement, ' total_paid IS NULL')
    } else if (is(total_paid, 'subQuery')){
      statement <- paste0(statement, ' total_paid = (', as.character(total_paid), ')')
    } else {
      statement <- paste0(statement, " total_paid = '", total_paid,"'")
    }
  }

  if (!missing(paid_by_payer)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(paid_by_payer)) {
      statement <- paste0(statement, ' paid_by_payer IS NULL')
    } else if (is(paid_by_payer, 'subQuery')){
      statement <- paste0(statement, ' paid_by_payer = (', as.character(paid_by_payer), ')')
    } else {
      statement <- paste0(statement, " paid_by_payer = '", paid_by_payer,"'")
    }
  }

  if (!missing(paid_by_patient)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(paid_by_patient)) {
      statement <- paste0(statement, ' paid_by_patient IS NULL')
    } else if (is(paid_by_patient, 'subQuery')){
      statement <- paste0(statement, ' paid_by_patient = (', as.character(paid_by_patient), ')')
    } else {
      statement <- paste0(statement, " paid_by_patient = '", paid_by_patient,"'")
    }
  }

  if (!missing(paid_patient_copay)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(paid_patient_copay)) {
      statement <- paste0(statement, ' paid_patient_copay IS NULL')
    } else if (is(paid_patient_copay, 'subQuery')){
      statement <- paste0(statement, ' paid_patient_copay = (', as.character(paid_patient_copay), ')')
    } else {
      statement <- paste0(statement, " paid_patient_copay = '", paid_patient_copay,"'")
    }
  }

  if (!missing(paid_patient_coinsurance)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(paid_patient_coinsurance)) {
      statement <- paste0(statement, ' paid_patient_coinsurance IS NULL')
    } else if (is(paid_patient_coinsurance, 'subQuery')){
      statement <- paste0(statement, ' paid_patient_coinsurance = (', as.character(paid_patient_coinsurance), ')')
    } else {
      statement <- paste0(statement, " paid_patient_coinsurance = '", paid_patient_coinsurance,"'")
    }
  }

  if (!missing(paid_patient_deductible)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(paid_patient_deductible)) {
      statement <- paste0(statement, ' paid_patient_deductible IS NULL')
    } else if (is(paid_patient_deductible, 'subQuery')){
      statement <- paste0(statement, ' paid_patient_deductible = (', as.character(paid_patient_deductible), ')')
    } else {
      statement <- paste0(statement, " paid_patient_deductible = '", paid_patient_deductible,"'")
    }
  }

  if (!missing(paid_by_primary)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(paid_by_primary)) {
      statement <- paste0(statement, ' paid_by_primary IS NULL')
    } else if (is(paid_by_primary, 'subQuery')){
      statement <- paste0(statement, ' paid_by_primary = (', as.character(paid_by_primary), ')')
    } else {
      statement <- paste0(statement, " paid_by_primary = '", paid_by_primary,"'")
    }
  }

  if (!missing(paid_ingredient_cost)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(paid_ingredient_cost)) {
      statement <- paste0(statement, ' paid_ingredient_cost IS NULL')
    } else if (is(paid_ingredient_cost, 'subQuery')){
      statement <- paste0(statement, ' paid_ingredient_cost = (', as.character(paid_ingredient_cost), ')')
    } else {
      statement <- paste0(statement, " paid_ingredient_cost = '", paid_ingredient_cost,"'")
    }
  }

  if (!missing(paid_dispensing_fee)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(paid_dispensing_fee)) {
      statement <- paste0(statement, ' paid_dispensing_fee IS NULL')
    } else if (is(paid_dispensing_fee, 'subQuery')){
      statement <- paste0(statement, ' paid_dispensing_fee = (', as.character(paid_dispensing_fee), ')')
    } else {
      statement <- paste0(statement, " paid_dispensing_fee = '", paid_dispensing_fee,"'")
    }
  }

  if (!missing(payer_plan_period_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(payer_plan_period_id)) {
      statement <- paste0(statement, ' payer_plan_period_id IS NULL')
    } else if (is(payer_plan_period_id, 'subQuery')){
      statement <- paste0(statement, ' payer_plan_period_id = (', as.character(payer_plan_period_id), ')')
    } else {
      statement <- paste0(statement, " payer_plan_period_id = '", payer_plan_period_id,"'")
    }
  }

  if (!missing(amount_allowed)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(amount_allowed)) {
      statement <- paste0(statement, ' amount_allowed IS NULL')
    } else if (is(amount_allowed, 'subQuery')){
      statement <- paste0(statement, ' amount_allowed = (', as.character(amount_allowed), ')')
    } else {
      statement <- paste0(statement, " amount_allowed = '", amount_allowed,"'")
    }
  }

  if (!missing(revenue_code_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(revenue_code_concept_id)) {
      statement <- paste0(statement, ' revenue_code_concept_id IS NULL')
    } else if (is(revenue_code_concept_id, 'subQuery')){
      statement <- paste0(statement, ' revenue_code_concept_id = (', as.character(revenue_code_concept_id), ')')
    } else {
      statement <- paste0(statement, " revenue_code_concept_id = '", revenue_code_concept_id,"'")
    }
  }

  if (!missing(revenue_code_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(revenue_code_source_value)) {
      statement <- paste0(statement, ' revenue_code_source_value IS NULL')
    } else if (is(revenue_code_source_value, 'subQuery')){
      statement <- paste0(statement, ' revenue_code_source_value = (', as.character(revenue_code_source_value), ')')
    } else {
      statement <- paste0(statement, " revenue_code_source_value = '", revenue_code_source_value,"'")
    }
  }

  if (!missing(drg_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drg_concept_id)) {
      statement <- paste0(statement, ' drg_concept_id IS NULL')
    } else if (is(drg_concept_id, 'subQuery')){
      statement <- paste0(statement, ' drg_concept_id = (', as.character(drg_concept_id), ')')
    } else {
      statement <- paste0(statement, " drg_concept_id = '", drg_concept_id,"'")
    }
  }

  if (!missing(drg_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drg_source_value)) {
      statement <- paste0(statement, ' drg_source_value IS NULL')
    } else if (is(drg_source_value, 'subQuery')){
      statement <- paste0(statement, ' drg_source_value = (', as.character(drg_source_value), ')')
    } else {
      statement <- paste0(statement, " drg_source_value = '", drg_source_value,"'")
    }
  }

  statement <- paste0(statement, ") = 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_payer_plan_period <- function(payer_plan_period_id, person_id, payer_plan_period_start_date, payer_plan_period_end_date, payer_source_value, plan_source_value, family_source_value) {

  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
    } else {
      source_pid <- paste0("'", as.character(source_pid), "'");
    }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
    }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect payer_plan_period' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.payer_plan_period WHERE")

  first <- TRUE
  if (!missing(payer_plan_period_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(payer_plan_period_id)) {
      statement <- paste0(statement, ' payer_plan_period_id IS NULL')
    } else if (is(payer_plan_period_id, 'subQuery')){
      statement <- paste0(statement, ' payer_plan_period_id = (', as.character(payer_plan_period_id), ')')
    } else {
      statement <- paste0(statement, " payer_plan_period_id = '", payer_plan_period_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(payer_plan_period_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(payer_plan_period_start_date)) {
      statement <- paste0(statement, ' payer_plan_period_start_date IS NULL')
    } else if (is(payer_plan_period_start_date, 'subQuery')){
      statement <- paste0(statement, ' payer_plan_period_start_date = (', as.character(payer_plan_period_start_date), ')')
    } else {
      statement <- paste0(statement, " payer_plan_period_start_date = '", payer_plan_period_start_date,"'")
    }
  }

  if (!missing(payer_plan_period_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(payer_plan_period_end_date)) {
      statement <- paste0(statement, ' payer_plan_period_end_date IS NULL')
    } else if (is(payer_plan_period_end_date, 'subQuery')){
      statement <- paste0(statement, ' payer_plan_period_end_date = (', as.character(payer_plan_period_end_date), ')')
    } else {
      statement <- paste0(statement, " payer_plan_period_end_date = '", payer_plan_period_end_date,"'")
    }
  }

  if (!missing(payer_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(payer_source_value)) {
      statement <- paste0(statement, ' payer_source_value IS NULL')
    } else if (is(payer_source_value, 'subQuery')){
      statement <- paste0(statement, ' payer_source_value = (', as.character(payer_source_value), ')')
    } else {
      statement <- paste0(statement, " payer_source_value = '", payer_source_value,"'")
    }
  }

  if (!missing(plan_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(plan_source_value)) {
      statement <- paste0(statement, ' plan_source_value IS NULL')
    } else if (is(plan_source_value, 'subQuery')){
      statement <- paste0(statement, ' plan_source_value = (', as.character(plan_source_value), ')')
    } else {
      statement <- paste0(statement, " plan_source_value = '", plan_source_value,"'")
    }
  }

  if (!missing(family_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(family_source_value)) {
      statement <- paste0(statement, ' family_source_value IS NULL')
    } else if (is(family_source_value, 'subQuery')){
      statement <- paste0(statement, ' family_source_value = (', as.character(family_source_value), ')')
    } else {
      statement <- paste0(statement, " family_source_value = '", family_source_value,"'")
    }
  }

  statement <- paste0(statement, ") = 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_care_site <- function(care_site_id, care_site_name, place_of_service_concept_id, location_id, care_site_source_value, place_of_service_source_value) {

  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect care_site' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.care_site WHERE")

  first <- TRUE
  if (!missing(care_site_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(care_site_id)) {
      statement <- paste0(statement, ' care_site_id IS NULL')
    } else if (is(care_site_id, 'subQuery')){
      statement <- paste0(statement, ' care_site_id = (', as.character(care_site_id), ')')
    } else {
      statement <- paste0(statement, " care_site_id = '", care_site_id,"'")
    }
  }

  if (!missing(care_site_name)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(care_site_name)) {
      statement <- paste0(statement, ' care_site_name IS NULL')
    } else if (is(care_site_name, 'subQuery')){
      statement <- paste0(statement, ' care_site_name = (', as.character(care_site_name), ')')
    } else {
      statement <- paste0(statement, " care_site_name = '", care_site_name,"'")
    }
  }

  if (!missing(place_of_service_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(place_of_service_concept_id)) {
      statement <- paste0(statement, ' place_of_service_concept_id IS NULL')
    } else if (is(place_of_service_concept_id, 'subQuery')){
      statement <- paste0(statement, ' place_of_service_concept_id = (', as.character(place_of_service_concept_id), ')')
    } else {
      statement <- paste0(statement, " place_of_service_concept_id = '", place_of_service_concept_id,"'")
    }
  }

  if (!missing(location_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(location_id)) {
      statement <- paste0(statement, ' location_id IS NULL')
    } else if (is(location_id, 'subQuery')){
      statement <- paste0(statement, ' location_id = (', as.character(location_id), ')')
    } else {
      statement <- paste0(statement, " location_id = '", location_id,"'")
    }
  }

  if (!missing(care_site_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(care_site_source_value)) {
      statement <- paste0(statement, ' care_site_source_value IS NULL')
    } else if (is(care_site_source_value, 'subQuery')){
      statement <- paste0(statement, ' care_site_source_value = (', as.character(care_site_source_value), ')')
    } else {
      statement <- paste0(statement, " care_site_source_value = '", care_site_source_value,"'")
    }
  }

  if (!missing(place_of_service_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(place_of_service_source_value)) {
      statement <- paste0(statement, ' place_of_service_source_value IS NULL')
    } else if (is(place_of_service_source_value, 'subQuery')){
      statement <- paste0(statement, ' place_of_service_source_value = (', as.character(place_of_service_source_value), ')')
    } else {
      statement <- paste0(statement, " place_of_service_source_value = '", place_of_service_source_value,"'")
    }
  }

  statement <- paste0(statement, ") = 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_location <- function(location_id, address_1, address_2, city, state, zip, county, location_source_value) {

  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

 statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect location' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.location WHERE")

  first <- TRUE
  if (!missing(location_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(location_id)) {
      statement <- paste0(statement, ' location_id IS NULL')
    } else if (is(location_id, 'subQuery')){
      statement <- paste0(statement, ' location_id = (', as.character(location_id), ')')
    } else {
      statement <- paste0(statement, " location_id = '", location_id,"'")
    }
  }

  if (!missing(address_1)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(address_1)) {
      statement <- paste0(statement, ' address_1 IS NULL')
    } else if (is(address_1, 'subQuery')){
      statement <- paste0(statement, ' address_1 = (', as.character(address_1), ')')
    } else {
      statement <- paste0(statement, " address_1 = '", address_1,"'")
    }
  }

  if (!missing(address_2)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(address_2)) {
      statement <- paste0(statement, ' address_2 IS NULL')
    } else if (is(address_2, 'subQuery')){
      statement <- paste0(statement, ' address_2 = (', as.character(address_2), ')')
    } else {
      statement <- paste0(statement, " address_2 = '", address_2,"'")
    }
  }

  if (!missing(city)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(city)) {
      statement <- paste0(statement, ' city IS NULL')
    } else if (is(city, 'subQuery')){
      statement <- paste0(statement, ' city = (', as.character(city), ')')
    } else {
      statement <- paste0(statement, " city = '", city,"'")
    }
  }

  if (!missing(state)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(state)) {
      statement <- paste0(statement, ' state IS NULL')
    } else if (is(state, 'subQuery')){
      statement <- paste0(statement, ' state = (', as.character(state), ')')
    } else {
      statement <- paste0(statement, " state = '", state,"'")
    }
  }

  if (!missing(zip)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(zip)) {
      statement <- paste0(statement, ' zip IS NULL')
    } else if (is(zip, 'subQuery')){
      statement <- paste0(statement, ' zip = (', as.character(zip), ')')
    } else {
      statement <- paste0(statement, " zip = '", zip,"'")
    }
  }

  if (!missing(county)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(county)) {
      statement <- paste0(statement, ' county IS NULL')
    } else if (is(county, 'subQuery')){
      statement <- paste0(statement, ' county = (', as.character(county), ')')
    } else {
      statement <- paste0(statement, " county = '", county,"'")
    }
  }

  if (!missing(location_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(location_source_value)) {
      statement <- paste0(statement, ' location_source_value IS NULL')
    } else if (is(location_source_value, 'subQuery')){
      statement <- paste0(statement, ' location_source_value = (', as.character(location_source_value), ')')
    } else {
      statement <- paste0(statement, " location_source_value = '", location_source_value,"'")
    }
  }

  statement <- paste0(statement, ") = 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_provider <- function(provider_id, provider_name, npi, dea, specialty_concept_id, care_site_id, year_of_birth, gender_concept_id, provider_source_value, specialty_source_value, specialty_source_concept_id, gender_source_value, gender_source_concept_id) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect provider' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.provider WHERE")
  first <- TRUE
  if (!missing(provider_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_id)) {
      statement <- paste0(statement, ' provider_id IS NULL')
    } else if (is(provider_id, 'subQuery')){
      statement <- paste0(statement, ' provider_id = (', as.character(provider_id), ')')
    } else {
      statement <- paste0(statement, " provider_id = '", provider_id,"'")
    }
  }

  if (!missing(provider_name)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_name)) {
      statement <- paste0(statement, ' provider_name IS NULL')
    } else if (is(provider_name, 'subQuery')){
      statement <- paste0(statement, ' provider_name = (', as.character(provider_name), ')')
    } else {
      statement <- paste0(statement, " provider_name = '", provider_name,"'")
    }
  }

  if (!missing(npi)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(npi)) {
      statement <- paste0(statement, ' npi IS NULL')
    } else if (is(npi, 'subQuery')){
      statement <- paste0(statement, ' npi = (', as.character(npi), ')')
    } else {
      statement <- paste0(statement, " npi = '", npi,"'")
    }
  }

  if (!missing(dea)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(dea)) {
      statement <- paste0(statement, ' dea IS NULL')
    } else if (is(dea, 'subQuery')){
      statement <- paste0(statement, ' dea = (', as.character(dea), ')')
    } else {
      statement <- paste0(statement, " dea = '", dea,"'")
    }
  }

  if (!missing(specialty_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(specialty_concept_id)) {
      statement <- paste0(statement, ' specialty_concept_id IS NULL')
    } else if (is(specialty_concept_id, 'subQuery')){
      statement <- paste0(statement, ' specialty_concept_id = (', as.character(specialty_concept_id), ')')
    } else {
      statement <- paste0(statement, " specialty_concept_id = '", specialty_concept_id,"'")
    }
  }

  if (!missing(care_site_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(care_site_id)) {
      statement <- paste0(statement, ' care_site_id IS NULL')
    } else if (is(care_site_id, 'subQuery')){
      statement <- paste0(statement, ' care_site_id = (', as.character(care_site_id), ')')
    } else {
      statement <- paste0(statement, " care_site_id = '", care_site_id,"'")
    }
  }

  if (!missing(year_of_birth)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(year_of_birth)) {
      statement <- paste0(statement, ' year_of_birth IS NULL')
    } else if (is(year_of_birth, 'subQuery')){
      statement <- paste0(statement, ' year_of_birth = (', as.character(year_of_birth), ')')
    } else {
      statement <- paste0(statement, " year_of_birth = '", year_of_birth,"'")
    }
  }

  if (!missing(gender_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(gender_concept_id)) {
      statement <- paste0(statement, ' gender_concept_id IS NULL')
    } else if (is(gender_concept_id, 'subQuery')){
      statement <- paste0(statement, ' gender_concept_id = (', as.character(gender_concept_id), ')')
    } else {
      statement <- paste0(statement, " gender_concept_id = '", gender_concept_id,"'")
    }
  }

  if (!missing(provider_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_source_value)) {
      statement <- paste0(statement, ' provider_source_value IS NULL')
    } else if (is(provider_source_value, 'subQuery')){
      statement <- paste0(statement, ' provider_source_value = (', as.character(provider_source_value), ')')
    } else {
      statement <- paste0(statement, " provider_source_value = '", provider_source_value,"'")
    }
  }

  if (!missing(specialty_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(specialty_source_value)) {
      statement <- paste0(statement, ' specialty_source_value IS NULL')
    } else if (is(specialty_source_value, 'subQuery')){
      statement <- paste0(statement, ' specialty_source_value = (', as.character(specialty_source_value), ')')
    } else {
      statement <- paste0(statement, " specialty_source_value = '", specialty_source_value,"'")
    }
  }

  if (!missing(specialty_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(specialty_source_concept_id)) {
      statement <- paste0(statement, ' specialty_source_concept_id IS NULL')
    } else if (is(specialty_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' specialty_source_concept_id = (', as.character(specialty_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " specialty_source_concept_id = '", specialty_source_concept_id,"'")
    }
  }

  if (!missing(gender_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(gender_source_value)) {
      statement <- paste0(statement, ' gender_source_value IS NULL')
    } else if (is(gender_source_value, 'subQuery')){
      statement <- paste0(statement, ' gender_source_value = (', as.character(gender_source_value), ')')
    } else {
      statement <- paste0(statement, " gender_source_value = '", gender_source_value,"'")
    }
  }

  if (!missing(gender_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(gender_source_concept_id)) {
      statement <- paste0(statement, ' gender_source_concept_id IS NULL')
    } else if (is(gender_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' gender_source_concept_id = (', as.character(gender_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " gender_source_concept_id = '", gender_source_concept_id,"'")
    }
  }

  statement <- paste0(statement, ") = 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_cdm_source <- function(cdm_source_name, cdm_source_abbreviation, cdm_holder, source_description, source_documentation_reference, cdm_etl__reference, source_release_date, cdm_release_date, cdm_version, vocabulary_version) {

  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect cdm_source' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.cdm_source WHERE")
  first <- TRUE
  if (!missing(cdm_source_name)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cdm_source_name)) {
      statement <- paste0(statement, ' cdm_source_name IS NULL')
    } else if (is(cdm_source_name, 'subQuery')){
      statement <- paste0(statement, ' cdm_source_name = (', as.character(cdm_source_name), ')')
    } else {
      statement <- paste0(statement, " cdm_source_name = '", cdm_source_name,"'")
    }
  }

  if (!missing(cdm_source_abbreviation)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cdm_source_abbreviation)) {
      statement <- paste0(statement, ' cdm_source_abbreviation IS NULL')
    } else if (is(cdm_source_abbreviation, 'subQuery')){
      statement <- paste0(statement, ' cdm_source_abbreviation = (', as.character(cdm_source_abbreviation), ')')
    } else {
      statement <- paste0(statement, " cdm_source_abbreviation = '", cdm_source_abbreviation,"'")
    }
  }

  if (!missing(cdm_holder)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cdm_holder)) {
      statement <- paste0(statement, ' cdm_holder IS NULL')
    } else if (is(cdm_holder, 'subQuery')){
      statement <- paste0(statement, ' cdm_holder = (', as.character(cdm_holder), ')')
    } else {
      statement <- paste0(statement, " cdm_holder = '", cdm_holder,"'")
    }
  }

  if (!missing(source_description)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(source_description)) {
      statement <- paste0(statement, ' source_description IS NULL')
    } else if (is(source_description, 'subQuery')){
      statement <- paste0(statement, ' source_description = (', as.character(source_description), ')')
    } else {
      statement <- paste0(statement, " source_description = '", source_description,"'")
    }
  }

  if (!missing(source_documentation_reference)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(source_documentation_reference)) {
      statement <- paste0(statement, ' source_documentation_reference IS NULL')
    } else if (is(source_documentation_reference, 'subQuery')){
      statement <- paste0(statement, ' source_documentation_reference = (', as.character(source_documentation_reference), ')')
    } else {
      statement <- paste0(statement, " source_documentation_reference = '", source_documentation_reference,"'")
    }
  }

  if (!missing(cdm_etl__reference)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cdm_etl__reference)) {
      statement <- paste0(statement, ' [cdm_etl _reference] IS NULL')
    } else if (is(cdm_etl__reference, 'subQuery')){
      statement <- paste0(statement, ' [cdm_etl _reference] = (', as.character(cdm_etl__reference), ')')
    } else {
      statement <- paste0(statement, " [cdm_etl _reference] = '", cdm_etl__reference,"'")
    }
  }

  if (!missing(source_release_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(source_release_date)) {
      statement <- paste0(statement, ' source_release_date IS NULL')
    } else if (is(source_release_date, 'subQuery')){
      statement <- paste0(statement, ' source_release_date = (', as.character(source_release_date), ')')
    } else {
      statement <- paste0(statement, " source_release_date = '", source_release_date,"'")
    }
  }

  if (!missing(cdm_release_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cdm_release_date)) {
      statement <- paste0(statement, ' cdm_release_date IS NULL')
    } else if (is(cdm_release_date, 'subQuery')){
      statement <- paste0(statement, ' cdm_release_date = (', as.character(cdm_release_date), ')')
    } else {
      statement <- paste0(statement, " cdm_release_date = '", cdm_release_date,"'")
    }
  }

  if (!missing(cdm_version)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cdm_version)) {
      statement <- paste0(statement, ' cdm_version IS NULL')
    } else if (is(cdm_version, 'subQuery')){
      statement <- paste0(statement, ' cdm_version = (', as.character(cdm_version), ')')
    } else {
      statement <- paste0(statement, " cdm_version = '", cdm_version,"'")
    }
  }

  if (!missing(vocabulary_version)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(vocabulary_version)) {
      statement <- paste0(statement, ' vocabulary_version IS NULL')
    } else if (is(vocabulary_version, 'subQuery')){
      statement <- paste0(statement, ' vocabulary_version = (', as.character(vocabulary_version), ')')
    } else {
      statement <- paste0(statement, " vocabulary_version = '", vocabulary_version,"'")
    }
  }

  statement <- paste0(statement, ") = 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_attribute_definition <- function(attribute_definition_id, attribute_name, attribute_description, attribute_type_concept_id, attribute_syntax) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect attribute_definition' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.attribute_definition WHERE")
  first <- TRUE
  if (!missing(attribute_definition_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(attribute_definition_id)) {
      statement <- paste0(statement, ' attribute_definition_id IS NULL')
    } else if (is(attribute_definition_id, 'subQuery')){
      statement <- paste0(statement, ' attribute_definition_id = (', as.character(attribute_definition_id), ')')
    } else {
      statement <- paste0(statement, " attribute_definition_id = '", attribute_definition_id,"'")
    }
  }

  if (!missing(attribute_name)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(attribute_name)) {
      statement <- paste0(statement, ' attribute_name IS NULL')
    } else if (is(attribute_name, 'subQuery')){
      statement <- paste0(statement, ' attribute_name = (', as.character(attribute_name), ')')
    } else {
      statement <- paste0(statement, " attribute_name = '", attribute_name,"'")
    }
  }

  if (!missing(attribute_description)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(attribute_description)) {
      statement <- paste0(statement, ' attribute_description IS NULL')
    } else if (is(attribute_description, 'subQuery')){
      statement <- paste0(statement, ' attribute_description = (', as.character(attribute_description), ')')
    } else {
      statement <- paste0(statement, " attribute_description = '", attribute_description,"'")
    }
  }

  if (!missing(attribute_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(attribute_type_concept_id)) {
      statement <- paste0(statement, ' attribute_type_concept_id IS NULL')
    } else if (is(attribute_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' attribute_type_concept_id = (', as.character(attribute_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " attribute_type_concept_id = '", attribute_type_concept_id,"'")
    }
  }

  if (!missing(attribute_syntax)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(attribute_syntax)) {
      statement <- paste0(statement, ' attribute_syntax IS NULL')
    } else if (is(attribute_syntax, 'subQuery')){
      statement <- paste0(statement, ' attribute_syntax = (', as.character(attribute_syntax), ')')
    } else {
      statement <- paste0(statement, " attribute_syntax = '", attribute_syntax,"'")
    }
  }

  statement <- paste0(statement, ") = 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_cohort_definition <- function(cohort_definition_id, cohort_definition_name, cohort_definition_description, definition_type_concept_id, cohort_definition_syntax, subject_concept_id, cohort_instantiation_date) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect cohort_definition' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.cohort_definition WHERE")
  first <- TRUE
  if (!missing(cohort_definition_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cohort_definition_id)) {
      statement <- paste0(statement, ' cohort_definition_id IS NULL')
    } else if (is(cohort_definition_id, 'subQuery')){
      statement <- paste0(statement, ' cohort_definition_id = (', as.character(cohort_definition_id), ')')
    } else {
      statement <- paste0(statement, " cohort_definition_id = '", cohort_definition_id,"'")
    }
  }

  if (!missing(cohort_definition_name)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cohort_definition_name)) {
      statement <- paste0(statement, ' cohort_definition_name IS NULL')
    } else if (is(cohort_definition_name, 'subQuery')){
      statement <- paste0(statement, ' cohort_definition_name = (', as.character(cohort_definition_name), ')')
    } else {
      statement <- paste0(statement, " cohort_definition_name = '", cohort_definition_name,"'")
    }
  }

  if (!missing(cohort_definition_description)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cohort_definition_description)) {
      statement <- paste0(statement, ' cohort_definition_description IS NULL')
    } else if (is(cohort_definition_description, 'subQuery')){
      statement <- paste0(statement, ' cohort_definition_description = (', as.character(cohort_definition_description), ')')
    } else {
      statement <- paste0(statement, " cohort_definition_description = '", cohort_definition_description,"'")
    }
  }

  if (!missing(definition_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(definition_type_concept_id)) {
      statement <- paste0(statement, ' definition_type_concept_id IS NULL')
    } else if (is(definition_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' definition_type_concept_id = (', as.character(definition_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " definition_type_concept_id = '", definition_type_concept_id,"'")
    }
  }

  if (!missing(cohort_definition_syntax)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cohort_definition_syntax)) {
      statement <- paste0(statement, ' cohort_definition_syntax IS NULL')
    } else if (is(cohort_definition_syntax, 'subQuery')){
      statement <- paste0(statement, ' cohort_definition_syntax = (', as.character(cohort_definition_syntax), ')')
    } else {
      statement <- paste0(statement, " cohort_definition_syntax = '", cohort_definition_syntax,"'")
    }
  }

  if (!missing(subject_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(subject_concept_id)) {
      statement <- paste0(statement, ' subject_concept_id IS NULL')
    } else if (is(subject_concept_id, 'subQuery')){
      statement <- paste0(statement, ' subject_concept_id = (', as.character(subject_concept_id), ')')
    } else {
      statement <- paste0(statement, " subject_concept_id = '", subject_concept_id,"'")
    }
  }

  if (!missing(cohort_instantiation_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cohort_instantiation_date)) {
      statement <- paste0(statement, ' cohort_instantiation_date IS NULL')
    } else if (is(cohort_instantiation_date, 'subQuery')){
      statement <- paste0(statement, ' cohort_instantiation_date = (', as.character(cohort_instantiation_date), ')')
    } else {
      statement <- paste0(statement, " cohort_instantiation_date = '", cohort_instantiation_date,"'")
    }
  }

  statement <- paste0(statement, ") = 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_no_condition_occurrence <- function(condition_occurrence_id, person_id, condition_concept_id, condition_start_date, condition_start_datetime, condition_end_date, condition_end_datetime, condition_type_concept_id, stop_reason, provider_id, visit_occurrence_id, visit_detail_id, condition_source_value, condition_source_concept_id, condition_status_source_value, condition_status_concept_id) {

  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect condition_occurrence' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.condition_occurrence WHERE")
  first <- TRUE
  if (!missing(condition_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_occurrence_id)) {
      statement <- paste0(statement, ' condition_occurrence_id IS NULL')
    } else if (is(condition_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' condition_occurrence_id = (', as.character(condition_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " condition_occurrence_id = '", condition_occurrence_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(condition_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_concept_id)) {
      statement <- paste0(statement, ' condition_concept_id IS NULL')
    } else if (is(condition_concept_id, 'subQuery')){
      statement <- paste0(statement, ' condition_concept_id = (', as.character(condition_concept_id), ')')
    } else {
      statement <- paste0(statement, " condition_concept_id = '", condition_concept_id,"'")
    }
  }

  if (!missing(condition_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_start_date)) {
      statement <- paste0(statement, ' condition_start_date IS NULL')
    } else if (is(condition_start_date, 'subQuery')){
      statement <- paste0(statement, ' condition_start_date = (', as.character(condition_start_date), ')')
    } else {
      statement <- paste0(statement, " condition_start_date = '", condition_start_date,"'")
    }
  }

  if (!missing(condition_start_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_start_datetime)) {
      statement <- paste0(statement, ' condition_start_datetime IS NULL')
    } else if (is(condition_start_datetime, 'subQuery')){
      statement <- paste0(statement, ' condition_start_datetime = (', as.character(condition_start_datetime), ')')
    } else {
      statement <- paste0(statement, " condition_start_datetime = '", condition_start_datetime,"'")
    }
  }

  if (!missing(condition_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_end_date)) {
      statement <- paste0(statement, ' condition_end_date IS NULL')
    } else if (is(condition_end_date, 'subQuery')){
      statement <- paste0(statement, ' condition_end_date = (', as.character(condition_end_date), ')')
    } else {
      statement <- paste0(statement, " condition_end_date = '", condition_end_date,"'")
    }
  }

  if (!missing(condition_end_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_end_datetime)) {
      statement <- paste0(statement, ' condition_end_datetime IS NULL')
    } else if (is(condition_end_datetime, 'subQuery')){
      statement <- paste0(statement, ' condition_end_datetime = (', as.character(condition_end_datetime), ')')
    } else {
      statement <- paste0(statement, " condition_end_datetime = '", condition_end_datetime,"'")
    }
  }

  if (!missing(condition_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_type_concept_id)) {
      statement <- paste0(statement, ' condition_type_concept_id IS NULL')
    } else if (is(condition_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' condition_type_concept_id = (', as.character(condition_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " condition_type_concept_id = '", condition_type_concept_id,"'")
    }
  }

  if (!missing(stop_reason)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(stop_reason)) {
      statement <- paste0(statement, ' stop_reason IS NULL')
    } else if (is(stop_reason, 'subQuery')){
      statement <- paste0(statement, ' stop_reason = (', as.character(stop_reason), ')')
    } else {
      statement <- paste0(statement, " stop_reason = '", stop_reason,"'")
    }
  }

  if (!missing(provider_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_id)) {
      statement <- paste0(statement, ' provider_id IS NULL')
    } else if (is(provider_id, 'subQuery')){
      statement <- paste0(statement, ' provider_id = (', as.character(provider_id), ')')
    } else {
      statement <- paste0(statement, " provider_id = '", provider_id,"'")
    }
  }

  if (!missing(visit_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_occurrence_id)) {
      statement <- paste0(statement, ' visit_occurrence_id IS NULL')
    } else if (is(visit_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' visit_occurrence_id = (', as.character(visit_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " visit_occurrence_id = '", visit_occurrence_id,"'")
    }
  }

  if (!missing(visit_detail_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_detail_id)) {
      statement <- paste0(statement, ' visit_detail_id IS NULL')
    } else if (is(visit_detail_id, 'subQuery')){
      statement <- paste0(statement, ' visit_detail_id = (', as.character(visit_detail_id), ')')
    } else {
      statement <- paste0(statement, " visit_detail_id = '", visit_detail_id,"'")
    }
  }

  if (!missing(condition_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_source_value)) {
      statement <- paste0(statement, ' condition_source_value IS NULL')
    } else if (is(condition_source_value, 'subQuery')){
      statement <- paste0(statement, ' condition_source_value = (', as.character(condition_source_value), ')')
    } else {
      statement <- paste0(statement, " condition_source_value = '", condition_source_value,"'")
    }
  }

  if (!missing(condition_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_source_concept_id)) {
      statement <- paste0(statement, ' condition_source_concept_id IS NULL')
    } else if (is(condition_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' condition_source_concept_id = (', as.character(condition_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " condition_source_concept_id = '", condition_source_concept_id,"'")
    }
  }

  if (!missing(condition_status_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_status_source_value)) {
      statement <- paste0(statement, ' condition_status_source_value IS NULL')
    } else if (is(condition_status_source_value, 'subQuery')){
      statement <- paste0(statement, ' condition_status_source_value = (', as.character(condition_status_source_value), ')')
    } else {
      statement <- paste0(statement, " condition_status_source_value = '", condition_status_source_value,"'")
    }
  }

  if (!missing(condition_status_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_status_concept_id)) {
      statement <- paste0(statement, ' condition_status_concept_id IS NULL')
    } else if (is(condition_status_concept_id, 'subQuery')){
      statement <- paste0(statement, ' condition_status_concept_id = (', as.character(condition_status_concept_id), ')')
    } else {
      statement <- paste0(statement, " condition_status_concept_id = '", condition_status_concept_id,"'")
    }
  }

  statement <- paste0(statement, ") != 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_no_death <- function(person_id, death_date, death_datetime, death_type_concept_id, cause_concept_id, cause_source_value, cause_source_concept_id) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect death' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.death WHERE")
  first <- TRUE
  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(death_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(death_date)) {
      statement <- paste0(statement, ' death_date IS NULL')
    } else if (is(death_date, 'subQuery')){
      statement <- paste0(statement, ' death_date = (', as.character(death_date), ')')
    } else {
      statement <- paste0(statement, " death_date = '", death_date,"'")
    }
  }

  if (!missing(death_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(death_datetime)) {
      statement <- paste0(statement, ' death_datetime IS NULL')
    } else if (is(death_datetime, 'subQuery')){
      statement <- paste0(statement, ' death_datetime = (', as.character(death_datetime), ')')
    } else {
      statement <- paste0(statement, " death_datetime = '", death_datetime,"'")
    }
  }

  if (!missing(death_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(death_type_concept_id)) {
      statement <- paste0(statement, ' death_type_concept_id IS NULL')
    } else if (is(death_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' death_type_concept_id = (', as.character(death_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " death_type_concept_id = '", death_type_concept_id,"'")
    }
  }

  if (!missing(cause_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cause_concept_id)) {
      statement <- paste0(statement, ' cause_concept_id IS NULL')
    } else if (is(cause_concept_id, 'subQuery')){
      statement <- paste0(statement, ' cause_concept_id = (', as.character(cause_concept_id), ')')
    } else {
      statement <- paste0(statement, " cause_concept_id = '", cause_concept_id,"'")
    }
  }

  if (!missing(cause_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cause_source_value)) {
      statement <- paste0(statement, ' cause_source_value IS NULL')
    } else if (is(cause_source_value, 'subQuery')){
      statement <- paste0(statement, ' cause_source_value = (', as.character(cause_source_value), ')')
    } else {
      statement <- paste0(statement, " cause_source_value = '", cause_source_value,"'")
    }
  }

  if (!missing(cause_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cause_source_concept_id)) {
      statement <- paste0(statement, ' cause_source_concept_id IS NULL')
    } else if (is(cause_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' cause_source_concept_id = (', as.character(cause_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " cause_source_concept_id = '", cause_source_concept_id,"'")
    }
  }

  statement <- paste0(statement, ") != 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_no_device_exposure <- function(device_exposure_id, person_id, device_concept_id, device_exposure_start_date, device_exposure_start_datetime, device_exposure_end_date, device_exposure_end_datetime, device_type_concept_id, unique_device_id, quantity, provider_id, visit_occurrence_id, device_source_value, device_source__concept_id, visit_detail_id) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect device_exposure' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.device_exposure WHERE")
  first <- TRUE
  if (!missing(device_exposure_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(device_exposure_id)) {
      statement <- paste0(statement, ' device_exposure_id IS NULL')
    } else if (is(device_exposure_id, 'subQuery')){
      statement <- paste0(statement, ' device_exposure_id = (', as.character(device_exposure_id), ')')
    } else {
      statement <- paste0(statement, " device_exposure_id = '", device_exposure_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(device_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(device_concept_id)) {
      statement <- paste0(statement, ' device_concept_id IS NULL')
    } else if (is(device_concept_id, 'subQuery')){
      statement <- paste0(statement, ' device_concept_id = (', as.character(device_concept_id), ')')
    } else {
      statement <- paste0(statement, " device_concept_id = '", device_concept_id,"'")
    }
  }

  if (!missing(device_exposure_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(device_exposure_start_date)) {
      statement <- paste0(statement, ' device_exposure_start_date IS NULL')
    } else if (is(device_exposure_start_date, 'subQuery')){
      statement <- paste0(statement, ' device_exposure_start_date = (', as.character(device_exposure_start_date), ')')
    } else {
      statement <- paste0(statement, " device_exposure_start_date = '", device_exposure_start_date,"'")
    }
  }

  if (!missing(device_exposure_start_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(device_exposure_start_datetime)) {
      statement <- paste0(statement, ' device_exposure_start_datetime IS NULL')
    } else if (is(device_exposure_start_datetime, 'subQuery')){
      statement <- paste0(statement, ' device_exposure_start_datetime = (', as.character(device_exposure_start_datetime), ')')
    } else {
      statement <- paste0(statement, " device_exposure_start_datetime = '", device_exposure_start_datetime,"'")
    }
  }

  if (!missing(device_exposure_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(device_exposure_end_date)) {
      statement <- paste0(statement, ' device_exposure_end_date IS NULL')
    } else if (is(device_exposure_end_date, 'subQuery')){
      statement <- paste0(statement, ' device_exposure_end_date = (', as.character(device_exposure_end_date), ')')
    } else {
      statement <- paste0(statement, " device_exposure_end_date = '", device_exposure_end_date,"'")
    }
  }

  if (!missing(device_exposure_end_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(device_exposure_end_datetime)) {
      statement <- paste0(statement, ' device_exposure_end_datetime IS NULL')
    } else if (is(device_exposure_end_datetime, 'subQuery')){
      statement <- paste0(statement, ' device_exposure_end_datetime = (', as.character(device_exposure_end_datetime), ')')
    } else {
      statement <- paste0(statement, " device_exposure_end_datetime = '", device_exposure_end_datetime,"'")
    }
  }

  if (!missing(device_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(device_type_concept_id)) {
      statement <- paste0(statement, ' device_type_concept_id IS NULL')
    } else if (is(device_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' device_type_concept_id = (', as.character(device_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " device_type_concept_id = '", device_type_concept_id,"'")
    }
  }

  if (!missing(unique_device_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(unique_device_id)) {
      statement <- paste0(statement, ' unique_device_id IS NULL')
    } else if (is(unique_device_id, 'subQuery')){
      statement <- paste0(statement, ' unique_device_id = (', as.character(unique_device_id), ')')
    } else {
      statement <- paste0(statement, " unique_device_id = '", unique_device_id,"'")
    }
  }

  if (!missing(quantity)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(quantity)) {
      statement <- paste0(statement, ' quantity IS NULL')
    } else if (is(quantity, 'subQuery')){
      statement <- paste0(statement, ' quantity = (', as.character(quantity), ')')
    } else {
      statement <- paste0(statement, " quantity = '", quantity,"'")
    }
  }

  if (!missing(provider_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_id)) {
      statement <- paste0(statement, ' provider_id IS NULL')
    } else if (is(provider_id, 'subQuery')){
      statement <- paste0(statement, ' provider_id = (', as.character(provider_id), ')')
    } else {
      statement <- paste0(statement, " provider_id = '", provider_id,"'")
    }
  }

  if (!missing(visit_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_occurrence_id)) {
      statement <- paste0(statement, ' visit_occurrence_id IS NULL')
    } else if (is(visit_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' visit_occurrence_id = (', as.character(visit_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " visit_occurrence_id = '", visit_occurrence_id,"'")
    }
  }

  if (!missing(device_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(device_source_value)) {
      statement <- paste0(statement, ' device_source_value IS NULL')
    } else if (is(device_source_value, 'subQuery')){
      statement <- paste0(statement, ' device_source_value = (', as.character(device_source_value), ')')
    } else {
      statement <- paste0(statement, " device_source_value = '", device_source_value,"'")
    }
  }

  if (!missing(device_source__concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(device_source__concept_id)) {
      statement <- paste0(statement, ' [device_source_ concept_id] IS NULL')
    } else if (is(device_source__concept_id, 'subQuery')){
      statement <- paste0(statement, ' [device_source_ concept_id] = (', as.character(device_source__concept_id), ')')
    } else {
      statement <- paste0(statement, " [device_source_ concept_id] = '", device_source__concept_id,"'")
    }
  }

  if (!missing(visit_detail_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_detail_id)) {
      statement <- paste0(statement, ' visit_detail_id IS NULL')
    } else if (is(visit_detail_id, 'subQuery')){
      statement <- paste0(statement, ' visit_detail_id = (', as.character(visit_detail_id), ')')
    } else {
      statement <- paste0(statement, " visit_detail_id = '", visit_detail_id,"'")
    }
  }

  statement <- paste0(statement, ") != 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_no_drug_exposure <- function(drug_exposure_id, person_id, drug_concept_id, drug_exposure_start_date, drug_exposure_start_datetime, drug_exposure_end_date, drug_exposure_end_datetime, verbatim_end_date, drug_type_concept_id, stop_reason, refills, quantity, days_supply, sig, route_concept_id, lot_number, provider_id, visit_occurrence_id, drug_source_value, drug_source_concept_id, route_source_value, dose_unit_source_value, visit_detail_id) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect drug_exposure' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.drug_exposure WHERE")
  first <- TRUE
  if (!missing(drug_exposure_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_exposure_id)) {
      statement <- paste0(statement, ' drug_exposure_id IS NULL')
    } else if (is(drug_exposure_id, 'subQuery')){
      statement <- paste0(statement, ' drug_exposure_id = (', as.character(drug_exposure_id), ')')
    } else {
      statement <- paste0(statement, " drug_exposure_id = '", drug_exposure_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(drug_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_concept_id)) {
      statement <- paste0(statement, ' drug_concept_id IS NULL')
    } else if (is(drug_concept_id, 'subQuery')){
      statement <- paste0(statement, ' drug_concept_id = (', as.character(drug_concept_id), ')')
    } else {
      statement <- paste0(statement, " drug_concept_id = '", drug_concept_id,"'")
    }
  }

  if (!missing(drug_exposure_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_exposure_start_date)) {
      statement <- paste0(statement, ' drug_exposure_start_date IS NULL')
    } else if (is(drug_exposure_start_date, 'subQuery')){
      statement <- paste0(statement, ' drug_exposure_start_date = (', as.character(drug_exposure_start_date), ')')
    } else {
      statement <- paste0(statement, " drug_exposure_start_date = '", drug_exposure_start_date,"'")
    }
  }

  if (!missing(drug_exposure_start_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_exposure_start_datetime)) {
      statement <- paste0(statement, ' drug_exposure_start_datetime IS NULL')
    } else if (is(drug_exposure_start_datetime, 'subQuery')){
      statement <- paste0(statement, ' drug_exposure_start_datetime = (', as.character(drug_exposure_start_datetime), ')')
    } else {
      statement <- paste0(statement, " drug_exposure_start_datetime = '", drug_exposure_start_datetime,"'")
    }
  }

  if (!missing(drug_exposure_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_exposure_end_date)) {
      statement <- paste0(statement, ' drug_exposure_end_date IS NULL')
    } else if (is(drug_exposure_end_date, 'subQuery')){
      statement <- paste0(statement, ' drug_exposure_end_date = (', as.character(drug_exposure_end_date), ')')
    } else {
      statement <- paste0(statement, " drug_exposure_end_date = '", drug_exposure_end_date,"'")
    }
  }

  if (!missing(drug_exposure_end_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_exposure_end_datetime)) {
      statement <- paste0(statement, ' drug_exposure_end_datetime IS NULL')
    } else if (is(drug_exposure_end_datetime, 'subQuery')){
      statement <- paste0(statement, ' drug_exposure_end_datetime = (', as.character(drug_exposure_end_datetime), ')')
    } else {
      statement <- paste0(statement, " drug_exposure_end_datetime = '", drug_exposure_end_datetime,"'")
    }
  }

  if (!missing(verbatim_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(verbatim_end_date)) {
      statement <- paste0(statement, ' verbatim_end_date IS NULL')
    } else if (is(verbatim_end_date, 'subQuery')){
      statement <- paste0(statement, ' verbatim_end_date = (', as.character(verbatim_end_date), ')')
    } else {
      statement <- paste0(statement, " verbatim_end_date = '", verbatim_end_date,"'")
    }
  }

  if (!missing(drug_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_type_concept_id)) {
      statement <- paste0(statement, ' drug_type_concept_id IS NULL')
    } else if (is(drug_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' drug_type_concept_id = (', as.character(drug_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " drug_type_concept_id = '", drug_type_concept_id,"'")
    }
  }

  if (!missing(stop_reason)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(stop_reason)) {
      statement <- paste0(statement, ' stop_reason IS NULL')
    } else if (is(stop_reason, 'subQuery')){
      statement <- paste0(statement, ' stop_reason = (', as.character(stop_reason), ')')
    } else {
      statement <- paste0(statement, " stop_reason = '", stop_reason,"'")
    }
  }

  if (!missing(refills)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(refills)) {
      statement <- paste0(statement, ' refills IS NULL')
    } else if (is(refills, 'subQuery')){
      statement <- paste0(statement, ' refills = (', as.character(refills), ')')
    } else {
      statement <- paste0(statement, " refills = '", refills,"'")
    }
  }

  if (!missing(quantity)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(quantity)) {
      statement <- paste0(statement, ' quantity IS NULL')
    } else if (is(quantity, 'subQuery')){
      statement <- paste0(statement, ' quantity = (', as.character(quantity), ')')
    } else {
      statement <- paste0(statement, " quantity = '", quantity,"'")
    }
  }

  if (!missing(days_supply)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(days_supply)) {
      statement <- paste0(statement, ' days_supply IS NULL')
    } else if (is(days_supply, 'subQuery')){
      statement <- paste0(statement, ' days_supply = (', as.character(days_supply), ')')
    } else {
      statement <- paste0(statement, " days_supply = '", days_supply,"'")
    }
  }

  if (!missing(sig)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(sig)) {
      statement <- paste0(statement, ' sig IS NULL')
    } else if (is(sig, 'subQuery')){
      statement <- paste0(statement, ' sig = (', as.character(sig), ')')
    } else {
      statement <- paste0(statement, " sig = '", sig,"'")
    }
  }

  if (!missing(route_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(route_concept_id)) {
      statement <- paste0(statement, ' route_concept_id IS NULL')
    } else if (is(route_concept_id, 'subQuery')){
      statement <- paste0(statement, ' route_concept_id = (', as.character(route_concept_id), ')')
    } else {
      statement <- paste0(statement, " route_concept_id = '", route_concept_id,"'")
    }
  }

  if (!missing(lot_number)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(lot_number)) {
      statement <- paste0(statement, ' lot_number IS NULL')
    } else if (is(lot_number, 'subQuery')){
      statement <- paste0(statement, ' lot_number = (', as.character(lot_number), ')')
    } else {
      statement <- paste0(statement, " lot_number = '", lot_number,"'")
    }
  }

  if (!missing(provider_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_id)) {
      statement <- paste0(statement, ' provider_id IS NULL')
    } else if (is(provider_id, 'subQuery')){
      statement <- paste0(statement, ' provider_id = (', as.character(provider_id), ')')
    } else {
      statement <- paste0(statement, " provider_id = '", provider_id,"'")
    }
  }

  if (!missing(visit_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_occurrence_id)) {
      statement <- paste0(statement, ' visit_occurrence_id IS NULL')
    } else if (is(visit_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' visit_occurrence_id = (', as.character(visit_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " visit_occurrence_id = '", visit_occurrence_id,"'")
    }
  }

  if (!missing(drug_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_source_value)) {
      statement <- paste0(statement, ' drug_source_value IS NULL')
    } else if (is(drug_source_value, 'subQuery')){
      statement <- paste0(statement, ' drug_source_value = (', as.character(drug_source_value), ')')
    } else {
      statement <- paste0(statement, " drug_source_value = '", drug_source_value,"'")
    }
  }

  if (!missing(drug_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_source_concept_id)) {
      statement <- paste0(statement, ' drug_source_concept_id IS NULL')
    } else if (is(drug_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' drug_source_concept_id = (', as.character(drug_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " drug_source_concept_id = '", drug_source_concept_id,"'")
    }
  }

  if (!missing(route_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(route_source_value)) {
      statement <- paste0(statement, ' route_source_value IS NULL')
    } else if (is(route_source_value, 'subQuery')){
      statement <- paste0(statement, ' route_source_value = (', as.character(route_source_value), ')')
    } else {
      statement <- paste0(statement, " route_source_value = '", route_source_value,"'")
    }
  }

  if (!missing(dose_unit_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(dose_unit_source_value)) {
      statement <- paste0(statement, ' dose_unit_source_value IS NULL')
    } else if (is(dose_unit_source_value, 'subQuery')){
      statement <- paste0(statement, ' dose_unit_source_value = (', as.character(dose_unit_source_value), ')')
    } else {
      statement <- paste0(statement, " dose_unit_source_value = '", dose_unit_source_value,"'")
    }
  }

  if (!missing(visit_detail_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_detail_id)) {
      statement <- paste0(statement, ' visit_detail_id IS NULL')
    } else if (is(visit_detail_id, 'subQuery')){
      statement <- paste0(statement, ' visit_detail_id = (', as.character(visit_detail_id), ')')
    } else {
      statement <- paste0(statement, " visit_detail_id = '", visit_detail_id,"'")
    }
  }

  statement <- paste0(statement, ") != 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_no_fact_relationship <- function(domain_concept_id_1, fact_id_1, domain_concept_id_2, fact_id_2, relationship_concept_id) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect fact_relationship' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.fact_relationship WHERE")
  first <- TRUE
  if (!missing(domain_concept_id_1)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(domain_concept_id_1)) {
      statement <- paste0(statement, ' domain_concept_id_1 IS NULL')
    } else if (is(domain_concept_id_1, 'subQuery')){
      statement <- paste0(statement, ' domain_concept_id_1 = (', as.character(domain_concept_id_1), ')')
    } else {
      statement <- paste0(statement, " domain_concept_id_1 = '", domain_concept_id_1,"'")
    }
  }

  if (!missing(fact_id_1)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(fact_id_1)) {
      statement <- paste0(statement, ' fact_id_1 IS NULL')
    } else if (is(fact_id_1, 'subQuery')){
      statement <- paste0(statement, ' fact_id_1 = (', as.character(fact_id_1), ')')
    } else {
      statement <- paste0(statement, " fact_id_1 = '", fact_id_1,"'")
    }
  }

  if (!missing(domain_concept_id_2)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(domain_concept_id_2)) {
      statement <- paste0(statement, ' domain_concept_id_2 IS NULL')
    } else if (is(domain_concept_id_2, 'subQuery')){
      statement <- paste0(statement, ' domain_concept_id_2 = (', as.character(domain_concept_id_2), ')')
    } else {
      statement <- paste0(statement, " domain_concept_id_2 = '", domain_concept_id_2,"'")
    }
  }

  if (!missing(fact_id_2)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(fact_id_2)) {
      statement <- paste0(statement, ' fact_id_2 IS NULL')
    } else if (is(fact_id_2, 'subQuery')){
      statement <- paste0(statement, ' fact_id_2 = (', as.character(fact_id_2), ')')
    } else {
      statement <- paste0(statement, " fact_id_2 = '", fact_id_2,"'")
    }
  }

  if (!missing(relationship_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(relationship_concept_id)) {
      statement <- paste0(statement, ' relationship_concept_id IS NULL')
    } else if (is(relationship_concept_id, 'subQuery')){
      statement <- paste0(statement, ' relationship_concept_id = (', as.character(relationship_concept_id), ')')
    } else {
      statement <- paste0(statement, " relationship_concept_id = '", relationship_concept_id,"'")
    }
  }

  statement <- paste0(statement, ") != 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_no_measurement <- function(measurement_id, person_id, measurement_concept_id, measurement_date, measurement_datetime, measurement_type_concept_id, operator_concept_id, value_as_number, value_as_concept_id, unit_concept_id, range_low, range_high, provider_id, visit_occurrence_id, visit_detail_id, measurement_source_value, measurement_source_concept_id, unit_source_value, value_source_value) {

  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect measurement' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.measurement WHERE")
  first <- TRUE
  if (!missing(measurement_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(measurement_id)) {
      statement <- paste0(statement, ' measurement_id IS NULL')
    } else if (is(measurement_id, 'subQuery')){
      statement <- paste0(statement, ' measurement_id = (', as.character(measurement_id), ')')
    } else {
      statement <- paste0(statement, " measurement_id = '", measurement_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(measurement_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(measurement_concept_id)) {
      statement <- paste0(statement, ' measurement_concept_id IS NULL')
    } else if (is(measurement_concept_id, 'subQuery')){
      statement <- paste0(statement, ' measurement_concept_id = (', as.character(measurement_concept_id), ')')
    } else {
      statement <- paste0(statement, " measurement_concept_id = '", measurement_concept_id,"'")
    }
  }

  if (!missing(measurement_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(measurement_date)) {
      statement <- paste0(statement, ' measurement_date IS NULL')
    } else if (is(measurement_date, 'subQuery')){
      statement <- paste0(statement, ' measurement_date = (', as.character(measurement_date), ')')
    } else {
      statement <- paste0(statement, " measurement_date = '", measurement_date,"'")
    }
  }

  if (!missing(measurement_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(measurement_datetime)) {
      statement <- paste0(statement, ' measurement_datetime IS NULL')
    } else if (is(measurement_datetime, 'subQuery')){
      statement <- paste0(statement, ' measurement_datetime = (', as.character(measurement_datetime), ')')
    } else {
      statement <- paste0(statement, " measurement_datetime = '", measurement_datetime,"'")
    }
  }

  if (!missing(measurement_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(measurement_type_concept_id)) {
      statement <- paste0(statement, ' measurement_type_concept_id IS NULL')
    } else if (is(measurement_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' measurement_type_concept_id = (', as.character(measurement_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " measurement_type_concept_id = '", measurement_type_concept_id,"'")
    }
  }

  if (!missing(operator_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(operator_concept_id)) {
      statement <- paste0(statement, ' operator_concept_id IS NULL')
    } else if (is(operator_concept_id, 'subQuery')){
      statement <- paste0(statement, ' operator_concept_id = (', as.character(operator_concept_id), ')')
    } else {
      statement <- paste0(statement, " operator_concept_id = '", operator_concept_id,"'")
    }
  }

  if (!missing(value_as_number)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(value_as_number)) {
      statement <- paste0(statement, ' value_as_number IS NULL')
    } else if (is(value_as_number, 'subQuery')){
      statement <- paste0(statement, ' value_as_number = (', as.character(value_as_number), ')')
    } else {
      statement <- paste0(statement, " value_as_number = '", value_as_number,"'")
    }
  }

  if (!missing(value_as_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(value_as_concept_id)) {
      statement <- paste0(statement, ' value_as_concept_id IS NULL')
    } else if (is(value_as_concept_id, 'subQuery')){
      statement <- paste0(statement, ' value_as_concept_id = (', as.character(value_as_concept_id), ')')
    } else {
      statement <- paste0(statement, " value_as_concept_id = '", value_as_concept_id,"'")
    }
  }

  if (!missing(unit_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(unit_concept_id)) {
      statement <- paste0(statement, ' unit_concept_id IS NULL')
    } else if (is(unit_concept_id, 'subQuery')){
      statement <- paste0(statement, ' unit_concept_id = (', as.character(unit_concept_id), ')')
    } else {
      statement <- paste0(statement, " unit_concept_id = '", unit_concept_id,"'")
    }
  }

  if (!missing(range_low)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(range_low)) {
      statement <- paste0(statement, ' range_low IS NULL')
    } else if (is(range_low, 'subQuery')){
      statement <- paste0(statement, ' range_low = (', as.character(range_low), ')')
    } else {
      statement <- paste0(statement, " range_low = '", range_low,"'")
    }
  }

  if (!missing(range_high)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(range_high)) {
      statement <- paste0(statement, ' range_high IS NULL')
    } else if (is(range_high, 'subQuery')){
      statement <- paste0(statement, ' range_high = (', as.character(range_high), ')')
    } else {
      statement <- paste0(statement, " range_high = '", range_high,"'")
    }
  }

  if (!missing(provider_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_id)) {
      statement <- paste0(statement, ' provider_id IS NULL')
    } else if (is(provider_id, 'subQuery')){
      statement <- paste0(statement, ' provider_id = (', as.character(provider_id), ')')
    } else {
      statement <- paste0(statement, " provider_id = '", provider_id,"'")
    }
  }

  if (!missing(visit_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_occurrence_id)) {
      statement <- paste0(statement, ' visit_occurrence_id IS NULL')
    } else if (is(visit_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' visit_occurrence_id = (', as.character(visit_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " visit_occurrence_id = '", visit_occurrence_id,"'")
    }
  }

  if (!missing(visit_detail_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_detail_id)) {
      statement <- paste0(statement, ' visit_detail_id IS NULL')
    } else if (is(visit_detail_id, 'subQuery')){
      statement <- paste0(statement, ' visit_detail_id = (', as.character(visit_detail_id), ')')
    } else {
      statement <- paste0(statement, " visit_detail_id = '", visit_detail_id,"'")
    }
  }

  if (!missing(measurement_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(measurement_source_value)) {
      statement <- paste0(statement, ' measurement_source_value IS NULL')
    } else if (is(measurement_source_value, 'subQuery')){
      statement <- paste0(statement, ' measurement_source_value = (', as.character(measurement_source_value), ')')
    } else {
      statement <- paste0(statement, " measurement_source_value = '", measurement_source_value,"'")
    }
  }

  if (!missing(measurement_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(measurement_source_concept_id)) {
      statement <- paste0(statement, ' measurement_source_concept_id IS NULL')
    } else if (is(measurement_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' measurement_source_concept_id = (', as.character(measurement_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " measurement_source_concept_id = '", measurement_source_concept_id,"'")
    }
  }

  if (!missing(unit_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(unit_source_value)) {
      statement <- paste0(statement, ' unit_source_value IS NULL')
    } else if (is(unit_source_value, 'subQuery')){
      statement <- paste0(statement, ' unit_source_value = (', as.character(unit_source_value), ')')
    } else {
      statement <- paste0(statement, " unit_source_value = '", unit_source_value,"'")
    }
  }

  if (!missing(value_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(value_source_value)) {
      statement <- paste0(statement, ' value_source_value IS NULL')
    } else if (is(value_source_value, 'subQuery')){
      statement <- paste0(statement, ' value_source_value = (', as.character(value_source_value), ')')
    } else {
      statement <- paste0(statement, " value_source_value = '", value_source_value,"'")
    }
  }

  statement <- paste0(statement, ") != 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_no_note <- function(note_id, person_id, note_date, note_datetime, note_type_concept_id, note_class_concept_id, note_title, note_text, encoding_concept_id, language_concept_id, provider_id, note_source_value, visit_occurrence_id) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect note' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.note WHERE")
  first <- TRUE
  if (!missing(note_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_id)) {
      statement <- paste0(statement, ' note_id IS NULL')
    } else if (is(note_id, 'subQuery')){
      statement <- paste0(statement, ' note_id = (', as.character(note_id), ')')
    } else {
      statement <- paste0(statement, " note_id = '", note_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(note_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_date)) {
      statement <- paste0(statement, ' note_date IS NULL')
    } else if (is(note_date, 'subQuery')){
      statement <- paste0(statement, ' note_date = (', as.character(note_date), ')')
    } else {
      statement <- paste0(statement, " note_date = '", note_date,"'")
    }
  }

  if (!missing(note_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_datetime)) {
      statement <- paste0(statement, ' note_datetime IS NULL')
    } else if (is(note_datetime, 'subQuery')){
      statement <- paste0(statement, ' note_datetime = (', as.character(note_datetime), ')')
    } else {
      statement <- paste0(statement, " note_datetime = '", note_datetime,"'")
    }
  }

  if (!missing(note_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_type_concept_id)) {
      statement <- paste0(statement, ' note_type_concept_id IS NULL')
    } else if (is(note_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' note_type_concept_id = (', as.character(note_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " note_type_concept_id = '", note_type_concept_id,"'")
    }
  }

  if (!missing(note_class_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_class_concept_id)) {
      statement <- paste0(statement, ' note_class_concept_id IS NULL')
    } else if (is(note_class_concept_id, 'subQuery')){
      statement <- paste0(statement, ' note_class_concept_id = (', as.character(note_class_concept_id), ')')
    } else {
      statement <- paste0(statement, " note_class_concept_id = '", note_class_concept_id,"'")
    }
  }

  if (!missing(note_title)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_title)) {
      statement <- paste0(statement, ' note_title IS NULL')
    } else if (is(note_title, 'subQuery')){
      statement <- paste0(statement, ' note_title = (', as.character(note_title), ')')
    } else {
      statement <- paste0(statement, " note_title = '", note_title,"'")
    }
  }

  if (!missing(note_text)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_text)) {
      statement <- paste0(statement, ' note_text IS NULL')
    } else if (is(note_text, 'subQuery')){
      statement <- paste0(statement, ' note_text = (', as.character(note_text), ')')
    } else {
      statement <- paste0(statement, " note_text = '", note_text,"'")
    }
  }

  if (!missing(encoding_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(encoding_concept_id)) {
      statement <- paste0(statement, ' encoding_concept_id IS NULL')
    } else if (is(encoding_concept_id, 'subQuery')){
      statement <- paste0(statement, ' encoding_concept_id = (', as.character(encoding_concept_id), ')')
    } else {
      statement <- paste0(statement, " encoding_concept_id = '", encoding_concept_id,"'")
    }
  }

  if (!missing(language_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(language_concept_id)) {
      statement <- paste0(statement, ' language_concept_id IS NULL')
    } else if (is(language_concept_id, 'subQuery')){
      statement <- paste0(statement, ' language_concept_id = (', as.character(language_concept_id), ')')
    } else {
      statement <- paste0(statement, " language_concept_id = '", language_concept_id,"'")
    }
  }

  if (!missing(provider_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_id)) {
      statement <- paste0(statement, ' provider_id IS NULL')
    } else if (is(provider_id, 'subQuery')){
      statement <- paste0(statement, ' provider_id = (', as.character(provider_id), ')')
    } else {
      statement <- paste0(statement, " provider_id = '", provider_id,"'")
    }
  }

  if (!missing(note_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_source_value)) {
      statement <- paste0(statement, ' note_source_value IS NULL')
    } else if (is(note_source_value, 'subQuery')){
      statement <- paste0(statement, ' note_source_value = (', as.character(note_source_value), ')')
    } else {
      statement <- paste0(statement, " note_source_value = '", note_source_value,"'")
    }
  }

  if (!missing(visit_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_occurrence_id)) {
      statement <- paste0(statement, ' visit_occurrence_id IS NULL')
    } else if (is(visit_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' visit_occurrence_id = (', as.character(visit_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " visit_occurrence_id = '", visit_occurrence_id,"'")
    }
  }

  statement <- paste0(statement, ") != 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_no_note_nlp <- function(note_nlp_id, note_id, section_concept_id, snippet, offset, lexical_variant, note_nlp_concept_id, note_nlp_source_concept_id, nlp_system, nlp_date, nlp_date_time, term_exists, term_temporal, term_modifiers) {

  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect note_nlp' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.note_nlp WHERE")
  first <- TRUE
  if (!missing(note_nlp_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_nlp_id)) {
      statement <- paste0(statement, ' note_nlp_id IS NULL')
    } else if (is(note_nlp_id, 'subQuery')){
      statement <- paste0(statement, ' note_nlp_id = (', as.character(note_nlp_id), ')')
    } else {
      statement <- paste0(statement, " note_nlp_id = '", note_nlp_id,"'")
    }
  }

  if (!missing(note_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_id)) {
      statement <- paste0(statement, ' note_id IS NULL')
    } else if (is(note_id, 'subQuery')){
      statement <- paste0(statement, ' note_id = (', as.character(note_id), ')')
    } else {
      statement <- paste0(statement, " note_id = '", note_id,"'")
    }
  }

  if (!missing(section_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(section_concept_id)) {
      statement <- paste0(statement, ' section_concept_id IS NULL')
    } else if (is(section_concept_id, 'subQuery')){
      statement <- paste0(statement, ' section_concept_id = (', as.character(section_concept_id), ')')
    } else {
      statement <- paste0(statement, " section_concept_id = '", section_concept_id,"'")
    }
  }

  if (!missing(snippet)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(snippet)) {
      statement <- paste0(statement, ' snippet IS NULL')
    } else if (is(snippet, 'subQuery')){
      statement <- paste0(statement, ' snippet = (', as.character(snippet), ')')
    } else {
      statement <- paste0(statement, " snippet = '", snippet,"'")
    }
  }

  if (!missing(offset)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(offset)) {
      statement <- paste0(statement, ' offset IS NULL')
    } else if (is(offset, 'subQuery')){
      statement <- paste0(statement, ' offset = (', as.character(offset), ')')
    } else {
      statement <- paste0(statement, " offset = '", offset,"'")
    }
  }

  if (!missing(lexical_variant)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(lexical_variant)) {
      statement <- paste0(statement, ' lexical_variant IS NULL')
    } else if (is(lexical_variant, 'subQuery')){
      statement <- paste0(statement, ' lexical_variant = (', as.character(lexical_variant), ')')
    } else {
      statement <- paste0(statement, " lexical_variant = '", lexical_variant,"'")
    }
  }

  if (!missing(note_nlp_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_nlp_concept_id)) {
      statement <- paste0(statement, ' note_nlp_concept_id IS NULL')
    } else if (is(note_nlp_concept_id, 'subQuery')){
      statement <- paste0(statement, ' note_nlp_concept_id = (', as.character(note_nlp_concept_id), ')')
    } else {
      statement <- paste0(statement, " note_nlp_concept_id = '", note_nlp_concept_id,"'")
    }
  }

  if (!missing(note_nlp_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_nlp_source_concept_id)) {
      statement <- paste0(statement, ' note_nlp_source_concept_id IS NULL')
    } else if (is(note_nlp_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' note_nlp_source_concept_id = (', as.character(note_nlp_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " note_nlp_source_concept_id = '", note_nlp_source_concept_id,"'")
    }
  }

  if (!missing(nlp_system)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(nlp_system)) {
      statement <- paste0(statement, ' nlp_system IS NULL')
    } else if (is(nlp_system, 'subQuery')){
      statement <- paste0(statement, ' nlp_system = (', as.character(nlp_system), ')')
    } else {
      statement <- paste0(statement, " nlp_system = '", nlp_system,"'")
    }
  }

  if (!missing(nlp_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(nlp_date)) {
      statement <- paste0(statement, ' nlp_date IS NULL')
    } else if (is(nlp_date, 'subQuery')){
      statement <- paste0(statement, ' nlp_date = (', as.character(nlp_date), ')')
    } else {
      statement <- paste0(statement, " nlp_date = '", nlp_date,"'")
    }
  }

  if (!missing(nlp_date_time)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(nlp_date_time)) {
      statement <- paste0(statement, ' nlp_date_time IS NULL')
    } else if (is(nlp_date_time, 'subQuery')){
      statement <- paste0(statement, ' nlp_date_time = (', as.character(nlp_date_time), ')')
    } else {
      statement <- paste0(statement, " nlp_date_time = '", nlp_date_time,"'")
    }
  }

  if (!missing(term_exists)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(term_exists)) {
      statement <- paste0(statement, ' term_exists IS NULL')
    } else if (is(term_exists, 'subQuery')){
      statement <- paste0(statement, ' term_exists = (', as.character(term_exists), ')')
    } else {
      statement <- paste0(statement, " term_exists = '", term_exists,"'")
    }
  }

  if (!missing(term_temporal)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(term_temporal)) {
      statement <- paste0(statement, ' term_temporal IS NULL')
    } else if (is(term_temporal, 'subQuery')){
      statement <- paste0(statement, ' term_temporal = (', as.character(term_temporal), ')')
    } else {
      statement <- paste0(statement, " term_temporal = '", term_temporal,"'")
    }
  }

  if (!missing(term_modifiers)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(term_modifiers)) {
      statement <- paste0(statement, ' term_modifiers IS NULL')
    } else if (is(term_modifiers, 'subQuery')){
      statement <- paste0(statement, ' term_modifiers = (', as.character(term_modifiers), ')')
    } else {
      statement <- paste0(statement, " term_modifiers = '", term_modifiers,"'")
    }
  }

  statement <- paste0(statement, ") != 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_no_observation <- function(observation_id, person_id, observation_concept_id, observation_date, observation_datetime, observation_type_concept_id, value_as_number, value_as_string, value_as_concept_id, qualifier_concept_id, unit_concept_id, provider_id, visit_occurrence_id, visit_detail_id, observation_source_value, observation_source_concept_id, unit_source_value, qualifier_source_value) {

  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect observation' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.observation WHERE")
  first <- TRUE
  if (!missing(observation_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(observation_id)) {
      statement <- paste0(statement, ' observation_id IS NULL')
    } else if (is(observation_id, 'subQuery')){
      statement <- paste0(statement, ' observation_id = (', as.character(observation_id), ')')
    } else {
      statement <- paste0(statement, " observation_id = '", observation_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(observation_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(observation_concept_id)) {
      statement <- paste0(statement, ' observation_concept_id IS NULL')
    } else if (is(observation_concept_id, 'subQuery')){
      statement <- paste0(statement, ' observation_concept_id = (', as.character(observation_concept_id), ')')
    } else {
      statement <- paste0(statement, " observation_concept_id = '", observation_concept_id,"'")
    }
  }

  if (!missing(observation_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(observation_date)) {
      statement <- paste0(statement, ' observation_date IS NULL')
    } else if (is(observation_date, 'subQuery')){
      statement <- paste0(statement, ' observation_date = (', as.character(observation_date), ')')
    } else {
      statement <- paste0(statement, " observation_date = '", observation_date,"'")
    }
  }

  if (!missing(observation_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(observation_datetime)) {
      statement <- paste0(statement, ' observation_datetime IS NULL')
    } else if (is(observation_datetime, 'subQuery')){
      statement <- paste0(statement, ' observation_datetime = (', as.character(observation_datetime), ')')
    } else {
      statement <- paste0(statement, " observation_datetime = '", observation_datetime,"'")
    }
  }

  if (!missing(observation_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(observation_type_concept_id)) {
      statement <- paste0(statement, ' observation_type_concept_id IS NULL')
    } else if (is(observation_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' observation_type_concept_id = (', as.character(observation_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " observation_type_concept_id = '", observation_type_concept_id,"'")
    }
  }

  if (!missing(value_as_number)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(value_as_number)) {
      statement <- paste0(statement, ' value_as_number IS NULL')
    } else if (is(value_as_number, 'subQuery')){
      statement <- paste0(statement, ' value_as_number = (', as.character(value_as_number), ')')
    } else {
      statement <- paste0(statement, " value_as_number = '", value_as_number,"'")
    }
  }

  if (!missing(value_as_string)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(value_as_string)) {
      statement <- paste0(statement, ' value_as_string IS NULL')
    } else if (is(value_as_string, 'subQuery')){
      statement <- paste0(statement, ' value_as_string = (', as.character(value_as_string), ')')
    } else {
      statement <- paste0(statement, " value_as_string = '", value_as_string,"'")
    }
  }

  if (!missing(value_as_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(value_as_concept_id)) {
      statement <- paste0(statement, ' value_as_concept_id IS NULL')
    } else if (is(value_as_concept_id, 'subQuery')){
      statement <- paste0(statement, ' value_as_concept_id = (', as.character(value_as_concept_id), ')')
    } else {
      statement <- paste0(statement, " value_as_concept_id = '", value_as_concept_id,"'")
    }
  }

  if (!missing(qualifier_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(qualifier_concept_id)) {
      statement <- paste0(statement, ' qualifier_concept_id IS NULL')
    } else if (is(qualifier_concept_id, 'subQuery')){
      statement <- paste0(statement, ' qualifier_concept_id = (', as.character(qualifier_concept_id), ')')
    } else {
      statement <- paste0(statement, " qualifier_concept_id = '", qualifier_concept_id,"'")
    }
  }

  if (!missing(unit_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(unit_concept_id)) {
      statement <- paste0(statement, ' unit_concept_id IS NULL')
    } else if (is(unit_concept_id, 'subQuery')){
      statement <- paste0(statement, ' unit_concept_id = (', as.character(unit_concept_id), ')')
    } else {
      statement <- paste0(statement, " unit_concept_id = '", unit_concept_id,"'")
    }
  }

  if (!missing(provider_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_id)) {
      statement <- paste0(statement, ' provider_id IS NULL')
    } else if (is(provider_id, 'subQuery')){
      statement <- paste0(statement, ' provider_id = (', as.character(provider_id), ')')
    } else {
      statement <- paste0(statement, " provider_id = '", provider_id,"'")
    }
  }

  if (!missing(visit_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_occurrence_id)) {
      statement <- paste0(statement, ' visit_occurrence_id IS NULL')
    } else if (is(visit_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' visit_occurrence_id = (', as.character(visit_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " visit_occurrence_id = '", visit_occurrence_id,"'")
    }
  }

  if (!missing(visit_detail_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_detail_id)) {
      statement <- paste0(statement, ' visit_detail_id IS NULL')
    } else if (is(visit_detail_id, 'subQuery')){
      statement <- paste0(statement, ' visit_detail_id = (', as.character(visit_detail_id), ')')
    } else {
      statement <- paste0(statement, " visit_detail_id = '", visit_detail_id,"'")
    }
  }

  if (!missing(observation_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(observation_source_value)) {
      statement <- paste0(statement, ' observation_source_value IS NULL')
    } else if (is(observation_source_value, 'subQuery')){
      statement <- paste0(statement, ' observation_source_value = (', as.character(observation_source_value), ')')
    } else {
      statement <- paste0(statement, " observation_source_value = '", observation_source_value,"'")
    }
  }

  if (!missing(observation_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(observation_source_concept_id)) {
      statement <- paste0(statement, ' observation_source_concept_id IS NULL')
    } else if (is(observation_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' observation_source_concept_id = (', as.character(observation_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " observation_source_concept_id = '", observation_source_concept_id,"'")
    }
  }

  if (!missing(unit_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(unit_source_value)) {
      statement <- paste0(statement, ' unit_source_value IS NULL')
    } else if (is(unit_source_value, 'subQuery')){
      statement <- paste0(statement, ' unit_source_value = (', as.character(unit_source_value), ')')
    } else {
      statement <- paste0(statement, " unit_source_value = '", unit_source_value,"'")
    }
  }

  if (!missing(qualifier_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(qualifier_source_value)) {
      statement <- paste0(statement, ' qualifier_source_value IS NULL')
    } else if (is(qualifier_source_value, 'subQuery')){
      statement <- paste0(statement, ' qualifier_source_value = (', as.character(qualifier_source_value), ')')
    } else {
      statement <- paste0(statement, " qualifier_source_value = '", qualifier_source_value,"'")
    }
  }

  statement <- paste0(statement, ") != 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_no_observation_period <- function(observation_period_id, person_id, observation_period_start_date, observation_period_end_date, period_type_concept_id) {

  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect observation_period' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.observation_period WHERE")
  first <- TRUE
  if (!missing(observation_period_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(observation_period_id)) {
      statement <- paste0(statement, ' observation_period_id IS NULL')
    } else if (is(observation_period_id, 'subQuery')){
      statement <- paste0(statement, ' observation_period_id = (', as.character(observation_period_id), ')')
    } else {
      statement <- paste0(statement, " observation_period_id = '", observation_period_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(observation_period_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(observation_period_start_date)) {
      statement <- paste0(statement, ' observation_period_start_date IS NULL')
    } else if (is(observation_period_start_date, 'subQuery')){
      statement <- paste0(statement, ' observation_period_start_date = (', as.character(observation_period_start_date), ')')
    } else {
      statement <- paste0(statement, " observation_period_start_date = '", observation_period_start_date,"'")
    }
  }

  if (!missing(observation_period_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(observation_period_end_date)) {
      statement <- paste0(statement, ' observation_period_end_date IS NULL')
    } else if (is(observation_period_end_date, 'subQuery')){
      statement <- paste0(statement, ' observation_period_end_date = (', as.character(observation_period_end_date), ')')
    } else {
      statement <- paste0(statement, " observation_period_end_date = '", observation_period_end_date,"'")
    }
  }

  if (!missing(period_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(period_type_concept_id)) {
      statement <- paste0(statement, ' period_type_concept_id IS NULL')
    } else if (is(period_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' period_type_concept_id = (', as.character(period_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " period_type_concept_id = '", period_type_concept_id,"'")
    }
  }

  statement <- paste0(statement, ") != 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_no_person <- function(person_id, gender_concept_id, year_of_birth, month_of_birth, day_of_birth, birth_datetime, race_concept_id, ethnicity_concept_id, location_id, provider_id, care_site_id, person_source_value, gender_source_value, gender_source_concept_id, race_source_value, race_source_concept_id, ethnicity_source_value, ethnicity_source_concept_id) {

  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect person' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.person WHERE")
  first <- TRUE
  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(gender_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(gender_concept_id)) {
      statement <- paste0(statement, ' gender_concept_id IS NULL')
    } else if (is(gender_concept_id, 'subQuery')){
      statement <- paste0(statement, ' gender_concept_id = (', as.character(gender_concept_id), ')')
    } else {
      statement <- paste0(statement, " gender_concept_id = '", gender_concept_id,"'")
    }
  }

  if (!missing(year_of_birth)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(year_of_birth)) {
      statement <- paste0(statement, ' year_of_birth IS NULL')
    } else if (is(year_of_birth, 'subQuery')){
      statement <- paste0(statement, ' year_of_birth = (', as.character(year_of_birth), ')')
    } else {
      statement <- paste0(statement, " year_of_birth = '", year_of_birth,"'")
    }
  }

  if (!missing(month_of_birth)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(month_of_birth)) {
      statement <- paste0(statement, ' month_of_birth IS NULL')
    } else if (is(month_of_birth, 'subQuery')){
      statement <- paste0(statement, ' month_of_birth = (', as.character(month_of_birth), ')')
    } else {
      statement <- paste0(statement, " month_of_birth = '", month_of_birth,"'")
    }
  }

  if (!missing(day_of_birth)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(day_of_birth)) {
      statement <- paste0(statement, ' day_of_birth IS NULL')
    } else if (is(day_of_birth, 'subQuery')){
      statement <- paste0(statement, ' day_of_birth = (', as.character(day_of_birth), ')')
    } else {
      statement <- paste0(statement, " day_of_birth = '", day_of_birth,"'")
    }
  }

  if (!missing(birth_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(birth_datetime)) {
      statement <- paste0(statement, ' birth_datetime IS NULL')
    } else if (is(birth_datetime, 'subQuery')){
      statement <- paste0(statement, ' birth_datetime = (', as.character(birth_datetime), ')')
    } else {
      statement <- paste0(statement, " birth_datetime = '", birth_datetime,"'")
    }
  }

  if (!missing(race_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(race_concept_id)) {
      statement <- paste0(statement, ' race_concept_id IS NULL')
    } else if (is(race_concept_id, 'subQuery')){
      statement <- paste0(statement, ' race_concept_id = (', as.character(race_concept_id), ')')
    } else {
      statement <- paste0(statement, " race_concept_id = '", race_concept_id,"'")
    }
  }

  if (!missing(ethnicity_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(ethnicity_concept_id)) {
      statement <- paste0(statement, ' ethnicity_concept_id IS NULL')
    } else if (is(ethnicity_concept_id, 'subQuery')){
      statement <- paste0(statement, ' ethnicity_concept_id = (', as.character(ethnicity_concept_id), ')')
    } else {
      statement <- paste0(statement, " ethnicity_concept_id = '", ethnicity_concept_id,"'")
    }
  }

  if (!missing(location_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(location_id)) {
      statement <- paste0(statement, ' location_id IS NULL')
    } else if (is(location_id, 'subQuery')){
      statement <- paste0(statement, ' location_id = (', as.character(location_id), ')')
    } else {
      statement <- paste0(statement, " location_id = '", location_id,"'")
    }
  }

  if (!missing(provider_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_id)) {
      statement <- paste0(statement, ' provider_id IS NULL')
    } else if (is(provider_id, 'subQuery')){
      statement <- paste0(statement, ' provider_id = (', as.character(provider_id), ')')
    } else {
      statement <- paste0(statement, " provider_id = '", provider_id,"'")
    }
  }

  if (!missing(care_site_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(care_site_id)) {
      statement <- paste0(statement, ' care_site_id IS NULL')
    } else if (is(care_site_id, 'subQuery')){
      statement <- paste0(statement, ' care_site_id = (', as.character(care_site_id), ')')
    } else {
      statement <- paste0(statement, " care_site_id = '", care_site_id,"'")
    }
  }

  if (!missing(person_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_source_value)) {
      statement <- paste0(statement, ' person_source_value IS NULL')
    } else if (is(person_source_value, 'subQuery')){
      statement <- paste0(statement, ' person_source_value = (', as.character(person_source_value), ')')
    } else {
      statement <- paste0(statement, " person_source_value = '", person_source_value,"'")
    }
  }

  if (!missing(gender_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(gender_source_value)) {
      statement <- paste0(statement, ' gender_source_value IS NULL')
    } else if (is(gender_source_value, 'subQuery')){
      statement <- paste0(statement, ' gender_source_value = (', as.character(gender_source_value), ')')
    } else {
      statement <- paste0(statement, " gender_source_value = '", gender_source_value,"'")
    }
  }

  if (!missing(gender_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(gender_source_concept_id)) {
      statement <- paste0(statement, ' gender_source_concept_id IS NULL')
    } else if (is(gender_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' gender_source_concept_id = (', as.character(gender_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " gender_source_concept_id = '", gender_source_concept_id,"'")
    }
  }

  if (!missing(race_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(race_source_value)) {
      statement <- paste0(statement, ' race_source_value IS NULL')
    } else if (is(race_source_value, 'subQuery')){
      statement <- paste0(statement, ' race_source_value = (', as.character(race_source_value), ')')
    } else {
      statement <- paste0(statement, " race_source_value = '", race_source_value,"'")
    }
  }

  if (!missing(race_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(race_source_concept_id)) {
      statement <- paste0(statement, ' race_source_concept_id IS NULL')
    } else if (is(race_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' race_source_concept_id = (', as.character(race_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " race_source_concept_id = '", race_source_concept_id,"'")
    }
  }

  if (!missing(ethnicity_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(ethnicity_source_value)) {
      statement <- paste0(statement, ' ethnicity_source_value IS NULL')
    } else if (is(ethnicity_source_value, 'subQuery')){
      statement <- paste0(statement, ' ethnicity_source_value = (', as.character(ethnicity_source_value), ')')
    } else {
      statement <- paste0(statement, " ethnicity_source_value = '", ethnicity_source_value,"'")
    }
  }

  if (!missing(ethnicity_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(ethnicity_source_concept_id)) {
      statement <- paste0(statement, ' ethnicity_source_concept_id IS NULL')
    } else if (is(ethnicity_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' ethnicity_source_concept_id = (', as.character(ethnicity_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " ethnicity_source_concept_id = '", ethnicity_source_concept_id,"'")
    }
  }

  statement <- paste0(statement, ") != 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_no_procedure_occurrence <- function(procedure_occurrence_id, person_id, procedure_concept_id, procedure_date, procedure_datetime, procedure_type_concept_id, modifier_concept_id, quantity, provider_id, visit_occurrence_id, procedure_source_value, procedure_source_concept_id, qualifier_source_value, visit_detail_id) {

  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }
  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect procedure_occurrence' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.procedure_occurrence WHERE")
  first <- TRUE
  if (!missing(procedure_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(procedure_occurrence_id)) {
      statement <- paste0(statement, ' procedure_occurrence_id IS NULL')
    } else if (is(procedure_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' procedure_occurrence_id = (', as.character(procedure_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " procedure_occurrence_id = '", procedure_occurrence_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(procedure_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(procedure_concept_id)) {
      statement <- paste0(statement, ' procedure_concept_id IS NULL')
    } else if (is(procedure_concept_id, 'subQuery')){
      statement <- paste0(statement, ' procedure_concept_id = (', as.character(procedure_concept_id), ')')
    } else {
      statement <- paste0(statement, " procedure_concept_id = '", procedure_concept_id,"'")
    }
  }

  if (!missing(procedure_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(procedure_date)) {
      statement <- paste0(statement, ' procedure_date IS NULL')
    } else if (is(procedure_date, 'subQuery')){
      statement <- paste0(statement, ' procedure_date = (', as.character(procedure_date), ')')
    } else {
      statement <- paste0(statement, " procedure_date = '", procedure_date,"'")
    }
  }

  if (!missing(procedure_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(procedure_datetime)) {
      statement <- paste0(statement, ' procedure_datetime IS NULL')
    } else if (is(procedure_datetime, 'subQuery')){
      statement <- paste0(statement, ' procedure_datetime = (', as.character(procedure_datetime), ')')
    } else {
      statement <- paste0(statement, " procedure_datetime = '", procedure_datetime,"'")
    }
  }

  if (!missing(procedure_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(procedure_type_concept_id)) {
      statement <- paste0(statement, ' procedure_type_concept_id IS NULL')
    } else if (is(procedure_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' procedure_type_concept_id = (', as.character(procedure_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " procedure_type_concept_id = '", procedure_type_concept_id,"'")
    }
  }

  if (!missing(modifier_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(modifier_concept_id)) {
      statement <- paste0(statement, ' modifier_concept_id IS NULL')
    } else if (is(modifier_concept_id, 'subQuery')){
      statement <- paste0(statement, ' modifier_concept_id = (', as.character(modifier_concept_id), ')')
    } else {
      statement <- paste0(statement, " modifier_concept_id = '", modifier_concept_id,"'")
    }
  }

  if (!missing(quantity)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(quantity)) {
      statement <- paste0(statement, ' quantity IS NULL')
    } else if (is(quantity, 'subQuery')){
      statement <- paste0(statement, ' quantity = (', as.character(quantity), ')')
    } else {
      statement <- paste0(statement, " quantity = '", quantity,"'")
    }
  }

  if (!missing(provider_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_id)) {
      statement <- paste0(statement, ' provider_id IS NULL')
    } else if (is(provider_id, 'subQuery')){
      statement <- paste0(statement, ' provider_id = (', as.character(provider_id), ')')
    } else {
      statement <- paste0(statement, " provider_id = '", provider_id,"'")
    }
  }

  if (!missing(visit_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_occurrence_id)) {
      statement <- paste0(statement, ' visit_occurrence_id IS NULL')
    } else if (is(visit_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' visit_occurrence_id = (', as.character(visit_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " visit_occurrence_id = '", visit_occurrence_id,"'")
    }
  }

  if (!missing(procedure_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(procedure_source_value)) {
      statement <- paste0(statement, ' procedure_source_value IS NULL')
    } else if (is(procedure_source_value, 'subQuery')){
      statement <- paste0(statement, ' procedure_source_value = (', as.character(procedure_source_value), ')')
    } else {
      statement <- paste0(statement, " procedure_source_value = '", procedure_source_value,"'")
    }
  }

  if (!missing(procedure_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(procedure_source_concept_id)) {
      statement <- paste0(statement, ' procedure_source_concept_id IS NULL')
    } else if (is(procedure_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' procedure_source_concept_id = (', as.character(procedure_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " procedure_source_concept_id = '", procedure_source_concept_id,"'")
    }
  }

  if (!missing(qualifier_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(qualifier_source_value)) {
      statement <- paste0(statement, ' qualifier_source_value IS NULL')
    } else if (is(qualifier_source_value, 'subQuery')){
      statement <- paste0(statement, ' qualifier_source_value = (', as.character(qualifier_source_value), ')')
    } else {
      statement <- paste0(statement, " qualifier_source_value = '", qualifier_source_value,"'")
    }
  }

  if (!missing(visit_detail_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_detail_id)) {
      statement <- paste0(statement, ' visit_detail_id IS NULL')
    } else if (is(visit_detail_id, 'subQuery')){
      statement <- paste0(statement, ' visit_detail_id = (', as.character(visit_detail_id), ')')
    } else {
      statement <- paste0(statement, " visit_detail_id = '", visit_detail_id,"'")
    }
  }

  statement <- paste0(statement, ") != 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_no_specimen <- function(specimen_id, person_id, specimen_concept_id, specimen_type_concept_id, specimen_date, specimen_datetime, quantity, unit_concept_id, anatomic_site_concept_id, disease_status_concept_id, specimen_source_id, specimen_source_value, unit_source_value, anatomic_site_source_value, disease_status_source_value) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect specimen' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.specimen WHERE")
  first <- TRUE
  if (!missing(specimen_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(specimen_id)) {
      statement <- paste0(statement, ' specimen_id IS NULL')
    } else if (is(specimen_id, 'subQuery')){
      statement <- paste0(statement, ' specimen_id = (', as.character(specimen_id), ')')
    } else {
      statement <- paste0(statement, " specimen_id = '", specimen_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(specimen_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(specimen_concept_id)) {
      statement <- paste0(statement, ' specimen_concept_id IS NULL')
    } else if (is(specimen_concept_id, 'subQuery')){
      statement <- paste0(statement, ' specimen_concept_id = (', as.character(specimen_concept_id), ')')
    } else {
      statement <- paste0(statement, " specimen_concept_id = '", specimen_concept_id,"'")
    }
  }

  if (!missing(specimen_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(specimen_type_concept_id)) {
      statement <- paste0(statement, ' specimen_type_concept_id IS NULL')
    } else if (is(specimen_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' specimen_type_concept_id = (', as.character(specimen_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " specimen_type_concept_id = '", specimen_type_concept_id,"'")
    }
  }

  if (!missing(specimen_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(specimen_date)) {
      statement <- paste0(statement, ' specimen_date IS NULL')
    } else if (is(specimen_date, 'subQuery')){
      statement <- paste0(statement, ' specimen_date = (', as.character(specimen_date), ')')
    } else {
      statement <- paste0(statement, " specimen_date = '", specimen_date,"'")
    }
  }

  if (!missing(specimen_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(specimen_datetime)) {
      statement <- paste0(statement, ' specimen_datetime IS NULL')
    } else if (is(specimen_datetime, 'subQuery')){
      statement <- paste0(statement, ' specimen_datetime = (', as.character(specimen_datetime), ')')
    } else {
      statement <- paste0(statement, " specimen_datetime = '", specimen_datetime,"'")
    }
  }

  if (!missing(quantity)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(quantity)) {
      statement <- paste0(statement, ' quantity IS NULL')
    } else if (is(quantity, 'subQuery')){
      statement <- paste0(statement, ' quantity = (', as.character(quantity), ')')
    } else {
      statement <- paste0(statement, " quantity = '", quantity,"'")
    }
  }

  if (!missing(unit_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(unit_concept_id)) {
      statement <- paste0(statement, ' unit_concept_id IS NULL')
    } else if (is(unit_concept_id, 'subQuery')){
      statement <- paste0(statement, ' unit_concept_id = (', as.character(unit_concept_id), ')')
    } else {
      statement <- paste0(statement, " unit_concept_id = '", unit_concept_id,"'")
    }
  }

  if (!missing(anatomic_site_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(anatomic_site_concept_id)) {
      statement <- paste0(statement, ' anatomic_site_concept_id IS NULL')
    } else if (is(anatomic_site_concept_id, 'subQuery')){
      statement <- paste0(statement, ' anatomic_site_concept_id = (', as.character(anatomic_site_concept_id), ')')
    } else {
      statement <- paste0(statement, " anatomic_site_concept_id = '", anatomic_site_concept_id,"'")
    }
  }

  if (!missing(disease_status_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(disease_status_concept_id)) {
      statement <- paste0(statement, ' disease_status_concept_id IS NULL')
    } else if (is(disease_status_concept_id, 'subQuery')){
      statement <- paste0(statement, ' disease_status_concept_id = (', as.character(disease_status_concept_id), ')')
    } else {
      statement <- paste0(statement, " disease_status_concept_id = '", disease_status_concept_id,"'")
    }
  }

  if (!missing(specimen_source_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(specimen_source_id)) {
      statement <- paste0(statement, ' specimen_source_id IS NULL')
    } else if (is(specimen_source_id, 'subQuery')){
      statement <- paste0(statement, ' specimen_source_id = (', as.character(specimen_source_id), ')')
    } else {
      statement <- paste0(statement, " specimen_source_id = '", specimen_source_id,"'")
    }
  }

  if (!missing(specimen_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(specimen_source_value)) {
      statement <- paste0(statement, ' specimen_source_value IS NULL')
    } else if (is(specimen_source_value, 'subQuery')){
      statement <- paste0(statement, ' specimen_source_value = (', as.character(specimen_source_value), ')')
    } else {
      statement <- paste0(statement, " specimen_source_value = '", specimen_source_value,"'")
    }
  }

  if (!missing(unit_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(unit_source_value)) {
      statement <- paste0(statement, ' unit_source_value IS NULL')
    } else if (is(unit_source_value, 'subQuery')){
      statement <- paste0(statement, ' unit_source_value = (', as.character(unit_source_value), ')')
    } else {
      statement <- paste0(statement, " unit_source_value = '", unit_source_value,"'")
    }
  }

  if (!missing(anatomic_site_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(anatomic_site_source_value)) {
      statement <- paste0(statement, ' anatomic_site_source_value IS NULL')
    } else if (is(anatomic_site_source_value, 'subQuery')){
      statement <- paste0(statement, ' anatomic_site_source_value = (', as.character(anatomic_site_source_value), ')')
    } else {
      statement <- paste0(statement, " anatomic_site_source_value = '", anatomic_site_source_value,"'")
    }
  }

  if (!missing(disease_status_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(disease_status_source_value)) {
      statement <- paste0(statement, ' disease_status_source_value IS NULL')
    } else if (is(disease_status_source_value, 'subQuery')){
      statement <- paste0(statement, ' disease_status_source_value = (', as.character(disease_status_source_value), ')')
    } else {
      statement <- paste0(statement, " disease_status_source_value = '", disease_status_source_value,"'")
    }
  }

  statement <- paste0(statement, ") != 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_no_visit_detail <- function(visit_detail_id, person_id, visit_concept_id, visit_start_date, visit_start_datetime, visit_end_date, visit_end_datetime, visit_type_concept_id, provider_id, care_site_id, visit_source_value, visit_source_concept_id, admitting_source_value, admitting_source_concept_id, discharge_to_source_value, discharge_to_concept_id, preceding_visit_detail_id, visit_detail_parent_id, visit_occurrence_id) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect visit_detail' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.visit_detail WHERE")
  first <- TRUE
  if (!missing(visit_detail_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_detail_id)) {
      statement <- paste0(statement, ' visit_detail_id IS NULL')
    } else if (is(visit_detail_id, 'subQuery')){
      statement <- paste0(statement, ' visit_detail_id = (', as.character(visit_detail_id), ')')
    } else {
      statement <- paste0(statement, " visit_detail_id = '", visit_detail_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(visit_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_concept_id)) {
      statement <- paste0(statement, ' visit_concept_id IS NULL')
    } else if (is(visit_concept_id, 'subQuery')){
      statement <- paste0(statement, ' visit_concept_id = (', as.character(visit_concept_id), ')')
    } else {
      statement <- paste0(statement, " visit_concept_id = '", visit_concept_id,"'")
    }
  }

  if (!missing(visit_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_start_date)) {
      statement <- paste0(statement, ' visit_start_date IS NULL')
    } else if (is(visit_start_date, 'subQuery')){
      statement <- paste0(statement, ' visit_start_date = (', as.character(visit_start_date), ')')
    } else {
      statement <- paste0(statement, " visit_start_date = '", visit_start_date,"'")
    }
  }

  if (!missing(visit_start_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_start_datetime)) {
      statement <- paste0(statement, ' visit_start_datetime IS NULL')
    } else if (is(visit_start_datetime, 'subQuery')){
      statement <- paste0(statement, ' visit_start_datetime = (', as.character(visit_start_datetime), ')')
    } else {
      statement <- paste0(statement, " visit_start_datetime = '", visit_start_datetime,"'")
    }
  }

  if (!missing(visit_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_end_date)) {
      statement <- paste0(statement, ' visit_end_date IS NULL')
    } else if (is(visit_end_date, 'subQuery')){
      statement <- paste0(statement, ' visit_end_date = (', as.character(visit_end_date), ')')
    } else {
      statement <- paste0(statement, " visit_end_date = '", visit_end_date,"'")
    }
  }

  if (!missing(visit_end_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_end_datetime)) {
      statement <- paste0(statement, ' visit_end_datetime IS NULL')
    } else if (is(visit_end_datetime, 'subQuery')){
      statement <- paste0(statement, ' visit_end_datetime = (', as.character(visit_end_datetime), ')')
    } else {
      statement <- paste0(statement, " visit_end_datetime = '", visit_end_datetime,"'")
    }
  }

  if (!missing(visit_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_type_concept_id)) {
      statement <- paste0(statement, ' visit_type_concept_id IS NULL')
    } else if (is(visit_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' visit_type_concept_id = (', as.character(visit_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " visit_type_concept_id = '", visit_type_concept_id,"'")
    }
  }

  if (!missing(provider_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_id)) {
      statement <- paste0(statement, ' provider_id IS NULL')
    } else if (is(provider_id, 'subQuery')){
      statement <- paste0(statement, ' provider_id = (', as.character(provider_id), ')')
    } else {
      statement <- paste0(statement, " provider_id = '", provider_id,"'")
    }
  }

  if (!missing(care_site_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(care_site_id)) {
      statement <- paste0(statement, ' care_site_id IS NULL')
    } else if (is(care_site_id, 'subQuery')){
      statement <- paste0(statement, ' care_site_id = (', as.character(care_site_id), ')')
    } else {
      statement <- paste0(statement, " care_site_id = '", care_site_id,"'")
    }
  }

  if (!missing(visit_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_source_value)) {
      statement <- paste0(statement, ' visit_source_value IS NULL')
    } else if (is(visit_source_value, 'subQuery')){
      statement <- paste0(statement, ' visit_source_value = (', as.character(visit_source_value), ')')
    } else {
      statement <- paste0(statement, " visit_source_value = '", visit_source_value,"'")
    }
  }

  if (!missing(visit_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_source_concept_id)) {
      statement <- paste0(statement, ' visit_source_concept_id IS NULL')
    } else if (is(visit_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' visit_source_concept_id = (', as.character(visit_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " visit_source_concept_id = '", visit_source_concept_id,"'")
    }
  }

  if (!missing(admitting_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(admitting_source_value)) {
      statement <- paste0(statement, ' admitting_source_value IS NULL')
    } else if (is(admitting_source_value, 'subQuery')){
      statement <- paste0(statement, ' admitting_source_value = (', as.character(admitting_source_value), ')')
    } else {
      statement <- paste0(statement, " admitting_source_value = '", admitting_source_value,"'")
    }
  }

  if (!missing(admitting_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(admitting_source_concept_id)) {
      statement <- paste0(statement, ' admitting_source_concept_id IS NULL')
    } else if (is(admitting_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' admitting_source_concept_id = (', as.character(admitting_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " admitting_source_concept_id = '", admitting_source_concept_id,"'")
    }
  }

  if (!missing(discharge_to_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(discharge_to_source_value)) {
      statement <- paste0(statement, ' discharge_to_source_value IS NULL')
    } else if (is(discharge_to_source_value, 'subQuery')){
      statement <- paste0(statement, ' discharge_to_source_value = (', as.character(discharge_to_source_value), ')')
    } else {
      statement <- paste0(statement, " discharge_to_source_value = '", discharge_to_source_value,"'")
    }
  }

  if (!missing(discharge_to_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(discharge_to_concept_id)) {
      statement <- paste0(statement, ' discharge_to_concept_id IS NULL')
    } else if (is(discharge_to_concept_id, 'subQuery')){
      statement <- paste0(statement, ' discharge_to_concept_id = (', as.character(discharge_to_concept_id), ')')
    } else {
      statement <- paste0(statement, " discharge_to_concept_id = '", discharge_to_concept_id,"'")
    }
  }

  if (!missing(preceding_visit_detail_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(preceding_visit_detail_id)) {
      statement <- paste0(statement, ' preceding_visit_detail_id IS NULL')
    } else if (is(preceding_visit_detail_id, 'subQuery')){
      statement <- paste0(statement, ' preceding_visit_detail_id = (', as.character(preceding_visit_detail_id), ')')
    } else {
      statement <- paste0(statement, " preceding_visit_detail_id = '", preceding_visit_detail_id,"'")
    }
  }

  if (!missing(visit_detail_parent_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_detail_parent_id)) {
      statement <- paste0(statement, ' visit_detail_parent_id IS NULL')
    } else if (is(visit_detail_parent_id, 'subQuery')){
      statement <- paste0(statement, ' visit_detail_parent_id = (', as.character(visit_detail_parent_id), ')')
    } else {
      statement <- paste0(statement, " visit_detail_parent_id = '", visit_detail_parent_id,"'")
    }
  }

  if (!missing(visit_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_occurrence_id)) {
      statement <- paste0(statement, ' visit_occurrence_id IS NULL')
    } else if (is(visit_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' visit_occurrence_id = (', as.character(visit_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " visit_occurrence_id = '", visit_occurrence_id,"'")
    }
  }

  statement <- paste0(statement, ") != 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_no_visit_occurrence <- function(visit_occurrence_id, person_id, visit_concept_id, visit_start_date, visit_start_datetime, visit_end_date, visit_end_datetime, visit_type_concept_id, provider_id, care_site_id, visit_source_value, visit_source_concept_id, admitting_source_concept_id, admitting_source_value, discharge_to_concept_id, discharge_to_source_value, preceding_visit_occurrence_id) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect visit_occurrence' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.visit_occurrence WHERE")
  first <- TRUE
  if (!missing(visit_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_occurrence_id)) {
      statement <- paste0(statement, ' visit_occurrence_id IS NULL')
    } else if (is(visit_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' visit_occurrence_id = (', as.character(visit_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " visit_occurrence_id = '", visit_occurrence_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(visit_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_concept_id)) {
      statement <- paste0(statement, ' visit_concept_id IS NULL')
    } else if (is(visit_concept_id, 'subQuery')){
      statement <- paste0(statement, ' visit_concept_id = (', as.character(visit_concept_id), ')')
    } else {
      statement <- paste0(statement, " visit_concept_id = '", visit_concept_id,"'")
    }
  }

  if (!missing(visit_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_start_date)) {
      statement <- paste0(statement, ' visit_start_date IS NULL')
    } else if (is(visit_start_date, 'subQuery')){
      statement <- paste0(statement, ' visit_start_date = (', as.character(visit_start_date), ')')
    } else {
      statement <- paste0(statement, " visit_start_date = '", visit_start_date,"'")
    }
  }

  if (!missing(visit_start_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_start_datetime)) {
      statement <- paste0(statement, ' visit_start_datetime IS NULL')
    } else if (is(visit_start_datetime, 'subQuery')){
      statement <- paste0(statement, ' visit_start_datetime = (', as.character(visit_start_datetime), ')')
    } else {
      statement <- paste0(statement, " visit_start_datetime = '", visit_start_datetime,"'")
    }
  }

  if (!missing(visit_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_end_date)) {
      statement <- paste0(statement, ' visit_end_date IS NULL')
    } else if (is(visit_end_date, 'subQuery')){
      statement <- paste0(statement, ' visit_end_date = (', as.character(visit_end_date), ')')
    } else {
      statement <- paste0(statement, " visit_end_date = '", visit_end_date,"'")
    }
  }

  if (!missing(visit_end_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_end_datetime)) {
      statement <- paste0(statement, ' visit_end_datetime IS NULL')
    } else if (is(visit_end_datetime, 'subQuery')){
      statement <- paste0(statement, ' visit_end_datetime = (', as.character(visit_end_datetime), ')')
    } else {
      statement <- paste0(statement, " visit_end_datetime = '", visit_end_datetime,"'")
    }
  }

  if (!missing(visit_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_type_concept_id)) {
      statement <- paste0(statement, ' visit_type_concept_id IS NULL')
    } else if (is(visit_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' visit_type_concept_id = (', as.character(visit_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " visit_type_concept_id = '", visit_type_concept_id,"'")
    }
  }

  if (!missing(provider_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_id)) {
      statement <- paste0(statement, ' provider_id IS NULL')
    } else if (is(provider_id, 'subQuery')){
      statement <- paste0(statement, ' provider_id = (', as.character(provider_id), ')')
    } else {
      statement <- paste0(statement, " provider_id = '", provider_id,"'")
    }
  }

  if (!missing(care_site_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(care_site_id)) {
      statement <- paste0(statement, ' care_site_id IS NULL')
    } else if (is(care_site_id, 'subQuery')){
      statement <- paste0(statement, ' care_site_id = (', as.character(care_site_id), ')')
    } else {
      statement <- paste0(statement, " care_site_id = '", care_site_id,"'")
    }
  }

  if (!missing(visit_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_source_value)) {
      statement <- paste0(statement, ' visit_source_value IS NULL')
    } else if (is(visit_source_value, 'subQuery')){
      statement <- paste0(statement, ' visit_source_value = (', as.character(visit_source_value), ')')
    } else {
      statement <- paste0(statement, " visit_source_value = '", visit_source_value,"'")
    }
  }

  if (!missing(visit_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_source_concept_id)) {
      statement <- paste0(statement, ' visit_source_concept_id IS NULL')
    } else if (is(visit_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' visit_source_concept_id = (', as.character(visit_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " visit_source_concept_id = '", visit_source_concept_id,"'")
    }
  }

  if (!missing(admitting_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(admitting_source_concept_id)) {
      statement <- paste0(statement, ' admitting_source_concept_id IS NULL')
    } else if (is(admitting_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' admitting_source_concept_id = (', as.character(admitting_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " admitting_source_concept_id = '", admitting_source_concept_id,"'")
    }
  }

  if (!missing(admitting_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(admitting_source_value)) {
      statement <- paste0(statement, ' admitting_source_value IS NULL')
    } else if (is(admitting_source_value, 'subQuery')){
      statement <- paste0(statement, ' admitting_source_value = (', as.character(admitting_source_value), ')')
    } else {
      statement <- paste0(statement, " admitting_source_value = '", admitting_source_value,"'")
    }
  }

  if (!missing(discharge_to_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(discharge_to_concept_id)) {
      statement <- paste0(statement, ' discharge_to_concept_id IS NULL')
    } else if (is(discharge_to_concept_id, 'subQuery')){
      statement <- paste0(statement, ' discharge_to_concept_id = (', as.character(discharge_to_concept_id), ')')
    } else {
      statement <- paste0(statement, " discharge_to_concept_id = '", discharge_to_concept_id,"'")
    }
  }

  if (!missing(discharge_to_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(discharge_to_source_value)) {
      statement <- paste0(statement, ' discharge_to_source_value IS NULL')
    } else if (is(discharge_to_source_value, 'subQuery')){
      statement <- paste0(statement, ' discharge_to_source_value = (', as.character(discharge_to_source_value), ')')
    } else {
      statement <- paste0(statement, " discharge_to_source_value = '", discharge_to_source_value,"'")
    }
  }

  if (!missing(preceding_visit_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(preceding_visit_occurrence_id)) {
      statement <- paste0(statement, ' preceding_visit_occurrence_id IS NULL')
    } else if (is(preceding_visit_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' preceding_visit_occurrence_id = (', as.character(preceding_visit_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " preceding_visit_occurrence_id = '", preceding_visit_occurrence_id,"'")
    }
  }

  statement <- paste0(statement, ") != 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_no_cohort <- function(cohort_definition_id, subject_id, cohort_start_date, cohort_end_date) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect cohort' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.cohort WHERE")
  first <- TRUE
  if (!missing(cohort_definition_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cohort_definition_id)) {
      statement <- paste0(statement, ' cohort_definition_id IS NULL')
    } else if (is(cohort_definition_id, 'subQuery')){
      statement <- paste0(statement, ' cohort_definition_id = (', as.character(cohort_definition_id), ')')
    } else {
      statement <- paste0(statement, " cohort_definition_id = '", cohort_definition_id,"'")
    }
  }

  if (!missing(subject_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(subject_id)) {
      statement <- paste0(statement, ' subject_id IS NULL')
    } else if (is(subject_id, 'subQuery')){
      statement <- paste0(statement, ' subject_id = (', as.character(subject_id), ')')
    } else {
      statement <- paste0(statement, " subject_id = '", subject_id,"'")
    }
  }

  if (!missing(cohort_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cohort_start_date)) {
      statement <- paste0(statement, ' cohort_start_date IS NULL')
    } else if (is(cohort_start_date, 'subQuery')){
      statement <- paste0(statement, ' cohort_start_date = (', as.character(cohort_start_date), ')')
    } else {
      statement <- paste0(statement, " cohort_start_date = '", cohort_start_date,"'")
    }
  }

  if (!missing(cohort_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cohort_end_date)) {
      statement <- paste0(statement, ' cohort_end_date IS NULL')
    } else if (is(cohort_end_date, 'subQuery')){
      statement <- paste0(statement, ' cohort_end_date = (', as.character(cohort_end_date), ')')
    } else {
      statement <- paste0(statement, " cohort_end_date = '", cohort_end_date,"'")
    }
  }

  statement <- paste0(statement, ") != 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_no_cohort_attribute <- function(cohort_definition_id, subject_id, cohort_start_date, cohort_end_date, attribute_definition_id, value_as_number, value_as_concept_id) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect cohort_attribute' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.cohort_attribute WHERE")
  first <- TRUE
  if (!missing(cohort_definition_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cohort_definition_id)) {
      statement <- paste0(statement, ' cohort_definition_id IS NULL')
    } else if (is(cohort_definition_id, 'subQuery')){
      statement <- paste0(statement, ' cohort_definition_id = (', as.character(cohort_definition_id), ')')
    } else {
      statement <- paste0(statement, " cohort_definition_id = '", cohort_definition_id,"'")
    }
  }

  if (!missing(subject_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(subject_id)) {
      statement <- paste0(statement, ' subject_id IS NULL')
    } else if (is(subject_id, 'subQuery')){
      statement <- paste0(statement, ' subject_id = (', as.character(subject_id), ')')
    } else {
      statement <- paste0(statement, " subject_id = '", subject_id,"'")
    }
  }

  if (!missing(cohort_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cohort_start_date)) {
      statement <- paste0(statement, ' cohort_start_date IS NULL')
    } else if (is(cohort_start_date, 'subQuery')){
      statement <- paste0(statement, ' cohort_start_date = (', as.character(cohort_start_date), ')')
    } else {
      statement <- paste0(statement, " cohort_start_date = '", cohort_start_date,"'")
    }
  }

  if (!missing(cohort_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cohort_end_date)) {
      statement <- paste0(statement, ' cohort_end_date IS NULL')
    } else if (is(cohort_end_date, 'subQuery')){
      statement <- paste0(statement, ' cohort_end_date = (', as.character(cohort_end_date), ')')
    } else {
      statement <- paste0(statement, " cohort_end_date = '", cohort_end_date,"'")
    }
  }

  if (!missing(attribute_definition_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(attribute_definition_id)) {
      statement <- paste0(statement, ' attribute_definition_id IS NULL')
    } else if (is(attribute_definition_id, 'subQuery')){
      statement <- paste0(statement, ' attribute_definition_id = (', as.character(attribute_definition_id), ')')
    } else {
      statement <- paste0(statement, " attribute_definition_id = '", attribute_definition_id,"'")
    }
  }

  if (!missing(value_as_number)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(value_as_number)) {
      statement <- paste0(statement, ' value_as_number IS NULL')
    } else if (is(value_as_number, 'subQuery')){
      statement <- paste0(statement, ' value_as_number = (', as.character(value_as_number), ')')
    } else {
      statement <- paste0(statement, " value_as_number = '", value_as_number,"'")
    }
  }

  if (!missing(value_as_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(value_as_concept_id)) {
      statement <- paste0(statement, ' value_as_concept_id IS NULL')
    } else if (is(value_as_concept_id, 'subQuery')){
      statement <- paste0(statement, ' value_as_concept_id = (', as.character(value_as_concept_id), ')')
    } else {
      statement <- paste0(statement, " value_as_concept_id = '", value_as_concept_id,"'")
    }
  }

  statement <- paste0(statement, ") != 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_no_condition_era <- function(condition_era_id, person_id, condition_concept_id, condition_era_start_date, condition_era_end_date, condition_occurrence_count) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect condition_era' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.condition_era WHERE")
  first <- TRUE
  if (!missing(condition_era_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_era_id)) {
      statement <- paste0(statement, ' condition_era_id IS NULL')
    } else if (is(condition_era_id, 'subQuery')){
      statement <- paste0(statement, ' condition_era_id = (', as.character(condition_era_id), ')')
    } else {
      statement <- paste0(statement, " condition_era_id = '", condition_era_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(condition_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_concept_id)) {
      statement <- paste0(statement, ' condition_concept_id IS NULL')
    } else if (is(condition_concept_id, 'subQuery')){
      statement <- paste0(statement, ' condition_concept_id = (', as.character(condition_concept_id), ')')
    } else {
      statement <- paste0(statement, " condition_concept_id = '", condition_concept_id,"'")
    }
  }

  if (!missing(condition_era_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_era_start_date)) {
      statement <- paste0(statement, ' condition_era_start_date IS NULL')
    } else if (is(condition_era_start_date, 'subQuery')){
      statement <- paste0(statement, ' condition_era_start_date = (', as.character(condition_era_start_date), ')')
    } else {
      statement <- paste0(statement, " condition_era_start_date = '", condition_era_start_date,"'")
    }
  }

  if (!missing(condition_era_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_era_end_date)) {
      statement <- paste0(statement, ' condition_era_end_date IS NULL')
    } else if (is(condition_era_end_date, 'subQuery')){
      statement <- paste0(statement, ' condition_era_end_date = (', as.character(condition_era_end_date), ')')
    } else {
      statement <- paste0(statement, " condition_era_end_date = '", condition_era_end_date,"'")
    }
  }

  if (!missing(condition_occurrence_count)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_occurrence_count)) {
      statement <- paste0(statement, ' condition_occurrence_count IS NULL')
    } else if (is(condition_occurrence_count, 'subQuery')){
      statement <- paste0(statement, ' condition_occurrence_count = (', as.character(condition_occurrence_count), ')')
    } else {
      statement <- paste0(statement, " condition_occurrence_count = '", condition_occurrence_count,"'")
    }
  }

  statement <- paste0(statement, ") != 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_no_dose_era <- function(dose_era_id, person_id, drug_concept_id, unit_concept_id, dose_value, dose_era_start_date, dose_era_end_date) {

  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect dose_era' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.dose_era WHERE")
  first <- TRUE
  if (!missing(dose_era_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(dose_era_id)) {
      statement <- paste0(statement, ' dose_era_id IS NULL')
    } else if (is(dose_era_id, 'subQuery')){
      statement <- paste0(statement, ' dose_era_id = (', as.character(dose_era_id), ')')
    } else {
      statement <- paste0(statement, " dose_era_id = '", dose_era_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(drug_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_concept_id)) {
      statement <- paste0(statement, ' drug_concept_id IS NULL')
    } else if (is(drug_concept_id, 'subQuery')){
      statement <- paste0(statement, ' drug_concept_id = (', as.character(drug_concept_id), ')')
    } else {
      statement <- paste0(statement, " drug_concept_id = '", drug_concept_id,"'")
    }
  }

  if (!missing(unit_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(unit_concept_id)) {
      statement <- paste0(statement, ' unit_concept_id IS NULL')
    } else if (is(unit_concept_id, 'subQuery')){
      statement <- paste0(statement, ' unit_concept_id = (', as.character(unit_concept_id), ')')
    } else {
      statement <- paste0(statement, " unit_concept_id = '", unit_concept_id,"'")
    }
  }

  if (!missing(dose_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(dose_value)) {
      statement <- paste0(statement, ' dose_value IS NULL')
    } else if (is(dose_value, 'subQuery')){
      statement <- paste0(statement, ' dose_value = (', as.character(dose_value), ')')
    } else {
      statement <- paste0(statement, " dose_value = '", dose_value,"'")
    }
  }

  if (!missing(dose_era_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(dose_era_start_date)) {
      statement <- paste0(statement, ' dose_era_start_date IS NULL')
    } else if (is(dose_era_start_date, 'subQuery')){
      statement <- paste0(statement, ' dose_era_start_date = (', as.character(dose_era_start_date), ')')
    } else {
      statement <- paste0(statement, " dose_era_start_date = '", dose_era_start_date,"'")
    }
  }

  if (!missing(dose_era_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(dose_era_end_date)) {
      statement <- paste0(statement, ' dose_era_end_date IS NULL')
    } else if (is(dose_era_end_date, 'subQuery')){
      statement <- paste0(statement, ' dose_era_end_date = (', as.character(dose_era_end_date), ')')
    } else {
      statement <- paste0(statement, " dose_era_end_date = '", dose_era_end_date,"'")
    }
  }

  statement <- paste0(statement, ") != 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_no_drug_era <- function(drug_era_id, person_id, drug_concept_id, drug_era_start_date, drug_era_end_date, drug_exposure_count, gap_days) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect drug_era' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.drug_era WHERE")
  first <- TRUE
  if (!missing(drug_era_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_era_id)) {
      statement <- paste0(statement, ' drug_era_id IS NULL')
    } else if (is(drug_era_id, 'subQuery')){
      statement <- paste0(statement, ' drug_era_id = (', as.character(drug_era_id), ')')
    } else {
      statement <- paste0(statement, " drug_era_id = '", drug_era_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(drug_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_concept_id)) {
      statement <- paste0(statement, ' drug_concept_id IS NULL')
    } else if (is(drug_concept_id, 'subQuery')){
      statement <- paste0(statement, ' drug_concept_id = (', as.character(drug_concept_id), ')')
    } else {
      statement <- paste0(statement, " drug_concept_id = '", drug_concept_id,"'")
    }
  }

  if (!missing(drug_era_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_era_start_date)) {
      statement <- paste0(statement, ' drug_era_start_date IS NULL')
    } else if (is(drug_era_start_date, 'subQuery')){
      statement <- paste0(statement, ' drug_era_start_date = (', as.character(drug_era_start_date), ')')
    } else {
      statement <- paste0(statement, " drug_era_start_date = '", drug_era_start_date,"'")
    }
  }

  if (!missing(drug_era_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_era_end_date)) {
      statement <- paste0(statement, ' drug_era_end_date IS NULL')
    } else if (is(drug_era_end_date, 'subQuery')){
      statement <- paste0(statement, ' drug_era_end_date = (', as.character(drug_era_end_date), ')')
    } else {
      statement <- paste0(statement, " drug_era_end_date = '", drug_era_end_date,"'")
    }
  }

  if (!missing(drug_exposure_count)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_exposure_count)) {
      statement <- paste0(statement, ' drug_exposure_count IS NULL')
    } else if (is(drug_exposure_count, 'subQuery')){
      statement <- paste0(statement, ' drug_exposure_count = (', as.character(drug_exposure_count), ')')
    } else {
      statement <- paste0(statement, " drug_exposure_count = '", drug_exposure_count,"'")
    }
  }

  if (!missing(gap_days)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(gap_days)) {
      statement <- paste0(statement, ' gap_days IS NULL')
    } else if (is(gap_days, 'subQuery')){
      statement <- paste0(statement, ' gap_days = (', as.character(gap_days), ')')
    } else {
      statement <- paste0(statement, " gap_days = '", gap_days,"'")
    }
  }

  statement <- paste0(statement, ") != 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_no_cost <- function(cost_id, cost_event_id, cost_domain_id, cost_type_concept_id, currency_concept_id, total_charge, total_cost, total_paid, paid_by_payer, paid_by_patient, paid_patient_copay, paid_patient_coinsurance, paid_patient_deductible, paid_by_primary, paid_ingredient_cost, paid_dispensing_fee, payer_plan_period_id, amount_allowed, revenue_code_concept_id, revenue_code_source_value, drg_concept_id, drg_source_value) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect cost' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.cost WHERE")
  first <- TRUE
  if (!missing(cost_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cost_id)) {
      statement <- paste0(statement, ' cost_id IS NULL')
    } else if (is(cost_id, 'subQuery')){
      statement <- paste0(statement, ' cost_id = (', as.character(cost_id), ')')
    } else {
      statement <- paste0(statement, " cost_id = '", cost_id,"'")
    }
  }

  if (!missing(cost_event_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cost_event_id)) {
      statement <- paste0(statement, ' cost_event_id IS NULL')
    } else if (is(cost_event_id, 'subQuery')){
      statement <- paste0(statement, ' cost_event_id = (', as.character(cost_event_id), ')')
    } else {
      statement <- paste0(statement, " cost_event_id = '", cost_event_id,"'")
    }
  }

  if (!missing(cost_domain_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cost_domain_id)) {
      statement <- paste0(statement, ' cost_domain_id IS NULL')
    } else if (is(cost_domain_id, 'subQuery')){
      statement <- paste0(statement, ' cost_domain_id = (', as.character(cost_domain_id), ')')
    } else {
      statement <- paste0(statement, " cost_domain_id = '", cost_domain_id,"'")
    }
  }

  if (!missing(cost_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cost_type_concept_id)) {
      statement <- paste0(statement, ' cost_type_concept_id IS NULL')
    } else if (is(cost_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' cost_type_concept_id = (', as.character(cost_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " cost_type_concept_id = '", cost_type_concept_id,"'")
    }
  }

  if (!missing(currency_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(currency_concept_id)) {
      statement <- paste0(statement, ' currency_concept_id IS NULL')
    } else if (is(currency_concept_id, 'subQuery')){
      statement <- paste0(statement, ' currency_concept_id = (', as.character(currency_concept_id), ')')
    } else {
      statement <- paste0(statement, " currency_concept_id = '", currency_concept_id,"'")
    }
  }

  if (!missing(total_charge)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(total_charge)) {
      statement <- paste0(statement, ' total_charge IS NULL')
    } else if (is(total_charge, 'subQuery')){
      statement <- paste0(statement, ' total_charge = (', as.character(total_charge), ')')
    } else {
      statement <- paste0(statement, " total_charge = '", total_charge,"'")
    }
  }

  if (!missing(total_cost)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(total_cost)) {
      statement <- paste0(statement, ' total_cost IS NULL')
    } else if (is(total_cost, 'subQuery')){
      statement <- paste0(statement, ' total_cost = (', as.character(total_cost), ')')
    } else {
      statement <- paste0(statement, " total_cost = '", total_cost,"'")
    }
  }

  if (!missing(total_paid)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(total_paid)) {
      statement <- paste0(statement, ' total_paid IS NULL')
    } else if (is(total_paid, 'subQuery')){
      statement <- paste0(statement, ' total_paid = (', as.character(total_paid), ')')
    } else {
      statement <- paste0(statement, " total_paid = '", total_paid,"'")
    }
  }

  if (!missing(paid_by_payer)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(paid_by_payer)) {
      statement <- paste0(statement, ' paid_by_payer IS NULL')
    } else if (is(paid_by_payer, 'subQuery')){
      statement <- paste0(statement, ' paid_by_payer = (', as.character(paid_by_payer), ')')
    } else {
      statement <- paste0(statement, " paid_by_payer = '", paid_by_payer,"'")
    }
  }

  if (!missing(paid_by_patient)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(paid_by_patient)) {
      statement <- paste0(statement, ' paid_by_patient IS NULL')
    } else if (is(paid_by_patient, 'subQuery')){
      statement <- paste0(statement, ' paid_by_patient = (', as.character(paid_by_patient), ')')
    } else {
      statement <- paste0(statement, " paid_by_patient = '", paid_by_patient,"'")
    }
  }

  if (!missing(paid_patient_copay)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(paid_patient_copay)) {
      statement <- paste0(statement, ' paid_patient_copay IS NULL')
    } else if (is(paid_patient_copay, 'subQuery')){
      statement <- paste0(statement, ' paid_patient_copay = (', as.character(paid_patient_copay), ')')
    } else {
      statement <- paste0(statement, " paid_patient_copay = '", paid_patient_copay,"'")
    }
  }

  if (!missing(paid_patient_coinsurance)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(paid_patient_coinsurance)) {
      statement <- paste0(statement, ' paid_patient_coinsurance IS NULL')
    } else if (is(paid_patient_coinsurance, 'subQuery')){
      statement <- paste0(statement, ' paid_patient_coinsurance = (', as.character(paid_patient_coinsurance), ')')
    } else {
      statement <- paste0(statement, " paid_patient_coinsurance = '", paid_patient_coinsurance,"'")
    }
  }

  if (!missing(paid_patient_deductible)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(paid_patient_deductible)) {
      statement <- paste0(statement, ' paid_patient_deductible IS NULL')
    } else if (is(paid_patient_deductible, 'subQuery')){
      statement <- paste0(statement, ' paid_patient_deductible = (', as.character(paid_patient_deductible), ')')
    } else {
      statement <- paste0(statement, " paid_patient_deductible = '", paid_patient_deductible,"'")
    }
  }

  if (!missing(paid_by_primary)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(paid_by_primary)) {
      statement <- paste0(statement, ' paid_by_primary IS NULL')
    } else if (is(paid_by_primary, 'subQuery')){
      statement <- paste0(statement, ' paid_by_primary = (', as.character(paid_by_primary), ')')
    } else {
      statement <- paste0(statement, " paid_by_primary = '", paid_by_primary,"'")
    }
  }

  if (!missing(paid_ingredient_cost)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(paid_ingredient_cost)) {
      statement <- paste0(statement, ' paid_ingredient_cost IS NULL')
    } else if (is(paid_ingredient_cost, 'subQuery')){
      statement <- paste0(statement, ' paid_ingredient_cost = (', as.character(paid_ingredient_cost), ')')
    } else {
      statement <- paste0(statement, " paid_ingredient_cost = '", paid_ingredient_cost,"'")
    }
  }

  if (!missing(paid_dispensing_fee)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(paid_dispensing_fee)) {
      statement <- paste0(statement, ' paid_dispensing_fee IS NULL')
    } else if (is(paid_dispensing_fee, 'subQuery')){
      statement <- paste0(statement, ' paid_dispensing_fee = (', as.character(paid_dispensing_fee), ')')
    } else {
      statement <- paste0(statement, " paid_dispensing_fee = '", paid_dispensing_fee,"'")
    }
  }

  if (!missing(payer_plan_period_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(payer_plan_period_id)) {
      statement <- paste0(statement, ' payer_plan_period_id IS NULL')
    } else if (is(payer_plan_period_id, 'subQuery')){
      statement <- paste0(statement, ' payer_plan_period_id = (', as.character(payer_plan_period_id), ')')
    } else {
      statement <- paste0(statement, " payer_plan_period_id = '", payer_plan_period_id,"'")
    }
  }

  if (!missing(amount_allowed)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(amount_allowed)) {
      statement <- paste0(statement, ' amount_allowed IS NULL')
    } else if (is(amount_allowed, 'subQuery')){
      statement <- paste0(statement, ' amount_allowed = (', as.character(amount_allowed), ')')
    } else {
      statement <- paste0(statement, " amount_allowed = '", amount_allowed,"'")
    }
  }

  if (!missing(revenue_code_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(revenue_code_concept_id)) {
      statement <- paste0(statement, ' revenue_code_concept_id IS NULL')
    } else if (is(revenue_code_concept_id, 'subQuery')){
      statement <- paste0(statement, ' revenue_code_concept_id = (', as.character(revenue_code_concept_id), ')')
    } else {
      statement <- paste0(statement, " revenue_code_concept_id = '", revenue_code_concept_id,"'")
    }
  }

  if (!missing(revenue_code_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(revenue_code_source_value)) {
      statement <- paste0(statement, ' revenue_code_source_value IS NULL')
    } else if (is(revenue_code_source_value, 'subQuery')){
      statement <- paste0(statement, ' revenue_code_source_value = (', as.character(revenue_code_source_value), ')')
    } else {
      statement <- paste0(statement, " revenue_code_source_value = '", revenue_code_source_value,"'")
    }
  }

  if (!missing(drg_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drg_concept_id)) {
      statement <- paste0(statement, ' drg_concept_id IS NULL')
    } else if (is(drg_concept_id, 'subQuery')){
      statement <- paste0(statement, ' drg_concept_id = (', as.character(drg_concept_id), ')')
    } else {
      statement <- paste0(statement, " drg_concept_id = '", drg_concept_id,"'")
    }
  }

  if (!missing(drg_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drg_source_value)) {
      statement <- paste0(statement, ' drg_source_value IS NULL')
    } else if (is(drg_source_value, 'subQuery')){
      statement <- paste0(statement, ' drg_source_value = (', as.character(drg_source_value), ')')
    } else {
      statement <- paste0(statement, " drg_source_value = '", drg_source_value,"'")
    }
  }

  statement <- paste0(statement, ") != 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_no_payer_plan_period <- function(payer_plan_period_id, person_id, payer_plan_period_start_date, payer_plan_period_end_date, payer_source_value, plan_source_value, family_source_value) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect payer_plan_period' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.payer_plan_period WHERE")
  first <- TRUE
  if (!missing(payer_plan_period_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(payer_plan_period_id)) {
      statement <- paste0(statement, ' payer_plan_period_id IS NULL')
    } else if (is(payer_plan_period_id, 'subQuery')){
      statement <- paste0(statement, ' payer_plan_period_id = (', as.character(payer_plan_period_id), ')')
    } else {
      statement <- paste0(statement, " payer_plan_period_id = '", payer_plan_period_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(payer_plan_period_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(payer_plan_period_start_date)) {
      statement <- paste0(statement, ' payer_plan_period_start_date IS NULL')
    } else if (is(payer_plan_period_start_date, 'subQuery')){
      statement <- paste0(statement, ' payer_plan_period_start_date = (', as.character(payer_plan_period_start_date), ')')
    } else {
      statement <- paste0(statement, " payer_plan_period_start_date = '", payer_plan_period_start_date,"'")
    }
  }

  if (!missing(payer_plan_period_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(payer_plan_period_end_date)) {
      statement <- paste0(statement, ' payer_plan_period_end_date IS NULL')
    } else if (is(payer_plan_period_end_date, 'subQuery')){
      statement <- paste0(statement, ' payer_plan_period_end_date = (', as.character(payer_plan_period_end_date), ')')
    } else {
      statement <- paste0(statement, " payer_plan_period_end_date = '", payer_plan_period_end_date,"'")
    }
  }

  if (!missing(payer_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(payer_source_value)) {
      statement <- paste0(statement, ' payer_source_value IS NULL')
    } else if (is(payer_source_value, 'subQuery')){
      statement <- paste0(statement, ' payer_source_value = (', as.character(payer_source_value), ')')
    } else {
      statement <- paste0(statement, " payer_source_value = '", payer_source_value,"'")
    }
  }

  if (!missing(plan_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(plan_source_value)) {
      statement <- paste0(statement, ' plan_source_value IS NULL')
    } else if (is(plan_source_value, 'subQuery')){
      statement <- paste0(statement, ' plan_source_value = (', as.character(plan_source_value), ')')
    } else {
      statement <- paste0(statement, " plan_source_value = '", plan_source_value,"'")
    }
  }

  if (!missing(family_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(family_source_value)) {
      statement <- paste0(statement, ' family_source_value IS NULL')
    } else if (is(family_source_value, 'subQuery')){
      statement <- paste0(statement, ' family_source_value = (', as.character(family_source_value), ')')
    } else {
      statement <- paste0(statement, " family_source_value = '", family_source_value,"'")
    }
  }

  statement <- paste0(statement, ") != 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_no_care_site <- function(care_site_id, care_site_name, place_of_service_concept_id, location_id, care_site_source_value, place_of_service_source_value) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect care_site' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.care_site WHERE")
  first <- TRUE
  if (!missing(care_site_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(care_site_id)) {
      statement <- paste0(statement, ' care_site_id IS NULL')
    } else if (is(care_site_id, 'subQuery')){
      statement <- paste0(statement, ' care_site_id = (', as.character(care_site_id), ')')
    } else {
      statement <- paste0(statement, " care_site_id = '", care_site_id,"'")
    }
  }

  if (!missing(care_site_name)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(care_site_name)) {
      statement <- paste0(statement, ' care_site_name IS NULL')
    } else if (is(care_site_name, 'subQuery')){
      statement <- paste0(statement, ' care_site_name = (', as.character(care_site_name), ')')
    } else {
      statement <- paste0(statement, " care_site_name = '", care_site_name,"'")
    }
  }

  if (!missing(place_of_service_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(place_of_service_concept_id)) {
      statement <- paste0(statement, ' place_of_service_concept_id IS NULL')
    } else if (is(place_of_service_concept_id, 'subQuery')){
      statement <- paste0(statement, ' place_of_service_concept_id = (', as.character(place_of_service_concept_id), ')')
    } else {
      statement <- paste0(statement, " place_of_service_concept_id = '", place_of_service_concept_id,"'")
    }
  }

  if (!missing(location_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(location_id)) {
      statement <- paste0(statement, ' location_id IS NULL')
    } else if (is(location_id, 'subQuery')){
      statement <- paste0(statement, ' location_id = (', as.character(location_id), ')')
    } else {
      statement <- paste0(statement, " location_id = '", location_id,"'")
    }
  }

  if (!missing(care_site_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(care_site_source_value)) {
      statement <- paste0(statement, ' care_site_source_value IS NULL')
    } else if (is(care_site_source_value, 'subQuery')){
      statement <- paste0(statement, ' care_site_source_value = (', as.character(care_site_source_value), ')')
    } else {
      statement <- paste0(statement, " care_site_source_value = '", care_site_source_value,"'")
    }
  }

  if (!missing(place_of_service_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(place_of_service_source_value)) {
      statement <- paste0(statement, ' place_of_service_source_value IS NULL')
    } else if (is(place_of_service_source_value, 'subQuery')){
      statement <- paste0(statement, ' place_of_service_source_value = (', as.character(place_of_service_source_value), ')')
    } else {
      statement <- paste0(statement, " place_of_service_source_value = '", place_of_service_source_value,"'")
    }
  }

  statement <- paste0(statement, ") != 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_no_location <- function(location_id, address_1, address_2, city, state, zip, county, location_source_value) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect location' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.location WHERE")
  first <- TRUE
  if (!missing(location_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(location_id)) {
      statement <- paste0(statement, ' location_id IS NULL')
    } else if (is(location_id, 'subQuery')){
      statement <- paste0(statement, ' location_id = (', as.character(location_id), ')')
    } else {
      statement <- paste0(statement, " location_id = '", location_id,"'")
    }
  }

  if (!missing(address_1)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(address_1)) {
      statement <- paste0(statement, ' address_1 IS NULL')
    } else if (is(address_1, 'subQuery')){
      statement <- paste0(statement, ' address_1 = (', as.character(address_1), ')')
    } else {
      statement <- paste0(statement, " address_1 = '", address_1,"'")
    }
  }

  if (!missing(address_2)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(address_2)) {
      statement <- paste0(statement, ' address_2 IS NULL')
    } else if (is(address_2, 'subQuery')){
      statement <- paste0(statement, ' address_2 = (', as.character(address_2), ')')
    } else {
      statement <- paste0(statement, " address_2 = '", address_2,"'")
    }
  }

  if (!missing(city)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(city)) {
      statement <- paste0(statement, ' city IS NULL')
    } else if (is(city, 'subQuery')){
      statement <- paste0(statement, ' city = (', as.character(city), ')')
    } else {
      statement <- paste0(statement, " city = '", city,"'")
    }
  }

  if (!missing(state)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(state)) {
      statement <- paste0(statement, ' state IS NULL')
    } else if (is(state, 'subQuery')){
      statement <- paste0(statement, ' state = (', as.character(state), ')')
    } else {
      statement <- paste0(statement, " state = '", state,"'")
    }
  }

  if (!missing(zip)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(zip)) {
      statement <- paste0(statement, ' zip IS NULL')
    } else if (is(zip, 'subQuery')){
      statement <- paste0(statement, ' zip = (', as.character(zip), ')')
    } else {
      statement <- paste0(statement, " zip = '", zip,"'")
    }
  }

  if (!missing(county)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(county)) {
      statement <- paste0(statement, ' county IS NULL')
    } else if (is(county, 'subQuery')){
      statement <- paste0(statement, ' county = (', as.character(county), ')')
    } else {
      statement <- paste0(statement, " county = '", county,"'")
    }
  }

  if (!missing(location_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(location_source_value)) {
      statement <- paste0(statement, ' location_source_value IS NULL')
    } else if (is(location_source_value, 'subQuery')){
      statement <- paste0(statement, ' location_source_value = (', as.character(location_source_value), ')')
    } else {
      statement <- paste0(statement, " location_source_value = '", location_source_value,"'")
    }
  }

  statement <- paste0(statement, ") != 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_no_provider <- function(provider_id, provider_name, npi, dea, specialty_concept_id, care_site_id, year_of_birth, gender_concept_id, provider_source_value, specialty_source_value, specialty_source_concept_id, gender_source_value, gender_source_concept_id) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect provider' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.provider WHERE")
  first <- TRUE
  if (!missing(provider_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_id)) {
      statement <- paste0(statement, ' provider_id IS NULL')
    } else if (is(provider_id, 'subQuery')){
      statement <- paste0(statement, ' provider_id = (', as.character(provider_id), ')')
    } else {
      statement <- paste0(statement, " provider_id = '", provider_id,"'")
    }
  }

  if (!missing(provider_name)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_name)) {
      statement <- paste0(statement, ' provider_name IS NULL')
    } else if (is(provider_name, 'subQuery')){
      statement <- paste0(statement, ' provider_name = (', as.character(provider_name), ')')
    } else {
      statement <- paste0(statement, " provider_name = '", provider_name,"'")
    }
  }

  if (!missing(npi)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(npi)) {
      statement <- paste0(statement, ' npi IS NULL')
    } else if (is(npi, 'subQuery')){
      statement <- paste0(statement, ' npi = (', as.character(npi), ')')
    } else {
      statement <- paste0(statement, " npi = '", npi,"'")
    }
  }

  if (!missing(dea)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(dea)) {
      statement <- paste0(statement, ' dea IS NULL')
    } else if (is(dea, 'subQuery')){
      statement <- paste0(statement, ' dea = (', as.character(dea), ')')
    } else {
      statement <- paste0(statement, " dea = '", dea,"'")
    }
  }

  if (!missing(specialty_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(specialty_concept_id)) {
      statement <- paste0(statement, ' specialty_concept_id IS NULL')
    } else if (is(specialty_concept_id, 'subQuery')){
      statement <- paste0(statement, ' specialty_concept_id = (', as.character(specialty_concept_id), ')')
    } else {
      statement <- paste0(statement, " specialty_concept_id = '", specialty_concept_id,"'")
    }
  }

  if (!missing(care_site_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(care_site_id)) {
      statement <- paste0(statement, ' care_site_id IS NULL')
    } else if (is(care_site_id, 'subQuery')){
      statement <- paste0(statement, ' care_site_id = (', as.character(care_site_id), ')')
    } else {
      statement <- paste0(statement, " care_site_id = '", care_site_id,"'")
    }
  }

  if (!missing(year_of_birth)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(year_of_birth)) {
      statement <- paste0(statement, ' year_of_birth IS NULL')
    } else if (is(year_of_birth, 'subQuery')){
      statement <- paste0(statement, ' year_of_birth = (', as.character(year_of_birth), ')')
    } else {
      statement <- paste0(statement, " year_of_birth = '", year_of_birth,"'")
    }
  }

  if (!missing(gender_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(gender_concept_id)) {
      statement <- paste0(statement, ' gender_concept_id IS NULL')
    } else if (is(gender_concept_id, 'subQuery')){
      statement <- paste0(statement, ' gender_concept_id = (', as.character(gender_concept_id), ')')
    } else {
      statement <- paste0(statement, " gender_concept_id = '", gender_concept_id,"'")
    }
  }

  if (!missing(provider_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_source_value)) {
      statement <- paste0(statement, ' provider_source_value IS NULL')
    } else if (is(provider_source_value, 'subQuery')){
      statement <- paste0(statement, ' provider_source_value = (', as.character(provider_source_value), ')')
    } else {
      statement <- paste0(statement, " provider_source_value = '", provider_source_value,"'")
    }
  }

  if (!missing(specialty_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(specialty_source_value)) {
      statement <- paste0(statement, ' specialty_source_value IS NULL')
    } else if (is(specialty_source_value, 'subQuery')){
      statement <- paste0(statement, ' specialty_source_value = (', as.character(specialty_source_value), ')')
    } else {
      statement <- paste0(statement, " specialty_source_value = '", specialty_source_value,"'")
    }
  }

  if (!missing(specialty_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(specialty_source_concept_id)) {
      statement <- paste0(statement, ' specialty_source_concept_id IS NULL')
    } else if (is(specialty_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' specialty_source_concept_id = (', as.character(specialty_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " specialty_source_concept_id = '", specialty_source_concept_id,"'")
    }
  }

  if (!missing(gender_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(gender_source_value)) {
      statement <- paste0(statement, ' gender_source_value IS NULL')
    } else if (is(gender_source_value, 'subQuery')){
      statement <- paste0(statement, ' gender_source_value = (', as.character(gender_source_value), ')')
    } else {
      statement <- paste0(statement, " gender_source_value = '", gender_source_value,"'")
    }
  }

  if (!missing(gender_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(gender_source_concept_id)) {
      statement <- paste0(statement, ' gender_source_concept_id IS NULL')
    } else if (is(gender_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' gender_source_concept_id = (', as.character(gender_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " gender_source_concept_id = '", gender_source_concept_id,"'")
    }
  }

  statement <- paste0(statement, ") != 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_no_cdm_source <- function(cdm_source_name, cdm_source_abbreviation, cdm_holder, source_description, source_documentation_reference, cdm_etl__reference, source_release_date, cdm_release_date, cdm_version, vocabulary_version) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect cdm_source' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.cdm_source WHERE")
  first <- TRUE
  if (!missing(cdm_source_name)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cdm_source_name)) {
      statement <- paste0(statement, ' cdm_source_name IS NULL')
    } else if (is(cdm_source_name, 'subQuery')){
      statement <- paste0(statement, ' cdm_source_name = (', as.character(cdm_source_name), ')')
    } else {
      statement <- paste0(statement, " cdm_source_name = '", cdm_source_name,"'")
    }
  }

  if (!missing(cdm_source_abbreviation)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cdm_source_abbreviation)) {
      statement <- paste0(statement, ' cdm_source_abbreviation IS NULL')
    } else if (is(cdm_source_abbreviation, 'subQuery')){
      statement <- paste0(statement, ' cdm_source_abbreviation = (', as.character(cdm_source_abbreviation), ')')
    } else {
      statement <- paste0(statement, " cdm_source_abbreviation = '", cdm_source_abbreviation,"'")
    }
  }

  if (!missing(cdm_holder)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cdm_holder)) {
      statement <- paste0(statement, ' cdm_holder IS NULL')
    } else if (is(cdm_holder, 'subQuery')){
      statement <- paste0(statement, ' cdm_holder = (', as.character(cdm_holder), ')')
    } else {
      statement <- paste0(statement, " cdm_holder = '", cdm_holder,"'")
    }
  }

  if (!missing(source_description)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(source_description)) {
      statement <- paste0(statement, ' source_description IS NULL')
    } else if (is(source_description, 'subQuery')){
      statement <- paste0(statement, ' source_description = (', as.character(source_description), ')')
    } else {
      statement <- paste0(statement, " source_description = '", source_description,"'")
    }
  }

  if (!missing(source_documentation_reference)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(source_documentation_reference)) {
      statement <- paste0(statement, ' source_documentation_reference IS NULL')
    } else if (is(source_documentation_reference, 'subQuery')){
      statement <- paste0(statement, ' source_documentation_reference = (', as.character(source_documentation_reference), ')')
    } else {
      statement <- paste0(statement, " source_documentation_reference = '", source_documentation_reference,"'")
    }
  }

  if (!missing(cdm_etl__reference)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cdm_etl__reference)) {
      statement <- paste0(statement, ' [cdm_etl _reference] IS NULL')
    } else if (is(cdm_etl__reference, 'subQuery')){
      statement <- paste0(statement, ' [cdm_etl _reference] = (', as.character(cdm_etl__reference), ')')
    } else {
      statement <- paste0(statement, " [cdm_etl _reference] = '", cdm_etl__reference,"'")
    }
  }

  if (!missing(source_release_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(source_release_date)) {
      statement <- paste0(statement, ' source_release_date IS NULL')
    } else if (is(source_release_date, 'subQuery')){
      statement <- paste0(statement, ' source_release_date = (', as.character(source_release_date), ')')
    } else {
      statement <- paste0(statement, " source_release_date = '", source_release_date,"'")
    }
  }

  if (!missing(cdm_release_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cdm_release_date)) {
      statement <- paste0(statement, ' cdm_release_date IS NULL')
    } else if (is(cdm_release_date, 'subQuery')){
      statement <- paste0(statement, ' cdm_release_date = (', as.character(cdm_release_date), ')')
    } else {
      statement <- paste0(statement, " cdm_release_date = '", cdm_release_date,"'")
    }
  }

  if (!missing(cdm_version)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cdm_version)) {
      statement <- paste0(statement, ' cdm_version IS NULL')
    } else if (is(cdm_version, 'subQuery')){
      statement <- paste0(statement, ' cdm_version = (', as.character(cdm_version), ')')
    } else {
      statement <- paste0(statement, " cdm_version = '", cdm_version,"'")
    }
  }

  if (!missing(vocabulary_version)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(vocabulary_version)) {
      statement <- paste0(statement, ' vocabulary_version IS NULL')
    } else if (is(vocabulary_version, 'subQuery')){
      statement <- paste0(statement, ' vocabulary_version = (', as.character(vocabulary_version), ')')
    } else {
      statement <- paste0(statement, " vocabulary_version = '", vocabulary_version,"'")
    }
  }

  statement <- paste0(statement, ") != 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_no_attribute_definition <- function(attribute_definition_id, attribute_name, attribute_description, attribute_type_concept_id, attribute_syntax) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect attribute_definition' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.attribute_definition WHERE")
  first <- TRUE
  if (!missing(attribute_definition_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(attribute_definition_id)) {
      statement <- paste0(statement, ' attribute_definition_id IS NULL')
    } else if (is(attribute_definition_id, 'subQuery')){
      statement <- paste0(statement, ' attribute_definition_id = (', as.character(attribute_definition_id), ')')
    } else {
      statement <- paste0(statement, " attribute_definition_id = '", attribute_definition_id,"'")
    }
  }

  if (!missing(attribute_name)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(attribute_name)) {
      statement <- paste0(statement, ' attribute_name IS NULL')
    } else if (is(attribute_name, 'subQuery')){
      statement <- paste0(statement, ' attribute_name = (', as.character(attribute_name), ')')
    } else {
      statement <- paste0(statement, " attribute_name = '", attribute_name,"'")
    }
  }

  if (!missing(attribute_description)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(attribute_description)) {
      statement <- paste0(statement, ' attribute_description IS NULL')
    } else if (is(attribute_description, 'subQuery')){
      statement <- paste0(statement, ' attribute_description = (', as.character(attribute_description), ')')
    } else {
      statement <- paste0(statement, " attribute_description = '", attribute_description,"'")
    }
  }

  if (!missing(attribute_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(attribute_type_concept_id)) {
      statement <- paste0(statement, ' attribute_type_concept_id IS NULL')
    } else if (is(attribute_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' attribute_type_concept_id = (', as.character(attribute_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " attribute_type_concept_id = '", attribute_type_concept_id,"'")
    }
  }

  if (!missing(attribute_syntax)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(attribute_syntax)) {
      statement <- paste0(statement, ' attribute_syntax IS NULL')
    } else if (is(attribute_syntax, 'subQuery')){
      statement <- paste0(statement, ' attribute_syntax = (', as.character(attribute_syntax), ')')
    } else {
      statement <- paste0(statement, " attribute_syntax = '", attribute_syntax,"'")
    }
  }

  statement <- paste0(statement, ") != 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_no_cohort_definition <- function(cohort_definition_id, cohort_definition_name, cohort_definition_description, definition_type_concept_id, cohort_definition_syntax, subject_concept_id, cohort_instantiation_date) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect cohort_definition' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.cohort_definition WHERE")
  first <- TRUE
  if (!missing(cohort_definition_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cohort_definition_id)) {
      statement <- paste0(statement, ' cohort_definition_id IS NULL')
    } else if (is(cohort_definition_id, 'subQuery')){
      statement <- paste0(statement, ' cohort_definition_id = (', as.character(cohort_definition_id), ')')
    } else {
      statement <- paste0(statement, " cohort_definition_id = '", cohort_definition_id,"'")
    }
  }

  if (!missing(cohort_definition_name)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cohort_definition_name)) {
      statement <- paste0(statement, ' cohort_definition_name IS NULL')
    } else if (is(cohort_definition_name, 'subQuery')){
      statement <- paste0(statement, ' cohort_definition_name = (', as.character(cohort_definition_name), ')')
    } else {
      statement <- paste0(statement, " cohort_definition_name = '", cohort_definition_name,"'")
    }
  }

  if (!missing(cohort_definition_description)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cohort_definition_description)) {
      statement <- paste0(statement, ' cohort_definition_description IS NULL')
    } else if (is(cohort_definition_description, 'subQuery')){
      statement <- paste0(statement, ' cohort_definition_description = (', as.character(cohort_definition_description), ')')
    } else {
      statement <- paste0(statement, " cohort_definition_description = '", cohort_definition_description,"'")
    }
  }

  if (!missing(definition_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(definition_type_concept_id)) {
      statement <- paste0(statement, ' definition_type_concept_id IS NULL')
    } else if (is(definition_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' definition_type_concept_id = (', as.character(definition_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " definition_type_concept_id = '", definition_type_concept_id,"'")
    }
  }

  if (!missing(cohort_definition_syntax)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cohort_definition_syntax)) {
      statement <- paste0(statement, ' cohort_definition_syntax IS NULL')
    } else if (is(cohort_definition_syntax, 'subQuery')){
      statement <- paste0(statement, ' cohort_definition_syntax = (', as.character(cohort_definition_syntax), ')')
    } else {
      statement <- paste0(statement, " cohort_definition_syntax = '", cohort_definition_syntax,"'")
    }
  }

  if (!missing(subject_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(subject_concept_id)) {
      statement <- paste0(statement, ' subject_concept_id IS NULL')
    } else if (is(subject_concept_id, 'subQuery')){
      statement <- paste0(statement, ' subject_concept_id = (', as.character(subject_concept_id), ')')
    } else {
      statement <- paste0(statement, " subject_concept_id = '", subject_concept_id,"'")
    }
  }

  if (!missing(cohort_instantiation_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cohort_instantiation_date)) {
      statement <- paste0(statement, ' cohort_instantiation_date IS NULL')
    } else if (is(cohort_instantiation_date, 'subQuery')){
      statement <- paste0(statement, ' cohort_instantiation_date = (', as.character(cohort_instantiation_date), ')')
    } else {
      statement <- paste0(statement, " cohort_instantiation_date = '", cohort_instantiation_date,"'")
    }
  }

  statement <- paste0(statement, ") != 0 THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_count_condition_occurrence <- function(rowCount, condition_occurrence_id, person_id, condition_concept_id, condition_start_date, condition_start_datetime, condition_end_date, condition_end_datetime, condition_type_concept_id, stop_reason, provider_id, visit_occurrence_id, visit_detail_id, condition_source_value, condition_source_concept_id, condition_status_source_value, condition_status_concept_id) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect condition_occurrence' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.condition_occurrence WHERE")
  first <- TRUE
  if (!missing(condition_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_occurrence_id)) {
      statement <- paste0(statement, ' condition_occurrence_id IS NULL')
    } else if (is(condition_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' condition_occurrence_id = (', as.character(condition_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " condition_occurrence_id = '", condition_occurrence_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(condition_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_concept_id)) {
      statement <- paste0(statement, ' condition_concept_id IS NULL')
    } else if (is(condition_concept_id, 'subQuery')){
      statement <- paste0(statement, ' condition_concept_id = (', as.character(condition_concept_id), ')')
    } else {
      statement <- paste0(statement, " condition_concept_id = '", condition_concept_id,"'")
    }
  }

  if (!missing(condition_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_start_date)) {
      statement <- paste0(statement, ' condition_start_date IS NULL')
    } else if (is(condition_start_date, 'subQuery')){
      statement <- paste0(statement, ' condition_start_date = (', as.character(condition_start_date), ')')
    } else {
      statement <- paste0(statement, " condition_start_date = '", condition_start_date,"'")
    }
  }

  if (!missing(condition_start_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_start_datetime)) {
      statement <- paste0(statement, ' condition_start_datetime IS NULL')
    } else if (is(condition_start_datetime, 'subQuery')){
      statement <- paste0(statement, ' condition_start_datetime = (', as.character(condition_start_datetime), ')')
    } else {
      statement <- paste0(statement, " condition_start_datetime = '", condition_start_datetime,"'")
    }
  }

  if (!missing(condition_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_end_date)) {
      statement <- paste0(statement, ' condition_end_date IS NULL')
    } else if (is(condition_end_date, 'subQuery')){
      statement <- paste0(statement, ' condition_end_date = (', as.character(condition_end_date), ')')
    } else {
      statement <- paste0(statement, " condition_end_date = '", condition_end_date,"'")
    }
  }

  if (!missing(condition_end_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_end_datetime)) {
      statement <- paste0(statement, ' condition_end_datetime IS NULL')
    } else if (is(condition_end_datetime, 'subQuery')){
      statement <- paste0(statement, ' condition_end_datetime = (', as.character(condition_end_datetime), ')')
    } else {
      statement <- paste0(statement, " condition_end_datetime = '", condition_end_datetime,"'")
    }
  }

  if (!missing(condition_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_type_concept_id)) {
      statement <- paste0(statement, ' condition_type_concept_id IS NULL')
    } else if (is(condition_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' condition_type_concept_id = (', as.character(condition_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " condition_type_concept_id = '", condition_type_concept_id,"'")
    }
  }

  if (!missing(stop_reason)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(stop_reason)) {
      statement <- paste0(statement, ' stop_reason IS NULL')
    } else if (is(stop_reason, 'subQuery')){
      statement <- paste0(statement, ' stop_reason = (', as.character(stop_reason), ')')
    } else {
      statement <- paste0(statement, " stop_reason = '", stop_reason,"'")
    }
  }

  if (!missing(provider_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_id)) {
      statement <- paste0(statement, ' provider_id IS NULL')
    } else if (is(provider_id, 'subQuery')){
      statement <- paste0(statement, ' provider_id = (', as.character(provider_id), ')')
    } else {
      statement <- paste0(statement, " provider_id = '", provider_id,"'")
    }
  }

  if (!missing(visit_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_occurrence_id)) {
      statement <- paste0(statement, ' visit_occurrence_id IS NULL')
    } else if (is(visit_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' visit_occurrence_id = (', as.character(visit_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " visit_occurrence_id = '", visit_occurrence_id,"'")
    }
  }

  if (!missing(visit_detail_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_detail_id)) {
      statement <- paste0(statement, ' visit_detail_id IS NULL')
    } else if (is(visit_detail_id, 'subQuery')){
      statement <- paste0(statement, ' visit_detail_id = (', as.character(visit_detail_id), ')')
    } else {
      statement <- paste0(statement, " visit_detail_id = '", visit_detail_id,"'")
    }
  }

  if (!missing(condition_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_source_value)) {
      statement <- paste0(statement, ' condition_source_value IS NULL')
    } else if (is(condition_source_value, 'subQuery')){
      statement <- paste0(statement, ' condition_source_value = (', as.character(condition_source_value), ')')
    } else {
      statement <- paste0(statement, " condition_source_value = '", condition_source_value,"'")
    }
  }

  if (!missing(condition_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_source_concept_id)) {
      statement <- paste0(statement, ' condition_source_concept_id IS NULL')
    } else if (is(condition_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' condition_source_concept_id = (', as.character(condition_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " condition_source_concept_id = '", condition_source_concept_id,"'")
    }
  }

  if (!missing(condition_status_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_status_source_value)) {
      statement <- paste0(statement, ' condition_status_source_value IS NULL')
    } else if (is(condition_status_source_value, 'subQuery')){
      statement <- paste0(statement, ' condition_status_source_value = (', as.character(condition_status_source_value), ')')
    } else {
      statement <- paste0(statement, " condition_status_source_value = '", condition_status_source_value,"'")
    }
  }

  if (!missing(condition_status_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_status_concept_id)) {
      statement <- paste0(statement, ' condition_status_concept_id IS NULL')
    } else if (is(condition_status_concept_id, 'subQuery')){
      statement <- paste0(statement, ' condition_status_concept_id = (', as.character(condition_status_concept_id), ')')
    } else {
      statement <- paste0(statement, " condition_status_concept_id = '", condition_status_concept_id,"'")
    }
  }

  statement <- paste0(statement, ') != ', rowCount , " THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_count_death <- function(rowCount, person_id, death_date, death_datetime, death_type_concept_id, cause_concept_id, cause_source_value, cause_source_concept_id) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect death' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.death WHERE")
  first <- TRUE
  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(death_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(death_date)) {
      statement <- paste0(statement, ' death_date IS NULL')
    } else if (is(death_date, 'subQuery')){
      statement <- paste0(statement, ' death_date = (', as.character(death_date), ')')
    } else {
      statement <- paste0(statement, " death_date = '", death_date,"'")
    }
  }

  if (!missing(death_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(death_datetime)) {
      statement <- paste0(statement, ' death_datetime IS NULL')
    } else if (is(death_datetime, 'subQuery')){
      statement <- paste0(statement, ' death_datetime = (', as.character(death_datetime), ')')
    } else {
      statement <- paste0(statement, " death_datetime = '", death_datetime,"'")
    }
  }

  if (!missing(death_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(death_type_concept_id)) {
      statement <- paste0(statement, ' death_type_concept_id IS NULL')
    } else if (is(death_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' death_type_concept_id = (', as.character(death_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " death_type_concept_id = '", death_type_concept_id,"'")
    }
  }

  if (!missing(cause_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cause_concept_id)) {
      statement <- paste0(statement, ' cause_concept_id IS NULL')
    } else if (is(cause_concept_id, 'subQuery')){
      statement <- paste0(statement, ' cause_concept_id = (', as.character(cause_concept_id), ')')
    } else {
      statement <- paste0(statement, " cause_concept_id = '", cause_concept_id,"'")
    }
  }

  if (!missing(cause_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cause_source_value)) {
      statement <- paste0(statement, ' cause_source_value IS NULL')
    } else if (is(cause_source_value, 'subQuery')){
      statement <- paste0(statement, ' cause_source_value = (', as.character(cause_source_value), ')')
    } else {
      statement <- paste0(statement, " cause_source_value = '", cause_source_value,"'")
    }
  }

  if (!missing(cause_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cause_source_concept_id)) {
      statement <- paste0(statement, ' cause_source_concept_id IS NULL')
    } else if (is(cause_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' cause_source_concept_id = (', as.character(cause_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " cause_source_concept_id = '", cause_source_concept_id,"'")
    }
  }

  statement <- paste0(statement, ') != ', rowCount , " THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_count_device_exposure <- function(rowCount, device_exposure_id, person_id, device_concept_id, device_exposure_start_date, device_exposure_start_datetime, device_exposure_end_date, device_exposure_end_datetime, device_type_concept_id, unique_device_id, quantity, provider_id, visit_occurrence_id, device_source_value, device_source__concept_id, visit_detail_id) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect device_exposure' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.device_exposure WHERE")
  first <- TRUE
  if (!missing(device_exposure_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(device_exposure_id)) {
      statement <- paste0(statement, ' device_exposure_id IS NULL')
    } else if (is(device_exposure_id, 'subQuery')){
      statement <- paste0(statement, ' device_exposure_id = (', as.character(device_exposure_id), ')')
    } else {
      statement <- paste0(statement, " device_exposure_id = '", device_exposure_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(device_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(device_concept_id)) {
      statement <- paste0(statement, ' device_concept_id IS NULL')
    } else if (is(device_concept_id, 'subQuery')){
      statement <- paste0(statement, ' device_concept_id = (', as.character(device_concept_id), ')')
    } else {
      statement <- paste0(statement, " device_concept_id = '", device_concept_id,"'")
    }
  }

  if (!missing(device_exposure_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(device_exposure_start_date)) {
      statement <- paste0(statement, ' device_exposure_start_date IS NULL')
    } else if (is(device_exposure_start_date, 'subQuery')){
      statement <- paste0(statement, ' device_exposure_start_date = (', as.character(device_exposure_start_date), ')')
    } else {
      statement <- paste0(statement, " device_exposure_start_date = '", device_exposure_start_date,"'")
    }
  }

  if (!missing(device_exposure_start_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(device_exposure_start_datetime)) {
      statement <- paste0(statement, ' device_exposure_start_datetime IS NULL')
    } else if (is(device_exposure_start_datetime, 'subQuery')){
      statement <- paste0(statement, ' device_exposure_start_datetime = (', as.character(device_exposure_start_datetime), ')')
    } else {
      statement <- paste0(statement, " device_exposure_start_datetime = '", device_exposure_start_datetime,"'")
    }
  }

  if (!missing(device_exposure_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(device_exposure_end_date)) {
      statement <- paste0(statement, ' device_exposure_end_date IS NULL')
    } else if (is(device_exposure_end_date, 'subQuery')){
      statement <- paste0(statement, ' device_exposure_end_date = (', as.character(device_exposure_end_date), ')')
    } else {
      statement <- paste0(statement, " device_exposure_end_date = '", device_exposure_end_date,"'")
    }
  }

  if (!missing(device_exposure_end_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(device_exposure_end_datetime)) {
      statement <- paste0(statement, ' device_exposure_end_datetime IS NULL')
    } else if (is(device_exposure_end_datetime, 'subQuery')){
      statement <- paste0(statement, ' device_exposure_end_datetime = (', as.character(device_exposure_end_datetime), ')')
    } else {
      statement <- paste0(statement, " device_exposure_end_datetime = '", device_exposure_end_datetime,"'")
    }
  }

  if (!missing(device_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(device_type_concept_id)) {
      statement <- paste0(statement, ' device_type_concept_id IS NULL')
    } else if (is(device_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' device_type_concept_id = (', as.character(device_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " device_type_concept_id = '", device_type_concept_id,"'")
    }
  }

  if (!missing(unique_device_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(unique_device_id)) {
      statement <- paste0(statement, ' unique_device_id IS NULL')
    } else if (is(unique_device_id, 'subQuery')){
      statement <- paste0(statement, ' unique_device_id = (', as.character(unique_device_id), ')')
    } else {
      statement <- paste0(statement, " unique_device_id = '", unique_device_id,"'")
    }
  }

  if (!missing(quantity)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(quantity)) {
      statement <- paste0(statement, ' quantity IS NULL')
    } else if (is(quantity, 'subQuery')){
      statement <- paste0(statement, ' quantity = (', as.character(quantity), ')')
    } else {
      statement <- paste0(statement, " quantity = '", quantity,"'")
    }
  }

  if (!missing(provider_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_id)) {
      statement <- paste0(statement, ' provider_id IS NULL')
    } else if (is(provider_id, 'subQuery')){
      statement <- paste0(statement, ' provider_id = (', as.character(provider_id), ')')
    } else {
      statement <- paste0(statement, " provider_id = '", provider_id,"'")
    }
  }

  if (!missing(visit_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_occurrence_id)) {
      statement <- paste0(statement, ' visit_occurrence_id IS NULL')
    } else if (is(visit_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' visit_occurrence_id = (', as.character(visit_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " visit_occurrence_id = '", visit_occurrence_id,"'")
    }
  }

  if (!missing(device_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(device_source_value)) {
      statement <- paste0(statement, ' device_source_value IS NULL')
    } else if (is(device_source_value, 'subQuery')){
      statement <- paste0(statement, ' device_source_value = (', as.character(device_source_value), ')')
    } else {
      statement <- paste0(statement, " device_source_value = '", device_source_value,"'")
    }
  }

  if (!missing(device_source__concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(device_source__concept_id)) {
      statement <- paste0(statement, ' [device_source_ concept_id] IS NULL')
    } else if (is(device_source__concept_id, 'subQuery')){
      statement <- paste0(statement, ' [device_source_ concept_id] = (', as.character(device_source__concept_id), ')')
    } else {
      statement <- paste0(statement, " [device_source_ concept_id] = '", device_source__concept_id,"'")
    }
  }

  if (!missing(visit_detail_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_detail_id)) {
      statement <- paste0(statement, ' visit_detail_id IS NULL')
    } else if (is(visit_detail_id, 'subQuery')){
      statement <- paste0(statement, ' visit_detail_id = (', as.character(visit_detail_id), ')')
    } else {
      statement <- paste0(statement, " visit_detail_id = '", visit_detail_id,"'")
    }
  }

  statement <- paste0(statement, ') != ', rowCount , " THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_count_drug_exposure <- function(rowCount, drug_exposure_id, person_id, drug_concept_id, drug_exposure_start_date, drug_exposure_start_datetime, drug_exposure_end_date, drug_exposure_end_datetime, verbatim_end_date, drug_type_concept_id, stop_reason, refills, quantity, days_supply, sig, route_concept_id, lot_number, provider_id, visit_occurrence_id, drug_source_value, drug_source_concept_id, route_source_value, dose_unit_source_value, visit_detail_id) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect drug_exposure' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.drug_exposure WHERE")
  first <- TRUE
  if (!missing(drug_exposure_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_exposure_id)) {
      statement <- paste0(statement, ' drug_exposure_id IS NULL')
    } else if (is(drug_exposure_id, 'subQuery')){
      statement <- paste0(statement, ' drug_exposure_id = (', as.character(drug_exposure_id), ')')
    } else {
      statement <- paste0(statement, " drug_exposure_id = '", drug_exposure_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(drug_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_concept_id)) {
      statement <- paste0(statement, ' drug_concept_id IS NULL')
    } else if (is(drug_concept_id, 'subQuery')){
      statement <- paste0(statement, ' drug_concept_id = (', as.character(drug_concept_id), ')')
    } else {
      statement <- paste0(statement, " drug_concept_id = '", drug_concept_id,"'")
    }
  }

  if (!missing(drug_exposure_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_exposure_start_date)) {
      statement <- paste0(statement, ' drug_exposure_start_date IS NULL')
    } else if (is(drug_exposure_start_date, 'subQuery')){
      statement <- paste0(statement, ' drug_exposure_start_date = (', as.character(drug_exposure_start_date), ')')
    } else {
      statement <- paste0(statement, " drug_exposure_start_date = '", drug_exposure_start_date,"'")
    }
  }

  if (!missing(drug_exposure_start_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_exposure_start_datetime)) {
      statement <- paste0(statement, ' drug_exposure_start_datetime IS NULL')
    } else if (is(drug_exposure_start_datetime, 'subQuery')){
      statement <- paste0(statement, ' drug_exposure_start_datetime = (', as.character(drug_exposure_start_datetime), ')')
    } else {
      statement <- paste0(statement, " drug_exposure_start_datetime = '", drug_exposure_start_datetime,"'")
    }
  }

  if (!missing(drug_exposure_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_exposure_end_date)) {
      statement <- paste0(statement, ' drug_exposure_end_date IS NULL')
    } else if (is(drug_exposure_end_date, 'subQuery')){
      statement <- paste0(statement, ' drug_exposure_end_date = (', as.character(drug_exposure_end_date), ')')
    } else {
      statement <- paste0(statement, " drug_exposure_end_date = '", drug_exposure_end_date,"'")
    }
  }

  if (!missing(drug_exposure_end_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_exposure_end_datetime)) {
      statement <- paste0(statement, ' drug_exposure_end_datetime IS NULL')
    } else if (is(drug_exposure_end_datetime, 'subQuery')){
      statement <- paste0(statement, ' drug_exposure_end_datetime = (', as.character(drug_exposure_end_datetime), ')')
    } else {
      statement <- paste0(statement, " drug_exposure_end_datetime = '", drug_exposure_end_datetime,"'")
    }
  }

  if (!missing(verbatim_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(verbatim_end_date)) {
      statement <- paste0(statement, ' verbatim_end_date IS NULL')
    } else if (is(verbatim_end_date, 'subQuery')){
      statement <- paste0(statement, ' verbatim_end_date = (', as.character(verbatim_end_date), ')')
    } else {
      statement <- paste0(statement, " verbatim_end_date = '", verbatim_end_date,"'")
    }
  }

  if (!missing(drug_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_type_concept_id)) {
      statement <- paste0(statement, ' drug_type_concept_id IS NULL')
    } else if (is(drug_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' drug_type_concept_id = (', as.character(drug_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " drug_type_concept_id = '", drug_type_concept_id,"'")
    }
  }

  if (!missing(stop_reason)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(stop_reason)) {
      statement <- paste0(statement, ' stop_reason IS NULL')
    } else if (is(stop_reason, 'subQuery')){
      statement <- paste0(statement, ' stop_reason = (', as.character(stop_reason), ')')
    } else {
      statement <- paste0(statement, " stop_reason = '", stop_reason,"'")
    }
  }

  if (!missing(refills)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(refills)) {
      statement <- paste0(statement, ' refills IS NULL')
    } else if (is(refills, 'subQuery')){
      statement <- paste0(statement, ' refills = (', as.character(refills), ')')
    } else {
      statement <- paste0(statement, " refills = '", refills,"'")
    }
  }

  if (!missing(quantity)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(quantity)) {
      statement <- paste0(statement, ' quantity IS NULL')
    } else if (is(quantity, 'subQuery')){
      statement <- paste0(statement, ' quantity = (', as.character(quantity), ')')
    } else {
      statement <- paste0(statement, " quantity = '", quantity,"'")
    }
  }

  if (!missing(days_supply)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(days_supply)) {
      statement <- paste0(statement, ' days_supply IS NULL')
    } else if (is(days_supply, 'subQuery')){
      statement <- paste0(statement, ' days_supply = (', as.character(days_supply), ')')
    } else {
      statement <- paste0(statement, " days_supply = '", days_supply,"'")
    }
  }

  if (!missing(sig)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(sig)) {
      statement <- paste0(statement, ' sig IS NULL')
    } else if (is(sig, 'subQuery')){
      statement <- paste0(statement, ' sig = (', as.character(sig), ')')
    } else {
      statement <- paste0(statement, " sig = '", sig,"'")
    }
  }

  if (!missing(route_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(route_concept_id)) {
      statement <- paste0(statement, ' route_concept_id IS NULL')
    } else if (is(route_concept_id, 'subQuery')){
      statement <- paste0(statement, ' route_concept_id = (', as.character(route_concept_id), ')')
    } else {
      statement <- paste0(statement, " route_concept_id = '", route_concept_id,"'")
    }
  }

  if (!missing(lot_number)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(lot_number)) {
      statement <- paste0(statement, ' lot_number IS NULL')
    } else if (is(lot_number, 'subQuery')){
      statement <- paste0(statement, ' lot_number = (', as.character(lot_number), ')')
    } else {
      statement <- paste0(statement, " lot_number = '", lot_number,"'")
    }
  }

  if (!missing(provider_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_id)) {
      statement <- paste0(statement, ' provider_id IS NULL')
    } else if (is(provider_id, 'subQuery')){
      statement <- paste0(statement, ' provider_id = (', as.character(provider_id), ')')
    } else {
      statement <- paste0(statement, " provider_id = '", provider_id,"'")
    }
  }

  if (!missing(visit_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_occurrence_id)) {
      statement <- paste0(statement, ' visit_occurrence_id IS NULL')
    } else if (is(visit_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' visit_occurrence_id = (', as.character(visit_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " visit_occurrence_id = '", visit_occurrence_id,"'")
    }
  }

  if (!missing(drug_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_source_value)) {
      statement <- paste0(statement, ' drug_source_value IS NULL')
    } else if (is(drug_source_value, 'subQuery')){
      statement <- paste0(statement, ' drug_source_value = (', as.character(drug_source_value), ')')
    } else {
      statement <- paste0(statement, " drug_source_value = '", drug_source_value,"'")
    }
  }

  if (!missing(drug_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_source_concept_id)) {
      statement <- paste0(statement, ' drug_source_concept_id IS NULL')
    } else if (is(drug_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' drug_source_concept_id = (', as.character(drug_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " drug_source_concept_id = '", drug_source_concept_id,"'")
    }
  }

  if (!missing(route_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(route_source_value)) {
      statement <- paste0(statement, ' route_source_value IS NULL')
    } else if (is(route_source_value, 'subQuery')){
      statement <- paste0(statement, ' route_source_value = (', as.character(route_source_value), ')')
    } else {
      statement <- paste0(statement, " route_source_value = '", route_source_value,"'")
    }
  }

  if (!missing(dose_unit_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(dose_unit_source_value)) {
      statement <- paste0(statement, ' dose_unit_source_value IS NULL')
    } else if (is(dose_unit_source_value, 'subQuery')){
      statement <- paste0(statement, ' dose_unit_source_value = (', as.character(dose_unit_source_value), ')')
    } else {
      statement <- paste0(statement, " dose_unit_source_value = '", dose_unit_source_value,"'")
    }
  }

  if (!missing(visit_detail_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_detail_id)) {
      statement <- paste0(statement, ' visit_detail_id IS NULL')
    } else if (is(visit_detail_id, 'subQuery')){
      statement <- paste0(statement, ' visit_detail_id = (', as.character(visit_detail_id), ')')
    } else {
      statement <- paste0(statement, " visit_detail_id = '", visit_detail_id,"'")
    }
  }

  statement <- paste0(statement, ') != ', rowCount , " THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_count_fact_relationship <- function(rowCount, domain_concept_id_1, fact_id_1, domain_concept_id_2, fact_id_2, relationship_concept_id) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect fact_relationship' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.fact_relationship WHERE")
  first <- TRUE
  if (!missing(domain_concept_id_1)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(domain_concept_id_1)) {
      statement <- paste0(statement, ' domain_concept_id_1 IS NULL')
    } else if (is(domain_concept_id_1, 'subQuery')){
      statement <- paste0(statement, ' domain_concept_id_1 = (', as.character(domain_concept_id_1), ')')
    } else {
      statement <- paste0(statement, " domain_concept_id_1 = '", domain_concept_id_1,"'")
    }
  }

  if (!missing(fact_id_1)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(fact_id_1)) {
      statement <- paste0(statement, ' fact_id_1 IS NULL')
    } else if (is(fact_id_1, 'subQuery')){
      statement <- paste0(statement, ' fact_id_1 = (', as.character(fact_id_1), ')')
    } else {
      statement <- paste0(statement, " fact_id_1 = '", fact_id_1,"'")
    }
  }

  if (!missing(domain_concept_id_2)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(domain_concept_id_2)) {
      statement <- paste0(statement, ' domain_concept_id_2 IS NULL')
    } else if (is(domain_concept_id_2, 'subQuery')){
      statement <- paste0(statement, ' domain_concept_id_2 = (', as.character(domain_concept_id_2), ')')
    } else {
      statement <- paste0(statement, " domain_concept_id_2 = '", domain_concept_id_2,"'")
    }
  }

  if (!missing(fact_id_2)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(fact_id_2)) {
      statement <- paste0(statement, ' fact_id_2 IS NULL')
    } else if (is(fact_id_2, 'subQuery')){
      statement <- paste0(statement, ' fact_id_2 = (', as.character(fact_id_2), ')')
    } else {
      statement <- paste0(statement, " fact_id_2 = '", fact_id_2,"'")
    }
  }

  if (!missing(relationship_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(relationship_concept_id)) {
      statement <- paste0(statement, ' relationship_concept_id IS NULL')
    } else if (is(relationship_concept_id, 'subQuery')){
      statement <- paste0(statement, ' relationship_concept_id = (', as.character(relationship_concept_id), ')')
    } else {
      statement <- paste0(statement, " relationship_concept_id = '", relationship_concept_id,"'")
    }
  }

  statement <- paste0(statement, ') != ', rowCount , " THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_count_measurement <- function(rowCount, measurement_id, person_id, measurement_concept_id, measurement_date, measurement_datetime, measurement_type_concept_id, operator_concept_id, value_as_number, value_as_concept_id, unit_concept_id, range_low, range_high, provider_id, visit_occurrence_id, visit_detail_id, measurement_source_value, measurement_source_concept_id, unit_source_value, value_source_value) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect measurement' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.measurement WHERE")
  first <- TRUE
  if (!missing(measurement_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(measurement_id)) {
      statement <- paste0(statement, ' measurement_id IS NULL')
    } else if (is(measurement_id, 'subQuery')){
      statement <- paste0(statement, ' measurement_id = (', as.character(measurement_id), ')')
    } else {
      statement <- paste0(statement, " measurement_id = '", measurement_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(measurement_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(measurement_concept_id)) {
      statement <- paste0(statement, ' measurement_concept_id IS NULL')
    } else if (is(measurement_concept_id, 'subQuery')){
      statement <- paste0(statement, ' measurement_concept_id = (', as.character(measurement_concept_id), ')')
    } else {
      statement <- paste0(statement, " measurement_concept_id = '", measurement_concept_id,"'")
    }
  }

  if (!missing(measurement_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(measurement_date)) {
      statement <- paste0(statement, ' measurement_date IS NULL')
    } else if (is(measurement_date, 'subQuery')){
      statement <- paste0(statement, ' measurement_date = (', as.character(measurement_date), ')')
    } else {
      statement <- paste0(statement, " measurement_date = '", measurement_date,"'")
    }
  }

  if (!missing(measurement_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(measurement_datetime)) {
      statement <- paste0(statement, ' measurement_datetime IS NULL')
    } else if (is(measurement_datetime, 'subQuery')){
      statement <- paste0(statement, ' measurement_datetime = (', as.character(measurement_datetime), ')')
    } else {
      statement <- paste0(statement, " measurement_datetime = '", measurement_datetime,"'")
    }
  }

  if (!missing(measurement_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(measurement_type_concept_id)) {
      statement <- paste0(statement, ' measurement_type_concept_id IS NULL')
    } else if (is(measurement_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' measurement_type_concept_id = (', as.character(measurement_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " measurement_type_concept_id = '", measurement_type_concept_id,"'")
    }
  }

  if (!missing(operator_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(operator_concept_id)) {
      statement <- paste0(statement, ' operator_concept_id IS NULL')
    } else if (is(operator_concept_id, 'subQuery')){
      statement <- paste0(statement, ' operator_concept_id = (', as.character(operator_concept_id), ')')
    } else {
      statement <- paste0(statement, " operator_concept_id = '", operator_concept_id,"'")
    }
  }

  if (!missing(value_as_number)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(value_as_number)) {
      statement <- paste0(statement, ' value_as_number IS NULL')
    } else if (is(value_as_number, 'subQuery')){
      statement <- paste0(statement, ' value_as_number = (', as.character(value_as_number), ')')
    } else {
      statement <- paste0(statement, " value_as_number = '", value_as_number,"'")
    }
  }

  if (!missing(value_as_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(value_as_concept_id)) {
      statement <- paste0(statement, ' value_as_concept_id IS NULL')
    } else if (is(value_as_concept_id, 'subQuery')){
      statement <- paste0(statement, ' value_as_concept_id = (', as.character(value_as_concept_id), ')')
    } else {
      statement <- paste0(statement, " value_as_concept_id = '", value_as_concept_id,"'")
    }
  }

  if (!missing(unit_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(unit_concept_id)) {
      statement <- paste0(statement, ' unit_concept_id IS NULL')
    } else if (is(unit_concept_id, 'subQuery')){
      statement <- paste0(statement, ' unit_concept_id = (', as.character(unit_concept_id), ')')
    } else {
      statement <- paste0(statement, " unit_concept_id = '", unit_concept_id,"'")
    }
  }

  if (!missing(range_low)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(range_low)) {
      statement <- paste0(statement, ' range_low IS NULL')
    } else if (is(range_low, 'subQuery')){
      statement <- paste0(statement, ' range_low = (', as.character(range_low), ')')
    } else {
      statement <- paste0(statement, " range_low = '", range_low,"'")
    }
  }

  if (!missing(range_high)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(range_high)) {
      statement <- paste0(statement, ' range_high IS NULL')
    } else if (is(range_high, 'subQuery')){
      statement <- paste0(statement, ' range_high = (', as.character(range_high), ')')
    } else {
      statement <- paste0(statement, " range_high = '", range_high,"'")
    }
  }

  if (!missing(provider_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_id)) {
      statement <- paste0(statement, ' provider_id IS NULL')
    } else if (is(provider_id, 'subQuery')){
      statement <- paste0(statement, ' provider_id = (', as.character(provider_id), ')')
    } else {
      statement <- paste0(statement, " provider_id = '", provider_id,"'")
    }
  }

  if (!missing(visit_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_occurrence_id)) {
      statement <- paste0(statement, ' visit_occurrence_id IS NULL')
    } else if (is(visit_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' visit_occurrence_id = (', as.character(visit_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " visit_occurrence_id = '", visit_occurrence_id,"'")
    }
  }

  if (!missing(visit_detail_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_detail_id)) {
      statement <- paste0(statement, ' visit_detail_id IS NULL')
    } else if (is(visit_detail_id, 'subQuery')){
      statement <- paste0(statement, ' visit_detail_id = (', as.character(visit_detail_id), ')')
    } else {
      statement <- paste0(statement, " visit_detail_id = '", visit_detail_id,"'")
    }
  }

  if (!missing(measurement_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(measurement_source_value)) {
      statement <- paste0(statement, ' measurement_source_value IS NULL')
    } else if (is(measurement_source_value, 'subQuery')){
      statement <- paste0(statement, ' measurement_source_value = (', as.character(measurement_source_value), ')')
    } else {
      statement <- paste0(statement, " measurement_source_value = '", measurement_source_value,"'")
    }
  }

  if (!missing(measurement_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(measurement_source_concept_id)) {
      statement <- paste0(statement, ' measurement_source_concept_id IS NULL')
    } else if (is(measurement_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' measurement_source_concept_id = (', as.character(measurement_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " measurement_source_concept_id = '", measurement_source_concept_id,"'")
    }
  }

  if (!missing(unit_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(unit_source_value)) {
      statement <- paste0(statement, ' unit_source_value IS NULL')
    } else if (is(unit_source_value, 'subQuery')){
      statement <- paste0(statement, ' unit_source_value = (', as.character(unit_source_value), ')')
    } else {
      statement <- paste0(statement, " unit_source_value = '", unit_source_value,"'")
    }
  }

  if (!missing(value_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(value_source_value)) {
      statement <- paste0(statement, ' value_source_value IS NULL')
    } else if (is(value_source_value, 'subQuery')){
      statement <- paste0(statement, ' value_source_value = (', as.character(value_source_value), ')')
    } else {
      statement <- paste0(statement, " value_source_value = '", value_source_value,"'")
    }
  }

  statement <- paste0(statement, ') != ', rowCount , " THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_count_note <- function(rowCount, note_id, person_id, note_date, note_datetime, note_type_concept_id, note_class_concept_id, note_title, note_text, encoding_concept_id, language_concept_id, provider_id, note_source_value, visit_occurrence_id) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect note' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.note WHERE")
  first <- TRUE
  if (!missing(note_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_id)) {
      statement <- paste0(statement, ' note_id IS NULL')
    } else if (is(note_id, 'subQuery')){
      statement <- paste0(statement, ' note_id = (', as.character(note_id), ')')
    } else {
      statement <- paste0(statement, " note_id = '", note_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(note_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_date)) {
      statement <- paste0(statement, ' note_date IS NULL')
    } else if (is(note_date, 'subQuery')){
      statement <- paste0(statement, ' note_date = (', as.character(note_date), ')')
    } else {
      statement <- paste0(statement, " note_date = '", note_date,"'")
    }
  }

  if (!missing(note_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_datetime)) {
      statement <- paste0(statement, ' note_datetime IS NULL')
    } else if (is(note_datetime, 'subQuery')){
      statement <- paste0(statement, ' note_datetime = (', as.character(note_datetime), ')')
    } else {
      statement <- paste0(statement, " note_datetime = '", note_datetime,"'")
    }
  }

  if (!missing(note_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_type_concept_id)) {
      statement <- paste0(statement, ' note_type_concept_id IS NULL')
    } else if (is(note_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' note_type_concept_id = (', as.character(note_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " note_type_concept_id = '", note_type_concept_id,"'")
    }
  }

  if (!missing(note_class_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_class_concept_id)) {
      statement <- paste0(statement, ' note_class_concept_id IS NULL')
    } else if (is(note_class_concept_id, 'subQuery')){
      statement <- paste0(statement, ' note_class_concept_id = (', as.character(note_class_concept_id), ')')
    } else {
      statement <- paste0(statement, " note_class_concept_id = '", note_class_concept_id,"'")
    }
  }

  if (!missing(note_title)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_title)) {
      statement <- paste0(statement, ' note_title IS NULL')
    } else if (is(note_title, 'subQuery')){
      statement <- paste0(statement, ' note_title = (', as.character(note_title), ')')
    } else {
      statement <- paste0(statement, " note_title = '", note_title,"'")
    }
  }

  if (!missing(note_text)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_text)) {
      statement <- paste0(statement, ' note_text IS NULL')
    } else if (is(note_text, 'subQuery')){
      statement <- paste0(statement, ' note_text = (', as.character(note_text), ')')
    } else {
      statement <- paste0(statement, " note_text = '", note_text,"'")
    }
  }

  if (!missing(encoding_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(encoding_concept_id)) {
      statement <- paste0(statement, ' encoding_concept_id IS NULL')
    } else if (is(encoding_concept_id, 'subQuery')){
      statement <- paste0(statement, ' encoding_concept_id = (', as.character(encoding_concept_id), ')')
    } else {
      statement <- paste0(statement, " encoding_concept_id = '", encoding_concept_id,"'")
    }
  }

  if (!missing(language_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(language_concept_id)) {
      statement <- paste0(statement, ' language_concept_id IS NULL')
    } else if (is(language_concept_id, 'subQuery')){
      statement <- paste0(statement, ' language_concept_id = (', as.character(language_concept_id), ')')
    } else {
      statement <- paste0(statement, " language_concept_id = '", language_concept_id,"'")
    }
  }

  if (!missing(provider_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_id)) {
      statement <- paste0(statement, ' provider_id IS NULL')
    } else if (is(provider_id, 'subQuery')){
      statement <- paste0(statement, ' provider_id = (', as.character(provider_id), ')')
    } else {
      statement <- paste0(statement, " provider_id = '", provider_id,"'")
    }
  }

  if (!missing(note_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_source_value)) {
      statement <- paste0(statement, ' note_source_value IS NULL')
    } else if (is(note_source_value, 'subQuery')){
      statement <- paste0(statement, ' note_source_value = (', as.character(note_source_value), ')')
    } else {
      statement <- paste0(statement, " note_source_value = '", note_source_value,"'")
    }
  }

  if (!missing(visit_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_occurrence_id)) {
      statement <- paste0(statement, ' visit_occurrence_id IS NULL')
    } else if (is(visit_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' visit_occurrence_id = (', as.character(visit_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " visit_occurrence_id = '", visit_occurrence_id,"'")
    }
  }

  statement <- paste0(statement, ') != ', rowCount , " THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_count_note_nlp <- function(rowCount, note_nlp_id, note_id, section_concept_id, snippet, offset, lexical_variant, note_nlp_concept_id, note_nlp_source_concept_id, nlp_system, nlp_date, nlp_date_time, term_exists, term_temporal, term_modifiers) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect note_nlp' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.note_nlp WHERE")
  first <- TRUE
  if (!missing(note_nlp_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_nlp_id)) {
      statement <- paste0(statement, ' note_nlp_id IS NULL')
    } else if (is(note_nlp_id, 'subQuery')){
      statement <- paste0(statement, ' note_nlp_id = (', as.character(note_nlp_id), ')')
    } else {
      statement <- paste0(statement, " note_nlp_id = '", note_nlp_id,"'")
    }
  }

  if (!missing(note_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_id)) {
      statement <- paste0(statement, ' note_id IS NULL')
    } else if (is(note_id, 'subQuery')){
      statement <- paste0(statement, ' note_id = (', as.character(note_id), ')')
    } else {
      statement <- paste0(statement, " note_id = '", note_id,"'")
    }
  }

  if (!missing(section_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(section_concept_id)) {
      statement <- paste0(statement, ' section_concept_id IS NULL')
    } else if (is(section_concept_id, 'subQuery')){
      statement <- paste0(statement, ' section_concept_id = (', as.character(section_concept_id), ')')
    } else {
      statement <- paste0(statement, " section_concept_id = '", section_concept_id,"'")
    }
  }

  if (!missing(snippet)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(snippet)) {
      statement <- paste0(statement, ' snippet IS NULL')
    } else if (is(snippet, 'subQuery')){
      statement <- paste0(statement, ' snippet = (', as.character(snippet), ')')
    } else {
      statement <- paste0(statement, " snippet = '", snippet,"'")
    }
  }

  if (!missing(offset)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(offset)) {
      statement <- paste0(statement, ' offset IS NULL')
    } else if (is(offset, 'subQuery')){
      statement <- paste0(statement, ' offset = (', as.character(offset), ')')
    } else {
      statement <- paste0(statement, " offset = '", offset,"'")
    }
  }

  if (!missing(lexical_variant)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(lexical_variant)) {
      statement <- paste0(statement, ' lexical_variant IS NULL')
    } else if (is(lexical_variant, 'subQuery')){
      statement <- paste0(statement, ' lexical_variant = (', as.character(lexical_variant), ')')
    } else {
      statement <- paste0(statement, " lexical_variant = '", lexical_variant,"'")
    }
  }

  if (!missing(note_nlp_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_nlp_concept_id)) {
      statement <- paste0(statement, ' note_nlp_concept_id IS NULL')
    } else if (is(note_nlp_concept_id, 'subQuery')){
      statement <- paste0(statement, ' note_nlp_concept_id = (', as.character(note_nlp_concept_id), ')')
    } else {
      statement <- paste0(statement, " note_nlp_concept_id = '", note_nlp_concept_id,"'")
    }
  }

  if (!missing(note_nlp_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_nlp_source_concept_id)) {
      statement <- paste0(statement, ' note_nlp_source_concept_id IS NULL')
    } else if (is(note_nlp_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' note_nlp_source_concept_id = (', as.character(note_nlp_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " note_nlp_source_concept_id = '", note_nlp_source_concept_id,"'")
    }
  }

  if (!missing(nlp_system)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(nlp_system)) {
      statement <- paste0(statement, ' nlp_system IS NULL')
    } else if (is(nlp_system, 'subQuery')){
      statement <- paste0(statement, ' nlp_system = (', as.character(nlp_system), ')')
    } else {
      statement <- paste0(statement, " nlp_system = '", nlp_system,"'")
    }
  }

  if (!missing(nlp_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(nlp_date)) {
      statement <- paste0(statement, ' nlp_date IS NULL')
    } else if (is(nlp_date, 'subQuery')){
      statement <- paste0(statement, ' nlp_date = (', as.character(nlp_date), ')')
    } else {
      statement <- paste0(statement, " nlp_date = '", nlp_date,"'")
    }
  }

  if (!missing(nlp_date_time)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(nlp_date_time)) {
      statement <- paste0(statement, ' nlp_date_time IS NULL')
    } else if (is(nlp_date_time, 'subQuery')){
      statement <- paste0(statement, ' nlp_date_time = (', as.character(nlp_date_time), ')')
    } else {
      statement <- paste0(statement, " nlp_date_time = '", nlp_date_time,"'")
    }
  }

  if (!missing(term_exists)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(term_exists)) {
      statement <- paste0(statement, ' term_exists IS NULL')
    } else if (is(term_exists, 'subQuery')){
      statement <- paste0(statement, ' term_exists = (', as.character(term_exists), ')')
    } else {
      statement <- paste0(statement, " term_exists = '", term_exists,"'")
    }
  }

  if (!missing(term_temporal)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(term_temporal)) {
      statement <- paste0(statement, ' term_temporal IS NULL')
    } else if (is(term_temporal, 'subQuery')){
      statement <- paste0(statement, ' term_temporal = (', as.character(term_temporal), ')')
    } else {
      statement <- paste0(statement, " term_temporal = '", term_temporal,"'")
    }
  }

  if (!missing(term_modifiers)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(term_modifiers)) {
      statement <- paste0(statement, ' term_modifiers IS NULL')
    } else if (is(term_modifiers, 'subQuery')){
      statement <- paste0(statement, ' term_modifiers = (', as.character(term_modifiers), ')')
    } else {
      statement <- paste0(statement, " term_modifiers = '", term_modifiers,"'")
    }
  }

  statement <- paste0(statement, ') != ', rowCount , " THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_count_observation <- function(rowCount, observation_id, person_id, observation_concept_id, observation_date, observation_datetime, observation_type_concept_id, value_as_number, value_as_string, value_as_concept_id, qualifier_concept_id, unit_concept_id, provider_id, visit_occurrence_id, visit_detail_id, observation_source_value, observation_source_concept_id, unit_source_value, qualifier_source_value) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect observation' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.observation WHERE")
  first <- TRUE
  if (!missing(observation_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(observation_id)) {
      statement <- paste0(statement, ' observation_id IS NULL')
    } else if (is(observation_id, 'subQuery')){
      statement <- paste0(statement, ' observation_id = (', as.character(observation_id), ')')
    } else {
      statement <- paste0(statement, " observation_id = '", observation_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(observation_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(observation_concept_id)) {
      statement <- paste0(statement, ' observation_concept_id IS NULL')
    } else if (is(observation_concept_id, 'subQuery')){
      statement <- paste0(statement, ' observation_concept_id = (', as.character(observation_concept_id), ')')
    } else {
      statement <- paste0(statement, " observation_concept_id = '", observation_concept_id,"'")
    }
  }

  if (!missing(observation_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(observation_date)) {
      statement <- paste0(statement, ' observation_date IS NULL')
    } else if (is(observation_date, 'subQuery')){
      statement <- paste0(statement, ' observation_date = (', as.character(observation_date), ')')
    } else {
      statement <- paste0(statement, " observation_date = '", observation_date,"'")
    }
  }

  if (!missing(observation_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(observation_datetime)) {
      statement <- paste0(statement, ' observation_datetime IS NULL')
    } else if (is(observation_datetime, 'subQuery')){
      statement <- paste0(statement, ' observation_datetime = (', as.character(observation_datetime), ')')
    } else {
      statement <- paste0(statement, " observation_datetime = '", observation_datetime,"'")
    }
  }

  if (!missing(observation_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(observation_type_concept_id)) {
      statement <- paste0(statement, ' observation_type_concept_id IS NULL')
    } else if (is(observation_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' observation_type_concept_id = (', as.character(observation_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " observation_type_concept_id = '", observation_type_concept_id,"'")
    }
  }

  if (!missing(value_as_number)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(value_as_number)) {
      statement <- paste0(statement, ' value_as_number IS NULL')
    } else if (is(value_as_number, 'subQuery')){
      statement <- paste0(statement, ' value_as_number = (', as.character(value_as_number), ')')
    } else {
      statement <- paste0(statement, " value_as_number = '", value_as_number,"'")
    }
  }

  if (!missing(value_as_string)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(value_as_string)) {
      statement <- paste0(statement, ' value_as_string IS NULL')
    } else if (is(value_as_string, 'subQuery')){
      statement <- paste0(statement, ' value_as_string = (', as.character(value_as_string), ')')
    } else {
      statement <- paste0(statement, " value_as_string = '", value_as_string,"'")
    }
  }

  if (!missing(value_as_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(value_as_concept_id)) {
      statement <- paste0(statement, ' value_as_concept_id IS NULL')
    } else if (is(value_as_concept_id, 'subQuery')){
      statement <- paste0(statement, ' value_as_concept_id = (', as.character(value_as_concept_id), ')')
    } else {
      statement <- paste0(statement, " value_as_concept_id = '", value_as_concept_id,"'")
    }
  }

  if (!missing(qualifier_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(qualifier_concept_id)) {
      statement <- paste0(statement, ' qualifier_concept_id IS NULL')
    } else if (is(qualifier_concept_id, 'subQuery')){
      statement <- paste0(statement, ' qualifier_concept_id = (', as.character(qualifier_concept_id), ')')
    } else {
      statement <- paste0(statement, " qualifier_concept_id = '", qualifier_concept_id,"'")
    }
  }

  if (!missing(unit_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(unit_concept_id)) {
      statement <- paste0(statement, ' unit_concept_id IS NULL')
    } else if (is(unit_concept_id, 'subQuery')){
      statement <- paste0(statement, ' unit_concept_id = (', as.character(unit_concept_id), ')')
    } else {
      statement <- paste0(statement, " unit_concept_id = '", unit_concept_id,"'")
    }
  }

  if (!missing(provider_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_id)) {
      statement <- paste0(statement, ' provider_id IS NULL')
    } else if (is(provider_id, 'subQuery')){
      statement <- paste0(statement, ' provider_id = (', as.character(provider_id), ')')
    } else {
      statement <- paste0(statement, " provider_id = '", provider_id,"'")
    }
  }

  if (!missing(visit_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_occurrence_id)) {
      statement <- paste0(statement, ' visit_occurrence_id IS NULL')
    } else if (is(visit_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' visit_occurrence_id = (', as.character(visit_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " visit_occurrence_id = '", visit_occurrence_id,"'")
    }
  }

  if (!missing(visit_detail_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_detail_id)) {
      statement <- paste0(statement, ' visit_detail_id IS NULL')
    } else if (is(visit_detail_id, 'subQuery')){
      statement <- paste0(statement, ' visit_detail_id = (', as.character(visit_detail_id), ')')
    } else {
      statement <- paste0(statement, " visit_detail_id = '", visit_detail_id,"'")
    }
  }

  if (!missing(observation_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(observation_source_value)) {
      statement <- paste0(statement, ' observation_source_value IS NULL')
    } else if (is(observation_source_value, 'subQuery')){
      statement <- paste0(statement, ' observation_source_value = (', as.character(observation_source_value), ')')
    } else {
      statement <- paste0(statement, " observation_source_value = '", observation_source_value,"'")
    }
  }

  if (!missing(observation_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(observation_source_concept_id)) {
      statement <- paste0(statement, ' observation_source_concept_id IS NULL')
    } else if (is(observation_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' observation_source_concept_id = (', as.character(observation_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " observation_source_concept_id = '", observation_source_concept_id,"'")
    }
  }

  if (!missing(unit_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(unit_source_value)) {
      statement <- paste0(statement, ' unit_source_value IS NULL')
    } else if (is(unit_source_value, 'subQuery')){
      statement <- paste0(statement, ' unit_source_value = (', as.character(unit_source_value), ')')
    } else {
      statement <- paste0(statement, " unit_source_value = '", unit_source_value,"'")
    }
  }

  if (!missing(qualifier_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(qualifier_source_value)) {
      statement <- paste0(statement, ' qualifier_source_value IS NULL')
    } else if (is(qualifier_source_value, 'subQuery')){
      statement <- paste0(statement, ' qualifier_source_value = (', as.character(qualifier_source_value), ')')
    } else {
      statement <- paste0(statement, " qualifier_source_value = '", qualifier_source_value,"'")
    }
  }

  statement <- paste0(statement, ') != ', rowCount , " THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_count_observation_period <- function(rowCount, observation_period_id, person_id, observation_period_start_date, observation_period_end_date, period_type_concept_id) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect observation_period' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.observation_period WHERE")
  first <- TRUE
  if (!missing(observation_period_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(observation_period_id)) {
      statement <- paste0(statement, ' observation_period_id IS NULL')
    } else if (is(observation_period_id, 'subQuery')){
      statement <- paste0(statement, ' observation_period_id = (', as.character(observation_period_id), ')')
    } else {
      statement <- paste0(statement, " observation_period_id = '", observation_period_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(observation_period_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(observation_period_start_date)) {
      statement <- paste0(statement, ' observation_period_start_date IS NULL')
    } else if (is(observation_period_start_date, 'subQuery')){
      statement <- paste0(statement, ' observation_period_start_date = (', as.character(observation_period_start_date), ')')
    } else {
      statement <- paste0(statement, " observation_period_start_date = '", observation_period_start_date,"'")
    }
  }

  if (!missing(observation_period_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(observation_period_end_date)) {
      statement <- paste0(statement, ' observation_period_end_date IS NULL')
    } else if (is(observation_period_end_date, 'subQuery')){
      statement <- paste0(statement, ' observation_period_end_date = (', as.character(observation_period_end_date), ')')
    } else {
      statement <- paste0(statement, " observation_period_end_date = '", observation_period_end_date,"'")
    }
  }

  if (!missing(period_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(period_type_concept_id)) {
      statement <- paste0(statement, ' period_type_concept_id IS NULL')
    } else if (is(period_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' period_type_concept_id = (', as.character(period_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " period_type_concept_id = '", period_type_concept_id,"'")
    }
  }

  statement <- paste0(statement, ') != ', rowCount , " THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_count_person <- function(rowCount, person_id, gender_concept_id, year_of_birth, month_of_birth, day_of_birth, birth_datetime, race_concept_id, ethnicity_concept_id, location_id, provider_id, care_site_id, person_source_value, gender_source_value, gender_source_concept_id, race_source_value, race_source_concept_id, ethnicity_source_value, ethnicity_source_concept_id) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect person' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.person WHERE")
  first <- TRUE
  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(gender_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(gender_concept_id)) {
      statement <- paste0(statement, ' gender_concept_id IS NULL')
    } else if (is(gender_concept_id, 'subQuery')){
      statement <- paste0(statement, ' gender_concept_id = (', as.character(gender_concept_id), ')')
    } else {
      statement <- paste0(statement, " gender_concept_id = '", gender_concept_id,"'")
    }
  }

  if (!missing(year_of_birth)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(year_of_birth)) {
      statement <- paste0(statement, ' year_of_birth IS NULL')
    } else if (is(year_of_birth, 'subQuery')){
      statement <- paste0(statement, ' year_of_birth = (', as.character(year_of_birth), ')')
    } else {
      statement <- paste0(statement, " year_of_birth = '", year_of_birth,"'")
    }
  }

  if (!missing(month_of_birth)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(month_of_birth)) {
      statement <- paste0(statement, ' month_of_birth IS NULL')
    } else if (is(month_of_birth, 'subQuery')){
      statement <- paste0(statement, ' month_of_birth = (', as.character(month_of_birth), ')')
    } else {
      statement <- paste0(statement, " month_of_birth = '", month_of_birth,"'")
    }
  }

  if (!missing(day_of_birth)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(day_of_birth)) {
      statement <- paste0(statement, ' day_of_birth IS NULL')
    } else if (is(day_of_birth, 'subQuery')){
      statement <- paste0(statement, ' day_of_birth = (', as.character(day_of_birth), ')')
    } else {
      statement <- paste0(statement, " day_of_birth = '", day_of_birth,"'")
    }
  }

  if (!missing(birth_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(birth_datetime)) {
      statement <- paste0(statement, ' birth_datetime IS NULL')
    } else if (is(birth_datetime, 'subQuery')){
      statement <- paste0(statement, ' birth_datetime = (', as.character(birth_datetime), ')')
    } else {
      statement <- paste0(statement, " birth_datetime = '", birth_datetime,"'")
    }
  }

  if (!missing(race_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(race_concept_id)) {
      statement <- paste0(statement, ' race_concept_id IS NULL')
    } else if (is(race_concept_id, 'subQuery')){
      statement <- paste0(statement, ' race_concept_id = (', as.character(race_concept_id), ')')
    } else {
      statement <- paste0(statement, " race_concept_id = '", race_concept_id,"'")
    }
  }

  if (!missing(ethnicity_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(ethnicity_concept_id)) {
      statement <- paste0(statement, ' ethnicity_concept_id IS NULL')
    } else if (is(ethnicity_concept_id, 'subQuery')){
      statement <- paste0(statement, ' ethnicity_concept_id = (', as.character(ethnicity_concept_id), ')')
    } else {
      statement <- paste0(statement, " ethnicity_concept_id = '", ethnicity_concept_id,"'")
    }
  }

  if (!missing(location_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(location_id)) {
      statement <- paste0(statement, ' location_id IS NULL')
    } else if (is(location_id, 'subQuery')){
      statement <- paste0(statement, ' location_id = (', as.character(location_id), ')')
    } else {
      statement <- paste0(statement, " location_id = '", location_id,"'")
    }
  }

  if (!missing(provider_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_id)) {
      statement <- paste0(statement, ' provider_id IS NULL')
    } else if (is(provider_id, 'subQuery')){
      statement <- paste0(statement, ' provider_id = (', as.character(provider_id), ')')
    } else {
      statement <- paste0(statement, " provider_id = '", provider_id,"'")
    }
  }

  if (!missing(care_site_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(care_site_id)) {
      statement <- paste0(statement, ' care_site_id IS NULL')
    } else if (is(care_site_id, 'subQuery')){
      statement <- paste0(statement, ' care_site_id = (', as.character(care_site_id), ')')
    } else {
      statement <- paste0(statement, " care_site_id = '", care_site_id,"'")
    }
  }

  if (!missing(person_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_source_value)) {
      statement <- paste0(statement, ' person_source_value IS NULL')
    } else if (is(person_source_value, 'subQuery')){
      statement <- paste0(statement, ' person_source_value = (', as.character(person_source_value), ')')
    } else {
      statement <- paste0(statement, " person_source_value = '", person_source_value,"'")
    }
  }

  if (!missing(gender_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(gender_source_value)) {
      statement <- paste0(statement, ' gender_source_value IS NULL')
    } else if (is(gender_source_value, 'subQuery')){
      statement <- paste0(statement, ' gender_source_value = (', as.character(gender_source_value), ')')
    } else {
      statement <- paste0(statement, " gender_source_value = '", gender_source_value,"'")
    }
  }

  if (!missing(gender_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(gender_source_concept_id)) {
      statement <- paste0(statement, ' gender_source_concept_id IS NULL')
    } else if (is(gender_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' gender_source_concept_id = (', as.character(gender_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " gender_source_concept_id = '", gender_source_concept_id,"'")
    }
  }

  if (!missing(race_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(race_source_value)) {
      statement <- paste0(statement, ' race_source_value IS NULL')
    } else if (is(race_source_value, 'subQuery')){
      statement <- paste0(statement, ' race_source_value = (', as.character(race_source_value), ')')
    } else {
      statement <- paste0(statement, " race_source_value = '", race_source_value,"'")
    }
  }

  if (!missing(race_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(race_source_concept_id)) {
      statement <- paste0(statement, ' race_source_concept_id IS NULL')
    } else if (is(race_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' race_source_concept_id = (', as.character(race_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " race_source_concept_id = '", race_source_concept_id,"'")
    }
  }

  if (!missing(ethnicity_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(ethnicity_source_value)) {
      statement <- paste0(statement, ' ethnicity_source_value IS NULL')
    } else if (is(ethnicity_source_value, 'subQuery')){
      statement <- paste0(statement, ' ethnicity_source_value = (', as.character(ethnicity_source_value), ')')
    } else {
      statement <- paste0(statement, " ethnicity_source_value = '", ethnicity_source_value,"'")
    }
  }

  if (!missing(ethnicity_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(ethnicity_source_concept_id)) {
      statement <- paste0(statement, ' ethnicity_source_concept_id IS NULL')
    } else if (is(ethnicity_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' ethnicity_source_concept_id = (', as.character(ethnicity_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " ethnicity_source_concept_id = '", ethnicity_source_concept_id,"'")
    }
  }

  statement <- paste0(statement, ') != ', rowCount , " THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_count_procedure_occurrence <- function(rowCount, procedure_occurrence_id, person_id, procedure_concept_id, procedure_date, procedure_datetime, procedure_type_concept_id, modifier_concept_id, quantity, provider_id, visit_occurrence_id, procedure_source_value, procedure_source_concept_id, qualifier_source_value, visit_detail_id) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect procedure_occurrence' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.procedure_occurrence WHERE")
  first <- TRUE
  if (!missing(procedure_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(procedure_occurrence_id)) {
      statement <- paste0(statement, ' procedure_occurrence_id IS NULL')
    } else if (is(procedure_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' procedure_occurrence_id = (', as.character(procedure_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " procedure_occurrence_id = '", procedure_occurrence_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(procedure_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(procedure_concept_id)) {
      statement <- paste0(statement, ' procedure_concept_id IS NULL')
    } else if (is(procedure_concept_id, 'subQuery')){
      statement <- paste0(statement, ' procedure_concept_id = (', as.character(procedure_concept_id), ')')
    } else {
      statement <- paste0(statement, " procedure_concept_id = '", procedure_concept_id,"'")
    }
  }

  if (!missing(procedure_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(procedure_date)) {
      statement <- paste0(statement, ' procedure_date IS NULL')
    } else if (is(procedure_date, 'subQuery')){
      statement <- paste0(statement, ' procedure_date = (', as.character(procedure_date), ')')
    } else {
      statement <- paste0(statement, " procedure_date = '", procedure_date,"'")
    }
  }

  if (!missing(procedure_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(procedure_datetime)) {
      statement <- paste0(statement, ' procedure_datetime IS NULL')
    } else if (is(procedure_datetime, 'subQuery')){
      statement <- paste0(statement, ' procedure_datetime = (', as.character(procedure_datetime), ')')
    } else {
      statement <- paste0(statement, " procedure_datetime = '", procedure_datetime,"'")
    }
  }

  if (!missing(procedure_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(procedure_type_concept_id)) {
      statement <- paste0(statement, ' procedure_type_concept_id IS NULL')
    } else if (is(procedure_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' procedure_type_concept_id = (', as.character(procedure_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " procedure_type_concept_id = '", procedure_type_concept_id,"'")
    }
  }

  if (!missing(modifier_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(modifier_concept_id)) {
      statement <- paste0(statement, ' modifier_concept_id IS NULL')
    } else if (is(modifier_concept_id, 'subQuery')){
      statement <- paste0(statement, ' modifier_concept_id = (', as.character(modifier_concept_id), ')')
    } else {
      statement <- paste0(statement, " modifier_concept_id = '", modifier_concept_id,"'")
    }
  }

  if (!missing(quantity)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(quantity)) {
      statement <- paste0(statement, ' quantity IS NULL')
    } else if (is(quantity, 'subQuery')){
      statement <- paste0(statement, ' quantity = (', as.character(quantity), ')')
    } else {
      statement <- paste0(statement, " quantity = '", quantity,"'")
    }
  }

  if (!missing(provider_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_id)) {
      statement <- paste0(statement, ' provider_id IS NULL')
    } else if (is(provider_id, 'subQuery')){
      statement <- paste0(statement, ' provider_id = (', as.character(provider_id), ')')
    } else {
      statement <- paste0(statement, " provider_id = '", provider_id,"'")
    }
  }

  if (!missing(visit_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_occurrence_id)) {
      statement <- paste0(statement, ' visit_occurrence_id IS NULL')
    } else if (is(visit_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' visit_occurrence_id = (', as.character(visit_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " visit_occurrence_id = '", visit_occurrence_id,"'")
    }
  }

  if (!missing(procedure_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(procedure_source_value)) {
      statement <- paste0(statement, ' procedure_source_value IS NULL')
    } else if (is(procedure_source_value, 'subQuery')){
      statement <- paste0(statement, ' procedure_source_value = (', as.character(procedure_source_value), ')')
    } else {
      statement <- paste0(statement, " procedure_source_value = '", procedure_source_value,"'")
    }
  }

  if (!missing(procedure_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(procedure_source_concept_id)) {
      statement <- paste0(statement, ' procedure_source_concept_id IS NULL')
    } else if (is(procedure_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' procedure_source_concept_id = (', as.character(procedure_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " procedure_source_concept_id = '", procedure_source_concept_id,"'")
    }
  }

  if (!missing(qualifier_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(qualifier_source_value)) {
      statement <- paste0(statement, ' qualifier_source_value IS NULL')
    } else if (is(qualifier_source_value, 'subQuery')){
      statement <- paste0(statement, ' qualifier_source_value = (', as.character(qualifier_source_value), ')')
    } else {
      statement <- paste0(statement, " qualifier_source_value = '", qualifier_source_value,"'")
    }
  }

  if (!missing(visit_detail_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_detail_id)) {
      statement <- paste0(statement, ' visit_detail_id IS NULL')
    } else if (is(visit_detail_id, 'subQuery')){
      statement <- paste0(statement, ' visit_detail_id = (', as.character(visit_detail_id), ')')
    } else {
      statement <- paste0(statement, " visit_detail_id = '", visit_detail_id,"'")
    }
  }

  statement <- paste0(statement, ') != ', rowCount , " THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_count_specimen <- function(rowCount, specimen_id, person_id, specimen_concept_id, specimen_type_concept_id, specimen_date, specimen_datetime, quantity, unit_concept_id, anatomic_site_concept_id, disease_status_concept_id, specimen_source_id, specimen_source_value, unit_source_value, anatomic_site_source_value, disease_status_source_value) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect specimen' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.specimen WHERE")
  first <- TRUE
  if (!missing(specimen_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(specimen_id)) {
      statement <- paste0(statement, ' specimen_id IS NULL')
    } else if (is(specimen_id, 'subQuery')){
      statement <- paste0(statement, ' specimen_id = (', as.character(specimen_id), ')')
    } else {
      statement <- paste0(statement, " specimen_id = '", specimen_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(specimen_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(specimen_concept_id)) {
      statement <- paste0(statement, ' specimen_concept_id IS NULL')
    } else if (is(specimen_concept_id, 'subQuery')){
      statement <- paste0(statement, ' specimen_concept_id = (', as.character(specimen_concept_id), ')')
    } else {
      statement <- paste0(statement, " specimen_concept_id = '", specimen_concept_id,"'")
    }
  }

  if (!missing(specimen_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(specimen_type_concept_id)) {
      statement <- paste0(statement, ' specimen_type_concept_id IS NULL')
    } else if (is(specimen_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' specimen_type_concept_id = (', as.character(specimen_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " specimen_type_concept_id = '", specimen_type_concept_id,"'")
    }
  }

  if (!missing(specimen_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(specimen_date)) {
      statement <- paste0(statement, ' specimen_date IS NULL')
    } else if (is(specimen_date, 'subQuery')){
      statement <- paste0(statement, ' specimen_date = (', as.character(specimen_date), ')')
    } else {
      statement <- paste0(statement, " specimen_date = '", specimen_date,"'")
    }
  }

  if (!missing(specimen_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(specimen_datetime)) {
      statement <- paste0(statement, ' specimen_datetime IS NULL')
    } else if (is(specimen_datetime, 'subQuery')){
      statement <- paste0(statement, ' specimen_datetime = (', as.character(specimen_datetime), ')')
    } else {
      statement <- paste0(statement, " specimen_datetime = '", specimen_datetime,"'")
    }
  }

  if (!missing(quantity)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(quantity)) {
      statement <- paste0(statement, ' quantity IS NULL')
    } else if (is(quantity, 'subQuery')){
      statement <- paste0(statement, ' quantity = (', as.character(quantity), ')')
    } else {
      statement <- paste0(statement, " quantity = '", quantity,"'")
    }
  }

  if (!missing(unit_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(unit_concept_id)) {
      statement <- paste0(statement, ' unit_concept_id IS NULL')
    } else if (is(unit_concept_id, 'subQuery')){
      statement <- paste0(statement, ' unit_concept_id = (', as.character(unit_concept_id), ')')
    } else {
      statement <- paste0(statement, " unit_concept_id = '", unit_concept_id,"'")
    }
  }

  if (!missing(anatomic_site_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(anatomic_site_concept_id)) {
      statement <- paste0(statement, ' anatomic_site_concept_id IS NULL')
    } else if (is(anatomic_site_concept_id, 'subQuery')){
      statement <- paste0(statement, ' anatomic_site_concept_id = (', as.character(anatomic_site_concept_id), ')')
    } else {
      statement <- paste0(statement, " anatomic_site_concept_id = '", anatomic_site_concept_id,"'")
    }
  }

  if (!missing(disease_status_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(disease_status_concept_id)) {
      statement <- paste0(statement, ' disease_status_concept_id IS NULL')
    } else if (is(disease_status_concept_id, 'subQuery')){
      statement <- paste0(statement, ' disease_status_concept_id = (', as.character(disease_status_concept_id), ')')
    } else {
      statement <- paste0(statement, " disease_status_concept_id = '", disease_status_concept_id,"'")
    }
  }

  if (!missing(specimen_source_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(specimen_source_id)) {
      statement <- paste0(statement, ' specimen_source_id IS NULL')
    } else if (is(specimen_source_id, 'subQuery')){
      statement <- paste0(statement, ' specimen_source_id = (', as.character(specimen_source_id), ')')
    } else {
      statement <- paste0(statement, " specimen_source_id = '", specimen_source_id,"'")
    }
  }

  if (!missing(specimen_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(specimen_source_value)) {
      statement <- paste0(statement, ' specimen_source_value IS NULL')
    } else if (is(specimen_source_value, 'subQuery')){
      statement <- paste0(statement, ' specimen_source_value = (', as.character(specimen_source_value), ')')
    } else {
      statement <- paste0(statement, " specimen_source_value = '", specimen_source_value,"'")
    }
  }

  if (!missing(unit_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(unit_source_value)) {
      statement <- paste0(statement, ' unit_source_value IS NULL')
    } else if (is(unit_source_value, 'subQuery')){
      statement <- paste0(statement, ' unit_source_value = (', as.character(unit_source_value), ')')
    } else {
      statement <- paste0(statement, " unit_source_value = '", unit_source_value,"'")
    }
  }

  if (!missing(anatomic_site_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(anatomic_site_source_value)) {
      statement <- paste0(statement, ' anatomic_site_source_value IS NULL')
    } else if (is(anatomic_site_source_value, 'subQuery')){
      statement <- paste0(statement, ' anatomic_site_source_value = (', as.character(anatomic_site_source_value), ')')
    } else {
      statement <- paste0(statement, " anatomic_site_source_value = '", anatomic_site_source_value,"'")
    }
  }

  if (!missing(disease_status_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(disease_status_source_value)) {
      statement <- paste0(statement, ' disease_status_source_value IS NULL')
    } else if (is(disease_status_source_value, 'subQuery')){
      statement <- paste0(statement, ' disease_status_source_value = (', as.character(disease_status_source_value), ')')
    } else {
      statement <- paste0(statement, " disease_status_source_value = '", disease_status_source_value,"'")
    }
  }

  statement <- paste0(statement, ') != ', rowCount , " THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_count_visit_detail <- function(rowCount, visit_detail_id, person_id, visit_concept_id, visit_start_date, visit_start_datetime, visit_end_date, visit_end_datetime, visit_type_concept_id, provider_id, care_site_id, visit_source_value, visit_source_concept_id, admitting_source_value, admitting_source_concept_id, discharge_to_source_value, discharge_to_concept_id, preceding_visit_detail_id, visit_detail_parent_id, visit_occurrence_id) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect visit_detail' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.visit_detail WHERE")
  first <- TRUE
  if (!missing(visit_detail_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_detail_id)) {
      statement <- paste0(statement, ' visit_detail_id IS NULL')
    } else if (is(visit_detail_id, 'subQuery')){
      statement <- paste0(statement, ' visit_detail_id = (', as.character(visit_detail_id), ')')
    } else {
      statement <- paste0(statement, " visit_detail_id = '", visit_detail_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(visit_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_concept_id)) {
      statement <- paste0(statement, ' visit_concept_id IS NULL')
    } else if (is(visit_concept_id, 'subQuery')){
      statement <- paste0(statement, ' visit_concept_id = (', as.character(visit_concept_id), ')')
    } else {
      statement <- paste0(statement, " visit_concept_id = '", visit_concept_id,"'")
    }
  }

  if (!missing(visit_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_start_date)) {
      statement <- paste0(statement, ' visit_start_date IS NULL')
    } else if (is(visit_start_date, 'subQuery')){
      statement <- paste0(statement, ' visit_start_date = (', as.character(visit_start_date), ')')
    } else {
      statement <- paste0(statement, " visit_start_date = '", visit_start_date,"'")
    }
  }

  if (!missing(visit_start_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_start_datetime)) {
      statement <- paste0(statement, ' visit_start_datetime IS NULL')
    } else if (is(visit_start_datetime, 'subQuery')){
      statement <- paste0(statement, ' visit_start_datetime = (', as.character(visit_start_datetime), ')')
    } else {
      statement <- paste0(statement, " visit_start_datetime = '", visit_start_datetime,"'")
    }
  }

  if (!missing(visit_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_end_date)) {
      statement <- paste0(statement, ' visit_end_date IS NULL')
    } else if (is(visit_end_date, 'subQuery')){
      statement <- paste0(statement, ' visit_end_date = (', as.character(visit_end_date), ')')
    } else {
      statement <- paste0(statement, " visit_end_date = '", visit_end_date,"'")
    }
  }

  if (!missing(visit_end_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_end_datetime)) {
      statement <- paste0(statement, ' visit_end_datetime IS NULL')
    } else if (is(visit_end_datetime, 'subQuery')){
      statement <- paste0(statement, ' visit_end_datetime = (', as.character(visit_end_datetime), ')')
    } else {
      statement <- paste0(statement, " visit_end_datetime = '", visit_end_datetime,"'")
    }
  }

  if (!missing(visit_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_type_concept_id)) {
      statement <- paste0(statement, ' visit_type_concept_id IS NULL')
    } else if (is(visit_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' visit_type_concept_id = (', as.character(visit_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " visit_type_concept_id = '", visit_type_concept_id,"'")
    }
  }

  if (!missing(provider_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_id)) {
      statement <- paste0(statement, ' provider_id IS NULL')
    } else if (is(provider_id, 'subQuery')){
      statement <- paste0(statement, ' provider_id = (', as.character(provider_id), ')')
    } else {
      statement <- paste0(statement, " provider_id = '", provider_id,"'")
    }
  }

  if (!missing(care_site_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(care_site_id)) {
      statement <- paste0(statement, ' care_site_id IS NULL')
    } else if (is(care_site_id, 'subQuery')){
      statement <- paste0(statement, ' care_site_id = (', as.character(care_site_id), ')')
    } else {
      statement <- paste0(statement, " care_site_id = '", care_site_id,"'")
    }
  }

  if (!missing(visit_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_source_value)) {
      statement <- paste0(statement, ' visit_source_value IS NULL')
    } else if (is(visit_source_value, 'subQuery')){
      statement <- paste0(statement, ' visit_source_value = (', as.character(visit_source_value), ')')
    } else {
      statement <- paste0(statement, " visit_source_value = '", visit_source_value,"'")
    }
  }

  if (!missing(visit_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_source_concept_id)) {
      statement <- paste0(statement, ' visit_source_concept_id IS NULL')
    } else if (is(visit_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' visit_source_concept_id = (', as.character(visit_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " visit_source_concept_id = '", visit_source_concept_id,"'")
    }
  }

  if (!missing(admitting_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(admitting_source_value)) {
      statement <- paste0(statement, ' admitting_source_value IS NULL')
    } else if (is(admitting_source_value, 'subQuery')){
      statement <- paste0(statement, ' admitting_source_value = (', as.character(admitting_source_value), ')')
    } else {
      statement <- paste0(statement, " admitting_source_value = '", admitting_source_value,"'")
    }
  }

  if (!missing(admitting_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(admitting_source_concept_id)) {
      statement <- paste0(statement, ' admitting_source_concept_id IS NULL')
    } else if (is(admitting_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' admitting_source_concept_id = (', as.character(admitting_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " admitting_source_concept_id = '", admitting_source_concept_id,"'")
    }
  }

  if (!missing(discharge_to_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(discharge_to_source_value)) {
      statement <- paste0(statement, ' discharge_to_source_value IS NULL')
    } else if (is(discharge_to_source_value, 'subQuery')){
      statement <- paste0(statement, ' discharge_to_source_value = (', as.character(discharge_to_source_value), ')')
    } else {
      statement <- paste0(statement, " discharge_to_source_value = '", discharge_to_source_value,"'")
    }
  }

  if (!missing(discharge_to_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(discharge_to_concept_id)) {
      statement <- paste0(statement, ' discharge_to_concept_id IS NULL')
    } else if (is(discharge_to_concept_id, 'subQuery')){
      statement <- paste0(statement, ' discharge_to_concept_id = (', as.character(discharge_to_concept_id), ')')
    } else {
      statement <- paste0(statement, " discharge_to_concept_id = '", discharge_to_concept_id,"'")
    }
  }

  if (!missing(preceding_visit_detail_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(preceding_visit_detail_id)) {
      statement <- paste0(statement, ' preceding_visit_detail_id IS NULL')
    } else if (is(preceding_visit_detail_id, 'subQuery')){
      statement <- paste0(statement, ' preceding_visit_detail_id = (', as.character(preceding_visit_detail_id), ')')
    } else {
      statement <- paste0(statement, " preceding_visit_detail_id = '", preceding_visit_detail_id,"'")
    }
  }

  if (!missing(visit_detail_parent_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_detail_parent_id)) {
      statement <- paste0(statement, ' visit_detail_parent_id IS NULL')
    } else if (is(visit_detail_parent_id, 'subQuery')){
      statement <- paste0(statement, ' visit_detail_parent_id = (', as.character(visit_detail_parent_id), ')')
    } else {
      statement <- paste0(statement, " visit_detail_parent_id = '", visit_detail_parent_id,"'")
    }
  }

  if (!missing(visit_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_occurrence_id)) {
      statement <- paste0(statement, ' visit_occurrence_id IS NULL')
    } else if (is(visit_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' visit_occurrence_id = (', as.character(visit_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " visit_occurrence_id = '", visit_occurrence_id,"'")
    }
  }

  statement <- paste0(statement, ') != ', rowCount , " THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_count_visit_occurrence <- function(rowCount, visit_occurrence_id, person_id, visit_concept_id, visit_start_date, visit_start_datetime, visit_end_date, visit_end_datetime, visit_type_concept_id, provider_id, care_site_id, visit_source_value, visit_source_concept_id, admitting_source_concept_id, admitting_source_value, discharge_to_concept_id, discharge_to_source_value, preceding_visit_occurrence_id) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect visit_occurrence' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.visit_occurrence WHERE")
  first <- TRUE
  if (!missing(visit_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_occurrence_id)) {
      statement <- paste0(statement, ' visit_occurrence_id IS NULL')
    } else if (is(visit_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' visit_occurrence_id = (', as.character(visit_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " visit_occurrence_id = '", visit_occurrence_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(visit_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_concept_id)) {
      statement <- paste0(statement, ' visit_concept_id IS NULL')
    } else if (is(visit_concept_id, 'subQuery')){
      statement <- paste0(statement, ' visit_concept_id = (', as.character(visit_concept_id), ')')
    } else {
      statement <- paste0(statement, " visit_concept_id = '", visit_concept_id,"'")
    }
  }

  if (!missing(visit_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_start_date)) {
      statement <- paste0(statement, ' visit_start_date IS NULL')
    } else if (is(visit_start_date, 'subQuery')){
      statement <- paste0(statement, ' visit_start_date = (', as.character(visit_start_date), ')')
    } else {
      statement <- paste0(statement, " visit_start_date = '", visit_start_date,"'")
    }
  }

  if (!missing(visit_start_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_start_datetime)) {
      statement <- paste0(statement, ' visit_start_datetime IS NULL')
    } else if (is(visit_start_datetime, 'subQuery')){
      statement <- paste0(statement, ' visit_start_datetime = (', as.character(visit_start_datetime), ')')
    } else {
      statement <- paste0(statement, " visit_start_datetime = '", visit_start_datetime,"'")
    }
  }

  if (!missing(visit_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_end_date)) {
      statement <- paste0(statement, ' visit_end_date IS NULL')
    } else if (is(visit_end_date, 'subQuery')){
      statement <- paste0(statement, ' visit_end_date = (', as.character(visit_end_date), ')')
    } else {
      statement <- paste0(statement, " visit_end_date = '", visit_end_date,"'")
    }
  }

  if (!missing(visit_end_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_end_datetime)) {
      statement <- paste0(statement, ' visit_end_datetime IS NULL')
    } else if (is(visit_end_datetime, 'subQuery')){
      statement <- paste0(statement, ' visit_end_datetime = (', as.character(visit_end_datetime), ')')
    } else {
      statement <- paste0(statement, " visit_end_datetime = '", visit_end_datetime,"'")
    }
  }

  if (!missing(visit_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_type_concept_id)) {
      statement <- paste0(statement, ' visit_type_concept_id IS NULL')
    } else if (is(visit_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' visit_type_concept_id = (', as.character(visit_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " visit_type_concept_id = '", visit_type_concept_id,"'")
    }
  }

  if (!missing(provider_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_id)) {
      statement <- paste0(statement, ' provider_id IS NULL')
    } else if (is(provider_id, 'subQuery')){
      statement <- paste0(statement, ' provider_id = (', as.character(provider_id), ')')
    } else {
      statement <- paste0(statement, " provider_id = '", provider_id,"'")
    }
  }

  if (!missing(care_site_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(care_site_id)) {
      statement <- paste0(statement, ' care_site_id IS NULL')
    } else if (is(care_site_id, 'subQuery')){
      statement <- paste0(statement, ' care_site_id = (', as.character(care_site_id), ')')
    } else {
      statement <- paste0(statement, " care_site_id = '", care_site_id,"'")
    }
  }

  if (!missing(visit_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_source_value)) {
      statement <- paste0(statement, ' visit_source_value IS NULL')
    } else if (is(visit_source_value, 'subQuery')){
      statement <- paste0(statement, ' visit_source_value = (', as.character(visit_source_value), ')')
    } else {
      statement <- paste0(statement, " visit_source_value = '", visit_source_value,"'")
    }
  }

  if (!missing(visit_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_source_concept_id)) {
      statement <- paste0(statement, ' visit_source_concept_id IS NULL')
    } else if (is(visit_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' visit_source_concept_id = (', as.character(visit_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " visit_source_concept_id = '", visit_source_concept_id,"'")
    }
  }

  if (!missing(admitting_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(admitting_source_concept_id)) {
      statement <- paste0(statement, ' admitting_source_concept_id IS NULL')
    } else if (is(admitting_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' admitting_source_concept_id = (', as.character(admitting_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " admitting_source_concept_id = '", admitting_source_concept_id,"'")
    }
  }

  if (!missing(admitting_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(admitting_source_value)) {
      statement <- paste0(statement, ' admitting_source_value IS NULL')
    } else if (is(admitting_source_value, 'subQuery')){
      statement <- paste0(statement, ' admitting_source_value = (', as.character(admitting_source_value), ')')
    } else {
      statement <- paste0(statement, " admitting_source_value = '", admitting_source_value,"'")
    }
  }

  if (!missing(discharge_to_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(discharge_to_concept_id)) {
      statement <- paste0(statement, ' discharge_to_concept_id IS NULL')
    } else if (is(discharge_to_concept_id, 'subQuery')){
      statement <- paste0(statement, ' discharge_to_concept_id = (', as.character(discharge_to_concept_id), ')')
    } else {
      statement <- paste0(statement, " discharge_to_concept_id = '", discharge_to_concept_id,"'")
    }
  }

  if (!missing(discharge_to_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(discharge_to_source_value)) {
      statement <- paste0(statement, ' discharge_to_source_value IS NULL')
    } else if (is(discharge_to_source_value, 'subQuery')){
      statement <- paste0(statement, ' discharge_to_source_value = (', as.character(discharge_to_source_value), ')')
    } else {
      statement <- paste0(statement, " discharge_to_source_value = '", discharge_to_source_value,"'")
    }
  }

  if (!missing(preceding_visit_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(preceding_visit_occurrence_id)) {
      statement <- paste0(statement, ' preceding_visit_occurrence_id IS NULL')
    } else if (is(preceding_visit_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' preceding_visit_occurrence_id = (', as.character(preceding_visit_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " preceding_visit_occurrence_id = '", preceding_visit_occurrence_id,"'")
    }
  }

  statement <- paste0(statement, ') != ', rowCount , " THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_count_cohort <- function(rowCount, cohort_definition_id, subject_id, cohort_start_date, cohort_end_date) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect cohort' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.cohort WHERE")
  first <- TRUE
  if (!missing(cohort_definition_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cohort_definition_id)) {
      statement <- paste0(statement, ' cohort_definition_id IS NULL')
    } else if (is(cohort_definition_id, 'subQuery')){
      statement <- paste0(statement, ' cohort_definition_id = (', as.character(cohort_definition_id), ')')
    } else {
      statement <- paste0(statement, " cohort_definition_id = '", cohort_definition_id,"'")
    }
  }

  if (!missing(subject_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(subject_id)) {
      statement <- paste0(statement, ' subject_id IS NULL')
    } else if (is(subject_id, 'subQuery')){
      statement <- paste0(statement, ' subject_id = (', as.character(subject_id), ')')
    } else {
      statement <- paste0(statement, " subject_id = '", subject_id,"'")
    }
  }

  if (!missing(cohort_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cohort_start_date)) {
      statement <- paste0(statement, ' cohort_start_date IS NULL')
    } else if (is(cohort_start_date, 'subQuery')){
      statement <- paste0(statement, ' cohort_start_date = (', as.character(cohort_start_date), ')')
    } else {
      statement <- paste0(statement, " cohort_start_date = '", cohort_start_date,"'")
    }
  }

  if (!missing(cohort_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cohort_end_date)) {
      statement <- paste0(statement, ' cohort_end_date IS NULL')
    } else if (is(cohort_end_date, 'subQuery')){
      statement <- paste0(statement, ' cohort_end_date = (', as.character(cohort_end_date), ')')
    } else {
      statement <- paste0(statement, " cohort_end_date = '", cohort_end_date,"'")
    }
  }

  statement <- paste0(statement, ') != ', rowCount , " THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_count_cohort_attribute <- function(rowCount, cohort_definition_id, subject_id, cohort_start_date, cohort_end_date, attribute_definition_id, value_as_number, value_as_concept_id) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect cohort_attribute' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.cohort_attribute WHERE")
  first <- TRUE
  if (!missing(cohort_definition_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cohort_definition_id)) {
      statement <- paste0(statement, ' cohort_definition_id IS NULL')
    } else if (is(cohort_definition_id, 'subQuery')){
      statement <- paste0(statement, ' cohort_definition_id = (', as.character(cohort_definition_id), ')')
    } else {
      statement <- paste0(statement, " cohort_definition_id = '", cohort_definition_id,"'")
    }
  }

  if (!missing(subject_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(subject_id)) {
      statement <- paste0(statement, ' subject_id IS NULL')
    } else if (is(subject_id, 'subQuery')){
      statement <- paste0(statement, ' subject_id = (', as.character(subject_id), ')')
    } else {
      statement <- paste0(statement, " subject_id = '", subject_id,"'")
    }
  }

  if (!missing(cohort_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cohort_start_date)) {
      statement <- paste0(statement, ' cohort_start_date IS NULL')
    } else if (is(cohort_start_date, 'subQuery')){
      statement <- paste0(statement, ' cohort_start_date = (', as.character(cohort_start_date), ')')
    } else {
      statement <- paste0(statement, " cohort_start_date = '", cohort_start_date,"'")
    }
  }

  if (!missing(cohort_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cohort_end_date)) {
      statement <- paste0(statement, ' cohort_end_date IS NULL')
    } else if (is(cohort_end_date, 'subQuery')){
      statement <- paste0(statement, ' cohort_end_date = (', as.character(cohort_end_date), ')')
    } else {
      statement <- paste0(statement, " cohort_end_date = '", cohort_end_date,"'")
    }
  }

  if (!missing(attribute_definition_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(attribute_definition_id)) {
      statement <- paste0(statement, ' attribute_definition_id IS NULL')
    } else if (is(attribute_definition_id, 'subQuery')){
      statement <- paste0(statement, ' attribute_definition_id = (', as.character(attribute_definition_id), ')')
    } else {
      statement <- paste0(statement, " attribute_definition_id = '", attribute_definition_id,"'")
    }
  }

  if (!missing(value_as_number)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(value_as_number)) {
      statement <- paste0(statement, ' value_as_number IS NULL')
    } else if (is(value_as_number, 'subQuery')){
      statement <- paste0(statement, ' value_as_number = (', as.character(value_as_number), ')')
    } else {
      statement <- paste0(statement, " value_as_number = '", value_as_number,"'")
    }
  }

  if (!missing(value_as_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(value_as_concept_id)) {
      statement <- paste0(statement, ' value_as_concept_id IS NULL')
    } else if (is(value_as_concept_id, 'subQuery')){
      statement <- paste0(statement, ' value_as_concept_id = (', as.character(value_as_concept_id), ')')
    } else {
      statement <- paste0(statement, " value_as_concept_id = '", value_as_concept_id,"'")
    }
  }

  statement <- paste0(statement, ') != ', rowCount , " THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_count_condition_era <- function(rowCount, condition_era_id, person_id, condition_concept_id, condition_era_start_date, condition_era_end_date, condition_occurrence_count) {

  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect condition_era' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.condition_era WHERE")
  first <- TRUE
  if (!missing(condition_era_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_era_id)) {
      statement <- paste0(statement, ' condition_era_id IS NULL')
    } else if (is(condition_era_id, 'subQuery')){
      statement <- paste0(statement, ' condition_era_id = (', as.character(condition_era_id), ')')
    } else {
      statement <- paste0(statement, " condition_era_id = '", condition_era_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(condition_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_concept_id)) {
      statement <- paste0(statement, ' condition_concept_id IS NULL')
    } else if (is(condition_concept_id, 'subQuery')){
      statement <- paste0(statement, ' condition_concept_id = (', as.character(condition_concept_id), ')')
    } else {
      statement <- paste0(statement, " condition_concept_id = '", condition_concept_id,"'")
    }
  }

  if (!missing(condition_era_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_era_start_date)) {
      statement <- paste0(statement, ' condition_era_start_date IS NULL')
    } else if (is(condition_era_start_date, 'subQuery')){
      statement <- paste0(statement, ' condition_era_start_date = (', as.character(condition_era_start_date), ')')
    } else {
      statement <- paste0(statement, " condition_era_start_date = '", condition_era_start_date,"'")
    }
  }

  if (!missing(condition_era_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_era_end_date)) {
      statement <- paste0(statement, ' condition_era_end_date IS NULL')
    } else if (is(condition_era_end_date, 'subQuery')){
      statement <- paste0(statement, ' condition_era_end_date = (', as.character(condition_era_end_date), ')')
    } else {
      statement <- paste0(statement, " condition_era_end_date = '", condition_era_end_date,"'")
    }
  }

  if (!missing(condition_occurrence_count)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_occurrence_count)) {
      statement <- paste0(statement, ' condition_occurrence_count IS NULL')
    } else if (is(condition_occurrence_count, 'subQuery')){
      statement <- paste0(statement, ' condition_occurrence_count = (', as.character(condition_occurrence_count), ')')
    } else {
      statement <- paste0(statement, " condition_occurrence_count = '", condition_occurrence_count,"'")
    }
  }

  statement <- paste0(statement, ') != ', rowCount , " THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_count_dose_era <- function(rowCount, dose_era_id, person_id, drug_concept_id, unit_concept_id, dose_value, dose_era_start_date, dose_era_end_date) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect dose_era' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.dose_era WHERE")
  first <- TRUE
  if (!missing(dose_era_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(dose_era_id)) {
      statement <- paste0(statement, ' dose_era_id IS NULL')
    } else if (is(dose_era_id, 'subQuery')){
      statement <- paste0(statement, ' dose_era_id = (', as.character(dose_era_id), ')')
    } else {
      statement <- paste0(statement, " dose_era_id = '", dose_era_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(drug_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_concept_id)) {
      statement <- paste0(statement, ' drug_concept_id IS NULL')
    } else if (is(drug_concept_id, 'subQuery')){
      statement <- paste0(statement, ' drug_concept_id = (', as.character(drug_concept_id), ')')
    } else {
      statement <- paste0(statement, " drug_concept_id = '", drug_concept_id,"'")
    }
  }

  if (!missing(unit_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(unit_concept_id)) {
      statement <- paste0(statement, ' unit_concept_id IS NULL')
    } else if (is(unit_concept_id, 'subQuery')){
      statement <- paste0(statement, ' unit_concept_id = (', as.character(unit_concept_id), ')')
    } else {
      statement <- paste0(statement, " unit_concept_id = '", unit_concept_id,"'")
    }
  }

  if (!missing(dose_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(dose_value)) {
      statement <- paste0(statement, ' dose_value IS NULL')
    } else if (is(dose_value, 'subQuery')){
      statement <- paste0(statement, ' dose_value = (', as.character(dose_value), ')')
    } else {
      statement <- paste0(statement, " dose_value = '", dose_value,"'")
    }
  }

  if (!missing(dose_era_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(dose_era_start_date)) {
      statement <- paste0(statement, ' dose_era_start_date IS NULL')
    } else if (is(dose_era_start_date, 'subQuery')){
      statement <- paste0(statement, ' dose_era_start_date = (', as.character(dose_era_start_date), ')')
    } else {
      statement <- paste0(statement, " dose_era_start_date = '", dose_era_start_date,"'")
    }
  }

  if (!missing(dose_era_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(dose_era_end_date)) {
      statement <- paste0(statement, ' dose_era_end_date IS NULL')
    } else if (is(dose_era_end_date, 'subQuery')){
      statement <- paste0(statement, ' dose_era_end_date = (', as.character(dose_era_end_date), ')')
    } else {
      statement <- paste0(statement, " dose_era_end_date = '", dose_era_end_date,"'")
    }
  }

  statement <- paste0(statement, ') != ', rowCount , " THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_count_drug_era <- function(rowCount, drug_era_id, person_id, drug_concept_id, drug_era_start_date, drug_era_end_date, drug_exposure_count, gap_days) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect drug_era' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.drug_era WHERE")
  first <- TRUE
  if (!missing(drug_era_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_era_id)) {
      statement <- paste0(statement, ' drug_era_id IS NULL')
    } else if (is(drug_era_id, 'subQuery')){
      statement <- paste0(statement, ' drug_era_id = (', as.character(drug_era_id), ')')
    } else {
      statement <- paste0(statement, " drug_era_id = '", drug_era_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(drug_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_concept_id)) {
      statement <- paste0(statement, ' drug_concept_id IS NULL')
    } else if (is(drug_concept_id, 'subQuery')){
      statement <- paste0(statement, ' drug_concept_id = (', as.character(drug_concept_id), ')')
    } else {
      statement <- paste0(statement, " drug_concept_id = '", drug_concept_id,"'")
    }
  }

  if (!missing(drug_era_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_era_start_date)) {
      statement <- paste0(statement, ' drug_era_start_date IS NULL')
    } else if (is(drug_era_start_date, 'subQuery')){
      statement <- paste0(statement, ' drug_era_start_date = (', as.character(drug_era_start_date), ')')
    } else {
      statement <- paste0(statement, " drug_era_start_date = '", drug_era_start_date,"'")
    }
  }

  if (!missing(drug_era_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_era_end_date)) {
      statement <- paste0(statement, ' drug_era_end_date IS NULL')
    } else if (is(drug_era_end_date, 'subQuery')){
      statement <- paste0(statement, ' drug_era_end_date = (', as.character(drug_era_end_date), ')')
    } else {
      statement <- paste0(statement, " drug_era_end_date = '", drug_era_end_date,"'")
    }
  }

  if (!missing(drug_exposure_count)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_exposure_count)) {
      statement <- paste0(statement, ' drug_exposure_count IS NULL')
    } else if (is(drug_exposure_count, 'subQuery')){
      statement <- paste0(statement, ' drug_exposure_count = (', as.character(drug_exposure_count), ')')
    } else {
      statement <- paste0(statement, " drug_exposure_count = '", drug_exposure_count,"'")
    }
  }

  if (!missing(gap_days)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(gap_days)) {
      statement <- paste0(statement, ' gap_days IS NULL')
    } else if (is(gap_days, 'subQuery')){
      statement <- paste0(statement, ' gap_days = (', as.character(gap_days), ')')
    } else {
      statement <- paste0(statement, " gap_days = '", gap_days,"'")
    }
  }

  statement <- paste0(statement, ') != ', rowCount , " THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_count_cost <- function(rowCount, cost_id, cost_event_id, cost_domain_id, cost_type_concept_id, currency_concept_id, total_charge, total_cost, total_paid, paid_by_payer, paid_by_patient, paid_patient_copay, paid_patient_coinsurance, paid_patient_deductible, paid_by_primary, paid_ingredient_cost, paid_dispensing_fee, payer_plan_period_id, amount_allowed, revenue_code_concept_id, revenue_code_source_value, drg_concept_id, drg_source_value) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect cost' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.cost WHERE")
  first <- TRUE
  if (!missing(cost_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cost_id)) {
      statement <- paste0(statement, ' cost_id IS NULL')
    } else if (is(cost_id, 'subQuery')){
      statement <- paste0(statement, ' cost_id = (', as.character(cost_id), ')')
    } else {
      statement <- paste0(statement, " cost_id = '", cost_id,"'")
    }
  }

  if (!missing(cost_event_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cost_event_id)) {
      statement <- paste0(statement, ' cost_event_id IS NULL')
    } else if (is(cost_event_id, 'subQuery')){
      statement <- paste0(statement, ' cost_event_id = (', as.character(cost_event_id), ')')
    } else {
      statement <- paste0(statement, " cost_event_id = '", cost_event_id,"'")
    }
  }

  if (!missing(cost_domain_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cost_domain_id)) {
      statement <- paste0(statement, ' cost_domain_id IS NULL')
    } else if (is(cost_domain_id, 'subQuery')){
      statement <- paste0(statement, ' cost_domain_id = (', as.character(cost_domain_id), ')')
    } else {
      statement <- paste0(statement, " cost_domain_id = '", cost_domain_id,"'")
    }
  }

  if (!missing(cost_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cost_type_concept_id)) {
      statement <- paste0(statement, ' cost_type_concept_id IS NULL')
    } else if (is(cost_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' cost_type_concept_id = (', as.character(cost_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " cost_type_concept_id = '", cost_type_concept_id,"'")
    }
  }

  if (!missing(currency_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(currency_concept_id)) {
      statement <- paste0(statement, ' currency_concept_id IS NULL')
    } else if (is(currency_concept_id, 'subQuery')){
      statement <- paste0(statement, ' currency_concept_id = (', as.character(currency_concept_id), ')')
    } else {
      statement <- paste0(statement, " currency_concept_id = '", currency_concept_id,"'")
    }
  }

  if (!missing(total_charge)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(total_charge)) {
      statement <- paste0(statement, ' total_charge IS NULL')
    } else if (is(total_charge, 'subQuery')){
      statement <- paste0(statement, ' total_charge = (', as.character(total_charge), ')')
    } else {
      statement <- paste0(statement, " total_charge = '", total_charge,"'")
    }
  }

  if (!missing(total_cost)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(total_cost)) {
      statement <- paste0(statement, ' total_cost IS NULL')
    } else if (is(total_cost, 'subQuery')){
      statement <- paste0(statement, ' total_cost = (', as.character(total_cost), ')')
    } else {
      statement <- paste0(statement, " total_cost = '", total_cost,"'")
    }
  }

  if (!missing(total_paid)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(total_paid)) {
      statement <- paste0(statement, ' total_paid IS NULL')
    } else if (is(total_paid, 'subQuery')){
      statement <- paste0(statement, ' total_paid = (', as.character(total_paid), ')')
    } else {
      statement <- paste0(statement, " total_paid = '", total_paid,"'")
    }
  }

  if (!missing(paid_by_payer)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(paid_by_payer)) {
      statement <- paste0(statement, ' paid_by_payer IS NULL')
    } else if (is(paid_by_payer, 'subQuery')){
      statement <- paste0(statement, ' paid_by_payer = (', as.character(paid_by_payer), ')')
    } else {
      statement <- paste0(statement, " paid_by_payer = '", paid_by_payer,"'")
    }
  }

  if (!missing(paid_by_patient)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(paid_by_patient)) {
      statement <- paste0(statement, ' paid_by_patient IS NULL')
    } else if (is(paid_by_patient, 'subQuery')){
      statement <- paste0(statement, ' paid_by_patient = (', as.character(paid_by_patient), ')')
    } else {
      statement <- paste0(statement, " paid_by_patient = '", paid_by_patient,"'")
    }
  }

  if (!missing(paid_patient_copay)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(paid_patient_copay)) {
      statement <- paste0(statement, ' paid_patient_copay IS NULL')
    } else if (is(paid_patient_copay, 'subQuery')){
      statement <- paste0(statement, ' paid_patient_copay = (', as.character(paid_patient_copay), ')')
    } else {
      statement <- paste0(statement, " paid_patient_copay = '", paid_patient_copay,"'")
    }
  }

  if (!missing(paid_patient_coinsurance)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(paid_patient_coinsurance)) {
      statement <- paste0(statement, ' paid_patient_coinsurance IS NULL')
    } else if (is(paid_patient_coinsurance, 'subQuery')){
      statement <- paste0(statement, ' paid_patient_coinsurance = (', as.character(paid_patient_coinsurance), ')')
    } else {
      statement <- paste0(statement, " paid_patient_coinsurance = '", paid_patient_coinsurance,"'")
    }
  }

  if (!missing(paid_patient_deductible)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(paid_patient_deductible)) {
      statement <- paste0(statement, ' paid_patient_deductible IS NULL')
    } else if (is(paid_patient_deductible, 'subQuery')){
      statement <- paste0(statement, ' paid_patient_deductible = (', as.character(paid_patient_deductible), ')')
    } else {
      statement <- paste0(statement, " paid_patient_deductible = '", paid_patient_deductible,"'")
    }
  }

  if (!missing(paid_by_primary)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(paid_by_primary)) {
      statement <- paste0(statement, ' paid_by_primary IS NULL')
    } else if (is(paid_by_primary, 'subQuery')){
      statement <- paste0(statement, ' paid_by_primary = (', as.character(paid_by_primary), ')')
    } else {
      statement <- paste0(statement, " paid_by_primary = '", paid_by_primary,"'")
    }
  }

  if (!missing(paid_ingredient_cost)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(paid_ingredient_cost)) {
      statement <- paste0(statement, ' paid_ingredient_cost IS NULL')
    } else if (is(paid_ingredient_cost, 'subQuery')){
      statement <- paste0(statement, ' paid_ingredient_cost = (', as.character(paid_ingredient_cost), ')')
    } else {
      statement <- paste0(statement, " paid_ingredient_cost = '", paid_ingredient_cost,"'")
    }
  }

  if (!missing(paid_dispensing_fee)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(paid_dispensing_fee)) {
      statement <- paste0(statement, ' paid_dispensing_fee IS NULL')
    } else if (is(paid_dispensing_fee, 'subQuery')){
      statement <- paste0(statement, ' paid_dispensing_fee = (', as.character(paid_dispensing_fee), ')')
    } else {
      statement <- paste0(statement, " paid_dispensing_fee = '", paid_dispensing_fee,"'")
    }
  }

  if (!missing(payer_plan_period_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(payer_plan_period_id)) {
      statement <- paste0(statement, ' payer_plan_period_id IS NULL')
    } else if (is(payer_plan_period_id, 'subQuery')){
      statement <- paste0(statement, ' payer_plan_period_id = (', as.character(payer_plan_period_id), ')')
    } else {
      statement <- paste0(statement, " payer_plan_period_id = '", payer_plan_period_id,"'")
    }
  }

  if (!missing(amount_allowed)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(amount_allowed)) {
      statement <- paste0(statement, ' amount_allowed IS NULL')
    } else if (is(amount_allowed, 'subQuery')){
      statement <- paste0(statement, ' amount_allowed = (', as.character(amount_allowed), ')')
    } else {
      statement <- paste0(statement, " amount_allowed = '", amount_allowed,"'")
    }
  }

  if (!missing(revenue_code_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(revenue_code_concept_id)) {
      statement <- paste0(statement, ' revenue_code_concept_id IS NULL')
    } else if (is(revenue_code_concept_id, 'subQuery')){
      statement <- paste0(statement, ' revenue_code_concept_id = (', as.character(revenue_code_concept_id), ')')
    } else {
      statement <- paste0(statement, " revenue_code_concept_id = '", revenue_code_concept_id,"'")
    }
  }

  if (!missing(revenue_code_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(revenue_code_source_value)) {
      statement <- paste0(statement, ' revenue_code_source_value IS NULL')
    } else if (is(revenue_code_source_value, 'subQuery')){
      statement <- paste0(statement, ' revenue_code_source_value = (', as.character(revenue_code_source_value), ')')
    } else {
      statement <- paste0(statement, " revenue_code_source_value = '", revenue_code_source_value,"'")
    }
  }

  if (!missing(drg_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drg_concept_id)) {
      statement <- paste0(statement, ' drg_concept_id IS NULL')
    } else if (is(drg_concept_id, 'subQuery')){
      statement <- paste0(statement, ' drg_concept_id = (', as.character(drg_concept_id), ')')
    } else {
      statement <- paste0(statement, " drg_concept_id = '", drg_concept_id,"'")
    }
  }

  if (!missing(drg_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drg_source_value)) {
      statement <- paste0(statement, ' drg_source_value IS NULL')
    } else if (is(drg_source_value, 'subQuery')){
      statement <- paste0(statement, ' drg_source_value = (', as.character(drg_source_value), ')')
    } else {
      statement <- paste0(statement, " drg_source_value = '", drg_source_value,"'")
    }
  }

  statement <- paste0(statement, ') != ', rowCount , " THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_count_payer_plan_period <- function(rowCount, payer_plan_period_id, person_id, payer_plan_period_start_date, payer_plan_period_end_date, payer_source_value, plan_source_value, family_source_value) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect payer_plan_period' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.payer_plan_period WHERE")
  first <- TRUE
  if (!missing(payer_plan_period_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(payer_plan_period_id)) {
      statement <- paste0(statement, ' payer_plan_period_id IS NULL')
    } else if (is(payer_plan_period_id, 'subQuery')){
      statement <- paste0(statement, ' payer_plan_period_id = (', as.character(payer_plan_period_id), ')')
    } else {
      statement <- paste0(statement, " payer_plan_period_id = '", payer_plan_period_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(payer_plan_period_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(payer_plan_period_start_date)) {
      statement <- paste0(statement, ' payer_plan_period_start_date IS NULL')
    } else if (is(payer_plan_period_start_date, 'subQuery')){
      statement <- paste0(statement, ' payer_plan_period_start_date = (', as.character(payer_plan_period_start_date), ')')
    } else {
      statement <- paste0(statement, " payer_plan_period_start_date = '", payer_plan_period_start_date,"'")
    }
  }

  if (!missing(payer_plan_period_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(payer_plan_period_end_date)) {
      statement <- paste0(statement, ' payer_plan_period_end_date IS NULL')
    } else if (is(payer_plan_period_end_date, 'subQuery')){
      statement <- paste0(statement, ' payer_plan_period_end_date = (', as.character(payer_plan_period_end_date), ')')
    } else {
      statement <- paste0(statement, " payer_plan_period_end_date = '", payer_plan_period_end_date,"'")
    }
  }

  if (!missing(payer_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(payer_source_value)) {
      statement <- paste0(statement, ' payer_source_value IS NULL')
    } else if (is(payer_source_value, 'subQuery')){
      statement <- paste0(statement, ' payer_source_value = (', as.character(payer_source_value), ')')
    } else {
      statement <- paste0(statement, " payer_source_value = '", payer_source_value,"'")
    }
  }

  if (!missing(plan_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(plan_source_value)) {
      statement <- paste0(statement, ' plan_source_value IS NULL')
    } else if (is(plan_source_value, 'subQuery')){
      statement <- paste0(statement, ' plan_source_value = (', as.character(plan_source_value), ')')
    } else {
      statement <- paste0(statement, " plan_source_value = '", plan_source_value,"'")
    }
  }

  if (!missing(family_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(family_source_value)) {
      statement <- paste0(statement, ' family_source_value IS NULL')
    } else if (is(family_source_value, 'subQuery')){
      statement <- paste0(statement, ' family_source_value = (', as.character(family_source_value), ')')
    } else {
      statement <- paste0(statement, " family_source_value = '", family_source_value,"'")
    }
  }

  statement <- paste0(statement, ') != ', rowCount , " THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_count_care_site <- function(rowCount, care_site_id, care_site_name, place_of_service_concept_id, location_id, care_site_source_value, place_of_service_source_value) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect care_site' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.care_site WHERE")
  first <- TRUE
  if (!missing(care_site_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(care_site_id)) {
      statement <- paste0(statement, ' care_site_id IS NULL')
    } else if (is(care_site_id, 'subQuery')){
      statement <- paste0(statement, ' care_site_id = (', as.character(care_site_id), ')')
    } else {
      statement <- paste0(statement, " care_site_id = '", care_site_id,"'")
    }
  }

  if (!missing(care_site_name)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(care_site_name)) {
      statement <- paste0(statement, ' care_site_name IS NULL')
    } else if (is(care_site_name, 'subQuery')){
      statement <- paste0(statement, ' care_site_name = (', as.character(care_site_name), ')')
    } else {
      statement <- paste0(statement, " care_site_name = '", care_site_name,"'")
    }
  }

  if (!missing(place_of_service_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(place_of_service_concept_id)) {
      statement <- paste0(statement, ' place_of_service_concept_id IS NULL')
    } else if (is(place_of_service_concept_id, 'subQuery')){
      statement <- paste0(statement, ' place_of_service_concept_id = (', as.character(place_of_service_concept_id), ')')
    } else {
      statement <- paste0(statement, " place_of_service_concept_id = '", place_of_service_concept_id,"'")
    }
  }

  if (!missing(location_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(location_id)) {
      statement <- paste0(statement, ' location_id IS NULL')
    } else if (is(location_id, 'subQuery')){
      statement <- paste0(statement, ' location_id = (', as.character(location_id), ')')
    } else {
      statement <- paste0(statement, " location_id = '", location_id,"'")
    }
  }

  if (!missing(care_site_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(care_site_source_value)) {
      statement <- paste0(statement, ' care_site_source_value IS NULL')
    } else if (is(care_site_source_value, 'subQuery')){
      statement <- paste0(statement, ' care_site_source_value = (', as.character(care_site_source_value), ')')
    } else {
      statement <- paste0(statement, " care_site_source_value = '", care_site_source_value,"'")
    }
  }

  if (!missing(place_of_service_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(place_of_service_source_value)) {
      statement <- paste0(statement, ' place_of_service_source_value IS NULL')
    } else if (is(place_of_service_source_value, 'subQuery')){
      statement <- paste0(statement, ' place_of_service_source_value = (', as.character(place_of_service_source_value), ')')
    } else {
      statement <- paste0(statement, " place_of_service_source_value = '", place_of_service_source_value,"'")
    }
  }

  statement <- paste0(statement, ') != ', rowCount , " THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_count_location <- function(rowCount, location_id, address_1, address_2, city, state, zip, county, location_source_value) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect location' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.location WHERE")
  first <- TRUE
  if (!missing(location_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(location_id)) {
      statement <- paste0(statement, ' location_id IS NULL')
    } else if (is(location_id, 'subQuery')){
      statement <- paste0(statement, ' location_id = (', as.character(location_id), ')')
    } else {
      statement <- paste0(statement, " location_id = '", location_id,"'")
    }
  }

  if (!missing(address_1)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(address_1)) {
      statement <- paste0(statement, ' address_1 IS NULL')
    } else if (is(address_1, 'subQuery')){
      statement <- paste0(statement, ' address_1 = (', as.character(address_1), ')')
    } else {
      statement <- paste0(statement, " address_1 = '", address_1,"'")
    }
  }

  if (!missing(address_2)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(address_2)) {
      statement <- paste0(statement, ' address_2 IS NULL')
    } else if (is(address_2, 'subQuery')){
      statement <- paste0(statement, ' address_2 = (', as.character(address_2), ')')
    } else {
      statement <- paste0(statement, " address_2 = '", address_2,"'")
    }
  }

  if (!missing(city)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(city)) {
      statement <- paste0(statement, ' city IS NULL')
    } else if (is(city, 'subQuery')){
      statement <- paste0(statement, ' city = (', as.character(city), ')')
    } else {
      statement <- paste0(statement, " city = '", city,"'")
    }
  }

  if (!missing(state)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(state)) {
      statement <- paste0(statement, ' state IS NULL')
    } else if (is(state, 'subQuery')){
      statement <- paste0(statement, ' state = (', as.character(state), ')')
    } else {
      statement <- paste0(statement, " state = '", state,"'")
    }
  }

  if (!missing(zip)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(zip)) {
      statement <- paste0(statement, ' zip IS NULL')
    } else if (is(zip, 'subQuery')){
      statement <- paste0(statement, ' zip = (', as.character(zip), ')')
    } else {
      statement <- paste0(statement, " zip = '", zip,"'")
    }
  }

  if (!missing(county)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(county)) {
      statement <- paste0(statement, ' county IS NULL')
    } else if (is(county, 'subQuery')){
      statement <- paste0(statement, ' county = (', as.character(county), ')')
    } else {
      statement <- paste0(statement, " county = '", county,"'")
    }
  }

  if (!missing(location_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(location_source_value)) {
      statement <- paste0(statement, ' location_source_value IS NULL')
    } else if (is(location_source_value, 'subQuery')){
      statement <- paste0(statement, ' location_source_value = (', as.character(location_source_value), ')')
    } else {
      statement <- paste0(statement, " location_source_value = '", location_source_value,"'")
    }
  }

  statement <- paste0(statement, ') != ', rowCount , " THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_count_provider <- function(rowCount, provider_id, provider_name, npi, dea, specialty_concept_id, care_site_id, year_of_birth, gender_concept_id, provider_source_value, specialty_source_value, specialty_source_concept_id, gender_source_value, gender_source_concept_id) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect provider' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.provider WHERE")
  first <- TRUE
  if (!missing(provider_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_id)) {
      statement <- paste0(statement, ' provider_id IS NULL')
    } else if (is(provider_id, 'subQuery')){
      statement <- paste0(statement, ' provider_id = (', as.character(provider_id), ')')
    } else {
      statement <- paste0(statement, " provider_id = '", provider_id,"'")
    }
  }

  if (!missing(provider_name)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_name)) {
      statement <- paste0(statement, ' provider_name IS NULL')
    } else if (is(provider_name, 'subQuery')){
      statement <- paste0(statement, ' provider_name = (', as.character(provider_name), ')')
    } else {
      statement <- paste0(statement, " provider_name = '", provider_name,"'")
    }
  }

  if (!missing(npi)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(npi)) {
      statement <- paste0(statement, ' npi IS NULL')
    } else if (is(npi, 'subQuery')){
      statement <- paste0(statement, ' npi = (', as.character(npi), ')')
    } else {
      statement <- paste0(statement, " npi = '", npi,"'")
    }
  }

  if (!missing(dea)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(dea)) {
      statement <- paste0(statement, ' dea IS NULL')
    } else if (is(dea, 'subQuery')){
      statement <- paste0(statement, ' dea = (', as.character(dea), ')')
    } else {
      statement <- paste0(statement, " dea = '", dea,"'")
    }
  }

  if (!missing(specialty_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(specialty_concept_id)) {
      statement <- paste0(statement, ' specialty_concept_id IS NULL')
    } else if (is(specialty_concept_id, 'subQuery')){
      statement <- paste0(statement, ' specialty_concept_id = (', as.character(specialty_concept_id), ')')
    } else {
      statement <- paste0(statement, " specialty_concept_id = '", specialty_concept_id,"'")
    }
  }

  if (!missing(care_site_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(care_site_id)) {
      statement <- paste0(statement, ' care_site_id IS NULL')
    } else if (is(care_site_id, 'subQuery')){
      statement <- paste0(statement, ' care_site_id = (', as.character(care_site_id), ')')
    } else {
      statement <- paste0(statement, " care_site_id = '", care_site_id,"'")
    }
  }

  if (!missing(year_of_birth)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(year_of_birth)) {
      statement <- paste0(statement, ' year_of_birth IS NULL')
    } else if (is(year_of_birth, 'subQuery')){
      statement <- paste0(statement, ' year_of_birth = (', as.character(year_of_birth), ')')
    } else {
      statement <- paste0(statement, " year_of_birth = '", year_of_birth,"'")
    }
  }

  if (!missing(gender_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(gender_concept_id)) {
      statement <- paste0(statement, ' gender_concept_id IS NULL')
    } else if (is(gender_concept_id, 'subQuery')){
      statement <- paste0(statement, ' gender_concept_id = (', as.character(gender_concept_id), ')')
    } else {
      statement <- paste0(statement, " gender_concept_id = '", gender_concept_id,"'")
    }
  }

  if (!missing(provider_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_source_value)) {
      statement <- paste0(statement, ' provider_source_value IS NULL')
    } else if (is(provider_source_value, 'subQuery')){
      statement <- paste0(statement, ' provider_source_value = (', as.character(provider_source_value), ')')
    } else {
      statement <- paste0(statement, " provider_source_value = '", provider_source_value,"'")
    }
  }

  if (!missing(specialty_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(specialty_source_value)) {
      statement <- paste0(statement, ' specialty_source_value IS NULL')
    } else if (is(specialty_source_value, 'subQuery')){
      statement <- paste0(statement, ' specialty_source_value = (', as.character(specialty_source_value), ')')
    } else {
      statement <- paste0(statement, " specialty_source_value = '", specialty_source_value,"'")
    }
  }

  if (!missing(specialty_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(specialty_source_concept_id)) {
      statement <- paste0(statement, ' specialty_source_concept_id IS NULL')
    } else if (is(specialty_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' specialty_source_concept_id = (', as.character(specialty_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " specialty_source_concept_id = '", specialty_source_concept_id,"'")
    }
  }

  if (!missing(gender_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(gender_source_value)) {
      statement <- paste0(statement, ' gender_source_value IS NULL')
    } else if (is(gender_source_value, 'subQuery')){
      statement <- paste0(statement, ' gender_source_value = (', as.character(gender_source_value), ')')
    } else {
      statement <- paste0(statement, " gender_source_value = '", gender_source_value,"'")
    }
  }

  if (!missing(gender_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(gender_source_concept_id)) {
      statement <- paste0(statement, ' gender_source_concept_id IS NULL')
    } else if (is(gender_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' gender_source_concept_id = (', as.character(gender_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " gender_source_concept_id = '", gender_source_concept_id,"'")
    }
  }

  statement <- paste0(statement, ') != ', rowCount , " THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_count_cdm_source <- function(rowCount, cdm_source_name, cdm_source_abbreviation, cdm_holder, source_description, source_documentation_reference, cdm_etl__reference, source_release_date, cdm_release_date, cdm_version, vocabulary_version) {

  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect cdm_source' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.cdm_source WHERE")
  first <- TRUE
  if (!missing(cdm_source_name)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cdm_source_name)) {
      statement <- paste0(statement, ' cdm_source_name IS NULL')
    } else if (is(cdm_source_name, 'subQuery')){
      statement <- paste0(statement, ' cdm_source_name = (', as.character(cdm_source_name), ')')
    } else {
      statement <- paste0(statement, " cdm_source_name = '", cdm_source_name,"'")
    }
  }

  if (!missing(cdm_source_abbreviation)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cdm_source_abbreviation)) {
      statement <- paste0(statement, ' cdm_source_abbreviation IS NULL')
    } else if (is(cdm_source_abbreviation, 'subQuery')){
      statement <- paste0(statement, ' cdm_source_abbreviation = (', as.character(cdm_source_abbreviation), ')')
    } else {
      statement <- paste0(statement, " cdm_source_abbreviation = '", cdm_source_abbreviation,"'")
    }
  }

  if (!missing(cdm_holder)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cdm_holder)) {
      statement <- paste0(statement, ' cdm_holder IS NULL')
    } else if (is(cdm_holder, 'subQuery')){
      statement <- paste0(statement, ' cdm_holder = (', as.character(cdm_holder), ')')
    } else {
      statement <- paste0(statement, " cdm_holder = '", cdm_holder,"'")
    }
  }

  if (!missing(source_description)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(source_description)) {
      statement <- paste0(statement, ' source_description IS NULL')
    } else if (is(source_description, 'subQuery')){
      statement <- paste0(statement, ' source_description = (', as.character(source_description), ')')
    } else {
      statement <- paste0(statement, " source_description = '", source_description,"'")
    }
  }

  if (!missing(source_documentation_reference)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(source_documentation_reference)) {
      statement <- paste0(statement, ' source_documentation_reference IS NULL')
    } else if (is(source_documentation_reference, 'subQuery')){
      statement <- paste0(statement, ' source_documentation_reference = (', as.character(source_documentation_reference), ')')
    } else {
      statement <- paste0(statement, " source_documentation_reference = '", source_documentation_reference,"'")
    }
  }

  if (!missing(cdm_etl__reference)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cdm_etl__reference)) {
      statement <- paste0(statement, ' [cdm_etl _reference] IS NULL')
    } else if (is(cdm_etl__reference, 'subQuery')){
      statement <- paste0(statement, ' [cdm_etl _reference] = (', as.character(cdm_etl__reference), ')')
    } else {
      statement <- paste0(statement, " [cdm_etl _reference] = '", cdm_etl__reference,"'")
    }
  }

  if (!missing(source_release_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(source_release_date)) {
      statement <- paste0(statement, ' source_release_date IS NULL')
    } else if (is(source_release_date, 'subQuery')){
      statement <- paste0(statement, ' source_release_date = (', as.character(source_release_date), ')')
    } else {
      statement <- paste0(statement, " source_release_date = '", source_release_date,"'")
    }
  }

  if (!missing(cdm_release_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cdm_release_date)) {
      statement <- paste0(statement, ' cdm_release_date IS NULL')
    } else if (is(cdm_release_date, 'subQuery')){
      statement <- paste0(statement, ' cdm_release_date = (', as.character(cdm_release_date), ')')
    } else {
      statement <- paste0(statement, " cdm_release_date = '", cdm_release_date,"'")
    }
  }

  if (!missing(cdm_version)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cdm_version)) {
      statement <- paste0(statement, ' cdm_version IS NULL')
    } else if (is(cdm_version, 'subQuery')){
      statement <- paste0(statement, ' cdm_version = (', as.character(cdm_version), ')')
    } else {
      statement <- paste0(statement, " cdm_version = '", cdm_version,"'")
    }
  }

  if (!missing(vocabulary_version)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(vocabulary_version)) {
      statement <- paste0(statement, ' vocabulary_version IS NULL')
    } else if (is(vocabulary_version, 'subQuery')){
      statement <- paste0(statement, ' vocabulary_version = (', as.character(vocabulary_version), ')')
    } else {
      statement <- paste0(statement, " vocabulary_version = '", vocabulary_version,"'")
    }
  }

  statement <- paste0(statement, ') != ', rowCount , " THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_count_attribute_definition <- function(rowCount, attribute_definition_id, attribute_name, attribute_description, attribute_type_concept_id, attribute_syntax) {
  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect attribute_definition' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.attribute_definition WHERE")
  first <- TRUE
  if (!missing(attribute_definition_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(attribute_definition_id)) {
      statement <- paste0(statement, ' attribute_definition_id IS NULL')
    } else if (is(attribute_definition_id, 'subQuery')){
      statement <- paste0(statement, ' attribute_definition_id = (', as.character(attribute_definition_id), ')')
    } else {
      statement <- paste0(statement, " attribute_definition_id = '", attribute_definition_id,"'")
    }
  }

  if (!missing(attribute_name)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(attribute_name)) {
      statement <- paste0(statement, ' attribute_name IS NULL')
    } else if (is(attribute_name, 'subQuery')){
      statement <- paste0(statement, ' attribute_name = (', as.character(attribute_name), ')')
    } else {
      statement <- paste0(statement, " attribute_name = '", attribute_name,"'")
    }
  }

  if (!missing(attribute_description)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(attribute_description)) {
      statement <- paste0(statement, ' attribute_description IS NULL')
    } else if (is(attribute_description, 'subQuery')){
      statement <- paste0(statement, ' attribute_description = (', as.character(attribute_description), ')')
    } else {
      statement <- paste0(statement, " attribute_description = '", attribute_description,"'")
    }
  }

  if (!missing(attribute_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(attribute_type_concept_id)) {
      statement <- paste0(statement, ' attribute_type_concept_id IS NULL')
    } else if (is(attribute_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' attribute_type_concept_id = (', as.character(attribute_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " attribute_type_concept_id = '", attribute_type_concept_id,"'")
    }
  }

  if (!missing(attribute_syntax)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(attribute_syntax)) {
      statement <- paste0(statement, ' attribute_syntax IS NULL')
    } else if (is(attribute_syntax, 'subQuery')){
      statement <- paste0(statement, ' attribute_syntax = (', as.character(attribute_syntax), ')')
    } else {
      statement <- paste0(statement, " attribute_syntax = '", attribute_syntax,"'")
    }
  }

  statement <- paste0(statement, ') != ', rowCount , " THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

expect_count_cohort_definition <- function(rowCount, cohort_definition_id, cohort_definition_name, cohort_definition_description, definition_type_concept_id, cohort_definition_syntax, subject_concept_id, cohort_instantiation_date) {

  source_pid <- get("source_pid", envir = globalenv());
  if (is.null(source_pid)) {
    source_pid <- "NULL";
  } else {
    source_pid <- paste0("'", as.character(source_pid), "'");
  }

  cdm_pid <- get("cdm_pid", envir = globalenv());
  if (is.null(cdm_pid)) {
    cdm_pid <- "NULL"
  }

  statement <- paste0("INSERT INTO @cdmDatabaseSchema.test_results SELECT ", get("testId", envir = globalenv()), " AS id, '", get("testDescription", envir = globalenv()), "' AS description, ", cdm_pid, " AS cdm_pid, ", source_pid, " AS source_pid, 'Expect cohort_definition' AS test, CASE WHEN(SELECT COUNT(*) FROM @cdmDatabaseSchema.cohort_definition WHERE")
  first <- TRUE
  if (!missing(cohort_definition_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cohort_definition_id)) {
      statement <- paste0(statement, ' cohort_definition_id IS NULL')
    } else if (is(cohort_definition_id, 'subQuery')){
      statement <- paste0(statement, ' cohort_definition_id = (', as.character(cohort_definition_id), ')')
    } else {
      statement <- paste0(statement, " cohort_definition_id = '", cohort_definition_id,"'")
    }
  }

  if (!missing(cohort_definition_name)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cohort_definition_name)) {
      statement <- paste0(statement, ' cohort_definition_name IS NULL')
    } else if (is(cohort_definition_name, 'subQuery')){
      statement <- paste0(statement, ' cohort_definition_name = (', as.character(cohort_definition_name), ')')
    } else {
      statement <- paste0(statement, " cohort_definition_name = '", cohort_definition_name,"'")
    }
  }

  if (!missing(cohort_definition_description)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cohort_definition_description)) {
      statement <- paste0(statement, ' cohort_definition_description IS NULL')
    } else if (is(cohort_definition_description, 'subQuery')){
      statement <- paste0(statement, ' cohort_definition_description = (', as.character(cohort_definition_description), ')')
    } else {
      statement <- paste0(statement, " cohort_definition_description = '", cohort_definition_description,"'")
    }
  }

  if (!missing(definition_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(definition_type_concept_id)) {
      statement <- paste0(statement, ' definition_type_concept_id IS NULL')
    } else if (is(definition_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' definition_type_concept_id = (', as.character(definition_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " definition_type_concept_id = '", definition_type_concept_id,"'")
    }
  }

  if (!missing(cohort_definition_syntax)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cohort_definition_syntax)) {
      statement <- paste0(statement, ' cohort_definition_syntax IS NULL')
    } else if (is(cohort_definition_syntax, 'subQuery')){
      statement <- paste0(statement, ' cohort_definition_syntax = (', as.character(cohort_definition_syntax), ')')
    } else {
      statement <- paste0(statement, " cohort_definition_syntax = '", cohort_definition_syntax,"'")
    }
  }

  if (!missing(subject_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(subject_concept_id)) {
      statement <- paste0(statement, ' subject_concept_id IS NULL')
    } else if (is(subject_concept_id, 'subQuery')){
      statement <- paste0(statement, ' subject_concept_id = (', as.character(subject_concept_id), ')')
    } else {
      statement <- paste0(statement, " subject_concept_id = '", subject_concept_id,"'")
    }
  }

  if (!missing(cohort_instantiation_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cohort_instantiation_date)) {
      statement <- paste0(statement, ' cohort_instantiation_date IS NULL')
    } else if (is(cohort_instantiation_date, 'subQuery')){
      statement <- paste0(statement, ' cohort_instantiation_date = (', as.character(cohort_instantiation_date), ')')
    } else {
      statement <- paste0(statement, " cohort_instantiation_date = '", cohort_instantiation_date,"'")
    }
  }

  statement <- paste0(statement, ') != ', rowCount , " THEN 'FAIL' ELSE 'PASS' END AS status")
  if (exists('testNewExpected', where = globalenv()) && get('testNewExpected'))
  {
    assign('testNewExpected', FALSE, envir = globalenv())
    id <- get('testId', envir = globalenv())
    description <- get('testDescription', envir = globalenv())
    comment <- paste0('-- ', id, ': ', description)
    testSql <<- c(testSql, comment)
  }
  testSql <<- c(testSql, statement)
  invisible(statement)
}

lookup_condition_occurrence <- function(fetchField, condition_occurrence_id, person_id, condition_concept_id, condition_start_date, condition_start_datetime, condition_end_date, condition_end_datetime, condition_type_concept_id, stop_reason, provider_id, visit_occurrence_id, visit_detail_id, condition_source_value, condition_source_concept_id, condition_status_source_value, condition_status_concept_id) {
  statement <- paste0('SELECT ', fetchField , ' FROM condition_occurrence WHERE')
  first <- TRUE
  if (!missing(condition_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_occurrence_id)) {
      statement <- paste0(statement, ' condition_occurrence_id IS NULL')
    } else if (is(condition_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' condition_occurrence_id = (', as.character(condition_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " condition_occurrence_id = '", condition_occurrence_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(condition_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_concept_id)) {
      statement <- paste0(statement, ' condition_concept_id IS NULL')
    } else if (is(condition_concept_id, 'subQuery')){
      statement <- paste0(statement, ' condition_concept_id = (', as.character(condition_concept_id), ')')
    } else {
      statement <- paste0(statement, " condition_concept_id = '", condition_concept_id,"'")
    }
  }

  if (!missing(condition_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_start_date)) {
      statement <- paste0(statement, ' condition_start_date IS NULL')
    } else if (is(condition_start_date, 'subQuery')){
      statement <- paste0(statement, ' condition_start_date = (', as.character(condition_start_date), ')')
    } else {
      statement <- paste0(statement, " condition_start_date = '", condition_start_date,"'")
    }
  }

  if (!missing(condition_start_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_start_datetime)) {
      statement <- paste0(statement, ' condition_start_datetime IS NULL')
    } else if (is(condition_start_datetime, 'subQuery')){
      statement <- paste0(statement, ' condition_start_datetime = (', as.character(condition_start_datetime), ')')
    } else {
      statement <- paste0(statement, " condition_start_datetime = '", condition_start_datetime,"'")
    }
  }

  if (!missing(condition_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_end_date)) {
      statement <- paste0(statement, ' condition_end_date IS NULL')
    } else if (is(condition_end_date, 'subQuery')){
      statement <- paste0(statement, ' condition_end_date = (', as.character(condition_end_date), ')')
    } else {
      statement <- paste0(statement, " condition_end_date = '", condition_end_date,"'")
    }
  }

  if (!missing(condition_end_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_end_datetime)) {
      statement <- paste0(statement, ' condition_end_datetime IS NULL')
    } else if (is(condition_end_datetime, 'subQuery')){
      statement <- paste0(statement, ' condition_end_datetime = (', as.character(condition_end_datetime), ')')
    } else {
      statement <- paste0(statement, " condition_end_datetime = '", condition_end_datetime,"'")
    }
  }

  if (!missing(condition_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_type_concept_id)) {
      statement <- paste0(statement, ' condition_type_concept_id IS NULL')
    } else if (is(condition_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' condition_type_concept_id = (', as.character(condition_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " condition_type_concept_id = '", condition_type_concept_id,"'")
    }
  }

  if (!missing(stop_reason)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(stop_reason)) {
      statement <- paste0(statement, ' stop_reason IS NULL')
    } else if (is(stop_reason, 'subQuery')){
      statement <- paste0(statement, ' stop_reason = (', as.character(stop_reason), ')')
    } else {
      statement <- paste0(statement, " stop_reason = '", stop_reason,"'")
    }
  }

  if (!missing(provider_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_id)) {
      statement <- paste0(statement, ' provider_id IS NULL')
    } else if (is(provider_id, 'subQuery')){
      statement <- paste0(statement, ' provider_id = (', as.character(provider_id), ')')
    } else {
      statement <- paste0(statement, " provider_id = '", provider_id,"'")
    }
  }

  if (!missing(visit_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_occurrence_id)) {
      statement <- paste0(statement, ' visit_occurrence_id IS NULL')
    } else if (is(visit_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' visit_occurrence_id = (', as.character(visit_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " visit_occurrence_id = '", visit_occurrence_id,"'")
    }
  }

  if (!missing(visit_detail_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_detail_id)) {
      statement <- paste0(statement, ' visit_detail_id IS NULL')
    } else if (is(visit_detail_id, 'subQuery')){
      statement <- paste0(statement, ' visit_detail_id = (', as.character(visit_detail_id), ')')
    } else {
      statement <- paste0(statement, " visit_detail_id = '", visit_detail_id,"'")
    }
  }

  if (!missing(condition_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_source_value)) {
      statement <- paste0(statement, ' condition_source_value IS NULL')
    } else if (is(condition_source_value, 'subQuery')){
      statement <- paste0(statement, ' condition_source_value = (', as.character(condition_source_value), ')')
    } else {
      statement <- paste0(statement, " condition_source_value = '", condition_source_value,"'")
    }
  }

  if (!missing(condition_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_source_concept_id)) {
      statement <- paste0(statement, ' condition_source_concept_id IS NULL')
    } else if (is(condition_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' condition_source_concept_id = (', as.character(condition_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " condition_source_concept_id = '", condition_source_concept_id,"'")
    }
  }

  if (!missing(condition_status_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_status_source_value)) {
      statement <- paste0(statement, ' condition_status_source_value IS NULL')
    } else if (is(condition_status_source_value, 'subQuery')){
      statement <- paste0(statement, ' condition_status_source_value = (', as.character(condition_status_source_value), ')')
    } else {
      statement <- paste0(statement, " condition_status_source_value = '", condition_status_source_value,"'")
    }
  }

  if (!missing(condition_status_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_status_concept_id)) {
      statement <- paste0(statement, ' condition_status_concept_id IS NULL')
    } else if (is(condition_status_concept_id, 'subQuery')){
      statement <- paste0(statement, ' condition_status_concept_id = (', as.character(condition_status_concept_id), ')')
    } else {
      statement <- paste0(statement, " condition_status_concept_id = '", condition_status_concept_id,"'")
    }
  }

  class(statement) <- 'subQuery'
  return(statement)
}

lookup_death <- function(fetchField, person_id, death_date, death_datetime, death_type_concept_id, cause_concept_id, cause_source_value, cause_source_concept_id) {
  statement <- paste0('SELECT ', fetchField , ' FROM death WHERE')
  first <- TRUE
  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(death_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(death_date)) {
      statement <- paste0(statement, ' death_date IS NULL')
    } else if (is(death_date, 'subQuery')){
      statement <- paste0(statement, ' death_date = (', as.character(death_date), ')')
    } else {
      statement <- paste0(statement, " death_date = '", death_date,"'")
    }
  }

  if (!missing(death_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(death_datetime)) {
      statement <- paste0(statement, ' death_datetime IS NULL')
    } else if (is(death_datetime, 'subQuery')){
      statement <- paste0(statement, ' death_datetime = (', as.character(death_datetime), ')')
    } else {
      statement <- paste0(statement, " death_datetime = '", death_datetime,"'")
    }
  }

  if (!missing(death_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(death_type_concept_id)) {
      statement <- paste0(statement, ' death_type_concept_id IS NULL')
    } else if (is(death_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' death_type_concept_id = (', as.character(death_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " death_type_concept_id = '", death_type_concept_id,"'")
    }
  }

  if (!missing(cause_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cause_concept_id)) {
      statement <- paste0(statement, ' cause_concept_id IS NULL')
    } else if (is(cause_concept_id, 'subQuery')){
      statement <- paste0(statement, ' cause_concept_id = (', as.character(cause_concept_id), ')')
    } else {
      statement <- paste0(statement, " cause_concept_id = '", cause_concept_id,"'")
    }
  }

  if (!missing(cause_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cause_source_value)) {
      statement <- paste0(statement, ' cause_source_value IS NULL')
    } else if (is(cause_source_value, 'subQuery')){
      statement <- paste0(statement, ' cause_source_value = (', as.character(cause_source_value), ')')
    } else {
      statement <- paste0(statement, " cause_source_value = '", cause_source_value,"'")
    }
  }

  if (!missing(cause_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cause_source_concept_id)) {
      statement <- paste0(statement, ' cause_source_concept_id IS NULL')
    } else if (is(cause_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' cause_source_concept_id = (', as.character(cause_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " cause_source_concept_id = '", cause_source_concept_id,"'")
    }
  }

  class(statement) <- 'subQuery'
  return(statement)
}

lookup_device_exposure <- function(fetchField, device_exposure_id, person_id, device_concept_id, device_exposure_start_date, device_exposure_start_datetime, device_exposure_end_date, device_exposure_end_datetime, device_type_concept_id, unique_device_id, quantity, provider_id, visit_occurrence_id, device_source_value, device_source__concept_id, visit_detail_id) {
  statement <- paste0('SELECT ', fetchField , ' FROM device_exposure WHERE')
  first <- TRUE
  if (!missing(device_exposure_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(device_exposure_id)) {
      statement <- paste0(statement, ' device_exposure_id IS NULL')
    } else if (is(device_exposure_id, 'subQuery')){
      statement <- paste0(statement, ' device_exposure_id = (', as.character(device_exposure_id), ')')
    } else {
      statement <- paste0(statement, " device_exposure_id = '", device_exposure_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(device_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(device_concept_id)) {
      statement <- paste0(statement, ' device_concept_id IS NULL')
    } else if (is(device_concept_id, 'subQuery')){
      statement <- paste0(statement, ' device_concept_id = (', as.character(device_concept_id), ')')
    } else {
      statement <- paste0(statement, " device_concept_id = '", device_concept_id,"'")
    }
  }

  if (!missing(device_exposure_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(device_exposure_start_date)) {
      statement <- paste0(statement, ' device_exposure_start_date IS NULL')
    } else if (is(device_exposure_start_date, 'subQuery')){
      statement <- paste0(statement, ' device_exposure_start_date = (', as.character(device_exposure_start_date), ')')
    } else {
      statement <- paste0(statement, " device_exposure_start_date = '", device_exposure_start_date,"'")
    }
  }

  if (!missing(device_exposure_start_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(device_exposure_start_datetime)) {
      statement <- paste0(statement, ' device_exposure_start_datetime IS NULL')
    } else if (is(device_exposure_start_datetime, 'subQuery')){
      statement <- paste0(statement, ' device_exposure_start_datetime = (', as.character(device_exposure_start_datetime), ')')
    } else {
      statement <- paste0(statement, " device_exposure_start_datetime = '", device_exposure_start_datetime,"'")
    }
  }

  if (!missing(device_exposure_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(device_exposure_end_date)) {
      statement <- paste0(statement, ' device_exposure_end_date IS NULL')
    } else if (is(device_exposure_end_date, 'subQuery')){
      statement <- paste0(statement, ' device_exposure_end_date = (', as.character(device_exposure_end_date), ')')
    } else {
      statement <- paste0(statement, " device_exposure_end_date = '", device_exposure_end_date,"'")
    }
  }

  if (!missing(device_exposure_end_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(device_exposure_end_datetime)) {
      statement <- paste0(statement, ' device_exposure_end_datetime IS NULL')
    } else if (is(device_exposure_end_datetime, 'subQuery')){
      statement <- paste0(statement, ' device_exposure_end_datetime = (', as.character(device_exposure_end_datetime), ')')
    } else {
      statement <- paste0(statement, " device_exposure_end_datetime = '", device_exposure_end_datetime,"'")
    }
  }

  if (!missing(device_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(device_type_concept_id)) {
      statement <- paste0(statement, ' device_type_concept_id IS NULL')
    } else if (is(device_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' device_type_concept_id = (', as.character(device_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " device_type_concept_id = '", device_type_concept_id,"'")
    }
  }

  if (!missing(unique_device_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(unique_device_id)) {
      statement <- paste0(statement, ' unique_device_id IS NULL')
    } else if (is(unique_device_id, 'subQuery')){
      statement <- paste0(statement, ' unique_device_id = (', as.character(unique_device_id), ')')
    } else {
      statement <- paste0(statement, " unique_device_id = '", unique_device_id,"'")
    }
  }

  if (!missing(quantity)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(quantity)) {
      statement <- paste0(statement, ' quantity IS NULL')
    } else if (is(quantity, 'subQuery')){
      statement <- paste0(statement, ' quantity = (', as.character(quantity), ')')
    } else {
      statement <- paste0(statement, " quantity = '", quantity,"'")
    }
  }

  if (!missing(provider_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_id)) {
      statement <- paste0(statement, ' provider_id IS NULL')
    } else if (is(provider_id, 'subQuery')){
      statement <- paste0(statement, ' provider_id = (', as.character(provider_id), ')')
    } else {
      statement <- paste0(statement, " provider_id = '", provider_id,"'")
    }
  }

  if (!missing(visit_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_occurrence_id)) {
      statement <- paste0(statement, ' visit_occurrence_id IS NULL')
    } else if (is(visit_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' visit_occurrence_id = (', as.character(visit_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " visit_occurrence_id = '", visit_occurrence_id,"'")
    }
  }

  if (!missing(device_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(device_source_value)) {
      statement <- paste0(statement, ' device_source_value IS NULL')
    } else if (is(device_source_value, 'subQuery')){
      statement <- paste0(statement, ' device_source_value = (', as.character(device_source_value), ')')
    } else {
      statement <- paste0(statement, " device_source_value = '", device_source_value,"'")
    }
  }

  if (!missing(device_source__concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(device_source__concept_id)) {
      statement <- paste0(statement, ' [device_source_ concept_id] IS NULL')
    } else if (is(device_source__concept_id, 'subQuery')){
      statement <- paste0(statement, ' [device_source_ concept_id] = (', as.character(device_source__concept_id), ')')
    } else {
      statement <- paste0(statement, " [device_source_ concept_id] = '", device_source__concept_id,"'")
    }
  }

  if (!missing(visit_detail_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_detail_id)) {
      statement <- paste0(statement, ' visit_detail_id IS NULL')
    } else if (is(visit_detail_id, 'subQuery')){
      statement <- paste0(statement, ' visit_detail_id = (', as.character(visit_detail_id), ')')
    } else {
      statement <- paste0(statement, " visit_detail_id = '", visit_detail_id,"'")
    }
  }

  class(statement) <- 'subQuery'
  return(statement)
}

lookup_drug_exposure <- function(fetchField, drug_exposure_id, person_id, drug_concept_id, drug_exposure_start_date, drug_exposure_start_datetime, drug_exposure_end_date, drug_exposure_end_datetime, verbatim_end_date, drug_type_concept_id, stop_reason, refills, quantity, days_supply, sig, route_concept_id, lot_number, provider_id, visit_occurrence_id, drug_source_value, drug_source_concept_id, route_source_value, dose_unit_source_value, visit_detail_id) {
  statement <- paste0('SELECT ', fetchField , ' FROM drug_exposure WHERE')
  first <- TRUE
  if (!missing(drug_exposure_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_exposure_id)) {
      statement <- paste0(statement, ' drug_exposure_id IS NULL')
    } else if (is(drug_exposure_id, 'subQuery')){
      statement <- paste0(statement, ' drug_exposure_id = (', as.character(drug_exposure_id), ')')
    } else {
      statement <- paste0(statement, " drug_exposure_id = '", drug_exposure_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(drug_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_concept_id)) {
      statement <- paste0(statement, ' drug_concept_id IS NULL')
    } else if (is(drug_concept_id, 'subQuery')){
      statement <- paste0(statement, ' drug_concept_id = (', as.character(drug_concept_id), ')')
    } else {
      statement <- paste0(statement, " drug_concept_id = '", drug_concept_id,"'")
    }
  }

  if (!missing(drug_exposure_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_exposure_start_date)) {
      statement <- paste0(statement, ' drug_exposure_start_date IS NULL')
    } else if (is(drug_exposure_start_date, 'subQuery')){
      statement <- paste0(statement, ' drug_exposure_start_date = (', as.character(drug_exposure_start_date), ')')
    } else {
      statement <- paste0(statement, " drug_exposure_start_date = '", drug_exposure_start_date,"'")
    }
  }

  if (!missing(drug_exposure_start_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_exposure_start_datetime)) {
      statement <- paste0(statement, ' drug_exposure_start_datetime IS NULL')
    } else if (is(drug_exposure_start_datetime, 'subQuery')){
      statement <- paste0(statement, ' drug_exposure_start_datetime = (', as.character(drug_exposure_start_datetime), ')')
    } else {
      statement <- paste0(statement, " drug_exposure_start_datetime = '", drug_exposure_start_datetime,"'")
    }
  }

  if (!missing(drug_exposure_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_exposure_end_date)) {
      statement <- paste0(statement, ' drug_exposure_end_date IS NULL')
    } else if (is(drug_exposure_end_date, 'subQuery')){
      statement <- paste0(statement, ' drug_exposure_end_date = (', as.character(drug_exposure_end_date), ')')
    } else {
      statement <- paste0(statement, " drug_exposure_end_date = '", drug_exposure_end_date,"'")
    }
  }

  if (!missing(drug_exposure_end_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_exposure_end_datetime)) {
      statement <- paste0(statement, ' drug_exposure_end_datetime IS NULL')
    } else if (is(drug_exposure_end_datetime, 'subQuery')){
      statement <- paste0(statement, ' drug_exposure_end_datetime = (', as.character(drug_exposure_end_datetime), ')')
    } else {
      statement <- paste0(statement, " drug_exposure_end_datetime = '", drug_exposure_end_datetime,"'")
    }
  }

  if (!missing(verbatim_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(verbatim_end_date)) {
      statement <- paste0(statement, ' verbatim_end_date IS NULL')
    } else if (is(verbatim_end_date, 'subQuery')){
      statement <- paste0(statement, ' verbatim_end_date = (', as.character(verbatim_end_date), ')')
    } else {
      statement <- paste0(statement, " verbatim_end_date = '", verbatim_end_date,"'")
    }
  }

  if (!missing(drug_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_type_concept_id)) {
      statement <- paste0(statement, ' drug_type_concept_id IS NULL')
    } else if (is(drug_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' drug_type_concept_id = (', as.character(drug_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " drug_type_concept_id = '", drug_type_concept_id,"'")
    }
  }

  if (!missing(stop_reason)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(stop_reason)) {
      statement <- paste0(statement, ' stop_reason IS NULL')
    } else if (is(stop_reason, 'subQuery')){
      statement <- paste0(statement, ' stop_reason = (', as.character(stop_reason), ')')
    } else {
      statement <- paste0(statement, " stop_reason = '", stop_reason,"'")
    }
  }

  if (!missing(refills)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(refills)) {
      statement <- paste0(statement, ' refills IS NULL')
    } else if (is(refills, 'subQuery')){
      statement <- paste0(statement, ' refills = (', as.character(refills), ')')
    } else {
      statement <- paste0(statement, " refills = '", refills,"'")
    }
  }

  if (!missing(quantity)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(quantity)) {
      statement <- paste0(statement, ' quantity IS NULL')
    } else if (is(quantity, 'subQuery')){
      statement <- paste0(statement, ' quantity = (', as.character(quantity), ')')
    } else {
      statement <- paste0(statement, " quantity = '", quantity,"'")
    }
  }

  if (!missing(days_supply)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(days_supply)) {
      statement <- paste0(statement, ' days_supply IS NULL')
    } else if (is(days_supply, 'subQuery')){
      statement <- paste0(statement, ' days_supply = (', as.character(days_supply), ')')
    } else {
      statement <- paste0(statement, " days_supply = '", days_supply,"'")
    }
  }

  if (!missing(sig)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(sig)) {
      statement <- paste0(statement, ' sig IS NULL')
    } else if (is(sig, 'subQuery')){
      statement <- paste0(statement, ' sig = (', as.character(sig), ')')
    } else {
      statement <- paste0(statement, " sig = '", sig,"'")
    }
  }

  if (!missing(route_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(route_concept_id)) {
      statement <- paste0(statement, ' route_concept_id IS NULL')
    } else if (is(route_concept_id, 'subQuery')){
      statement <- paste0(statement, ' route_concept_id = (', as.character(route_concept_id), ')')
    } else {
      statement <- paste0(statement, " route_concept_id = '", route_concept_id,"'")
    }
  }

  if (!missing(lot_number)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(lot_number)) {
      statement <- paste0(statement, ' lot_number IS NULL')
    } else if (is(lot_number, 'subQuery')){
      statement <- paste0(statement, ' lot_number = (', as.character(lot_number), ')')
    } else {
      statement <- paste0(statement, " lot_number = '", lot_number,"'")
    }
  }

  if (!missing(provider_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_id)) {
      statement <- paste0(statement, ' provider_id IS NULL')
    } else if (is(provider_id, 'subQuery')){
      statement <- paste0(statement, ' provider_id = (', as.character(provider_id), ')')
    } else {
      statement <- paste0(statement, " provider_id = '", provider_id,"'")
    }
  }

  if (!missing(visit_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_occurrence_id)) {
      statement <- paste0(statement, ' visit_occurrence_id IS NULL')
    } else if (is(visit_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' visit_occurrence_id = (', as.character(visit_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " visit_occurrence_id = '", visit_occurrence_id,"'")
    }
  }

  if (!missing(drug_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_source_value)) {
      statement <- paste0(statement, ' drug_source_value IS NULL')
    } else if (is(drug_source_value, 'subQuery')){
      statement <- paste0(statement, ' drug_source_value = (', as.character(drug_source_value), ')')
    } else {
      statement <- paste0(statement, " drug_source_value = '", drug_source_value,"'")
    }
  }

  if (!missing(drug_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_source_concept_id)) {
      statement <- paste0(statement, ' drug_source_concept_id IS NULL')
    } else if (is(drug_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' drug_source_concept_id = (', as.character(drug_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " drug_source_concept_id = '", drug_source_concept_id,"'")
    }
  }

  if (!missing(route_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(route_source_value)) {
      statement <- paste0(statement, ' route_source_value IS NULL')
    } else if (is(route_source_value, 'subQuery')){
      statement <- paste0(statement, ' route_source_value = (', as.character(route_source_value), ')')
    } else {
      statement <- paste0(statement, " route_source_value = '", route_source_value,"'")
    }
  }

  if (!missing(dose_unit_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(dose_unit_source_value)) {
      statement <- paste0(statement, ' dose_unit_source_value IS NULL')
    } else if (is(dose_unit_source_value, 'subQuery')){
      statement <- paste0(statement, ' dose_unit_source_value = (', as.character(dose_unit_source_value), ')')
    } else {
      statement <- paste0(statement, " dose_unit_source_value = '", dose_unit_source_value,"'")
    }
  }

  if (!missing(visit_detail_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_detail_id)) {
      statement <- paste0(statement, ' visit_detail_id IS NULL')
    } else if (is(visit_detail_id, 'subQuery')){
      statement <- paste0(statement, ' visit_detail_id = (', as.character(visit_detail_id), ')')
    } else {
      statement <- paste0(statement, " visit_detail_id = '", visit_detail_id,"'")
    }
  }

  class(statement) <- 'subQuery'
  return(statement)
}

lookup_fact_relationship <- function(fetchField, domain_concept_id_1, fact_id_1, domain_concept_id_2, fact_id_2, relationship_concept_id) {
  statement <- paste0('SELECT ', fetchField , ' FROM fact_relationship WHERE')
  first <- TRUE
  if (!missing(domain_concept_id_1)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(domain_concept_id_1)) {
      statement <- paste0(statement, ' domain_concept_id_1 IS NULL')
    } else if (is(domain_concept_id_1, 'subQuery')){
      statement <- paste0(statement, ' domain_concept_id_1 = (', as.character(domain_concept_id_1), ')')
    } else {
      statement <- paste0(statement, " domain_concept_id_1 = '", domain_concept_id_1,"'")
    }
  }

  if (!missing(fact_id_1)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(fact_id_1)) {
      statement <- paste0(statement, ' fact_id_1 IS NULL')
    } else if (is(fact_id_1, 'subQuery')){
      statement <- paste0(statement, ' fact_id_1 = (', as.character(fact_id_1), ')')
    } else {
      statement <- paste0(statement, " fact_id_1 = '", fact_id_1,"'")
    }
  }

  if (!missing(domain_concept_id_2)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(domain_concept_id_2)) {
      statement <- paste0(statement, ' domain_concept_id_2 IS NULL')
    } else if (is(domain_concept_id_2, 'subQuery')){
      statement <- paste0(statement, ' domain_concept_id_2 = (', as.character(domain_concept_id_2), ')')
    } else {
      statement <- paste0(statement, " domain_concept_id_2 = '", domain_concept_id_2,"'")
    }
  }

  if (!missing(fact_id_2)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(fact_id_2)) {
      statement <- paste0(statement, ' fact_id_2 IS NULL')
    } else if (is(fact_id_2, 'subQuery')){
      statement <- paste0(statement, ' fact_id_2 = (', as.character(fact_id_2), ')')
    } else {
      statement <- paste0(statement, " fact_id_2 = '", fact_id_2,"'")
    }
  }

  if (!missing(relationship_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(relationship_concept_id)) {
      statement <- paste0(statement, ' relationship_concept_id IS NULL')
    } else if (is(relationship_concept_id, 'subQuery')){
      statement <- paste0(statement, ' relationship_concept_id = (', as.character(relationship_concept_id), ')')
    } else {
      statement <- paste0(statement, " relationship_concept_id = '", relationship_concept_id,"'")
    }
  }

  class(statement) <- 'subQuery'
  return(statement)
}

lookup_measurement <- function(fetchField, measurement_id, person_id, measurement_concept_id, measurement_date, measurement_datetime, measurement_type_concept_id, operator_concept_id, value_as_number, value_as_concept_id, unit_concept_id, range_low, range_high, provider_id, visit_occurrence_id, visit_detail_id, measurement_source_value, measurement_source_concept_id, unit_source_value, value_source_value) {
  statement <- paste0('SELECT ', fetchField , ' FROM measurement WHERE')
  first <- TRUE
  if (!missing(measurement_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(measurement_id)) {
      statement <- paste0(statement, ' measurement_id IS NULL')
    } else if (is(measurement_id, 'subQuery')){
      statement <- paste0(statement, ' measurement_id = (', as.character(measurement_id), ')')
    } else {
      statement <- paste0(statement, " measurement_id = '", measurement_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(measurement_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(measurement_concept_id)) {
      statement <- paste0(statement, ' measurement_concept_id IS NULL')
    } else if (is(measurement_concept_id, 'subQuery')){
      statement <- paste0(statement, ' measurement_concept_id = (', as.character(measurement_concept_id), ')')
    } else {
      statement <- paste0(statement, " measurement_concept_id = '", measurement_concept_id,"'")
    }
  }

  if (!missing(measurement_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(measurement_date)) {
      statement <- paste0(statement, ' measurement_date IS NULL')
    } else if (is(measurement_date, 'subQuery')){
      statement <- paste0(statement, ' measurement_date = (', as.character(measurement_date), ')')
    } else {
      statement <- paste0(statement, " measurement_date = '", measurement_date,"'")
    }
  }

  if (!missing(measurement_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(measurement_datetime)) {
      statement <- paste0(statement, ' measurement_datetime IS NULL')
    } else if (is(measurement_datetime, 'subQuery')){
      statement <- paste0(statement, ' measurement_datetime = (', as.character(measurement_datetime), ')')
    } else {
      statement <- paste0(statement, " measurement_datetime = '", measurement_datetime,"'")
    }
  }

  if (!missing(measurement_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(measurement_type_concept_id)) {
      statement <- paste0(statement, ' measurement_type_concept_id IS NULL')
    } else if (is(measurement_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' measurement_type_concept_id = (', as.character(measurement_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " measurement_type_concept_id = '", measurement_type_concept_id,"'")
    }
  }

  if (!missing(operator_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(operator_concept_id)) {
      statement <- paste0(statement, ' operator_concept_id IS NULL')
    } else if (is(operator_concept_id, 'subQuery')){
      statement <- paste0(statement, ' operator_concept_id = (', as.character(operator_concept_id), ')')
    } else {
      statement <- paste0(statement, " operator_concept_id = '", operator_concept_id,"'")
    }
  }

  if (!missing(value_as_number)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(value_as_number)) {
      statement <- paste0(statement, ' value_as_number IS NULL')
    } else if (is(value_as_number, 'subQuery')){
      statement <- paste0(statement, ' value_as_number = (', as.character(value_as_number), ')')
    } else {
      statement <- paste0(statement, " value_as_number = '", value_as_number,"'")
    }
  }

  if (!missing(value_as_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(value_as_concept_id)) {
      statement <- paste0(statement, ' value_as_concept_id IS NULL')
    } else if (is(value_as_concept_id, 'subQuery')){
      statement <- paste0(statement, ' value_as_concept_id = (', as.character(value_as_concept_id), ')')
    } else {
      statement <- paste0(statement, " value_as_concept_id = '", value_as_concept_id,"'")
    }
  }

  if (!missing(unit_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(unit_concept_id)) {
      statement <- paste0(statement, ' unit_concept_id IS NULL')
    } else if (is(unit_concept_id, 'subQuery')){
      statement <- paste0(statement, ' unit_concept_id = (', as.character(unit_concept_id), ')')
    } else {
      statement <- paste0(statement, " unit_concept_id = '", unit_concept_id,"'")
    }
  }

  if (!missing(range_low)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(range_low)) {
      statement <- paste0(statement, ' range_low IS NULL')
    } else if (is(range_low, 'subQuery')){
      statement <- paste0(statement, ' range_low = (', as.character(range_low), ')')
    } else {
      statement <- paste0(statement, " range_low = '", range_low,"'")
    }
  }

  if (!missing(range_high)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(range_high)) {
      statement <- paste0(statement, ' range_high IS NULL')
    } else if (is(range_high, 'subQuery')){
      statement <- paste0(statement, ' range_high = (', as.character(range_high), ')')
    } else {
      statement <- paste0(statement, " range_high = '", range_high,"'")
    }
  }

  if (!missing(provider_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_id)) {
      statement <- paste0(statement, ' provider_id IS NULL')
    } else if (is(provider_id, 'subQuery')){
      statement <- paste0(statement, ' provider_id = (', as.character(provider_id), ')')
    } else {
      statement <- paste0(statement, " provider_id = '", provider_id,"'")
    }
  }

  if (!missing(visit_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_occurrence_id)) {
      statement <- paste0(statement, ' visit_occurrence_id IS NULL')
    } else if (is(visit_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' visit_occurrence_id = (', as.character(visit_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " visit_occurrence_id = '", visit_occurrence_id,"'")
    }
  }

  if (!missing(visit_detail_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_detail_id)) {
      statement <- paste0(statement, ' visit_detail_id IS NULL')
    } else if (is(visit_detail_id, 'subQuery')){
      statement <- paste0(statement, ' visit_detail_id = (', as.character(visit_detail_id), ')')
    } else {
      statement <- paste0(statement, " visit_detail_id = '", visit_detail_id,"'")
    }
  }

  if (!missing(measurement_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(measurement_source_value)) {
      statement <- paste0(statement, ' measurement_source_value IS NULL')
    } else if (is(measurement_source_value, 'subQuery')){
      statement <- paste0(statement, ' measurement_source_value = (', as.character(measurement_source_value), ')')
    } else {
      statement <- paste0(statement, " measurement_source_value = '", measurement_source_value,"'")
    }
  }

  if (!missing(measurement_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(measurement_source_concept_id)) {
      statement <- paste0(statement, ' measurement_source_concept_id IS NULL')
    } else if (is(measurement_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' measurement_source_concept_id = (', as.character(measurement_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " measurement_source_concept_id = '", measurement_source_concept_id,"'")
    }
  }

  if (!missing(unit_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(unit_source_value)) {
      statement <- paste0(statement, ' unit_source_value IS NULL')
    } else if (is(unit_source_value, 'subQuery')){
      statement <- paste0(statement, ' unit_source_value = (', as.character(unit_source_value), ')')
    } else {
      statement <- paste0(statement, " unit_source_value = '", unit_source_value,"'")
    }
  }

  if (!missing(value_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(value_source_value)) {
      statement <- paste0(statement, ' value_source_value IS NULL')
    } else if (is(value_source_value, 'subQuery')){
      statement <- paste0(statement, ' value_source_value = (', as.character(value_source_value), ')')
    } else {
      statement <- paste0(statement, " value_source_value = '", value_source_value,"'")
    }
  }

  class(statement) <- 'subQuery'
  return(statement)
}

lookup_note <- function(fetchField, note_id, person_id, note_date, note_datetime, note_type_concept_id, note_class_concept_id, note_title, note_text, encoding_concept_id, language_concept_id, provider_id, note_source_value, visit_occurrence_id) {
  statement <- paste0('SELECT ', fetchField , ' FROM note WHERE')
  first <- TRUE
  if (!missing(note_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_id)) {
      statement <- paste0(statement, ' note_id IS NULL')
    } else if (is(note_id, 'subQuery')){
      statement <- paste0(statement, ' note_id = (', as.character(note_id), ')')
    } else {
      statement <- paste0(statement, " note_id = '", note_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(note_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_date)) {
      statement <- paste0(statement, ' note_date IS NULL')
    } else if (is(note_date, 'subQuery')){
      statement <- paste0(statement, ' note_date = (', as.character(note_date), ')')
    } else {
      statement <- paste0(statement, " note_date = '", note_date,"'")
    }
  }

  if (!missing(note_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_datetime)) {
      statement <- paste0(statement, ' note_datetime IS NULL')
    } else if (is(note_datetime, 'subQuery')){
      statement <- paste0(statement, ' note_datetime = (', as.character(note_datetime), ')')
    } else {
      statement <- paste0(statement, " note_datetime = '", note_datetime,"'")
    }
  }

  if (!missing(note_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_type_concept_id)) {
      statement <- paste0(statement, ' note_type_concept_id IS NULL')
    } else if (is(note_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' note_type_concept_id = (', as.character(note_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " note_type_concept_id = '", note_type_concept_id,"'")
    }
  }

  if (!missing(note_class_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_class_concept_id)) {
      statement <- paste0(statement, ' note_class_concept_id IS NULL')
    } else if (is(note_class_concept_id, 'subQuery')){
      statement <- paste0(statement, ' note_class_concept_id = (', as.character(note_class_concept_id), ')')
    } else {
      statement <- paste0(statement, " note_class_concept_id = '", note_class_concept_id,"'")
    }
  }

  if (!missing(note_title)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_title)) {
      statement <- paste0(statement, ' note_title IS NULL')
    } else if (is(note_title, 'subQuery')){
      statement <- paste0(statement, ' note_title = (', as.character(note_title), ')')
    } else {
      statement <- paste0(statement, " note_title = '", note_title,"'")
    }
  }

  if (!missing(note_text)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_text)) {
      statement <- paste0(statement, ' note_text IS NULL')
    } else if (is(note_text, 'subQuery')){
      statement <- paste0(statement, ' note_text = (', as.character(note_text), ')')
    } else {
      statement <- paste0(statement, " note_text = '", note_text,"'")
    }
  }

  if (!missing(encoding_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(encoding_concept_id)) {
      statement <- paste0(statement, ' encoding_concept_id IS NULL')
    } else if (is(encoding_concept_id, 'subQuery')){
      statement <- paste0(statement, ' encoding_concept_id = (', as.character(encoding_concept_id), ')')
    } else {
      statement <- paste0(statement, " encoding_concept_id = '", encoding_concept_id,"'")
    }
  }

  if (!missing(language_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(language_concept_id)) {
      statement <- paste0(statement, ' language_concept_id IS NULL')
    } else if (is(language_concept_id, 'subQuery')){
      statement <- paste0(statement, ' language_concept_id = (', as.character(language_concept_id), ')')
    } else {
      statement <- paste0(statement, " language_concept_id = '", language_concept_id,"'")
    }
  }

  if (!missing(provider_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_id)) {
      statement <- paste0(statement, ' provider_id IS NULL')
    } else if (is(provider_id, 'subQuery')){
      statement <- paste0(statement, ' provider_id = (', as.character(provider_id), ')')
    } else {
      statement <- paste0(statement, " provider_id = '", provider_id,"'")
    }
  }

  if (!missing(note_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_source_value)) {
      statement <- paste0(statement, ' note_source_value IS NULL')
    } else if (is(note_source_value, 'subQuery')){
      statement <- paste0(statement, ' note_source_value = (', as.character(note_source_value), ')')
    } else {
      statement <- paste0(statement, " note_source_value = '", note_source_value,"'")
    }
  }

  if (!missing(visit_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_occurrence_id)) {
      statement <- paste0(statement, ' visit_occurrence_id IS NULL')
    } else if (is(visit_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' visit_occurrence_id = (', as.character(visit_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " visit_occurrence_id = '", visit_occurrence_id,"'")
    }
  }

  class(statement) <- 'subQuery'
  return(statement)
}

lookup_note_nlp <- function(fetchField, note_nlp_id, note_id, section_concept_id, snippet, offset, lexical_variant, note_nlp_concept_id, note_nlp_source_concept_id, nlp_system, nlp_date, nlp_date_time, term_exists, term_temporal, term_modifiers) {
  statement <- paste0('SELECT ', fetchField , ' FROM note_nlp WHERE')
  first <- TRUE
  if (!missing(note_nlp_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_nlp_id)) {
      statement <- paste0(statement, ' note_nlp_id IS NULL')
    } else if (is(note_nlp_id, 'subQuery')){
      statement <- paste0(statement, ' note_nlp_id = (', as.character(note_nlp_id), ')')
    } else {
      statement <- paste0(statement, " note_nlp_id = '", note_nlp_id,"'")
    }
  }

  if (!missing(note_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_id)) {
      statement <- paste0(statement, ' note_id IS NULL')
    } else if (is(note_id, 'subQuery')){
      statement <- paste0(statement, ' note_id = (', as.character(note_id), ')')
    } else {
      statement <- paste0(statement, " note_id = '", note_id,"'")
    }
  }

  if (!missing(section_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(section_concept_id)) {
      statement <- paste0(statement, ' section_concept_id IS NULL')
    } else if (is(section_concept_id, 'subQuery')){
      statement <- paste0(statement, ' section_concept_id = (', as.character(section_concept_id), ')')
    } else {
      statement <- paste0(statement, " section_concept_id = '", section_concept_id,"'")
    }
  }

  if (!missing(snippet)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(snippet)) {
      statement <- paste0(statement, ' snippet IS NULL')
    } else if (is(snippet, 'subQuery')){
      statement <- paste0(statement, ' snippet = (', as.character(snippet), ')')
    } else {
      statement <- paste0(statement, " snippet = '", snippet,"'")
    }
  }

  if (!missing(offset)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(offset)) {
      statement <- paste0(statement, ' offset IS NULL')
    } else if (is(offset, 'subQuery')){
      statement <- paste0(statement, ' offset = (', as.character(offset), ')')
    } else {
      statement <- paste0(statement, " offset = '", offset,"'")
    }
  }

  if (!missing(lexical_variant)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(lexical_variant)) {
      statement <- paste0(statement, ' lexical_variant IS NULL')
    } else if (is(lexical_variant, 'subQuery')){
      statement <- paste0(statement, ' lexical_variant = (', as.character(lexical_variant), ')')
    } else {
      statement <- paste0(statement, " lexical_variant = '", lexical_variant,"'")
    }
  }

  if (!missing(note_nlp_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_nlp_concept_id)) {
      statement <- paste0(statement, ' note_nlp_concept_id IS NULL')
    } else if (is(note_nlp_concept_id, 'subQuery')){
      statement <- paste0(statement, ' note_nlp_concept_id = (', as.character(note_nlp_concept_id), ')')
    } else {
      statement <- paste0(statement, " note_nlp_concept_id = '", note_nlp_concept_id,"'")
    }
  }

  if (!missing(note_nlp_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(note_nlp_source_concept_id)) {
      statement <- paste0(statement, ' note_nlp_source_concept_id IS NULL')
    } else if (is(note_nlp_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' note_nlp_source_concept_id = (', as.character(note_nlp_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " note_nlp_source_concept_id = '", note_nlp_source_concept_id,"'")
    }
  }

  if (!missing(nlp_system)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(nlp_system)) {
      statement <- paste0(statement, ' nlp_system IS NULL')
    } else if (is(nlp_system, 'subQuery')){
      statement <- paste0(statement, ' nlp_system = (', as.character(nlp_system), ')')
    } else {
      statement <- paste0(statement, " nlp_system = '", nlp_system,"'")
    }
  }

  if (!missing(nlp_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(nlp_date)) {
      statement <- paste0(statement, ' nlp_date IS NULL')
    } else if (is(nlp_date, 'subQuery')){
      statement <- paste0(statement, ' nlp_date = (', as.character(nlp_date), ')')
    } else {
      statement <- paste0(statement, " nlp_date = '", nlp_date,"'")
    }
  }

  if (!missing(nlp_date_time)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(nlp_date_time)) {
      statement <- paste0(statement, ' nlp_date_time IS NULL')
    } else if (is(nlp_date_time, 'subQuery')){
      statement <- paste0(statement, ' nlp_date_time = (', as.character(nlp_date_time), ')')
    } else {
      statement <- paste0(statement, " nlp_date_time = '", nlp_date_time,"'")
    }
  }

  if (!missing(term_exists)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(term_exists)) {
      statement <- paste0(statement, ' term_exists IS NULL')
    } else if (is(term_exists, 'subQuery')){
      statement <- paste0(statement, ' term_exists = (', as.character(term_exists), ')')
    } else {
      statement <- paste0(statement, " term_exists = '", term_exists,"'")
    }
  }

  if (!missing(term_temporal)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(term_temporal)) {
      statement <- paste0(statement, ' term_temporal IS NULL')
    } else if (is(term_temporal, 'subQuery')){
      statement <- paste0(statement, ' term_temporal = (', as.character(term_temporal), ')')
    } else {
      statement <- paste0(statement, " term_temporal = '", term_temporal,"'")
    }
  }

  if (!missing(term_modifiers)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(term_modifiers)) {
      statement <- paste0(statement, ' term_modifiers IS NULL')
    } else if (is(term_modifiers, 'subQuery')){
      statement <- paste0(statement, ' term_modifiers = (', as.character(term_modifiers), ')')
    } else {
      statement <- paste0(statement, " term_modifiers = '", term_modifiers,"'")
    }
  }

  class(statement) <- 'subQuery'
  return(statement)
}

lookup_observation <- function(fetchField, observation_id, person_id, observation_concept_id, observation_date, observation_datetime, observation_type_concept_id, value_as_number, value_as_string, value_as_concept_id, qualifier_concept_id, unit_concept_id, provider_id, visit_occurrence_id, visit_detail_id, observation_source_value, observation_source_concept_id, unit_source_value, qualifier_source_value) {
  statement <- paste0('SELECT ', fetchField , ' FROM observation WHERE')
  first <- TRUE
  if (!missing(observation_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(observation_id)) {
      statement <- paste0(statement, ' observation_id IS NULL')
    } else if (is(observation_id, 'subQuery')){
      statement <- paste0(statement, ' observation_id = (', as.character(observation_id), ')')
    } else {
      statement <- paste0(statement, " observation_id = '", observation_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(observation_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(observation_concept_id)) {
      statement <- paste0(statement, ' observation_concept_id IS NULL')
    } else if (is(observation_concept_id, 'subQuery')){
      statement <- paste0(statement, ' observation_concept_id = (', as.character(observation_concept_id), ')')
    } else {
      statement <- paste0(statement, " observation_concept_id = '", observation_concept_id,"'")
    }
  }

  if (!missing(observation_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(observation_date)) {
      statement <- paste0(statement, ' observation_date IS NULL')
    } else if (is(observation_date, 'subQuery')){
      statement <- paste0(statement, ' observation_date = (', as.character(observation_date), ')')
    } else {
      statement <- paste0(statement, " observation_date = '", observation_date,"'")
    }
  }

  if (!missing(observation_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(observation_datetime)) {
      statement <- paste0(statement, ' observation_datetime IS NULL')
    } else if (is(observation_datetime, 'subQuery')){
      statement <- paste0(statement, ' observation_datetime = (', as.character(observation_datetime), ')')
    } else {
      statement <- paste0(statement, " observation_datetime = '", observation_datetime,"'")
    }
  }

  if (!missing(observation_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(observation_type_concept_id)) {
      statement <- paste0(statement, ' observation_type_concept_id IS NULL')
    } else if (is(observation_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' observation_type_concept_id = (', as.character(observation_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " observation_type_concept_id = '", observation_type_concept_id,"'")
    }
  }

  if (!missing(value_as_number)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(value_as_number)) {
      statement <- paste0(statement, ' value_as_number IS NULL')
    } else if (is(value_as_number, 'subQuery')){
      statement <- paste0(statement, ' value_as_number = (', as.character(value_as_number), ')')
    } else {
      statement <- paste0(statement, " value_as_number = '", value_as_number,"'")
    }
  }

  if (!missing(value_as_string)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(value_as_string)) {
      statement <- paste0(statement, ' value_as_string IS NULL')
    } else if (is(value_as_string, 'subQuery')){
      statement <- paste0(statement, ' value_as_string = (', as.character(value_as_string), ')')
    } else {
      statement <- paste0(statement, " value_as_string = '", value_as_string,"'")
    }
  }

  if (!missing(value_as_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(value_as_concept_id)) {
      statement <- paste0(statement, ' value_as_concept_id IS NULL')
    } else if (is(value_as_concept_id, 'subQuery')){
      statement <- paste0(statement, ' value_as_concept_id = (', as.character(value_as_concept_id), ')')
    } else {
      statement <- paste0(statement, " value_as_concept_id = '", value_as_concept_id,"'")
    }
  }

  if (!missing(qualifier_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(qualifier_concept_id)) {
      statement <- paste0(statement, ' qualifier_concept_id IS NULL')
    } else if (is(qualifier_concept_id, 'subQuery')){
      statement <- paste0(statement, ' qualifier_concept_id = (', as.character(qualifier_concept_id), ')')
    } else {
      statement <- paste0(statement, " qualifier_concept_id = '", qualifier_concept_id,"'")
    }
  }

  if (!missing(unit_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(unit_concept_id)) {
      statement <- paste0(statement, ' unit_concept_id IS NULL')
    } else if (is(unit_concept_id, 'subQuery')){
      statement <- paste0(statement, ' unit_concept_id = (', as.character(unit_concept_id), ')')
    } else {
      statement <- paste0(statement, " unit_concept_id = '", unit_concept_id,"'")
    }
  }

  if (!missing(provider_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_id)) {
      statement <- paste0(statement, ' provider_id IS NULL')
    } else if (is(provider_id, 'subQuery')){
      statement <- paste0(statement, ' provider_id = (', as.character(provider_id), ')')
    } else {
      statement <- paste0(statement, " provider_id = '", provider_id,"'")
    }
  }

  if (!missing(visit_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_occurrence_id)) {
      statement <- paste0(statement, ' visit_occurrence_id IS NULL')
    } else if (is(visit_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' visit_occurrence_id = (', as.character(visit_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " visit_occurrence_id = '", visit_occurrence_id,"'")
    }
  }

  if (!missing(visit_detail_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_detail_id)) {
      statement <- paste0(statement, ' visit_detail_id IS NULL')
    } else if (is(visit_detail_id, 'subQuery')){
      statement <- paste0(statement, ' visit_detail_id = (', as.character(visit_detail_id), ')')
    } else {
      statement <- paste0(statement, " visit_detail_id = '", visit_detail_id,"'")
    }
  }

  if (!missing(observation_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(observation_source_value)) {
      statement <- paste0(statement, ' observation_source_value IS NULL')
    } else if (is(observation_source_value, 'subQuery')){
      statement <- paste0(statement, ' observation_source_value = (', as.character(observation_source_value), ')')
    } else {
      statement <- paste0(statement, " observation_source_value = '", observation_source_value,"'")
    }
  }

  if (!missing(observation_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(observation_source_concept_id)) {
      statement <- paste0(statement, ' observation_source_concept_id IS NULL')
    } else if (is(observation_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' observation_source_concept_id = (', as.character(observation_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " observation_source_concept_id = '", observation_source_concept_id,"'")
    }
  }

  if (!missing(unit_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(unit_source_value)) {
      statement <- paste0(statement, ' unit_source_value IS NULL')
    } else if (is(unit_source_value, 'subQuery')){
      statement <- paste0(statement, ' unit_source_value = (', as.character(unit_source_value), ')')
    } else {
      statement <- paste0(statement, " unit_source_value = '", unit_source_value,"'")
    }
  }

  if (!missing(qualifier_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(qualifier_source_value)) {
      statement <- paste0(statement, ' qualifier_source_value IS NULL')
    } else if (is(qualifier_source_value, 'subQuery')){
      statement <- paste0(statement, ' qualifier_source_value = (', as.character(qualifier_source_value), ')')
    } else {
      statement <- paste0(statement, " qualifier_source_value = '", qualifier_source_value,"'")
    }
  }

  class(statement) <- 'subQuery'
  return(statement)
}

lookup_observation_period <- function(fetchField, observation_period_id, person_id, observation_period_start_date, observation_period_end_date, period_type_concept_id) {
  statement <- paste0('SELECT ', fetchField , ' FROM observation_period WHERE')
  first <- TRUE
  if (!missing(observation_period_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(observation_period_id)) {
      statement <- paste0(statement, ' observation_period_id IS NULL')
    } else if (is(observation_period_id, 'subQuery')){
      statement <- paste0(statement, ' observation_period_id = (', as.character(observation_period_id), ')')
    } else {
      statement <- paste0(statement, " observation_period_id = '", observation_period_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(observation_period_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(observation_period_start_date)) {
      statement <- paste0(statement, ' observation_period_start_date IS NULL')
    } else if (is(observation_period_start_date, 'subQuery')){
      statement <- paste0(statement, ' observation_period_start_date = (', as.character(observation_period_start_date), ')')
    } else {
      statement <- paste0(statement, " observation_period_start_date = '", observation_period_start_date,"'")
    }
  }

  if (!missing(observation_period_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(observation_period_end_date)) {
      statement <- paste0(statement, ' observation_period_end_date IS NULL')
    } else if (is(observation_period_end_date, 'subQuery')){
      statement <- paste0(statement, ' observation_period_end_date = (', as.character(observation_period_end_date), ')')
    } else {
      statement <- paste0(statement, " observation_period_end_date = '", observation_period_end_date,"'")
    }
  }

  if (!missing(period_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(period_type_concept_id)) {
      statement <- paste0(statement, ' period_type_concept_id IS NULL')
    } else if (is(period_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' period_type_concept_id = (', as.character(period_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " period_type_concept_id = '", period_type_concept_id,"'")
    }
  }

  class(statement) <- 'subQuery'
  return(statement)
}

lookup_person <- function(fetchField, person_id, gender_concept_id, year_of_birth, month_of_birth, day_of_birth, birth_datetime, race_concept_id, ethnicity_concept_id, location_id, provider_id, care_site_id, person_source_value, gender_source_value, gender_source_concept_id, race_source_value, race_source_concept_id, ethnicity_source_value, ethnicity_source_concept_id) {
  statement <- paste0('SELECT ', fetchField , ' FROM person WHERE')
  first <- TRUE
  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(gender_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(gender_concept_id)) {
      statement <- paste0(statement, ' gender_concept_id IS NULL')
    } else if (is(gender_concept_id, 'subQuery')){
      statement <- paste0(statement, ' gender_concept_id = (', as.character(gender_concept_id), ')')
    } else {
      statement <- paste0(statement, " gender_concept_id = '", gender_concept_id,"'")
    }
  }

  if (!missing(year_of_birth)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(year_of_birth)) {
      statement <- paste0(statement, ' year_of_birth IS NULL')
    } else if (is(year_of_birth, 'subQuery')){
      statement <- paste0(statement, ' year_of_birth = (', as.character(year_of_birth), ')')
    } else {
      statement <- paste0(statement, " year_of_birth = '", year_of_birth,"'")
    }
  }

  if (!missing(month_of_birth)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(month_of_birth)) {
      statement <- paste0(statement, ' month_of_birth IS NULL')
    } else if (is(month_of_birth, 'subQuery')){
      statement <- paste0(statement, ' month_of_birth = (', as.character(month_of_birth), ')')
    } else {
      statement <- paste0(statement, " month_of_birth = '", month_of_birth,"'")
    }
  }

  if (!missing(day_of_birth)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(day_of_birth)) {
      statement <- paste0(statement, ' day_of_birth IS NULL')
    } else if (is(day_of_birth, 'subQuery')){
      statement <- paste0(statement, ' day_of_birth = (', as.character(day_of_birth), ')')
    } else {
      statement <- paste0(statement, " day_of_birth = '", day_of_birth,"'")
    }
  }

  if (!missing(birth_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(birth_datetime)) {
      statement <- paste0(statement, ' birth_datetime IS NULL')
    } else if (is(birth_datetime, 'subQuery')){
      statement <- paste0(statement, ' birth_datetime = (', as.character(birth_datetime), ')')
    } else {
      statement <- paste0(statement, " birth_datetime = '", birth_datetime,"'")
    }
  }

  if (!missing(race_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(race_concept_id)) {
      statement <- paste0(statement, ' race_concept_id IS NULL')
    } else if (is(race_concept_id, 'subQuery')){
      statement <- paste0(statement, ' race_concept_id = (', as.character(race_concept_id), ')')
    } else {
      statement <- paste0(statement, " race_concept_id = '", race_concept_id,"'")
    }
  }

  if (!missing(ethnicity_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(ethnicity_concept_id)) {
      statement <- paste0(statement, ' ethnicity_concept_id IS NULL')
    } else if (is(ethnicity_concept_id, 'subQuery')){
      statement <- paste0(statement, ' ethnicity_concept_id = (', as.character(ethnicity_concept_id), ')')
    } else {
      statement <- paste0(statement, " ethnicity_concept_id = '", ethnicity_concept_id,"'")
    }
  }

  if (!missing(location_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(location_id)) {
      statement <- paste0(statement, ' location_id IS NULL')
    } else if (is(location_id, 'subQuery')){
      statement <- paste0(statement, ' location_id = (', as.character(location_id), ')')
    } else {
      statement <- paste0(statement, " location_id = '", location_id,"'")
    }
  }

  if (!missing(provider_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_id)) {
      statement <- paste0(statement, ' provider_id IS NULL')
    } else if (is(provider_id, 'subQuery')){
      statement <- paste0(statement, ' provider_id = (', as.character(provider_id), ')')
    } else {
      statement <- paste0(statement, " provider_id = '", provider_id,"'")
    }
  }

  if (!missing(care_site_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(care_site_id)) {
      statement <- paste0(statement, ' care_site_id IS NULL')
    } else if (is(care_site_id, 'subQuery')){
      statement <- paste0(statement, ' care_site_id = (', as.character(care_site_id), ')')
    } else {
      statement <- paste0(statement, " care_site_id = '", care_site_id,"'")
    }
  }

  if (!missing(person_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_source_value)) {
      statement <- paste0(statement, ' person_source_value IS NULL')
    } else if (is(person_source_value, 'subQuery')){
      statement <- paste0(statement, ' person_source_value = (', as.character(person_source_value), ')')
    } else {
      statement <- paste0(statement, " person_source_value = '", person_source_value,"'")
    }
  }

  if (!missing(gender_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(gender_source_value)) {
      statement <- paste0(statement, ' gender_source_value IS NULL')
    } else if (is(gender_source_value, 'subQuery')){
      statement <- paste0(statement, ' gender_source_value = (', as.character(gender_source_value), ')')
    } else {
      statement <- paste0(statement, " gender_source_value = '", gender_source_value,"'")
    }
  }

  if (!missing(gender_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(gender_source_concept_id)) {
      statement <- paste0(statement, ' gender_source_concept_id IS NULL')
    } else if (is(gender_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' gender_source_concept_id = (', as.character(gender_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " gender_source_concept_id = '", gender_source_concept_id,"'")
    }
  }

  if (!missing(race_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(race_source_value)) {
      statement <- paste0(statement, ' race_source_value IS NULL')
    } else if (is(race_source_value, 'subQuery')){
      statement <- paste0(statement, ' race_source_value = (', as.character(race_source_value), ')')
    } else {
      statement <- paste0(statement, " race_source_value = '", race_source_value,"'")
    }
  }

  if (!missing(race_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(race_source_concept_id)) {
      statement <- paste0(statement, ' race_source_concept_id IS NULL')
    } else if (is(race_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' race_source_concept_id = (', as.character(race_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " race_source_concept_id = '", race_source_concept_id,"'")
    }
  }

  if (!missing(ethnicity_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(ethnicity_source_value)) {
      statement <- paste0(statement, ' ethnicity_source_value IS NULL')
    } else if (is(ethnicity_source_value, 'subQuery')){
      statement <- paste0(statement, ' ethnicity_source_value = (', as.character(ethnicity_source_value), ')')
    } else {
      statement <- paste0(statement, " ethnicity_source_value = '", ethnicity_source_value,"'")
    }
  }

  if (!missing(ethnicity_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(ethnicity_source_concept_id)) {
      statement <- paste0(statement, ' ethnicity_source_concept_id IS NULL')
    } else if (is(ethnicity_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' ethnicity_source_concept_id = (', as.character(ethnicity_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " ethnicity_source_concept_id = '", ethnicity_source_concept_id,"'")
    }
  }

  class(statement) <- 'subQuery'
  return(statement)
}

lookup_procedure_occurrence <- function(fetchField, procedure_occurrence_id, person_id, procedure_concept_id, procedure_date, procedure_datetime, procedure_type_concept_id, modifier_concept_id, quantity, provider_id, visit_occurrence_id, procedure_source_value, procedure_source_concept_id, qualifier_source_value, visit_detail_id) {
  statement <- paste0('SELECT ', fetchField , ' FROM procedure_occurrence WHERE')
  first <- TRUE
  if (!missing(procedure_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(procedure_occurrence_id)) {
      statement <- paste0(statement, ' procedure_occurrence_id IS NULL')
    } else if (is(procedure_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' procedure_occurrence_id = (', as.character(procedure_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " procedure_occurrence_id = '", procedure_occurrence_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(procedure_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(procedure_concept_id)) {
      statement <- paste0(statement, ' procedure_concept_id IS NULL')
    } else if (is(procedure_concept_id, 'subQuery')){
      statement <- paste0(statement, ' procedure_concept_id = (', as.character(procedure_concept_id), ')')
    } else {
      statement <- paste0(statement, " procedure_concept_id = '", procedure_concept_id,"'")
    }
  }

  if (!missing(procedure_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(procedure_date)) {
      statement <- paste0(statement, ' procedure_date IS NULL')
    } else if (is(procedure_date, 'subQuery')){
      statement <- paste0(statement, ' procedure_date = (', as.character(procedure_date), ')')
    } else {
      statement <- paste0(statement, " procedure_date = '", procedure_date,"'")
    }
  }

  if (!missing(procedure_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(procedure_datetime)) {
      statement <- paste0(statement, ' procedure_datetime IS NULL')
    } else if (is(procedure_datetime, 'subQuery')){
      statement <- paste0(statement, ' procedure_datetime = (', as.character(procedure_datetime), ')')
    } else {
      statement <- paste0(statement, " procedure_datetime = '", procedure_datetime,"'")
    }
  }

  if (!missing(procedure_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(procedure_type_concept_id)) {
      statement <- paste0(statement, ' procedure_type_concept_id IS NULL')
    } else if (is(procedure_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' procedure_type_concept_id = (', as.character(procedure_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " procedure_type_concept_id = '", procedure_type_concept_id,"'")
    }
  }

  if (!missing(modifier_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(modifier_concept_id)) {
      statement <- paste0(statement, ' modifier_concept_id IS NULL')
    } else if (is(modifier_concept_id, 'subQuery')){
      statement <- paste0(statement, ' modifier_concept_id = (', as.character(modifier_concept_id), ')')
    } else {
      statement <- paste0(statement, " modifier_concept_id = '", modifier_concept_id,"'")
    }
  }

  if (!missing(quantity)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(quantity)) {
      statement <- paste0(statement, ' quantity IS NULL')
    } else if (is(quantity, 'subQuery')){
      statement <- paste0(statement, ' quantity = (', as.character(quantity), ')')
    } else {
      statement <- paste0(statement, " quantity = '", quantity,"'")
    }
  }

  if (!missing(provider_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_id)) {
      statement <- paste0(statement, ' provider_id IS NULL')
    } else if (is(provider_id, 'subQuery')){
      statement <- paste0(statement, ' provider_id = (', as.character(provider_id), ')')
    } else {
      statement <- paste0(statement, " provider_id = '", provider_id,"'")
    }
  }

  if (!missing(visit_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_occurrence_id)) {
      statement <- paste0(statement, ' visit_occurrence_id IS NULL')
    } else if (is(visit_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' visit_occurrence_id = (', as.character(visit_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " visit_occurrence_id = '", visit_occurrence_id,"'")
    }
  }

  if (!missing(procedure_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(procedure_source_value)) {
      statement <- paste0(statement, ' procedure_source_value IS NULL')
    } else if (is(procedure_source_value, 'subQuery')){
      statement <- paste0(statement, ' procedure_source_value = (', as.character(procedure_source_value), ')')
    } else {
      statement <- paste0(statement, " procedure_source_value = '", procedure_source_value,"'")
    }
  }

  if (!missing(procedure_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(procedure_source_concept_id)) {
      statement <- paste0(statement, ' procedure_source_concept_id IS NULL')
    } else if (is(procedure_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' procedure_source_concept_id = (', as.character(procedure_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " procedure_source_concept_id = '", procedure_source_concept_id,"'")
    }
  }

  if (!missing(qualifier_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(qualifier_source_value)) {
      statement <- paste0(statement, ' qualifier_source_value IS NULL')
    } else if (is(qualifier_source_value, 'subQuery')){
      statement <- paste0(statement, ' qualifier_source_value = (', as.character(qualifier_source_value), ')')
    } else {
      statement <- paste0(statement, " qualifier_source_value = '", qualifier_source_value,"'")
    }
  }

  if (!missing(visit_detail_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_detail_id)) {
      statement <- paste0(statement, ' visit_detail_id IS NULL')
    } else if (is(visit_detail_id, 'subQuery')){
      statement <- paste0(statement, ' visit_detail_id = (', as.character(visit_detail_id), ')')
    } else {
      statement <- paste0(statement, " visit_detail_id = '", visit_detail_id,"'")
    }
  }

  class(statement) <- 'subQuery'
  return(statement)
}

lookup_specimen <- function(fetchField, specimen_id, person_id, specimen_concept_id, specimen_type_concept_id, specimen_date, specimen_datetime, quantity, unit_concept_id, anatomic_site_concept_id, disease_status_concept_id, specimen_source_id, specimen_source_value, unit_source_value, anatomic_site_source_value, disease_status_source_value) {
  statement <- paste0('SELECT ', fetchField , ' FROM specimen WHERE')
  first <- TRUE
  if (!missing(specimen_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(specimen_id)) {
      statement <- paste0(statement, ' specimen_id IS NULL')
    } else if (is(specimen_id, 'subQuery')){
      statement <- paste0(statement, ' specimen_id = (', as.character(specimen_id), ')')
    } else {
      statement <- paste0(statement, " specimen_id = '", specimen_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(specimen_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(specimen_concept_id)) {
      statement <- paste0(statement, ' specimen_concept_id IS NULL')
    } else if (is(specimen_concept_id, 'subQuery')){
      statement <- paste0(statement, ' specimen_concept_id = (', as.character(specimen_concept_id), ')')
    } else {
      statement <- paste0(statement, " specimen_concept_id = '", specimen_concept_id,"'")
    }
  }

  if (!missing(specimen_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(specimen_type_concept_id)) {
      statement <- paste0(statement, ' specimen_type_concept_id IS NULL')
    } else if (is(specimen_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' specimen_type_concept_id = (', as.character(specimen_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " specimen_type_concept_id = '", specimen_type_concept_id,"'")
    }
  }

  if (!missing(specimen_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(specimen_date)) {
      statement <- paste0(statement, ' specimen_date IS NULL')
    } else if (is(specimen_date, 'subQuery')){
      statement <- paste0(statement, ' specimen_date = (', as.character(specimen_date), ')')
    } else {
      statement <- paste0(statement, " specimen_date = '", specimen_date,"'")
    }
  }

  if (!missing(specimen_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(specimen_datetime)) {
      statement <- paste0(statement, ' specimen_datetime IS NULL')
    } else if (is(specimen_datetime, 'subQuery')){
      statement <- paste0(statement, ' specimen_datetime = (', as.character(specimen_datetime), ')')
    } else {
      statement <- paste0(statement, " specimen_datetime = '", specimen_datetime,"'")
    }
  }

  if (!missing(quantity)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(quantity)) {
      statement <- paste0(statement, ' quantity IS NULL')
    } else if (is(quantity, 'subQuery')){
      statement <- paste0(statement, ' quantity = (', as.character(quantity), ')')
    } else {
      statement <- paste0(statement, " quantity = '", quantity,"'")
    }
  }

  if (!missing(unit_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(unit_concept_id)) {
      statement <- paste0(statement, ' unit_concept_id IS NULL')
    } else if (is(unit_concept_id, 'subQuery')){
      statement <- paste0(statement, ' unit_concept_id = (', as.character(unit_concept_id), ')')
    } else {
      statement <- paste0(statement, " unit_concept_id = '", unit_concept_id,"'")
    }
  }

  if (!missing(anatomic_site_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(anatomic_site_concept_id)) {
      statement <- paste0(statement, ' anatomic_site_concept_id IS NULL')
    } else if (is(anatomic_site_concept_id, 'subQuery')){
      statement <- paste0(statement, ' anatomic_site_concept_id = (', as.character(anatomic_site_concept_id), ')')
    } else {
      statement <- paste0(statement, " anatomic_site_concept_id = '", anatomic_site_concept_id,"'")
    }
  }

  if (!missing(disease_status_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(disease_status_concept_id)) {
      statement <- paste0(statement, ' disease_status_concept_id IS NULL')
    } else if (is(disease_status_concept_id, 'subQuery')){
      statement <- paste0(statement, ' disease_status_concept_id = (', as.character(disease_status_concept_id), ')')
    } else {
      statement <- paste0(statement, " disease_status_concept_id = '", disease_status_concept_id,"'")
    }
  }

  if (!missing(specimen_source_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(specimen_source_id)) {
      statement <- paste0(statement, ' specimen_source_id IS NULL')
    } else if (is(specimen_source_id, 'subQuery')){
      statement <- paste0(statement, ' specimen_source_id = (', as.character(specimen_source_id), ')')
    } else {
      statement <- paste0(statement, " specimen_source_id = '", specimen_source_id,"'")
    }
  }

  if (!missing(specimen_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(specimen_source_value)) {
      statement <- paste0(statement, ' specimen_source_value IS NULL')
    } else if (is(specimen_source_value, 'subQuery')){
      statement <- paste0(statement, ' specimen_source_value = (', as.character(specimen_source_value), ')')
    } else {
      statement <- paste0(statement, " specimen_source_value = '", specimen_source_value,"'")
    }
  }

  if (!missing(unit_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(unit_source_value)) {
      statement <- paste0(statement, ' unit_source_value IS NULL')
    } else if (is(unit_source_value, 'subQuery')){
      statement <- paste0(statement, ' unit_source_value = (', as.character(unit_source_value), ')')
    } else {
      statement <- paste0(statement, " unit_source_value = '", unit_source_value,"'")
    }
  }

  if (!missing(anatomic_site_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(anatomic_site_source_value)) {
      statement <- paste0(statement, ' anatomic_site_source_value IS NULL')
    } else if (is(anatomic_site_source_value, 'subQuery')){
      statement <- paste0(statement, ' anatomic_site_source_value = (', as.character(anatomic_site_source_value), ')')
    } else {
      statement <- paste0(statement, " anatomic_site_source_value = '", anatomic_site_source_value,"'")
    }
  }

  if (!missing(disease_status_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(disease_status_source_value)) {
      statement <- paste0(statement, ' disease_status_source_value IS NULL')
    } else if (is(disease_status_source_value, 'subQuery')){
      statement <- paste0(statement, ' disease_status_source_value = (', as.character(disease_status_source_value), ')')
    } else {
      statement <- paste0(statement, " disease_status_source_value = '", disease_status_source_value,"'")
    }
  }

  class(statement) <- 'subQuery'
  return(statement)
}

lookup_visit_detail <- function(fetchField, visit_detail_id, person_id, visit_concept_id, visit_start_date, visit_start_datetime, visit_end_date, visit_end_datetime, visit_type_concept_id, provider_id, care_site_id, visit_source_value, visit_source_concept_id, admitting_source_value, admitting_source_concept_id, discharge_to_source_value, discharge_to_concept_id, preceding_visit_detail_id, visit_detail_parent_id, visit_occurrence_id) {
  statement <- paste0('SELECT ', fetchField , ' FROM visit_detail WHERE')
  first <- TRUE
  if (!missing(visit_detail_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_detail_id)) {
      statement <- paste0(statement, ' visit_detail_id IS NULL')
    } else if (is(visit_detail_id, 'subQuery')){
      statement <- paste0(statement, ' visit_detail_id = (', as.character(visit_detail_id), ')')
    } else {
      statement <- paste0(statement, " visit_detail_id = '", visit_detail_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(visit_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_concept_id)) {
      statement <- paste0(statement, ' visit_concept_id IS NULL')
    } else if (is(visit_concept_id, 'subQuery')){
      statement <- paste0(statement, ' visit_concept_id = (', as.character(visit_concept_id), ')')
    } else {
      statement <- paste0(statement, " visit_concept_id = '", visit_concept_id,"'")
    }
  }

  if (!missing(visit_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_start_date)) {
      statement <- paste0(statement, ' visit_start_date IS NULL')
    } else if (is(visit_start_date, 'subQuery')){
      statement <- paste0(statement, ' visit_start_date = (', as.character(visit_start_date), ')')
    } else {
      statement <- paste0(statement, " visit_start_date = '", visit_start_date,"'")
    }
  }

  if (!missing(visit_start_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_start_datetime)) {
      statement <- paste0(statement, ' visit_start_datetime IS NULL')
    } else if (is(visit_start_datetime, 'subQuery')){
      statement <- paste0(statement, ' visit_start_datetime = (', as.character(visit_start_datetime), ')')
    } else {
      statement <- paste0(statement, " visit_start_datetime = '", visit_start_datetime,"'")
    }
  }

  if (!missing(visit_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_end_date)) {
      statement <- paste0(statement, ' visit_end_date IS NULL')
    } else if (is(visit_end_date, 'subQuery')){
      statement <- paste0(statement, ' visit_end_date = (', as.character(visit_end_date), ')')
    } else {
      statement <- paste0(statement, " visit_end_date = '", visit_end_date,"'")
    }
  }

  if (!missing(visit_end_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_end_datetime)) {
      statement <- paste0(statement, ' visit_end_datetime IS NULL')
    } else if (is(visit_end_datetime, 'subQuery')){
      statement <- paste0(statement, ' visit_end_datetime = (', as.character(visit_end_datetime), ')')
    } else {
      statement <- paste0(statement, " visit_end_datetime = '", visit_end_datetime,"'")
    }
  }

  if (!missing(visit_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_type_concept_id)) {
      statement <- paste0(statement, ' visit_type_concept_id IS NULL')
    } else if (is(visit_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' visit_type_concept_id = (', as.character(visit_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " visit_type_concept_id = '", visit_type_concept_id,"'")
    }
  }

  if (!missing(provider_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_id)) {
      statement <- paste0(statement, ' provider_id IS NULL')
    } else if (is(provider_id, 'subQuery')){
      statement <- paste0(statement, ' provider_id = (', as.character(provider_id), ')')
    } else {
      statement <- paste0(statement, " provider_id = '", provider_id,"'")
    }
  }

  if (!missing(care_site_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(care_site_id)) {
      statement <- paste0(statement, ' care_site_id IS NULL')
    } else if (is(care_site_id, 'subQuery')){
      statement <- paste0(statement, ' care_site_id = (', as.character(care_site_id), ')')
    } else {
      statement <- paste0(statement, " care_site_id = '", care_site_id,"'")
    }
  }

  if (!missing(visit_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_source_value)) {
      statement <- paste0(statement, ' visit_source_value IS NULL')
    } else if (is(visit_source_value, 'subQuery')){
      statement <- paste0(statement, ' visit_source_value = (', as.character(visit_source_value), ')')
    } else {
      statement <- paste0(statement, " visit_source_value = '", visit_source_value,"'")
    }
  }

  if (!missing(visit_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_source_concept_id)) {
      statement <- paste0(statement, ' visit_source_concept_id IS NULL')
    } else if (is(visit_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' visit_source_concept_id = (', as.character(visit_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " visit_source_concept_id = '", visit_source_concept_id,"'")
    }
  }

  if (!missing(admitting_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(admitting_source_value)) {
      statement <- paste0(statement, ' admitting_source_value IS NULL')
    } else if (is(admitting_source_value, 'subQuery')){
      statement <- paste0(statement, ' admitting_source_value = (', as.character(admitting_source_value), ')')
    } else {
      statement <- paste0(statement, " admitting_source_value = '", admitting_source_value,"'")
    }
  }

  if (!missing(admitting_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(admitting_source_concept_id)) {
      statement <- paste0(statement, ' admitting_source_concept_id IS NULL')
    } else if (is(admitting_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' admitting_source_concept_id = (', as.character(admitting_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " admitting_source_concept_id = '", admitting_source_concept_id,"'")
    }
  }

  if (!missing(discharge_to_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(discharge_to_source_value)) {
      statement <- paste0(statement, ' discharge_to_source_value IS NULL')
    } else if (is(discharge_to_source_value, 'subQuery')){
      statement <- paste0(statement, ' discharge_to_source_value = (', as.character(discharge_to_source_value), ')')
    } else {
      statement <- paste0(statement, " discharge_to_source_value = '", discharge_to_source_value,"'")
    }
  }

  if (!missing(discharge_to_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(discharge_to_concept_id)) {
      statement <- paste0(statement, ' discharge_to_concept_id IS NULL')
    } else if (is(discharge_to_concept_id, 'subQuery')){
      statement <- paste0(statement, ' discharge_to_concept_id = (', as.character(discharge_to_concept_id), ')')
    } else {
      statement <- paste0(statement, " discharge_to_concept_id = '", discharge_to_concept_id,"'")
    }
  }

  if (!missing(preceding_visit_detail_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(preceding_visit_detail_id)) {
      statement <- paste0(statement, ' preceding_visit_detail_id IS NULL')
    } else if (is(preceding_visit_detail_id, 'subQuery')){
      statement <- paste0(statement, ' preceding_visit_detail_id = (', as.character(preceding_visit_detail_id), ')')
    } else {
      statement <- paste0(statement, " preceding_visit_detail_id = '", preceding_visit_detail_id,"'")
    }
  }

  if (!missing(visit_detail_parent_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_detail_parent_id)) {
      statement <- paste0(statement, ' visit_detail_parent_id IS NULL')
    } else if (is(visit_detail_parent_id, 'subQuery')){
      statement <- paste0(statement, ' visit_detail_parent_id = (', as.character(visit_detail_parent_id), ')')
    } else {
      statement <- paste0(statement, " visit_detail_parent_id = '", visit_detail_parent_id,"'")
    }
  }

  if (!missing(visit_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_occurrence_id)) {
      statement <- paste0(statement, ' visit_occurrence_id IS NULL')
    } else if (is(visit_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' visit_occurrence_id = (', as.character(visit_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " visit_occurrence_id = '", visit_occurrence_id,"'")
    }
  }

  class(statement) <- 'subQuery'
  return(statement)
}

lookup_visit_occurrence <- function(fetchField, visit_occurrence_id, person_id, visit_concept_id, visit_start_date, visit_start_datetime, visit_end_date, visit_end_datetime, visit_type_concept_id, provider_id, care_site_id, visit_source_value, visit_source_concept_id, admitting_source_concept_id, admitting_source_value, discharge_to_concept_id, discharge_to_source_value, preceding_visit_occurrence_id) {
  statement <- paste0('SELECT ', fetchField , ' FROM visit_occurrence WHERE')
  first <- TRUE
  if (!missing(visit_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_occurrence_id)) {
      statement <- paste0(statement, ' visit_occurrence_id IS NULL')
    } else if (is(visit_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' visit_occurrence_id = (', as.character(visit_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " visit_occurrence_id = '", visit_occurrence_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(visit_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_concept_id)) {
      statement <- paste0(statement, ' visit_concept_id IS NULL')
    } else if (is(visit_concept_id, 'subQuery')){
      statement <- paste0(statement, ' visit_concept_id = (', as.character(visit_concept_id), ')')
    } else {
      statement <- paste0(statement, " visit_concept_id = '", visit_concept_id,"'")
    }
  }

  if (!missing(visit_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_start_date)) {
      statement <- paste0(statement, ' visit_start_date IS NULL')
    } else if (is(visit_start_date, 'subQuery')){
      statement <- paste0(statement, ' visit_start_date = (', as.character(visit_start_date), ')')
    } else {
      statement <- paste0(statement, " visit_start_date = '", visit_start_date,"'")
    }
  }

  if (!missing(visit_start_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_start_datetime)) {
      statement <- paste0(statement, ' visit_start_datetime IS NULL')
    } else if (is(visit_start_datetime, 'subQuery')){
      statement <- paste0(statement, ' visit_start_datetime = (', as.character(visit_start_datetime), ')')
    } else {
      statement <- paste0(statement, " visit_start_datetime = '", visit_start_datetime,"'")
    }
  }

  if (!missing(visit_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_end_date)) {
      statement <- paste0(statement, ' visit_end_date IS NULL')
    } else if (is(visit_end_date, 'subQuery')){
      statement <- paste0(statement, ' visit_end_date = (', as.character(visit_end_date), ')')
    } else {
      statement <- paste0(statement, " visit_end_date = '", visit_end_date,"'")
    }
  }

  if (!missing(visit_end_datetime)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_end_datetime)) {
      statement <- paste0(statement, ' visit_end_datetime IS NULL')
    } else if (is(visit_end_datetime, 'subQuery')){
      statement <- paste0(statement, ' visit_end_datetime = (', as.character(visit_end_datetime), ')')
    } else {
      statement <- paste0(statement, " visit_end_datetime = '", visit_end_datetime,"'")
    }
  }

  if (!missing(visit_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_type_concept_id)) {
      statement <- paste0(statement, ' visit_type_concept_id IS NULL')
    } else if (is(visit_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' visit_type_concept_id = (', as.character(visit_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " visit_type_concept_id = '", visit_type_concept_id,"'")
    }
  }

  if (!missing(provider_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_id)) {
      statement <- paste0(statement, ' provider_id IS NULL')
    } else if (is(provider_id, 'subQuery')){
      statement <- paste0(statement, ' provider_id = (', as.character(provider_id), ')')
    } else {
      statement <- paste0(statement, " provider_id = '", provider_id,"'")
    }
  }

  if (!missing(care_site_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(care_site_id)) {
      statement <- paste0(statement, ' care_site_id IS NULL')
    } else if (is(care_site_id, 'subQuery')){
      statement <- paste0(statement, ' care_site_id = (', as.character(care_site_id), ')')
    } else {
      statement <- paste0(statement, " care_site_id = '", care_site_id,"'")
    }
  }

  if (!missing(visit_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_source_value)) {
      statement <- paste0(statement, ' visit_source_value IS NULL')
    } else if (is(visit_source_value, 'subQuery')){
      statement <- paste0(statement, ' visit_source_value = (', as.character(visit_source_value), ')')
    } else {
      statement <- paste0(statement, " visit_source_value = '", visit_source_value,"'")
    }
  }

  if (!missing(visit_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(visit_source_concept_id)) {
      statement <- paste0(statement, ' visit_source_concept_id IS NULL')
    } else if (is(visit_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' visit_source_concept_id = (', as.character(visit_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " visit_source_concept_id = '", visit_source_concept_id,"'")
    }
  }

  if (!missing(admitting_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(admitting_source_concept_id)) {
      statement <- paste0(statement, ' admitting_source_concept_id IS NULL')
    } else if (is(admitting_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' admitting_source_concept_id = (', as.character(admitting_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " admitting_source_concept_id = '", admitting_source_concept_id,"'")
    }
  }

  if (!missing(admitting_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(admitting_source_value)) {
      statement <- paste0(statement, ' admitting_source_value IS NULL')
    } else if (is(admitting_source_value, 'subQuery')){
      statement <- paste0(statement, ' admitting_source_value = (', as.character(admitting_source_value), ')')
    } else {
      statement <- paste0(statement, " admitting_source_value = '", admitting_source_value,"'")
    }
  }

  if (!missing(discharge_to_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(discharge_to_concept_id)) {
      statement <- paste0(statement, ' discharge_to_concept_id IS NULL')
    } else if (is(discharge_to_concept_id, 'subQuery')){
      statement <- paste0(statement, ' discharge_to_concept_id = (', as.character(discharge_to_concept_id), ')')
    } else {
      statement <- paste0(statement, " discharge_to_concept_id = '", discharge_to_concept_id,"'")
    }
  }

  if (!missing(discharge_to_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(discharge_to_source_value)) {
      statement <- paste0(statement, ' discharge_to_source_value IS NULL')
    } else if (is(discharge_to_source_value, 'subQuery')){
      statement <- paste0(statement, ' discharge_to_source_value = (', as.character(discharge_to_source_value), ')')
    } else {
      statement <- paste0(statement, " discharge_to_source_value = '", discharge_to_source_value,"'")
    }
  }

  if (!missing(preceding_visit_occurrence_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(preceding_visit_occurrence_id)) {
      statement <- paste0(statement, ' preceding_visit_occurrence_id IS NULL')
    } else if (is(preceding_visit_occurrence_id, 'subQuery')){
      statement <- paste0(statement, ' preceding_visit_occurrence_id = (', as.character(preceding_visit_occurrence_id), ')')
    } else {
      statement <- paste0(statement, " preceding_visit_occurrence_id = '", preceding_visit_occurrence_id,"'")
    }
  }

  class(statement) <- 'subQuery'
  return(statement)
}

lookup_cohort <- function(fetchField, cohort_definition_id, subject_id, cohort_start_date, cohort_end_date) {
  statement <- paste0('SELECT ', fetchField , ' FROM cohort WHERE')
  first <- TRUE
  if (!missing(cohort_definition_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cohort_definition_id)) {
      statement <- paste0(statement, ' cohort_definition_id IS NULL')
    } else if (is(cohort_definition_id, 'subQuery')){
      statement <- paste0(statement, ' cohort_definition_id = (', as.character(cohort_definition_id), ')')
    } else {
      statement <- paste0(statement, " cohort_definition_id = '", cohort_definition_id,"'")
    }
  }

  if (!missing(subject_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(subject_id)) {
      statement <- paste0(statement, ' subject_id IS NULL')
    } else if (is(subject_id, 'subQuery')){
      statement <- paste0(statement, ' subject_id = (', as.character(subject_id), ')')
    } else {
      statement <- paste0(statement, " subject_id = '", subject_id,"'")
    }
  }

  if (!missing(cohort_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cohort_start_date)) {
      statement <- paste0(statement, ' cohort_start_date IS NULL')
    } else if (is(cohort_start_date, 'subQuery')){
      statement <- paste0(statement, ' cohort_start_date = (', as.character(cohort_start_date), ')')
    } else {
      statement <- paste0(statement, " cohort_start_date = '", cohort_start_date,"'")
    }
  }

  if (!missing(cohort_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cohort_end_date)) {
      statement <- paste0(statement, ' cohort_end_date IS NULL')
    } else if (is(cohort_end_date, 'subQuery')){
      statement <- paste0(statement, ' cohort_end_date = (', as.character(cohort_end_date), ')')
    } else {
      statement <- paste0(statement, " cohort_end_date = '", cohort_end_date,"'")
    }
  }

  class(statement) <- 'subQuery'
  return(statement)
}

lookup_cohort_attribute <- function(fetchField, cohort_definition_id, subject_id, cohort_start_date, cohort_end_date, attribute_definition_id, value_as_number, value_as_concept_id) {
  statement <- paste0('SELECT ', fetchField , ' FROM cohort_attribute WHERE')
  first <- TRUE
  if (!missing(cohort_definition_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cohort_definition_id)) {
      statement <- paste0(statement, ' cohort_definition_id IS NULL')
    } else if (is(cohort_definition_id, 'subQuery')){
      statement <- paste0(statement, ' cohort_definition_id = (', as.character(cohort_definition_id), ')')
    } else {
      statement <- paste0(statement, " cohort_definition_id = '", cohort_definition_id,"'")
    }
  }

  if (!missing(subject_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(subject_id)) {
      statement <- paste0(statement, ' subject_id IS NULL')
    } else if (is(subject_id, 'subQuery')){
      statement <- paste0(statement, ' subject_id = (', as.character(subject_id), ')')
    } else {
      statement <- paste0(statement, " subject_id = '", subject_id,"'")
    }
  }

  if (!missing(cohort_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cohort_start_date)) {
      statement <- paste0(statement, ' cohort_start_date IS NULL')
    } else if (is(cohort_start_date, 'subQuery')){
      statement <- paste0(statement, ' cohort_start_date = (', as.character(cohort_start_date), ')')
    } else {
      statement <- paste0(statement, " cohort_start_date = '", cohort_start_date,"'")
    }
  }

  if (!missing(cohort_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cohort_end_date)) {
      statement <- paste0(statement, ' cohort_end_date IS NULL')
    } else if (is(cohort_end_date, 'subQuery')){
      statement <- paste0(statement, ' cohort_end_date = (', as.character(cohort_end_date), ')')
    } else {
      statement <- paste0(statement, " cohort_end_date = '", cohort_end_date,"'")
    }
  }

  if (!missing(attribute_definition_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(attribute_definition_id)) {
      statement <- paste0(statement, ' attribute_definition_id IS NULL')
    } else if (is(attribute_definition_id, 'subQuery')){
      statement <- paste0(statement, ' attribute_definition_id = (', as.character(attribute_definition_id), ')')
    } else {
      statement <- paste0(statement, " attribute_definition_id = '", attribute_definition_id,"'")
    }
  }

  if (!missing(value_as_number)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(value_as_number)) {
      statement <- paste0(statement, ' value_as_number IS NULL')
    } else if (is(value_as_number, 'subQuery')){
      statement <- paste0(statement, ' value_as_number = (', as.character(value_as_number), ')')
    } else {
      statement <- paste0(statement, " value_as_number = '", value_as_number,"'")
    }
  }

  if (!missing(value_as_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(value_as_concept_id)) {
      statement <- paste0(statement, ' value_as_concept_id IS NULL')
    } else if (is(value_as_concept_id, 'subQuery')){
      statement <- paste0(statement, ' value_as_concept_id = (', as.character(value_as_concept_id), ')')
    } else {
      statement <- paste0(statement, " value_as_concept_id = '", value_as_concept_id,"'")
    }
  }

  class(statement) <- 'subQuery'
  return(statement)
}

lookup_condition_era <- function(fetchField, condition_era_id, person_id, condition_concept_id, condition_era_start_date, condition_era_end_date, condition_occurrence_count) {
  statement <- paste0('SELECT ', fetchField , ' FROM condition_era WHERE')
  first <- TRUE
  if (!missing(condition_era_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_era_id)) {
      statement <- paste0(statement, ' condition_era_id IS NULL')
    } else if (is(condition_era_id, 'subQuery')){
      statement <- paste0(statement, ' condition_era_id = (', as.character(condition_era_id), ')')
    } else {
      statement <- paste0(statement, " condition_era_id = '", condition_era_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(condition_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_concept_id)) {
      statement <- paste0(statement, ' condition_concept_id IS NULL')
    } else if (is(condition_concept_id, 'subQuery')){
      statement <- paste0(statement, ' condition_concept_id = (', as.character(condition_concept_id), ')')
    } else {
      statement <- paste0(statement, " condition_concept_id = '", condition_concept_id,"'")
    }
  }

  if (!missing(condition_era_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_era_start_date)) {
      statement <- paste0(statement, ' condition_era_start_date IS NULL')
    } else if (is(condition_era_start_date, 'subQuery')){
      statement <- paste0(statement, ' condition_era_start_date = (', as.character(condition_era_start_date), ')')
    } else {
      statement <- paste0(statement, " condition_era_start_date = '", condition_era_start_date,"'")
    }
  }

  if (!missing(condition_era_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_era_end_date)) {
      statement <- paste0(statement, ' condition_era_end_date IS NULL')
    } else if (is(condition_era_end_date, 'subQuery')){
      statement <- paste0(statement, ' condition_era_end_date = (', as.character(condition_era_end_date), ')')
    } else {
      statement <- paste0(statement, " condition_era_end_date = '", condition_era_end_date,"'")
    }
  }

  if (!missing(condition_occurrence_count)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(condition_occurrence_count)) {
      statement <- paste0(statement, ' condition_occurrence_count IS NULL')
    } else if (is(condition_occurrence_count, 'subQuery')){
      statement <- paste0(statement, ' condition_occurrence_count = (', as.character(condition_occurrence_count), ')')
    } else {
      statement <- paste0(statement, " condition_occurrence_count = '", condition_occurrence_count,"'")
    }
  }

  class(statement) <- 'subQuery'
  return(statement)
}

lookup_dose_era <- function(fetchField, dose_era_id, person_id, drug_concept_id, unit_concept_id, dose_value, dose_era_start_date, dose_era_end_date) {
  statement <- paste0('SELECT ', fetchField , ' FROM dose_era WHERE')
  first <- TRUE
  if (!missing(dose_era_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(dose_era_id)) {
      statement <- paste0(statement, ' dose_era_id IS NULL')
    } else if (is(dose_era_id, 'subQuery')){
      statement <- paste0(statement, ' dose_era_id = (', as.character(dose_era_id), ')')
    } else {
      statement <- paste0(statement, " dose_era_id = '", dose_era_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(drug_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_concept_id)) {
      statement <- paste0(statement, ' drug_concept_id IS NULL')
    } else if (is(drug_concept_id, 'subQuery')){
      statement <- paste0(statement, ' drug_concept_id = (', as.character(drug_concept_id), ')')
    } else {
      statement <- paste0(statement, " drug_concept_id = '", drug_concept_id,"'")
    }
  }

  if (!missing(unit_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(unit_concept_id)) {
      statement <- paste0(statement, ' unit_concept_id IS NULL')
    } else if (is(unit_concept_id, 'subQuery')){
      statement <- paste0(statement, ' unit_concept_id = (', as.character(unit_concept_id), ')')
    } else {
      statement <- paste0(statement, " unit_concept_id = '", unit_concept_id,"'")
    }
  }

  if (!missing(dose_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(dose_value)) {
      statement <- paste0(statement, ' dose_value IS NULL')
    } else if (is(dose_value, 'subQuery')){
      statement <- paste0(statement, ' dose_value = (', as.character(dose_value), ')')
    } else {
      statement <- paste0(statement, " dose_value = '", dose_value,"'")
    }
  }

  if (!missing(dose_era_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(dose_era_start_date)) {
      statement <- paste0(statement, ' dose_era_start_date IS NULL')
    } else if (is(dose_era_start_date, 'subQuery')){
      statement <- paste0(statement, ' dose_era_start_date = (', as.character(dose_era_start_date), ')')
    } else {
      statement <- paste0(statement, " dose_era_start_date = '", dose_era_start_date,"'")
    }
  }

  if (!missing(dose_era_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(dose_era_end_date)) {
      statement <- paste0(statement, ' dose_era_end_date IS NULL')
    } else if (is(dose_era_end_date, 'subQuery')){
      statement <- paste0(statement, ' dose_era_end_date = (', as.character(dose_era_end_date), ')')
    } else {
      statement <- paste0(statement, " dose_era_end_date = '", dose_era_end_date,"'")
    }
  }

  class(statement) <- 'subQuery'
  return(statement)
}

lookup_drug_era <- function(fetchField, drug_era_id, person_id, drug_concept_id, drug_era_start_date, drug_era_end_date, drug_exposure_count, gap_days) {
  statement <- paste0('SELECT ', fetchField , ' FROM drug_era WHERE')
  first <- TRUE
  if (!missing(drug_era_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_era_id)) {
      statement <- paste0(statement, ' drug_era_id IS NULL')
    } else if (is(drug_era_id, 'subQuery')){
      statement <- paste0(statement, ' drug_era_id = (', as.character(drug_era_id), ')')
    } else {
      statement <- paste0(statement, " drug_era_id = '", drug_era_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(drug_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_concept_id)) {
      statement <- paste0(statement, ' drug_concept_id IS NULL')
    } else if (is(drug_concept_id, 'subQuery')){
      statement <- paste0(statement, ' drug_concept_id = (', as.character(drug_concept_id), ')')
    } else {
      statement <- paste0(statement, " drug_concept_id = '", drug_concept_id,"'")
    }
  }

  if (!missing(drug_era_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_era_start_date)) {
      statement <- paste0(statement, ' drug_era_start_date IS NULL')
    } else if (is(drug_era_start_date, 'subQuery')){
      statement <- paste0(statement, ' drug_era_start_date = (', as.character(drug_era_start_date), ')')
    } else {
      statement <- paste0(statement, " drug_era_start_date = '", drug_era_start_date,"'")
    }
  }

  if (!missing(drug_era_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_era_end_date)) {
      statement <- paste0(statement, ' drug_era_end_date IS NULL')
    } else if (is(drug_era_end_date, 'subQuery')){
      statement <- paste0(statement, ' drug_era_end_date = (', as.character(drug_era_end_date), ')')
    } else {
      statement <- paste0(statement, " drug_era_end_date = '", drug_era_end_date,"'")
    }
  }

  if (!missing(drug_exposure_count)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drug_exposure_count)) {
      statement <- paste0(statement, ' drug_exposure_count IS NULL')
    } else if (is(drug_exposure_count, 'subQuery')){
      statement <- paste0(statement, ' drug_exposure_count = (', as.character(drug_exposure_count), ')')
    } else {
      statement <- paste0(statement, " drug_exposure_count = '", drug_exposure_count,"'")
    }
  }

  if (!missing(gap_days)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(gap_days)) {
      statement <- paste0(statement, ' gap_days IS NULL')
    } else if (is(gap_days, 'subQuery')){
      statement <- paste0(statement, ' gap_days = (', as.character(gap_days), ')')
    } else {
      statement <- paste0(statement, " gap_days = '", gap_days,"'")
    }
  }

  class(statement) <- 'subQuery'
  return(statement)
}

lookup_cost <- function(fetchField, cost_id, cost_event_id, cost_domain_id, cost_type_concept_id, currency_concept_id, total_charge, total_cost, total_paid, paid_by_payer, paid_by_patient, paid_patient_copay, paid_patient_coinsurance, paid_patient_deductible, paid_by_primary, paid_ingredient_cost, paid_dispensing_fee, payer_plan_period_id, amount_allowed, revenue_code_concept_id, revenue_code_source_value, drg_concept_id, drg_source_value) {
  statement <- paste0('SELECT ', fetchField , ' FROM cost WHERE')
  first <- TRUE
  if (!missing(cost_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cost_id)) {
      statement <- paste0(statement, ' cost_id IS NULL')
    } else if (is(cost_id, 'subQuery')){
      statement <- paste0(statement, ' cost_id = (', as.character(cost_id), ')')
    } else {
      statement <- paste0(statement, " cost_id = '", cost_id,"'")
    }
  }

  if (!missing(cost_event_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cost_event_id)) {
      statement <- paste0(statement, ' cost_event_id IS NULL')
    } else if (is(cost_event_id, 'subQuery')){
      statement <- paste0(statement, ' cost_event_id = (', as.character(cost_event_id), ')')
    } else {
      statement <- paste0(statement, " cost_event_id = '", cost_event_id,"'")
    }
  }

  if (!missing(cost_domain_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cost_domain_id)) {
      statement <- paste0(statement, ' cost_domain_id IS NULL')
    } else if (is(cost_domain_id, 'subQuery')){
      statement <- paste0(statement, ' cost_domain_id = (', as.character(cost_domain_id), ')')
    } else {
      statement <- paste0(statement, " cost_domain_id = '", cost_domain_id,"'")
    }
  }

  if (!missing(cost_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cost_type_concept_id)) {
      statement <- paste0(statement, ' cost_type_concept_id IS NULL')
    } else if (is(cost_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' cost_type_concept_id = (', as.character(cost_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " cost_type_concept_id = '", cost_type_concept_id,"'")
    }
  }

  if (!missing(currency_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(currency_concept_id)) {
      statement <- paste0(statement, ' currency_concept_id IS NULL')
    } else if (is(currency_concept_id, 'subQuery')){
      statement <- paste0(statement, ' currency_concept_id = (', as.character(currency_concept_id), ')')
    } else {
      statement <- paste0(statement, " currency_concept_id = '", currency_concept_id,"'")
    }
  }

  if (!missing(total_charge)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(total_charge)) {
      statement <- paste0(statement, ' total_charge IS NULL')
    } else if (is(total_charge, 'subQuery')){
      statement <- paste0(statement, ' total_charge = (', as.character(total_charge), ')')
    } else {
      statement <- paste0(statement, " total_charge = '", total_charge,"'")
    }
  }

  if (!missing(total_cost)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(total_cost)) {
      statement <- paste0(statement, ' total_cost IS NULL')
    } else if (is(total_cost, 'subQuery')){
      statement <- paste0(statement, ' total_cost = (', as.character(total_cost), ')')
    } else {
      statement <- paste0(statement, " total_cost = '", total_cost,"'")
    }
  }

  if (!missing(total_paid)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(total_paid)) {
      statement <- paste0(statement, ' total_paid IS NULL')
    } else if (is(total_paid, 'subQuery')){
      statement <- paste0(statement, ' total_paid = (', as.character(total_paid), ')')
    } else {
      statement <- paste0(statement, " total_paid = '", total_paid,"'")
    }
  }

  if (!missing(paid_by_payer)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(paid_by_payer)) {
      statement <- paste0(statement, ' paid_by_payer IS NULL')
    } else if (is(paid_by_payer, 'subQuery')){
      statement <- paste0(statement, ' paid_by_payer = (', as.character(paid_by_payer), ')')
    } else {
      statement <- paste0(statement, " paid_by_payer = '", paid_by_payer,"'")
    }
  }

  if (!missing(paid_by_patient)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(paid_by_patient)) {
      statement <- paste0(statement, ' paid_by_patient IS NULL')
    } else if (is(paid_by_patient, 'subQuery')){
      statement <- paste0(statement, ' paid_by_patient = (', as.character(paid_by_patient), ')')
    } else {
      statement <- paste0(statement, " paid_by_patient = '", paid_by_patient,"'")
    }
  }

  if (!missing(paid_patient_copay)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(paid_patient_copay)) {
      statement <- paste0(statement, ' paid_patient_copay IS NULL')
    } else if (is(paid_patient_copay, 'subQuery')){
      statement <- paste0(statement, ' paid_patient_copay = (', as.character(paid_patient_copay), ')')
    } else {
      statement <- paste0(statement, " paid_patient_copay = '", paid_patient_copay,"'")
    }
  }

  if (!missing(paid_patient_coinsurance)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(paid_patient_coinsurance)) {
      statement <- paste0(statement, ' paid_patient_coinsurance IS NULL')
    } else if (is(paid_patient_coinsurance, 'subQuery')){
      statement <- paste0(statement, ' paid_patient_coinsurance = (', as.character(paid_patient_coinsurance), ')')
    } else {
      statement <- paste0(statement, " paid_patient_coinsurance = '", paid_patient_coinsurance,"'")
    }
  }

  if (!missing(paid_patient_deductible)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(paid_patient_deductible)) {
      statement <- paste0(statement, ' paid_patient_deductible IS NULL')
    } else if (is(paid_patient_deductible, 'subQuery')){
      statement <- paste0(statement, ' paid_patient_deductible = (', as.character(paid_patient_deductible), ')')
    } else {
      statement <- paste0(statement, " paid_patient_deductible = '", paid_patient_deductible,"'")
    }
  }

  if (!missing(paid_by_primary)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(paid_by_primary)) {
      statement <- paste0(statement, ' paid_by_primary IS NULL')
    } else if (is(paid_by_primary, 'subQuery')){
      statement <- paste0(statement, ' paid_by_primary = (', as.character(paid_by_primary), ')')
    } else {
      statement <- paste0(statement, " paid_by_primary = '", paid_by_primary,"'")
    }
  }

  if (!missing(paid_ingredient_cost)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(paid_ingredient_cost)) {
      statement <- paste0(statement, ' paid_ingredient_cost IS NULL')
    } else if (is(paid_ingredient_cost, 'subQuery')){
      statement <- paste0(statement, ' paid_ingredient_cost = (', as.character(paid_ingredient_cost), ')')
    } else {
      statement <- paste0(statement, " paid_ingredient_cost = '", paid_ingredient_cost,"'")
    }
  }

  if (!missing(paid_dispensing_fee)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(paid_dispensing_fee)) {
      statement <- paste0(statement, ' paid_dispensing_fee IS NULL')
    } else if (is(paid_dispensing_fee, 'subQuery')){
      statement <- paste0(statement, ' paid_dispensing_fee = (', as.character(paid_dispensing_fee), ')')
    } else {
      statement <- paste0(statement, " paid_dispensing_fee = '", paid_dispensing_fee,"'")
    }
  }

  if (!missing(payer_plan_period_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(payer_plan_period_id)) {
      statement <- paste0(statement, ' payer_plan_period_id IS NULL')
    } else if (is(payer_plan_period_id, 'subQuery')){
      statement <- paste0(statement, ' payer_plan_period_id = (', as.character(payer_plan_period_id), ')')
    } else {
      statement <- paste0(statement, " payer_plan_period_id = '", payer_plan_period_id,"'")
    }
  }

  if (!missing(amount_allowed)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(amount_allowed)) {
      statement <- paste0(statement, ' amount_allowed IS NULL')
    } else if (is(amount_allowed, 'subQuery')){
      statement <- paste0(statement, ' amount_allowed = (', as.character(amount_allowed), ')')
    } else {
      statement <- paste0(statement, " amount_allowed = '", amount_allowed,"'")
    }
  }

  if (!missing(revenue_code_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(revenue_code_concept_id)) {
      statement <- paste0(statement, ' revenue_code_concept_id IS NULL')
    } else if (is(revenue_code_concept_id, 'subQuery')){
      statement <- paste0(statement, ' revenue_code_concept_id = (', as.character(revenue_code_concept_id), ')')
    } else {
      statement <- paste0(statement, " revenue_code_concept_id = '", revenue_code_concept_id,"'")
    }
  }

  if (!missing(revenue_code_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(revenue_code_source_value)) {
      statement <- paste0(statement, ' revenue_code_source_value IS NULL')
    } else if (is(revenue_code_source_value, 'subQuery')){
      statement <- paste0(statement, ' revenue_code_source_value = (', as.character(revenue_code_source_value), ')')
    } else {
      statement <- paste0(statement, " revenue_code_source_value = '", revenue_code_source_value,"'")
    }
  }

  if (!missing(drg_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drg_concept_id)) {
      statement <- paste0(statement, ' drg_concept_id IS NULL')
    } else if (is(drg_concept_id, 'subQuery')){
      statement <- paste0(statement, ' drg_concept_id = (', as.character(drg_concept_id), ')')
    } else {
      statement <- paste0(statement, " drg_concept_id = '", drg_concept_id,"'")
    }
  }

  if (!missing(drg_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(drg_source_value)) {
      statement <- paste0(statement, ' drg_source_value IS NULL')
    } else if (is(drg_source_value, 'subQuery')){
      statement <- paste0(statement, ' drg_source_value = (', as.character(drg_source_value), ')')
    } else {
      statement <- paste0(statement, " drg_source_value = '", drg_source_value,"'")
    }
  }

  class(statement) <- 'subQuery'
  return(statement)
}

lookup_payer_plan_period <- function(fetchField, payer_plan_period_id, person_id, payer_plan_period_start_date, payer_plan_period_end_date, payer_source_value, plan_source_value, family_source_value) {
  statement <- paste0('SELECT ', fetchField , ' FROM payer_plan_period WHERE')
  first <- TRUE
  if (!missing(payer_plan_period_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(payer_plan_period_id)) {
      statement <- paste0(statement, ' payer_plan_period_id IS NULL')
    } else if (is(payer_plan_period_id, 'subQuery')){
      statement <- paste0(statement, ' payer_plan_period_id = (', as.character(payer_plan_period_id), ')')
    } else {
      statement <- paste0(statement, " payer_plan_period_id = '", payer_plan_period_id,"'")
    }
  }

  if (!missing(person_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(person_id)) {
      statement <- paste0(statement, ' person_id IS NULL')
    } else if (is(person_id, 'subQuery')){
      statement <- paste0(statement, ' person_id = (', as.character(person_id), ')')
    } else {
      statement <- paste0(statement, " person_id = '", person_id,"'")
    }
  }

  if (!missing(payer_plan_period_start_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(payer_plan_period_start_date)) {
      statement <- paste0(statement, ' payer_plan_period_start_date IS NULL')
    } else if (is(payer_plan_period_start_date, 'subQuery')){
      statement <- paste0(statement, ' payer_plan_period_start_date = (', as.character(payer_plan_period_start_date), ')')
    } else {
      statement <- paste0(statement, " payer_plan_period_start_date = '", payer_plan_period_start_date,"'")
    }
  }

  if (!missing(payer_plan_period_end_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(payer_plan_period_end_date)) {
      statement <- paste0(statement, ' payer_plan_period_end_date IS NULL')
    } else if (is(payer_plan_period_end_date, 'subQuery')){
      statement <- paste0(statement, ' payer_plan_period_end_date = (', as.character(payer_plan_period_end_date), ')')
    } else {
      statement <- paste0(statement, " payer_plan_period_end_date = '", payer_plan_period_end_date,"'")
    }
  }

  if (!missing(payer_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(payer_source_value)) {
      statement <- paste0(statement, ' payer_source_value IS NULL')
    } else if (is(payer_source_value, 'subQuery')){
      statement <- paste0(statement, ' payer_source_value = (', as.character(payer_source_value), ')')
    } else {
      statement <- paste0(statement, " payer_source_value = '", payer_source_value,"'")
    }
  }

  if (!missing(plan_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(plan_source_value)) {
      statement <- paste0(statement, ' plan_source_value IS NULL')
    } else if (is(plan_source_value, 'subQuery')){
      statement <- paste0(statement, ' plan_source_value = (', as.character(plan_source_value), ')')
    } else {
      statement <- paste0(statement, " plan_source_value = '", plan_source_value,"'")
    }
  }

  if (!missing(family_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(family_source_value)) {
      statement <- paste0(statement, ' family_source_value IS NULL')
    } else if (is(family_source_value, 'subQuery')){
      statement <- paste0(statement, ' family_source_value = (', as.character(family_source_value), ')')
    } else {
      statement <- paste0(statement, " family_source_value = '", family_source_value,"'")
    }
  }

  class(statement) <- 'subQuery'
  return(statement)
}

lookup_care_site <- function(fetchField, care_site_id, care_site_name, place_of_service_concept_id, location_id, care_site_source_value, place_of_service_source_value) {
  statement <- paste0('SELECT ', fetchField , ' FROM care_site WHERE')
  first <- TRUE
  if (!missing(care_site_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(care_site_id)) {
      statement <- paste0(statement, ' care_site_id IS NULL')
    } else if (is(care_site_id, 'subQuery')){
      statement <- paste0(statement, ' care_site_id = (', as.character(care_site_id), ')')
    } else {
      statement <- paste0(statement, " care_site_id = '", care_site_id,"'")
    }
  }

  if (!missing(care_site_name)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(care_site_name)) {
      statement <- paste0(statement, ' care_site_name IS NULL')
    } else if (is(care_site_name, 'subQuery')){
      statement <- paste0(statement, ' care_site_name = (', as.character(care_site_name), ')')
    } else {
      statement <- paste0(statement, " care_site_name = '", care_site_name,"'")
    }
  }

  if (!missing(place_of_service_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(place_of_service_concept_id)) {
      statement <- paste0(statement, ' place_of_service_concept_id IS NULL')
    } else if (is(place_of_service_concept_id, 'subQuery')){
      statement <- paste0(statement, ' place_of_service_concept_id = (', as.character(place_of_service_concept_id), ')')
    } else {
      statement <- paste0(statement, " place_of_service_concept_id = '", place_of_service_concept_id,"'")
    }
  }

  if (!missing(location_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(location_id)) {
      statement <- paste0(statement, ' location_id IS NULL')
    } else if (is(location_id, 'subQuery')){
      statement <- paste0(statement, ' location_id = (', as.character(location_id), ')')
    } else {
      statement <- paste0(statement, " location_id = '", location_id,"'")
    }
  }

  if (!missing(care_site_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(care_site_source_value)) {
      statement <- paste0(statement, ' care_site_source_value IS NULL')
    } else if (is(care_site_source_value, 'subQuery')){
      statement <- paste0(statement, ' care_site_source_value = (', as.character(care_site_source_value), ')')
    } else {
      statement <- paste0(statement, " care_site_source_value = '", care_site_source_value,"'")
    }
  }

  if (!missing(place_of_service_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(place_of_service_source_value)) {
      statement <- paste0(statement, ' place_of_service_source_value IS NULL')
    } else if (is(place_of_service_source_value, 'subQuery')){
      statement <- paste0(statement, ' place_of_service_source_value = (', as.character(place_of_service_source_value), ')')
    } else {
      statement <- paste0(statement, " place_of_service_source_value = '", place_of_service_source_value,"'")
    }
  }

  class(statement) <- 'subQuery'
  return(statement)
}

lookup_location <- function(fetchField, location_id, address_1, address_2, city, state, zip, county, location_source_value) {
  statement <- paste0('SELECT ', fetchField , ' FROM location WHERE')
  first <- TRUE
  if (!missing(location_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(location_id)) {
      statement <- paste0(statement, ' location_id IS NULL')
    } else if (is(location_id, 'subQuery')){
      statement <- paste0(statement, ' location_id = (', as.character(location_id), ')')
    } else {
      statement <- paste0(statement, " location_id = '", location_id,"'")
    }
  }

  if (!missing(address_1)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(address_1)) {
      statement <- paste0(statement, ' address_1 IS NULL')
    } else if (is(address_1, 'subQuery')){
      statement <- paste0(statement, ' address_1 = (', as.character(address_1), ')')
    } else {
      statement <- paste0(statement, " address_1 = '", address_1,"'")
    }
  }

  if (!missing(address_2)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(address_2)) {
      statement <- paste0(statement, ' address_2 IS NULL')
    } else if (is(address_2, 'subQuery')){
      statement <- paste0(statement, ' address_2 = (', as.character(address_2), ')')
    } else {
      statement <- paste0(statement, " address_2 = '", address_2,"'")
    }
  }

  if (!missing(city)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(city)) {
      statement <- paste0(statement, ' city IS NULL')
    } else if (is(city, 'subQuery')){
      statement <- paste0(statement, ' city = (', as.character(city), ')')
    } else {
      statement <- paste0(statement, " city = '", city,"'")
    }
  }

  if (!missing(state)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(state)) {
      statement <- paste0(statement, ' state IS NULL')
    } else if (is(state, 'subQuery')){
      statement <- paste0(statement, ' state = (', as.character(state), ')')
    } else {
      statement <- paste0(statement, " state = '", state,"'")
    }
  }

  if (!missing(zip)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(zip)) {
      statement <- paste0(statement, ' zip IS NULL')
    } else if (is(zip, 'subQuery')){
      statement <- paste0(statement, ' zip = (', as.character(zip), ')')
    } else {
      statement <- paste0(statement, " zip = '", zip,"'")
    }
  }

  if (!missing(county)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(county)) {
      statement <- paste0(statement, ' county IS NULL')
    } else if (is(county, 'subQuery')){
      statement <- paste0(statement, ' county = (', as.character(county), ')')
    } else {
      statement <- paste0(statement, " county = '", county,"'")
    }
  }

  if (!missing(location_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(location_source_value)) {
      statement <- paste0(statement, ' location_source_value IS NULL')
    } else if (is(location_source_value, 'subQuery')){
      statement <- paste0(statement, ' location_source_value = (', as.character(location_source_value), ')')
    } else {
      statement <- paste0(statement, " location_source_value = '", location_source_value,"'")
    }
  }

  class(statement) <- 'subQuery'
  return(statement)
}

lookup_provider <- function(fetchField, provider_id, provider_name, npi, dea, specialty_concept_id, care_site_id, year_of_birth, gender_concept_id, provider_source_value, specialty_source_value, specialty_source_concept_id, gender_source_value, gender_source_concept_id) {
  statement <- paste0('SELECT ', fetchField , ' FROM provider WHERE')
  first <- TRUE
  if (!missing(provider_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_id)) {
      statement <- paste0(statement, ' provider_id IS NULL')
    } else if (is(provider_id, 'subQuery')){
      statement <- paste0(statement, ' provider_id = (', as.character(provider_id), ')')
    } else {
      statement <- paste0(statement, " provider_id = '", provider_id,"'")
    }
  }

  if (!missing(provider_name)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_name)) {
      statement <- paste0(statement, ' provider_name IS NULL')
    } else if (is(provider_name, 'subQuery')){
      statement <- paste0(statement, ' provider_name = (', as.character(provider_name), ')')
    } else {
      statement <- paste0(statement, " provider_name = '", provider_name,"'")
    }
  }

  if (!missing(npi)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(npi)) {
      statement <- paste0(statement, ' npi IS NULL')
    } else if (is(npi, 'subQuery')){
      statement <- paste0(statement, ' npi = (', as.character(npi), ')')
    } else {
      statement <- paste0(statement, " npi = '", npi,"'")
    }
  }

  if (!missing(dea)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(dea)) {
      statement <- paste0(statement, ' dea IS NULL')
    } else if (is(dea, 'subQuery')){
      statement <- paste0(statement, ' dea = (', as.character(dea), ')')
    } else {
      statement <- paste0(statement, " dea = '", dea,"'")
    }
  }

  if (!missing(specialty_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(specialty_concept_id)) {
      statement <- paste0(statement, ' specialty_concept_id IS NULL')
    } else if (is(specialty_concept_id, 'subQuery')){
      statement <- paste0(statement, ' specialty_concept_id = (', as.character(specialty_concept_id), ')')
    } else {
      statement <- paste0(statement, " specialty_concept_id = '", specialty_concept_id,"'")
    }
  }

  if (!missing(care_site_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(care_site_id)) {
      statement <- paste0(statement, ' care_site_id IS NULL')
    } else if (is(care_site_id, 'subQuery')){
      statement <- paste0(statement, ' care_site_id = (', as.character(care_site_id), ')')
    } else {
      statement <- paste0(statement, " care_site_id = '", care_site_id,"'")
    }
  }

  if (!missing(year_of_birth)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(year_of_birth)) {
      statement <- paste0(statement, ' year_of_birth IS NULL')
    } else if (is(year_of_birth, 'subQuery')){
      statement <- paste0(statement, ' year_of_birth = (', as.character(year_of_birth), ')')
    } else {
      statement <- paste0(statement, " year_of_birth = '", year_of_birth,"'")
    }
  }

  if (!missing(gender_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(gender_concept_id)) {
      statement <- paste0(statement, ' gender_concept_id IS NULL')
    } else if (is(gender_concept_id, 'subQuery')){
      statement <- paste0(statement, ' gender_concept_id = (', as.character(gender_concept_id), ')')
    } else {
      statement <- paste0(statement, " gender_concept_id = '", gender_concept_id,"'")
    }
  }

  if (!missing(provider_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(provider_source_value)) {
      statement <- paste0(statement, ' provider_source_value IS NULL')
    } else if (is(provider_source_value, 'subQuery')){
      statement <- paste0(statement, ' provider_source_value = (', as.character(provider_source_value), ')')
    } else {
      statement <- paste0(statement, " provider_source_value = '", provider_source_value,"'")
    }
  }

  if (!missing(specialty_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(specialty_source_value)) {
      statement <- paste0(statement, ' specialty_source_value IS NULL')
    } else if (is(specialty_source_value, 'subQuery')){
      statement <- paste0(statement, ' specialty_source_value = (', as.character(specialty_source_value), ')')
    } else {
      statement <- paste0(statement, " specialty_source_value = '", specialty_source_value,"'")
    }
  }

  if (!missing(specialty_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(specialty_source_concept_id)) {
      statement <- paste0(statement, ' specialty_source_concept_id IS NULL')
    } else if (is(specialty_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' specialty_source_concept_id = (', as.character(specialty_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " specialty_source_concept_id = '", specialty_source_concept_id,"'")
    }
  }

  if (!missing(gender_source_value)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(gender_source_value)) {
      statement <- paste0(statement, ' gender_source_value IS NULL')
    } else if (is(gender_source_value, 'subQuery')){
      statement <- paste0(statement, ' gender_source_value = (', as.character(gender_source_value), ')')
    } else {
      statement <- paste0(statement, " gender_source_value = '", gender_source_value,"'")
    }
  }

  if (!missing(gender_source_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(gender_source_concept_id)) {
      statement <- paste0(statement, ' gender_source_concept_id IS NULL')
    } else if (is(gender_source_concept_id, 'subQuery')){
      statement <- paste0(statement, ' gender_source_concept_id = (', as.character(gender_source_concept_id), ')')
    } else {
      statement <- paste0(statement, " gender_source_concept_id = '", gender_source_concept_id,"'")
    }
  }

  class(statement) <- 'subQuery'
  return(statement)
}

lookup_cdm_source <- function(fetchField, cdm_source_name, cdm_source_abbreviation, cdm_holder, source_description, source_documentation_reference, cdm_etl__reference, source_release_date, cdm_release_date, cdm_version, vocabulary_version) {
  statement <- paste0('SELECT ', fetchField , ' FROM cdm_source WHERE')
  first <- TRUE
  if (!missing(cdm_source_name)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cdm_source_name)) {
      statement <- paste0(statement, ' cdm_source_name IS NULL')
    } else if (is(cdm_source_name, 'subQuery')){
      statement <- paste0(statement, ' cdm_source_name = (', as.character(cdm_source_name), ')')
    } else {
      statement <- paste0(statement, " cdm_source_name = '", cdm_source_name,"'")
    }
  }

  if (!missing(cdm_source_abbreviation)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cdm_source_abbreviation)) {
      statement <- paste0(statement, ' cdm_source_abbreviation IS NULL')
    } else if (is(cdm_source_abbreviation, 'subQuery')){
      statement <- paste0(statement, ' cdm_source_abbreviation = (', as.character(cdm_source_abbreviation), ')')
    } else {
      statement <- paste0(statement, " cdm_source_abbreviation = '", cdm_source_abbreviation,"'")
    }
  }

  if (!missing(cdm_holder)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cdm_holder)) {
      statement <- paste0(statement, ' cdm_holder IS NULL')
    } else if (is(cdm_holder, 'subQuery')){
      statement <- paste0(statement, ' cdm_holder = (', as.character(cdm_holder), ')')
    } else {
      statement <- paste0(statement, " cdm_holder = '", cdm_holder,"'")
    }
  }

  if (!missing(source_description)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(source_description)) {
      statement <- paste0(statement, ' source_description IS NULL')
    } else if (is(source_description, 'subQuery')){
      statement <- paste0(statement, ' source_description = (', as.character(source_description), ')')
    } else {
      statement <- paste0(statement, " source_description = '", source_description,"'")
    }
  }

  if (!missing(source_documentation_reference)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(source_documentation_reference)) {
      statement <- paste0(statement, ' source_documentation_reference IS NULL')
    } else if (is(source_documentation_reference, 'subQuery')){
      statement <- paste0(statement, ' source_documentation_reference = (', as.character(source_documentation_reference), ')')
    } else {
      statement <- paste0(statement, " source_documentation_reference = '", source_documentation_reference,"'")
    }
  }

  if (!missing(cdm_etl__reference)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cdm_etl__reference)) {
      statement <- paste0(statement, ' [cdm_etl _reference] IS NULL')
    } else if (is(cdm_etl__reference, 'subQuery')){
      statement <- paste0(statement, ' [cdm_etl _reference] = (', as.character(cdm_etl__reference), ')')
    } else {
      statement <- paste0(statement, " [cdm_etl _reference] = '", cdm_etl__reference,"'")
    }
  }

  if (!missing(source_release_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(source_release_date)) {
      statement <- paste0(statement, ' source_release_date IS NULL')
    } else if (is(source_release_date, 'subQuery')){
      statement <- paste0(statement, ' source_release_date = (', as.character(source_release_date), ')')
    } else {
      statement <- paste0(statement, " source_release_date = '", source_release_date,"'")
    }
  }

  if (!missing(cdm_release_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cdm_release_date)) {
      statement <- paste0(statement, ' cdm_release_date IS NULL')
    } else if (is(cdm_release_date, 'subQuery')){
      statement <- paste0(statement, ' cdm_release_date = (', as.character(cdm_release_date), ')')
    } else {
      statement <- paste0(statement, " cdm_release_date = '", cdm_release_date,"'")
    }
  }

  if (!missing(cdm_version)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cdm_version)) {
      statement <- paste0(statement, ' cdm_version IS NULL')
    } else if (is(cdm_version, 'subQuery')){
      statement <- paste0(statement, ' cdm_version = (', as.character(cdm_version), ')')
    } else {
      statement <- paste0(statement, " cdm_version = '", cdm_version,"'")
    }
  }

  if (!missing(vocabulary_version)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(vocabulary_version)) {
      statement <- paste0(statement, ' vocabulary_version IS NULL')
    } else if (is(vocabulary_version, 'subQuery')){
      statement <- paste0(statement, ' vocabulary_version = (', as.character(vocabulary_version), ')')
    } else {
      statement <- paste0(statement, " vocabulary_version = '", vocabulary_version,"'")
    }
  }

  class(statement) <- 'subQuery'
  return(statement)
}

lookup_attribute_definition <- function(fetchField, attribute_definition_id, attribute_name, attribute_description, attribute_type_concept_id, attribute_syntax) {
  statement <- paste0('SELECT ', fetchField , ' FROM attribute_definition WHERE')
  first <- TRUE
  if (!missing(attribute_definition_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(attribute_definition_id)) {
      statement <- paste0(statement, ' attribute_definition_id IS NULL')
    } else if (is(attribute_definition_id, 'subQuery')){
      statement <- paste0(statement, ' attribute_definition_id = (', as.character(attribute_definition_id), ')')
    } else {
      statement <- paste0(statement, " attribute_definition_id = '", attribute_definition_id,"'")
    }
  }

  if (!missing(attribute_name)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(attribute_name)) {
      statement <- paste0(statement, ' attribute_name IS NULL')
    } else if (is(attribute_name, 'subQuery')){
      statement <- paste0(statement, ' attribute_name = (', as.character(attribute_name), ')')
    } else {
      statement <- paste0(statement, " attribute_name = '", attribute_name,"'")
    }
  }

  if (!missing(attribute_description)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(attribute_description)) {
      statement <- paste0(statement, ' attribute_description IS NULL')
    } else if (is(attribute_description, 'subQuery')){
      statement <- paste0(statement, ' attribute_description = (', as.character(attribute_description), ')')
    } else {
      statement <- paste0(statement, " attribute_description = '", attribute_description,"'")
    }
  }

  if (!missing(attribute_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(attribute_type_concept_id)) {
      statement <- paste0(statement, ' attribute_type_concept_id IS NULL')
    } else if (is(attribute_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' attribute_type_concept_id = (', as.character(attribute_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " attribute_type_concept_id = '", attribute_type_concept_id,"'")
    }
  }

  if (!missing(attribute_syntax)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(attribute_syntax)) {
      statement <- paste0(statement, ' attribute_syntax IS NULL')
    } else if (is(attribute_syntax, 'subQuery')){
      statement <- paste0(statement, ' attribute_syntax = (', as.character(attribute_syntax), ')')
    } else {
      statement <- paste0(statement, " attribute_syntax = '", attribute_syntax,"'")
    }
  }

  class(statement) <- 'subQuery'
  return(statement)
}

lookup_cohort_definition <- function(fetchField, cohort_definition_id, cohort_definition_name, cohort_definition_description, definition_type_concept_id, cohort_definition_syntax, subject_concept_id, cohort_instantiation_date) {
  statement <- paste0('SELECT ', fetchField , ' FROM cohort_definition WHERE')
  first <- TRUE
  if (!missing(cohort_definition_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cohort_definition_id)) {
      statement <- paste0(statement, ' cohort_definition_id IS NULL')
    } else if (is(cohort_definition_id, 'subQuery')){
      statement <- paste0(statement, ' cohort_definition_id = (', as.character(cohort_definition_id), ')')
    } else {
      statement <- paste0(statement, " cohort_definition_id = '", cohort_definition_id,"'")
    }
  }

  if (!missing(cohort_definition_name)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cohort_definition_name)) {
      statement <- paste0(statement, ' cohort_definition_name IS NULL')
    } else if (is(cohort_definition_name, 'subQuery')){
      statement <- paste0(statement, ' cohort_definition_name = (', as.character(cohort_definition_name), ')')
    } else {
      statement <- paste0(statement, " cohort_definition_name = '", cohort_definition_name,"'")
    }
  }

  if (!missing(cohort_definition_description)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cohort_definition_description)) {
      statement <- paste0(statement, ' cohort_definition_description IS NULL')
    } else if (is(cohort_definition_description, 'subQuery')){
      statement <- paste0(statement, ' cohort_definition_description = (', as.character(cohort_definition_description), ')')
    } else {
      statement <- paste0(statement, " cohort_definition_description = '", cohort_definition_description,"'")
    }
  }

  if (!missing(definition_type_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(definition_type_concept_id)) {
      statement <- paste0(statement, ' definition_type_concept_id IS NULL')
    } else if (is(definition_type_concept_id, 'subQuery')){
      statement <- paste0(statement, ' definition_type_concept_id = (', as.character(definition_type_concept_id), ')')
    } else {
      statement <- paste0(statement, " definition_type_concept_id = '", definition_type_concept_id,"'")
    }
  }

  if (!missing(cohort_definition_syntax)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cohort_definition_syntax)) {
      statement <- paste0(statement, ' cohort_definition_syntax IS NULL')
    } else if (is(cohort_definition_syntax, 'subQuery')){
      statement <- paste0(statement, ' cohort_definition_syntax = (', as.character(cohort_definition_syntax), ')')
    } else {
      statement <- paste0(statement, " cohort_definition_syntax = '", cohort_definition_syntax,"'")
    }
  }

  if (!missing(subject_concept_id)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(subject_concept_id)) {
      statement <- paste0(statement, ' subject_concept_id IS NULL')
    } else if (is(subject_concept_id, 'subQuery')){
      statement <- paste0(statement, ' subject_concept_id = (', as.character(subject_concept_id), ')')
    } else {
      statement <- paste0(statement, " subject_concept_id = '", subject_concept_id,"'")
    }
  }

  if (!missing(cohort_instantiation_date)) {
    if (first) {
      first <- FALSE
    } else {
      statement <- paste0(statement, ' AND')
    }
    if (is.null(cohort_instantiation_date)) {
      statement <- paste0(statement, ' cohort_instantiation_date IS NULL')
    } else if (is(cohort_instantiation_date, 'subQuery')){
      statement <- paste0(statement, ' cohort_instantiation_date = (', as.character(cohort_instantiation_date), ')')
    } else {
      statement <- paste0(statement, " cohort_instantiation_date = '", cohort_instantiation_date,"'")
    }
  }

  class(statement) <- 'subQuery'
  return(statement)
}

